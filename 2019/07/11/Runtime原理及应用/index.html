<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.2.0',
    sidebar: {"position":"left","display":"always","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Runtimeä»‹ç»é«˜çº§ç¼–ç¨‹è¯­è¨€æƒ³è¦æˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶éœ€å…ˆç¼–è¯‘ä¸ºæ±‡ç¼–è¯­è¨€å†æ±‡ç¼–ä¸ºæœºå™¨è¯­è¨€ï¼Œæœºå™¨è¯­è¨€ä¹Ÿæ˜¯è®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«çš„å”¯ä¸€è¯­è¨€ï¼Œä½†æ˜¯OCå¹¶ä¸èƒ½ç›´æ¥ç¼–è¯‘ä¸ºæ±‡ç¼–è¯­è¨€ï¼Œè€Œæ˜¯è¦å…ˆè½¬å†™ä¸ºçº¯cè¯­è¨€å†è¿›è¡Œç¼–è¯‘å’Œæ±‡ç¼–æ“ä½œï¼Œä»OCåˆ°Cè¯­è¨€çš„è¿‡æ¸¡å°±æ˜¯runtimeæ¥å®ç°çš„ã€‚ç„¶è€Œæˆ‘ä»¬ä½¿ç”¨OCè¿›è¡Œé¢å‘å¯¹è±¡å¼€å‘ï¼Œè€ŒCè¯­è¨€æ›´å¤šçš„æ˜¯é¢å‘è¿‡ç¨‹å¼€å‘ï¼Œè¿™å°±éœ€è¦å°†é¢å‘å¯¹è±¡çš„ç±»è½¬å˜ä¸ºé¢å‘è¿‡ç¨‹çš„ç»“æ„ä½“ã€‚">
<meta name="keywords" content="iOS">
<meta property="og:type" content="article">
<meta property="og:title" content="RuntimeåŸç†åŠåº”ç”¨">
<meta property="og:url" content="http://yoursite.com/2019/07/11/RuntimeåŸç†åŠåº”ç”¨/index.html">
<meta property="og:site_name" content="PerryWangğŸåšå®¢">
<meta property="og:description" content="Runtimeä»‹ç»é«˜çº§ç¼–ç¨‹è¯­è¨€æƒ³è¦æˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶éœ€å…ˆç¼–è¯‘ä¸ºæ±‡ç¼–è¯­è¨€å†æ±‡ç¼–ä¸ºæœºå™¨è¯­è¨€ï¼Œæœºå™¨è¯­è¨€ä¹Ÿæ˜¯è®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«çš„å”¯ä¸€è¯­è¨€ï¼Œä½†æ˜¯OCå¹¶ä¸èƒ½ç›´æ¥ç¼–è¯‘ä¸ºæ±‡ç¼–è¯­è¨€ï¼Œè€Œæ˜¯è¦å…ˆè½¬å†™ä¸ºçº¯cè¯­è¨€å†è¿›è¡Œç¼–è¯‘å’Œæ±‡ç¼–æ“ä½œï¼Œä»OCåˆ°Cè¯­è¨€çš„è¿‡æ¸¡å°±æ˜¯runtimeæ¥å®ç°çš„ã€‚ç„¶è€Œæˆ‘ä»¬ä½¿ç”¨OCè¿›è¡Œé¢å‘å¯¹è±¡å¼€å‘ï¼Œè€ŒCè¯­è¨€æ›´å¤šçš„æ˜¯é¢å‘è¿‡ç¨‹å¼€å‘ï¼Œè¿™å°±éœ€è¦å°†é¢å‘å¯¹è±¡çš„ç±»è½¬å˜ä¸ºé¢å‘è¿‡ç¨‹çš„ç»“æ„ä½“ã€‚">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-07-10T16:23:03.471Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RuntimeåŸç†åŠåº”ç”¨">
<meta name="twitter:description" content="Runtimeä»‹ç»é«˜çº§ç¼–ç¨‹è¯­è¨€æƒ³è¦æˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶éœ€å…ˆç¼–è¯‘ä¸ºæ±‡ç¼–è¯­è¨€å†æ±‡ç¼–ä¸ºæœºå™¨è¯­è¨€ï¼Œæœºå™¨è¯­è¨€ä¹Ÿæ˜¯è®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«çš„å”¯ä¸€è¯­è¨€ï¼Œä½†æ˜¯OCå¹¶ä¸èƒ½ç›´æ¥ç¼–è¯‘ä¸ºæ±‡ç¼–è¯­è¨€ï¼Œè€Œæ˜¯è¦å…ˆè½¬å†™ä¸ºçº¯cè¯­è¨€å†è¿›è¡Œç¼–è¯‘å’Œæ±‡ç¼–æ“ä½œï¼Œä»OCåˆ°Cè¯­è¨€çš„è¿‡æ¸¡å°±æ˜¯runtimeæ¥å®ç°çš„ã€‚ç„¶è€Œæˆ‘ä»¬ä½¿ç”¨OCè¿›è¡Œé¢å‘å¯¹è±¡å¼€å‘ï¼Œè€ŒCè¯­è¨€æ›´å¤šçš„æ˜¯é¢å‘è¿‡ç¨‹å¼€å‘ï¼Œè¿™å°±éœ€è¦å°†é¢å‘å¯¹è±¡çš„ç±»è½¬å˜ä¸ºé¢å‘è¿‡ç¨‹çš„ç»“æ„ä½“ã€‚">



  <link rel="alternate" href="/atom.xml" title="PerryWangğŸåšå®¢" type="application/atom+xml">



  
  
  <link rel="canonical" href="http://yoursite.com/2019/07/11/RuntimeåŸç†åŠåº”ç”¨/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>RuntimeåŸç†åŠåº”ç”¨ | PerryWangğŸåšå®¢</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">PerryWangğŸåšå®¢</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">åˆ†äº«è½¯ä»¶å¼€å‘ä¸­å­¦åˆ°çš„ç‚¹æ»´çŸ¥è¯†</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>é¦–é¡µ</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>å…³äº</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>æ ‡ç­¾</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>åˆ†ç±»</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>å½’æ¡£</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    
  
  

  

  <a href="https://github.com/WangPerryWPY" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/11/RuntimeåŸç†åŠåº”ç”¨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PerryWang">
      <meta itemprop="description" content="sysu-student">
      <meta itemprop="image" content="/images/å¤´åƒ.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PerryWangğŸåšå®¢">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">RuntimeåŸç†åŠåº”ç”¨

              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-07-11 00:22:09 / ä¿®æ”¹æ—¶é—´ï¼š00:23:03" itemprop="dateCreated datePublished" datetime="2019-07-11T00:22:09+08:00">2019-07-11</time>
            </span>
          

          
            

            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">è¯„è®ºæ•°ï¼š</span>
                <a href="/2019/07/11/RuntimeåŸç†åŠåº”ç”¨/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/07/11/RuntimeåŸç†åŠåº”ç”¨/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
                 é˜…è¯»æ¬¡æ•°ï¼š 
                <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
              </span>
            </span>
          

          <br>
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              
              <span title="æœ¬æ–‡å­—æ•°">16k</span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="Runtimeä»‹ç»"><a href="#Runtimeä»‹ç»" class="headerlink" title="Runtimeä»‹ç»"></a>Runtimeä»‹ç»</h3><p>é«˜çº§ç¼–ç¨‹è¯­è¨€æƒ³è¦æˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶éœ€å…ˆç¼–è¯‘ä¸ºæ±‡ç¼–è¯­è¨€å†æ±‡ç¼–ä¸ºæœºå™¨è¯­è¨€ï¼Œæœºå™¨è¯­è¨€ä¹Ÿæ˜¯è®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«çš„å”¯ä¸€è¯­è¨€ï¼Œä½†æ˜¯OCå¹¶ä¸èƒ½ç›´æ¥ç¼–è¯‘ä¸ºæ±‡ç¼–è¯­è¨€ï¼Œè€Œæ˜¯è¦å…ˆè½¬å†™ä¸ºçº¯cè¯­è¨€å†è¿›è¡Œç¼–è¯‘å’Œæ±‡ç¼–æ“ä½œï¼Œä»OCåˆ°Cè¯­è¨€çš„è¿‡æ¸¡å°±æ˜¯runtimeæ¥å®ç°çš„ã€‚ç„¶è€Œæˆ‘ä»¬ä½¿ç”¨OCè¿›è¡Œé¢å‘å¯¹è±¡å¼€å‘ï¼Œè€ŒCè¯­è¨€æ›´å¤šçš„æ˜¯é¢å‘è¿‡ç¨‹å¼€å‘ï¼Œè¿™å°±éœ€è¦å°†é¢å‘å¯¹è±¡çš„ç±»è½¬å˜ä¸ºé¢å‘è¿‡ç¨‹çš„ç»“æ„ä½“ã€‚</p>
<a id="more"></a>

<h3 id="Runtimeæ¶ˆæ¯ä¼ é€’"><a href="#Runtimeæ¶ˆæ¯ä¼ é€’" class="headerlink" title="Runtimeæ¶ˆæ¯ä¼ é€’"></a>Runtimeæ¶ˆæ¯ä¼ é€’</h3><p>ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•åƒè¿™æ ·[obj foo]ï¼Œç¼–è¯‘å™¨è½¬æˆæ¶ˆæ¯å‘é€<code>objc_msgSend(obj, foo)</code>, Runtimeæ—¶æ‰§è¡Œçš„æµç¨‹æ˜¯è¿™æ ·çš„ã€‚</p>
<ul>
<li>é¦–å…ˆï¼Œé€šè¿‡<code>obj</code>çš„<code>isa</code>æŒ‡é’ˆæ‰¾åˆ°å®ƒçš„<code>class</code>;</li>
<li>åœ¨<code>class</code>çš„<code>method List</code>æ‰¾fooï¼›</li>
<li>å¦‚æœ<code>class</code>ä¸­æ²¡æœ‰fooï¼Œå°±ç»§ç»­å‰å¾€å®ƒçš„<code>superclass</code>ä¸­å»æŸ¥æ‰¾;</li>
<li>ä¸€æ—¦æ‰¾åˆ°fooè¿™ä¸ªå‡½æ•°ï¼Œå°±å»æ‰§è¡Œå®ƒçš„å®ç°IMPã€‚</li>
</ul>
<p>ä½†æ˜¯è¿™ç§å®ç°æœ‰ä¸ªé—®é¢˜ï¼Œæ•ˆç‡ä½ã€‚ä¸€ä¸ªClass å¾€å¾€åªæœ‰20%çš„å‡½æ•°ä¼šè¢«ç»å¸¸è°ƒç”¨ï¼Œå¯èƒ½å æ€»è°ƒç”¨æ¬¡æ•°çš„80%ã€‚æ¯æ¬¡æ¶ˆæ¯éƒ½éœ€è¦éå†ä¸€æ¬¡<code>objc_method_list</code> å¹¶ä¸åˆç†ã€‚å¦‚æœæŠŠç»å¸¸è¢«è°ƒç”¨çš„å‡½æ•°ç¼“å­˜ä¸‹æ¥ï¼Œé‚£å¯ä»¥å¤§å¤§æé«˜å‡½æ•°æŸ¥è¯¢çš„æ•ˆç‡ã€‚è¿™å°±æ˜¯<code>objc_class</code>ä¸­å¦ä¸€ä¸ªé‡è¦æˆå‘˜<code>objc_cache</code>åšçš„äº‹æƒ…ï¼Œå†æ‰¾åˆ°fooä¹‹åï¼ŒæŠŠfooçš„methed_nameä½œä¸ºkeyï¼Œmethod_impä½œä¸ºvalueç¼“å­˜èµ·æ¥ã€‚å½“å†æ¬¡æ”¶åˆ°fooæ¶ˆæ¯çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥åœ¨cacheé‡Œæ‰¾åˆ°ï¼Œé¿å…å»éå†objc_method_listã€‚</p>
<p><strong>objc_msgSendçš„æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">OBJC_EXPORT id <span class="title">objc_msgSend</span><span class="params">(id self, SEL op, ...)</span></span></span><br></pre></td></tr></table></figure>

<p>é‚£æ¶ˆæ¯ä¼ é€’æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿæˆ‘ä»¬çœ‹çœ‹å¯¹è±¡(object)ï¼Œç±»(class)ï¼Œæ–¹æ³•(method)è¿™å‡ ä¸ªçš„ç»“æ„ä½“ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯¹è±¡</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_object</span> &#123;</span></span><br><span class="line">    Class isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_class</span> &#123;</span></span><br><span class="line">    Class isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !__OBJC2__</span></span><br><span class="line">    Class super_class                                        OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name                                         OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> version                                             OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> info                                                OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> instance_size                                       OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_ivar_list</span> *<span class="title">ivars</span>                             <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_method_list</span> **<span class="title">methodLists</span>                    <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_cache</span> *<span class="title">cache</span>                                 <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_protocol_list</span> *<span class="title">protocols</span>                     <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125; OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="comment">//æ–¹æ³•åˆ—è¡¨</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_method_list</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_method_list</span> *<span class="title">obsolete</span>                        <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line">    <span class="keyword">int</span> method_count                                         OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __LP64__</span></span><br><span class="line">    <span class="keyword">int</span> space                                                OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">/* variable length structure */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_method</span> <span class="title">method_list</span>[1]                        <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line">&#125;                                                            OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="comment">//æ–¹æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_method</span> &#123;</span></span><br><span class="line">    SEL method_name                                          OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">char</span> *method_types                                       OBJC2_UNAVAILABLE;</span><br><span class="line">    IMP method_imp                                           OBJC2_UNAVAILABLE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>ç³»ç»Ÿé¦–å…ˆæ‰¾åˆ°æ¶ˆæ¯çš„æ¥å—å¯¹è±¡ï¼Œç„¶åé€šè¿‡å¯¹è±¡çš„isaæ‰¾åˆ°å®ƒçš„ç±»ã€‚</li>
<li>åœ¨å®ƒçš„ç±»ä¸­æŸ¥æ‰¾<code>method_list</code>ï¼Œæ˜¯å¦æœ‰<code>selector</code>æ–¹æ³•ã€‚</li>
<li>æ²¡æœ‰åˆ™æŸ¥æ‰¾çˆ¶ç±»çš„<code>method_list</code></li>
<li>æ‰¾åˆ°å¯¹åº”çš„<code>method</code>ï¼Œæ‰§è¡Œå®ƒçš„IMP</li>
<li>è½¬å‘IMPçš„returnå€¼ã€‚</li>
</ol>
<h4 id="æ¶ˆæ¯ä¼ é€’ä¸­çš„æ¦‚å¿µï¼š"><a href="#æ¶ˆæ¯ä¼ é€’ä¸­çš„æ¦‚å¿µï¼š" class="headerlink" title="æ¶ˆæ¯ä¼ é€’ä¸­çš„æ¦‚å¿µï¼š"></a>æ¶ˆæ¯ä¼ é€’ä¸­çš„æ¦‚å¿µï¼š</h4><h5 id="ç±»å¯¹è±¡-objc-class"><a href="#ç±»å¯¹è±¡-objc-class" class="headerlink" title="ç±»å¯¹è±¡(objc_class)"></a>ç±»å¯¹è±¡(objc_class)</h5><p>ocç±»æ˜¯ç”±Classç±»å‹è¡¨ç¤ºçš„ï¼Œå®ƒå®é™…ä¸Šä¸€ä¸ªæŒ‡å‘<code>objc_class</code>ç»“æ„ä½“çš„æŒ‡é’ˆã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">objc_class</span> *<span class="title">Class</span>;</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹<code>objc/runtime.h</code>ä¸­<code>objc_class</code>ç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_class</span> &#123;</span></span><br><span class="line">    Class _Nonnull isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !__OBJC2__</span></span><br><span class="line">    Class _Nullable super_class                              OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> * _Nonnull name                               OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> version                                             OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> info                                                OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> instance_size                                       OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_ivar_list</span> * _<span class="title">Nullable</span> <span class="title">ivars</span>                  <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_method_list</span> * _<span class="title">Nullable</span> * _<span class="title">Nullable</span> <span class="title">methodLists</span>                    <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_cache</span> * _<span class="title">Nonnull</span> <span class="title">cache</span>                       <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_protocol_list</span> * _<span class="title">Nullable</span> <span class="title">protocols</span>          <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">&#125; OBJC2_UNAVAILABLE;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºç±»å¯¹è±¡å°±æ˜¯ä¸€ä¸ªç»“æ„ä½“<code>struct objc_class</code>ï¼Œè¿™ä¸ªç»“æ„ä½“å­˜æ”¾çš„æ•°æ®ç§°ä¸ºå…ƒæ•°æ®(metadata)ï¼Œè¯¥ç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡ä¹Ÿæ˜¯isaæŒ‡é’ˆï¼Œè¿™å°±è¯´æ˜äº†<code>Class</code>æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç±»å¯¹è±¡ï¼Œç±»å¯¹è±¡åœ¨ç¼–è¯‘æœŸäº§ç”Ÿç”¨äºåˆ›å»ºå®ä¾‹å¯¹è±¡ï¼Œæ˜¯å•ä¾‹ã€‚</p>
<h5 id="å®ä¾‹-objc-object"><a href="#å®ä¾‹-objc-object" class="headerlink" title="å®ä¾‹(objc_object)"></a>å®ä¾‹(objc_object)</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Represents an instance of a class.</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_object</span> &#123;</span></span><br><span class="line">    Class isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// A pointer to an instance of a class.</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">objc_object</span> *<span class="title">id</span>;</span></span><br></pre></td></tr></table></figure>

<p>ç±»å¯¹è±¡ä¸­çš„å…ƒæ•°æ®å­˜å‚¨çš„éƒ½æ˜¯å¦‚ä½•åˆ›å»ºä¸€ä¸ªå®ä¾‹çš„ç›¸å…³ä¿¡æ¯ï¼Œé‚£ä¹ˆç±»å¯¹è±¡å’Œç±»æ–¹æ³•åº”è¯¥ä»å“ªé‡Œåˆ›å»ºå‘¢ï¼Ÿ</p>
<p>å°±æ˜¯ä»isaæŒ‡é’ˆæŒ‡å‘çš„ç»“æ„ä½“åˆ›å»ºï¼Œç±»å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘çš„æˆ‘ä»¬ç§°ä¹‹ä¸ºå…ƒç±»(metaclass)ã€‚</p>
<p>å…ƒç±»ä¸­ä¿å­˜äº†åˆ›å»ºç±»å¯¹è±¡ä»¥åŠç±»æ–¹æ³•æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
<h5 id="å…ƒç±»-Meta-Class"><a href="#å…ƒç±»-Meta-Class" class="headerlink" title="å…ƒç±»(Meta Class)"></a>å…ƒç±»(Meta Class)</h5><p>æ•´ä¸ªç³»ç»Ÿå½¢æˆäº†ä¸€ä¸ªè‡ªé—­ç¯ï¼Œstruct objc_object ç»“æ„ä½“å®ä¾‹çš„isaæŒ‡é’ˆæŒ‡å‘ç±»å¯¹è±¡ã€‚</p>
<p>ç±»å¯¹è±¡çš„ isa æŒ‡é’ˆæŒ‡å‘å…ƒç±»ï¼Œsuper_class æŒ‡é’ˆæŒ‡å‘çˆ¶ç±»çš„ç±»å¯¹è±¡ã€‚</p>
<p>å…ƒç±»çš„ super_class æŒ‡é’ˆæŒ‡å‘çˆ¶ç±»çš„å…ƒç±»ï¼Œè€Œå…ƒç±»çš„isaæŒ‡é’ˆåˆæŒ‡å‘äº†è‡ªå·±ã€‚</p>
<p>å…ƒç±»(Meta Class)æ˜¯ä¸€ä¸ªç±»å¯¹è±¡çš„ç±»ã€‚è€Œæ‰€æœ‰çš„ç±»è‡ªèº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å‘è¿™ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯(å³è°ƒç”¨ç±»æ–¹æ³•)ã€‚</p>
<p>ä¸ºäº†è°ƒç”¨ç±»æ–¹æ³•ï¼Œè¿™ä¸ªç±»çš„isaæŒ‡é’ˆå¿…é¡»æŒ‡å‘ä¸€ä¸ªåŒ…å«è¿™äº›ç±»æ–¹æ³•çš„ä¸€ä¸ªobjc_class ç»“æ„ä½“ã€‚è¿™å°±å¼•å‡ºäº† meta-class çš„æ¦‚å¿µï¼Œå…ƒç±»ä¸­ä¿å­˜äº†åˆ›å»ºç±»å¯¹è±¡ä»¥åŠç±»æ–¹æ³•æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
<p>ä»»ä½•NSObject ç»§æ‰¿ä½“ç³»ä¸‹çš„ meta-class éƒ½ä½¿ç”¨ NSObject çš„meta-class ä½œä¸ºè‡ªå·±çš„æ‰€å±ç±»ï¼Œè€ŒåŸºç±»çš„ meta-class çš„ isa æŒ‡é’ˆæ˜¯æŒ‡å‘å®ƒè‡ªå·±ã€‚</p>
<h5 id="Method-objc-method"><a href="#Method-objc-method" class="headerlink" title="Method(objc_method)"></a>Method(objc_method)</h5><p>å®šä¹‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// An opaque type that represents a method in a class definition.ä»£è¡¨ç±»å®šä¹‰ä¸­ä¸€ä¸ªæ–¹æ³•çš„ä¸é€æ˜ç±»å‹</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">objc_method</span> *<span class="title">Method</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_method</span> &#123;</span></span><br><span class="line">    SEL method_name        OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">char</span> *method_types     OBJC2_UNAVAILABLE;</span><br><span class="line">    IMP method_imp         OBJC2_UNAVAILABLE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“æ„ä½“ä¸­çš„å†…å®¹ï¼š</p>
<ul>
<li>SEL method_name æ–¹æ³•å</li>
<li>char *method_types æ–¹æ³•ç±»å‹</li>
<li>IMP method_imp æ–¹æ³•å®ç°</li>
</ul>
<h5 id="SEL-objc-selector"><a href="#SEL-objc-selector" class="headerlink" title="SEL(objc_selector)"></a>SEL(objc_selector)</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">objc.h</span><br><span class="line"><span class="comment">/// An opaque type that represents a method selector.ä»£è¡¨ä¸€ä¸ªæ–¹æ³•çš„ä¸é€æ˜ç±»å‹</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">objc_selector</span> *<span class="title">SEL</span>;</span></span><br></pre></td></tr></table></figure>

<p><code>Objc_msgSend</code>å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºSELï¼Œå®ƒæ˜¯selectoråœ¨ocä¸­è¡¨ç¤ºç±»å‹ã€‚selector æ˜¯æ–¹æ³•é€‰æ‹©å™¨ï¼Œå¯ä»¥ç†è§£ä¸ºåŒºåˆ†æ–¹æ³•çš„IDï¼Œè€Œè¿™ä¸ªIDçš„æ•°æ®ç»“æ„ä¸ºSELã€‚</p>
<p>å…¶å®selector å°±æ˜¯æ˜ å°„åˆ°æ–¹æ³•çš„ c å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨ <code>Objective-C</code> ç¼–è¯‘å™¨å‘½ä»¤<code>@selector()</code>æˆ–è€… <code>Runtime</code> ç³»ç»Ÿçš„<code>sel_registerName</code>å‡½æ•°æ¥è·å¾—ä¸€ä¸ª <code>SEL</code> ç±»å‹çš„æ–¹æ³•é€‰æ‹©å™¨ã€‚</p>
<p><code>selector</code>æ˜¯ä¸€ä¸ª<code>string</code>ï¼Œæ˜¯ç±»ä¼¼<code>className+method</code>çš„ç»„åˆï¼Œå‘½åè§„åˆ™æœ‰ä¸¤æ¡ï¼š</p>
<ul>
<li>åŒä¸€ä¸ªç±»ï¼Œselectorä¸èƒ½é‡å¤</li>
<li>ä¸åŒçš„ç±»ï¼Œselectorå¯ä»¥é‡å¤</li>
</ul>
<p>è¿™ä¹Ÿå¸¦æ¥ä¸€ä¸ªå¼Šç«¯ï¼ŒObjective-cä¸­æ˜¯æ²¡æœ‰å‡½æ•°é‡è½½çš„(å‡½æ•°åç›¸åŒï¼Œå‚æ•°ä¸åŒ)ï¼Œå› ä¸ºselectoråªè®°å½•äº†å‡½æ•°çš„nameæ²¡æœ‰è®°å½•å‚æ•°ï¼Œæ‰€ä»¥æ²¡åŠæ³•åŒºåˆ†ä¸åŒçš„ methodã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)caculate(NSInteger)num;</span><br><span class="line">- (<span class="keyword">void</span>)caculate(CGFloat)num;</span><br></pre></td></tr></table></figure>

<p>æ˜¯ä¼šæŠ¥é”™çš„ã€‚</p>
<p>æˆ‘ä»¬åªèƒ½é€šè¿‡å‘½åæ¥åŒºåˆ«ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)caculateWithInt(NSInteger)num;</span><br><span class="line">- (<span class="keyword">void</span>)caculateWithFloat(CGFloat)num;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸åŒç±»ä¸­ç›¸åŒåå­—çš„æ–¹æ³•æ‰€å¯¹åº”çš„æ–¹æ³•é€‰æ‹©å™¨æ˜¯ç›¸åŒçš„ï¼Œå³ä½¿æ–¹æ³•åå­—ç›¸åŒè€Œå˜é‡ç±»å‹ä¸åŒä¹Ÿä¼šå¯¼è‡´å®ƒä»¬å…·æœ‰ç›¸åŒçš„æ–¹æ³•é€‰æ‹©å™¨ã€‚</p>
<h5 id="IMP"><a href="#IMP" class="headerlink" title="IMP"></a>IMP</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A pointer to the function of a method implementation.  æŒ‡å‘ä¸€ä¸ªæ–¹æ³•å®ç°çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">id</span> <span class="params">(*IMP)</span><span class="params">(id, SEL, ...)</span></span>; </span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯æŒ‡å‘æœ€ç»ˆå®ç°ç¨‹åºçš„å†…å­˜åœ°å€çš„æŒ‡é’ˆã€‚</p>
<p>åœ¨<code>iOS</code>çš„<code>Runtime</code>ä¸­ï¼Œ<code>Method</code>é€šè¿‡<code>selector</code>å’Œ<code>IMP</code>ä¸¤ä¸ªå±æ€§ï¼Œå®ç°äº†å¿«é€ŸæŸ¥è¯¢æ–¹æ³•åŠå®ç°ï¼Œç›¸å¯¹æé«˜äº†æ€§èƒ½ï¼Œåˆä¿æŒäº†çµæ´»æ€§ã€‚</p>
<h5 id="ç±»ç¼“å­˜-objc-cache"><a href="#ç±»ç¼“å­˜-objc-cache" class="headerlink" title="ç±»ç¼“å­˜(objc_cache)"></a>ç±»ç¼“å­˜(objc_cache)</h5><p>å½“objective-cè¿è¡Œæ—¶é€šè¿‡è·Ÿè¸ªå®ƒçš„isaæŒ‡é’ˆæ£€æŸ¥å¯¹è±¡æ—¶ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå®ç°å¾ˆå¤šæ–¹æ³•çš„å¯¹è±¡ã€‚ç„¶è€Œï¼Œä½ å¯èƒ½åªè°ƒç”¨ä»–ä»¬çš„ä¸€å°éƒ¨åˆ†ï¼Œå¹¶ä¸”æ¯æ¬¡æ£€æŸ¥æ—¶ï¼Œæœç´¢æ‰€æœ‰é€‰æ‹©å™¨çš„ç±»åˆ†æ´¾è¡¨æ²¡æœ‰æ„ä¹‰ã€‚æ‰€ä»¥ç±»å®ç°ä¸€ä¸ªç¼“å­˜ï¼Œæ¯å½“ä½ æœç´¢ä¸€ä¸ªç±»åˆ†æ´¾è¡¨ï¼Œå¹¶æ‰¾åˆ°ç›¸åº”çš„é€‰æ‹©å™¨ï¼Œå®ƒæŠŠå®ƒæ”¾å…¥å®ƒçš„ç¼“å­˜ã€‚æ‰€ä»¥å½“objc_msgæŸ¥æ‰¾ä¸€ä¸ªç±»çš„é€‰æ‹©å™¨ï¼Œå®ƒä¼šå…ˆæœç´¢ç±»ç¼“å­˜ã€‚è¿™æ˜¯åŸºäºè¿™æ ·çš„ç†è®ºï¼šå¦‚æœä½ åœ¨ç±»ä¸Šè°ƒç”¨ä¸€ä¸ªæ¶ˆæ¯ï¼Œä½ å¯èƒ½ä»¥åå†æ¬¡è°ƒç”¨è¯¥æ¶ˆæ¯ã€‚</p>
<p>ä¸ºäº†åŠ é€Ÿæ¶ˆæ¯åˆ†å‘ï¼Œç³»ç»Ÿä¼šå¯¹æ–¹æ³•å’Œå¯¹åº”çš„åœ°å€è¿›è¡Œç¼“å­˜ï¼Œæ”¾åœ¨objc_cacheä¸­ï¼Œæ‰€ä»¥å®é™…è¿è¡Œä¸­ï¼Œå¤§éƒ¨åˆ†å¸¸ç”¨çš„æ–¹æ³•éƒ½ä¼šè¢«ç¼“å­˜èµ·æ¥ï¼ŒRuntime ç³»ç»Ÿå®é™…ä¸Šéå¸¸å¿«ï¼Œæ¥è¿‘ç›´æ¥æ‰§è¡Œå†…å­˜åœ°å€çš„ç¨‹åºé€Ÿåº¦ã€‚</p>
<h5 id="Category-objc-category"><a href="#Category-objc-category" class="headerlink" title="Category(objc_category)"></a>Category(objc_category)</h5><p>Category æ˜¯è¡¨ç¤ºä¸€ä¸ªæŒ‡å‘åˆ†ç±»çš„ç»“æ„ä½“æŒ‡é’ˆï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">category_t</span> &#123;</span> </span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name; </span><br><span class="line">    <span class="keyword">classref_t</span> cls; </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">method_list_t</span> *<span class="title">instanceMethods</span>;</span> </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">method_list_t</span> *<span class="title">classMethods</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">protocol_list_t</span> *<span class="title">protocols</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">property_list_t</span> *<span class="title">instanceProperties</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>nameï¼šæ˜¯æŒ‡ class_name è€Œä¸æ˜¯ category_nameã€‚ </li>
<li>clsï¼šè¦æ‰©å±•çš„ç±»å¯¹è±¡ï¼Œç¼–è¯‘æœŸé—´æ˜¯ä¸ä¼šå®šä¹‰çš„ï¼Œè€Œæ˜¯åœ¨Runtimeé˜¶æ®µé€šè¿‡nameå¯¹ åº”åˆ°å¯¹åº”çš„ç±»å¯¹è±¡ã€‚ </li>
<li>instanceMethodsï¼šcategoryä¸­æ‰€æœ‰ç»™ç±»æ·»åŠ çš„å®ä¾‹æ–¹æ³•çš„åˆ—è¡¨ã€‚ </li>
<li>classMethodsï¼šcategoryä¸­æ‰€æœ‰æ·»åŠ çš„ç±»æ–¹æ³•çš„åˆ—è¡¨ã€‚ </li>
<li>protocolsï¼šcategoryå®ç°çš„æ‰€æœ‰åè®®çš„åˆ—è¡¨ã€‚</li>
<li>instancePropertiesï¼šè¡¨ç¤ºCategoryé‡Œæ‰€æœ‰çš„propertiesï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡objc_setAssociatedObjectå’Œobjc_getAssociatedObjectå¢åŠ å®ä¾‹å˜é‡çš„åŸå› ï¼Œä¸è¿‡è¿™ä¸ªå’Œä¸€èˆ¬çš„å®ä¾‹å˜é‡æ˜¯ä¸ä¸€æ ·çš„ã€‚</li>
</ul>
<p><strong>ä»ä¸Šé¢çš„category_tçš„ç»“æ„ä½“ä¸­å¯ä»¥çœ‹å‡ºï¼Œåˆ†ç±»ä¸­å¯ä»¥æ·»åŠ å®ä¾‹æ–¹æ³•ï¼Œç±»æ–¹æ³•ï¼Œç”šè‡³å¯ä»¥å®ç°åè®®ï¼Œæ·»åŠ å±æ€§ï¼Œä¸å¯ä»¥æ·»åŠ æˆå‘˜å˜é‡ã€‚</strong></p>
<h3 id="Runtimeæ¶ˆæ¯è½¬å‘"><a href="#Runtimeæ¶ˆæ¯è½¬å‘" class="headerlink" title="Runtimeæ¶ˆæ¯è½¬å‘"></a>Runtimeæ¶ˆæ¯è½¬å‘</h3><p>è¿›è¡Œä¸€æ¬¡å‘é€æ¶ˆæ¯ä¼šåœ¨ç›¸å…³çš„ç±»å¯¹è±¡ä¸­æœç´¢æ–¹æ³•åˆ—è¡¨ï¼Œå¦‚æœæ‰¾ä¸åˆ°åˆ™ä¼šæ²¿ç€ç»§æ‰¿æ ‘ä¸€ç›´æœç´¢ç›´åˆ°ç»§æ‰¿æ ‘çš„æ ¹éƒ¨(é€šå¸¸ä¸ºNSObject)ï¼Œå¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°å¹¶ä¸”æ¶ˆæ¯è½¬å‘éƒ½å¤±è´¥äº†å°±ä¼šæ‰§è¡Œ<code>doesNotRecognizeSelector:</code>æ–¹æ³•æŠ¥ <code>unrecongnized selector</code>ã€‚ä¸‹é¢è¯´ä¸€ä¸‹æ¶ˆæ¯è½¬å‘ï¼š</p>
<ul>
<li>åŠ¨æ€æ–¹æ³•è§£æ</li>
<li>å¤‡ç”¨æ¥æ”¶è€…</li>
<li>å®Œæ•´æ¶ˆæ¯è½¬å‘</li>
</ul>
<h4 id="åŠ¨æ€æ–¹æ³•è§£æï¼š"><a href="#åŠ¨æ€æ–¹æ³•è§£æï¼š" class="headerlink" title="åŠ¨æ€æ–¹æ³•è§£æï¼š"></a>åŠ¨æ€æ–¹æ³•è§£æï¼š</h4><p>é¦–å…ˆï¼Œ<code>Objective-C</code>è¿è¡Œæ—¶ä¼šè°ƒç”¨ <code>+resolveInstanceMethod:</code>æˆ–è€… <code>+resolveClassMethod:</code>ï¼Œè®©ä½ æœ‰æœºä¼šæä¾›ä¸€ä¸ªå‡½æ•°å®ç°ã€‚å¦‚æœä½ æ·»åŠ äº†å‡½æ•°å¹¶è¿”å›<code>YES</code>ï¼Œ é‚£è¿è¡Œæ—¶ç³»ç»Ÿå°±ä¼šé‡æ–°å¯åŠ¨ä¸€æ¬¡æ¶ˆæ¯å‘é€çš„è¿‡ç¨‹ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    [self performSelector:@selector(foo:)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (sel == @selector(foo:))</span><br><span class="line">    &#123;</span><br><span class="line">        class_addMethod([self class], sel, (IMP)fooMethod, <span class="string">"v@:"</span>);</span><br><span class="line">        <span class="keyword">return</span> YES;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [super resolveInstanceMethod:sel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fooMethod</span><span class="params">(id obj, SEL _cmd)</span> </span>&#123;</span><br><span class="line">    NSLog(@<span class="string">"Doing foo"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-05</span> <span class="number">03</span>:<span class="number">53</span>:<span class="number">29.815835</span>+<span class="number">0800</span> TestDemo[<span class="number">821</span>:<span class="number">15514</span>] Doing foo</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è™½ç„¶æ²¡æœ‰å®ç°foo:è¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯é€šè¿‡class_addMethod åŠ¨æ€æ·»åŠ äº†fooMethod å‡½æ•°ï¼Œå¹¶æ‰§è¡ŒfooMethod è¿™ä¸ªå‡½æ•°çš„IMPã€‚å¦‚æœresolve æ–¹æ³•è¿”å›NOï¼Œè¿è¡Œå°±ä¼šç§»åˆ°ä¸‹ä¸€æ­¥ï¼šforwardingTargetForSelectorã€‚</p>
<h4 id="å¤‡ç”¨æ¥æ”¶è€…"><a href="#å¤‡ç”¨æ¥æ”¶è€…" class="headerlink" title="å¤‡ç”¨æ¥æ”¶è€…"></a>å¤‡ç”¨æ¥æ”¶è€…</h4><p>å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†<code>forwardingTargetForSelector</code>ï¼Œ<code>Runtime</code>è¿™æ—¶å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œç»™ä½ æŠŠè¿™ä¸ªæ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡çš„æœºä¼šã€‚æ‰€ä»¥è¯´æ˜¯å¤‡ç”¨æ¥æ”¶è€…ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"objc/runtime.h"</span></span></span><br><span class="line"></span><br><span class="line">@interface Person : NSObject</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation Person</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)foo &#123;</span><br><span class="line">    NSLog(@<span class="string">"Doing foo"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@<span class="function">interface <span class="title">ViewController</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation ViewController</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    [self performSelector:@selector(foo)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)forwardingTargetForSelector:(SEL)aSelector</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (aSelector == @selector(foo))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> [Person <span class="keyword">new</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [super forwardingTargetForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é€šè¿‡<code>forwardingTargetForSelector</code>æŠŠå½“å‰ ViewController çš„æ–¹æ³•è½¬å‘ç»™äº† Person å»æ‰§è¡Œï¼Œå¹¶æˆåŠŸæ‰§è¡Œã€‚</p>
<h4 id="å®Œæ•´æ¶ˆæ¯è½¬å‘"><a href="#å®Œæ•´æ¶ˆæ¯è½¬å‘" class="headerlink" title="å®Œæ•´æ¶ˆæ¯è½¬å‘"></a>å®Œæ•´æ¶ˆæ¯è½¬å‘</h4><p>å¦‚æœåœ¨ä¸Šä¸€æ­¥è¿˜ä¸èƒ½å¤„ç†æœªçŸ¥æ¶ˆæ¯ï¼Œåˆ™å”¯ä¸€èƒ½åšçš„å°±æ˜¯å¯ç”¨å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶äº†ã€‚é¦–å…ˆå®ƒä¼šå‘é€<code>-methodSignatureForSelector:</code>æ¶ˆæ¯è·å¾—å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹ã€‚å¦‚æœ<code>-methodSignatureForSelector:</code>è¿”å›<code>nil</code> ï¼Œ<code>Runtime</code>åˆ™ä¼šå‘å‡º <code>-doesNotRecognizeSelector:</code> æ¶ˆæ¯ï¼Œç¨‹åºè¿™æ—¶ä¹Ÿå°±æŒ‚æ‰äº†ã€‚å¦‚æœè¿”å›äº†ä¸€ä¸ªå‡½æ•°ç­¾åï¼Œ<code>Runtime</code>å°±ä¼šåˆ›å»ºä¸€ä¸ª<code>NSInvocation</code> å¯¹è±¡å¹¶å‘é€ <code>-forwardInvocation:</code>æ¶ˆæ¯ç»™ç›®æ ‡å¯¹è±¡ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"objc/runtime.h"</span></span></span><br><span class="line"></span><br><span class="line">@interface Person : NSObject</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation Person</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)foo &#123;</span><br><span class="line">    NSLog(@<span class="string">"Doing foo"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@<span class="function">interface <span class="title">ViewController</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation ViewController</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    [self performSelector:@selector(foo)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)forwardingTargetForSelector:(SEL)aSelector</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> nil;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> NO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fooMethod</span><span class="params">(id obj, SEL _cmd)</span> </span>&#123;</span><br><span class="line">    NSLog(@<span class="string">"Doing foooo"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ([NSStringFromSelector(aSelector) isEqualToString:@<span class="string">"foo"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span> [NSMethodSignature signatureWithObjCTypes:<span class="string">"v@:"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [super methodSignatureForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)forwardInvocation:(NSInvocation *)anInvocation</span><br><span class="line">&#123;</span><br><span class="line">    SEL sel = anInvocation.selector;</span><br><span class="line">    Person *p = [Person <span class="keyword">new</span>];</span><br><span class="line">    <span class="keyword">if</span> ([p respondsToSelector:sel]) &#123;</span><br><span class="line">        [anInvocation invokeWithTarget:p];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        [self doesNotRecognizeSelector:sel];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-05</span> <span class="number">04</span>:<span class="number">14</span>:<span class="number">05.722619</span>+<span class="number">0800</span> TestDemo[<span class="number">1195</span>:<span class="number">29921</span>] Doing foo</span><br></pre></td></tr></table></figure>

<p>ä»æ‰“å°ç»“æœçœ‹ï¼Œå®ç°äº†å®Œæ•´çš„è½¬å‘ï¼Œé€šè¿‡ç­¾åï¼ŒRuntime ç”Ÿæˆäº†ä¸€ä¸ªå¯¹è±¡ <code>anInvocation</code>ï¼Œå‘é€ç»™äº†<code>forwardInvocation</code>ï¼Œæˆ‘ä»¬åœ¨<code>forwardInvocation</code>æ–¹æ³•é‡Œè®©Personå¯¹è±¡å»æ‰§è¡Œäº†fooå‡½æ•°ã€‚å…¶ä¸­ç­¾åå‚æ•°<code>v@</code>å°±æ˜¯æŒ‡voidç±»å‹ã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯Runtimeçš„ä¸‰æ¬¡è½¬å‘æµç¨‹ã€‚</p>
<h3 id="Runtimeåº”ç”¨"><a href="#Runtimeåº”ç”¨" class="headerlink" title="Runtimeåº”ç”¨"></a>Runtimeåº”ç”¨</h3><p><code>Runtime</code>ç®€ç›´å°±æ˜¯åšå¤§å‹æ¡†æ¶çš„åˆ©å™¨ã€‚å®ƒçš„åº”ç”¨åœºæ™¯å¾ˆå¤šï¼Œä¸‹é¢ä»‹ç»ä¸€äº›å¸¸è§çš„åº”ç”¨åœºæ™¯ã€‚</p>
<ul>
<li>å…³è”å¯¹è±¡(OC Associated Objects)ç»™åˆ†ç±»å¢åŠ å±æ€§</li>
<li>æ–¹æ³•é­”æ³•(Method Swizzling)æ–¹æ³•æ·»åŠ å’Œæ›¿æ¢å’ŒKVOå®ç°</li>
<li>æ¶ˆæ¯è½¬å‘(çƒ­æ›´æ–°)è§£å†³Bug(JSPatch)</li>
<li>å®ç°NSCodingçš„è‡ªåŠ¨å½’æ¡£å’Œè‡ªåŠ¨è§£æ¡£</li>
<li>å®ç°å­—å…¸å’Œæ¨¡å‹çš„è‡ªåŠ¨è½¬æ¢</li>
</ul>
<h4 id="å…³è”å¯¹è±¡ç»™åˆ†ç±»å¢åŠ å±æ€§"><a href="#å…³è”å¯¹è±¡ç»™åˆ†ç±»å¢åŠ å±æ€§" class="headerlink" title="å…³è”å¯¹è±¡ç»™åˆ†ç±»å¢åŠ å±æ€§"></a>å…³è”å¯¹è±¡ç»™åˆ†ç±»å¢åŠ å±æ€§</h4><p>å…³è”å¯¹è±¡Runtimeæä¾›äº†ä¸‹é¢å‡ ä¸ªæ¥å£ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…³è”å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">objc_setAssociatedObject</span><span class="params">(id object, <span class="keyword">const</span> <span class="keyword">void</span> *key, id value, objc_AssociationPolicy policy)</span></span></span><br><span class="line"><span class="function"><span class="comment">//è·å–å…³è”çš„å¯¹è±¡</span></span></span><br><span class="line"><span class="function">id <span class="title">objc_getAssociatedObject</span><span class="params">(id object, <span class="keyword">const</span> <span class="keyword">void</span> *key)</span></span></span><br><span class="line"><span class="function"><span class="comment">//ç§»é™¤å…³è”çš„å¯¹è±¡</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">objc_removeAssociatedObjects</span><span class="params">(id object)</span></span></span><br></pre></td></tr></table></figure>

<p>å‚æ•°è§£é‡Šï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id objectï¼šè¢«å…³è”çš„å¯¹è±¡</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">void</span> *keyï¼šå…³è”çš„keyï¼Œè¦æ±‚å”¯ä¸€</span><br><span class="line">id valueï¼šå…³è”çš„å¯¹è±¡</span><br><span class="line">objc_AssociationPolicy policyï¼šå†…å­˜ç®¡ç†çš„ç­–ç•¥</span><br></pre></td></tr></table></figure>

<p>å†…å­˜ç®¡ç†çš„ç­–ç•¥ï¼š</p>
<table>
<thead>
<tr>
<th>å†…å­˜ç­–ç•¥</th>
<th>å±æ€§ä¿®é¥°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>OBJC_ASSOCIATION_ASSIGN</td>
<td>@property (assign) æˆ– @property (unsafe_unretained)</td>
<td>æŒ‡å®šä¸€ä¸ªå…³è”å¯¹è±¡çš„å¼±å¼•ç”¨ã€‚</td>
</tr>
<tr>
<td>OBJC_ASSOCIATION_RETAIN_NONATOMIC</td>
<td>@property (nonatomic, strong)</td>
<td>@property (nonatomic, strong)   æŒ‡å®šä¸€ä¸ªå…³è”å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œä¸èƒ½è¢«åŸå­åŒ–ä½¿ç”¨ã€‚</td>
</tr>
<tr>
<td>OBJC_ASSOCIATION_COPY_NONATOMIC</td>
<td>@property (nonatomic, copy)</td>
<td>æŒ‡å®šä¸€ä¸ªå…³è”å¯¹è±¡çš„copyå¼•ç”¨ï¼Œä¸èƒ½è¢«åŸå­åŒ–ä½¿ç”¨ã€‚</td>
</tr>
<tr>
<td>OBJC_ASSOCIATION_RETAIN</td>
<td>@property (atomic, strong)</td>
<td>æŒ‡å®šä¸€ä¸ªå…³è”å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œèƒ½è¢«åŸå­åŒ–ä½¿ç”¨ã€‚</td>
</tr>
<tr>
<td>OBJC_ASSOCIATION_COPY</td>
<td>@property (atomic, copy)</td>
<td>æŒ‡å®šä¸€ä¸ªå…³è”å¯¹è±¡çš„copyå¼•ç”¨ï¼Œèƒ½è¢«åŸå­åŒ–ä½¿ç”¨ã€‚</td>
</tr>
</tbody></table>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"objc/runtime.h"</span></span></span><br><span class="line"></span><br><span class="line">@<span class="function">interface <span class="title">UIView</span> <span class="params">(DefaultColor)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line">@property (nonatomic, strong) UIColor *defaultColor;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@<span class="function">implementation <span class="title">UIView</span> <span class="params">(DefaultColor)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">char</span> kDefaultColorKey</span>;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setDefaultColor:(UIColor *)defaultColor &#123;</span><br><span class="line">    objc_setAssociatedObject(self, &amp;kDefaultColorKey, defaultColor, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)defaultColor &#123;</span><br><span class="line">    <span class="keyword">return</span> objc_getAssociatedObject(self, &amp;kDefaultColorKey);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@<span class="function">interface <span class="title">ViewController</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation ViewController</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    </span><br><span class="line">    UIView *test = [UIView <span class="keyword">new</span>];</span><br><span class="line">    test.defaultColor = [UIColor blackColor];</span><br><span class="line">    NSLog(@<span class="string">"%@"</span>, test.defaultColor);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>æ‰“å°ç»“æœï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-05</span> <span class="number">09</span>:<span class="number">30</span>:<span class="number">29.002794</span>+<span class="number">0800</span> TestDemo[<span class="number">1131</span>:<span class="number">26732</span>] UIExtendedGrayColorSpace <span class="number">0</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h4 id="æ–¹æ³•é­”æ³•-Method-Swizzling-æ–¹æ³•æ·»åŠ å’Œæ›¿æ¢å’ŒKVOå®ç°"><a href="#æ–¹æ³•é­”æ³•-Method-Swizzling-æ–¹æ³•æ·»åŠ å’Œæ›¿æ¢å’ŒKVOå®ç°" class="headerlink" title="æ–¹æ³•é­”æ³•(Method Swizzling)æ–¹æ³•æ·»åŠ å’Œæ›¿æ¢å’ŒKVOå®ç°"></a>æ–¹æ³•é­”æ³•(Method Swizzling)æ–¹æ³•æ·»åŠ å’Œæ›¿æ¢å’ŒKVOå®ç°</h4><p>å®é™…ä¸Šæ·»åŠ æ–¹æ³•åˆšæ‰åœ¨è®²æ¶ˆæ¯è½¬å‘çš„æ—¶å€™ï¼ŒåŠ¨æ€æ–¹æ³•è§£æçš„æ—¶å€™å°±æåˆ°äº†ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//class_addMethod(Class  _Nullable __unsafe_unretained cls, SEL  _Nonnull name, IMP  _Nonnull imp, const char * _Nullable types)</span></span><br><span class="line">class_addMethod([self class], sel, (IMP)fooMethod, <span class="string">"v@:"</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>cls è¢«æ·»åŠ æ–¹æ³•çš„ç±»</li>
<li>name æ·»åŠ çš„æ–¹æ³•çš„åç§°çš„SEL</li>
<li>impæ–¹æ³•çš„å®ç°ï¼Œè¯¥å‡½æ•°å¿…é¡»è‡³å°‘æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œselfï¼Œ_cmd</li>
<li>æ–¹æ³•ç±»å‹ </li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"objc/runtime.h"</span></span></span><br><span class="line"></span><br><span class="line">@implementation ViewController</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">dispatch_once_t</span> onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        Class class = [self class];</span><br><span class="line">        SEL originalSelector = @selector(viewDidLoad);</span><br><span class="line">        SEL swizzledSelector = @selector(jkviewDidLoad);</span><br><span class="line">        </span><br><span class="line">        Method originalMethod = class_getInstanceMethod(class,originalSelector);</span><br><span class="line">        Method swizzledMethod = class_getInstanceMethod(class,swizzledSelector);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//judge the method named  swizzledMethod is already existed.</span></span><br><span class="line">        BOOL didAddMethod = class_addMethod(class, originalSelector, method_getImplementation(swizzledMethod), method_getTypeEncoding(swizzledMethod));</span><br><span class="line">        <span class="comment">// if swizzledMethod is already existed.</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (didAddMethod) &#123;</span><br><span class="line">            class_replaceMethod(class, swizzledSelector, method_getImplementation(originalMethod), method_getTypeEncoding(originalMethod));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            method_exchangeImplementations(originalMethod, swizzledMethod);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)jkviewDidLoad &#123;</span><br><span class="line">    NSLog(@<span class="string">"æ›¿æ¢çš„æ–¹æ³•"</span>);</span><br><span class="line">    <span class="comment">// å¦‚æœä¸æ‰§è¡Œä¸‹ä¸€æ­¥åªä¼šæ‰§è¡Œæ‰“å°æ›¿æ¢çš„æ–¹æ³•</span></span><br><span class="line">    [self jkviewDidLoad];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    NSLog(@<span class="string">"è‡ªå¸¦çš„æ–¹æ³•"</span>);</span><br><span class="line">    </span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p><code>swizzling</code>åº”è¯¥åªåœ¨<code>+load</code>ä¸­å®Œæˆã€‚ åœ¨ <code>Objective-C</code> çš„è¿è¡Œæ—¶ä¸­ï¼Œæ¯ä¸ªç±»æœ‰ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè‡ªåŠ¨è°ƒç”¨ã€‚<code>+load</code> æ˜¯åœ¨ä¸€ä¸ªç±»è¢«åˆå§‹è£…è½½æ—¶è°ƒç”¨ï¼Œ<code>+initialize</code> æ˜¯åœ¨åº”ç”¨ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥ç±»çš„ç±»æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•å‰è°ƒç”¨çš„ã€‚ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯å¯é€‰çš„ï¼Œå¹¶ä¸”åªæœ‰åœ¨æ–¹æ³•è¢«å®ç°çš„æƒ…å†µä¸‹æ‰ä¼šè¢«è°ƒç”¨ã€‚</p>
<p><code>swizzling</code>åº”è¯¥åªåœ¨<code>dispatch_once</code> ä¸­å®Œæˆ,ç”±äº<code>swizzling</code> æ”¹å˜äº†å…¨å±€çš„çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç¡®ä¿æ¯ä¸ªé¢„é˜²æªæ–½åœ¨è¿è¡Œæ—¶éƒ½æ˜¯å¯ç”¨çš„ã€‚åŸå­æ“ä½œå°±æ˜¯è¿™æ ·ä¸€ä¸ªç”¨äºç¡®ä¿ä»£ç åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡çš„é¢„é˜²æªæ–½ï¼Œå°±ç®—æ˜¯åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ä¹Ÿèƒ½ç¡®ä¿ä»£ç åªæ‰§è¡Œä¸€æ¬¡ã€‚<code>Grand Central Dispatch çš„ dispatch_once</code>æ»¡è¶³äº†æ‰€éœ€è¦çš„éœ€æ±‚ï¼Œå¹¶ä¸”åº”è¯¥è¢«å½“åšä½¿ç”¨<code>swizzling</code> çš„åˆå§‹åŒ–å•ä¾‹æ–¹æ³•çš„æ ‡å‡†ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-05</span> <span class="number">09</span>:<span class="number">50</span>:<span class="number">39.256374</span>+<span class="number">0800</span> TestDemo[<span class="number">1359</span>:<span class="number">36735</span>] æ›¿æ¢çš„æ–¹æ³•</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-05</span> <span class="number">09</span>:<span class="number">50</span>:<span class="number">39.256505</span>+<span class="number">0800</span> TestDemo[<span class="number">1359</span>:<span class="number">36735</span>] è‡ªå¸¦çš„æ–¹æ³•</span><br></pre></td></tr></table></figure>

<h4 id="KVOå®ç°"><a href="#KVOå®ç°" class="headerlink" title="KVOå®ç°"></a>KVOå®ç°</h4><blockquote>
<p>å…¨ç§°æ˜¯Key-value observingï¼Œç¿»è¯‘æˆé”®å€¼è§‚å¯Ÿã€‚æä¾›äº†ä¸€ç§å½“å…¶å®ƒå¯¹è±¡å±æ€§è¢«ä¿®æ”¹çš„æ—¶å€™èƒ½é€šçŸ¥å½“å‰å¯¹è±¡çš„æœºåˆ¶ã€‚å†MVCå¤§è¡Œå…¶é“çš„Cocoaä¸­ï¼ŒKVOæœºåˆ¶å¾ˆé€‚åˆå®ç°modelå’Œcontrollerç±»ä¹‹é—´çš„é€šè®¯ã€‚</p>
</blockquote>
<p>KVO çš„å®ç°ä¾èµ–äºOCçš„Runtimeï¼Œå½“è§‚å¯ŸæŸå¯¹è±¡Aæ—¶ï¼ŒKVO æœºåˆ¶åŠ¨æ€åˆ›å»ºä¸€ä¸ªå¯¹è±¡Aå½“å‰ç±»çš„å­ç±»ï¼Œå¹¶ä¸ºè¿™ä¸ªæ–°çš„å­ç±»é‡å†™äº†è¢«è§‚å¯Ÿå±æ€§ keyPath çš„ setter æ–¹æ³•ã€‚setter æ–¹æ³•éšåè´Ÿè´£é€šçŸ¥è§‚å¯Ÿå¯¹è±¡å±æ€§çš„æ”¹å˜çŠ¶å†µã€‚</p>
<p>Apple ä½¿ç”¨äº† isa-swizzling æ¥å®ç° KVOã€‚å½“è§‚å¯Ÿå¯¹è±¡ A æ—¶ï¼ŒKVOæœºåˆ¶åŠ¨æ€åˆ›å»ºä¸€ä¸ªæ–°çš„åä¸ºï¼šNSKVONofifying_A çš„æ–°ç±»ï¼Œè¯¥ç±»ç»§æ‰¿è‡ªå¯¹è±¡ A çš„æœ¬ç±»ï¼Œä¸” KVO ä¸ºNSKVONotifying_A é‡å†™è§‚å¯Ÿå±æ€§çš„ setter æ–¹æ³•ï¼Œsetter æ–¹æ³•ä¼šè´Ÿè´£åœ¨è°ƒç”¨åŸ setter æ–¹æ³•ä¹‹å‰å’Œä¹‹åï¼Œé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿå¯¹è±¡å±æ€§å€¼çš„æ›´æ”¹æƒ…å†µã€‚</p>
<ul>
<li>NSKVONotifying_Aç±»å‰–æï¼š</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSLog(@<span class="string">"self-&gt;isa:%@"</span>,self-&gt;isa);  </span><br><span class="line">NSLog(@<span class="string">"self class:%@"</span>,[self class]);</span><br></pre></td></tr></table></figure>

<p>åœ¨å»ºç«‹KVOç›‘å¬å‰ï¼Œæ‰“å°ç»“æœä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">self-&gt;isa:A</span><br><span class="line">self class:A</span><br></pre></td></tr></table></figure>

<p> åœ¨å»ºç«‹KVOç›‘å¬ä¹‹åï¼Œæ‰“å°ç»“æœä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">self-&gt;isa:NSKVONotifying_A</span><br><span class="line">self class:A</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ï¼Œè¢«è§‚å¯Ÿå¯¹è±¡çš„ <code>isa</code> æŒ‡é’ˆä»æŒ‡å‘åŸæ¥çš„ <code>A</code> ç±»ï¼Œè¢«<code>KVO</code> æœºåˆ¶ä¿®æ”¹ä¸ºæŒ‡å‘ç³»ç»Ÿæ–°åˆ›å»ºçš„å­ç±»<code>NSKVONotifying_A</code> ç±»ï¼Œæ¥å®ç°å½“å‰ç±»å±æ€§å€¼æ”¹å˜çš„ç›‘å¬ï¼›<br>æ‰€ä»¥å½“æˆ‘ä»¬ä»åº”ç”¨å±‚é¢ä¸Šçœ‹æ¥ï¼Œå®Œå…¨æ²¡æœ‰æ„è¯†åˆ°æœ‰æ–°çš„ç±»å‡ºç°ï¼Œè¿™æ˜¯ç³»ç»Ÿâ€œéšç’â€äº†å¯¹ <code>KVO</code> çš„åº•å±‚å®ç°è¿‡ç¨‹ï¼Œè®©æˆ‘ä»¬è¯¯ä»¥ä¸ºè¿˜æ˜¯åŸæ¥çš„ç±»ã€‚ä½†æ˜¯æ­¤æ—¶å¦‚æœæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„åä¸ºâ€œ<code>NSKVONotifying_A</code>â€çš„ç±»ï¼Œå°±ä¼šå‘ç°ç³»ç»Ÿè¿è¡Œåˆ°æ³¨å†Œ <code>KVO</code> çš„é‚£æ®µä»£ç æ—¶ç¨‹åºå°±å´©æºƒï¼Œå› ä¸ºç³»ç»Ÿåœ¨æ³¨å†Œç›‘å¬çš„æ—¶å€™åŠ¨æ€åˆ›å»ºäº†åä¸º <code>NSKVONotifying_A</code> çš„ä¸­é—´ç±»ï¼Œå¹¶æŒ‡å‘è¿™ä¸ªä¸­é—´ç±»äº†ã€‚</p>
<ul>
<li>å­ç±»setteræ–¹æ³•å‰–æ</li>
</ul>
<p><code>KVO</code> çš„é”®å€¼è§‚å¯Ÿé€šçŸ¥ä¾èµ–äº NSObject çš„ä¸¤ä¸ªæ–¹æ³•:<code>willChangeValueForKey:</code>å’Œ <code>didChangeValueForKey:</code> ï¼Œåœ¨å­˜å–æ•°å€¼çš„å‰ååˆ†åˆ«è°ƒç”¨ 2 ä¸ªæ–¹æ³•ï¼š<br> è¢«è§‚å¯Ÿå±æ€§å‘ç”Ÿæ”¹å˜ä¹‹å‰ï¼Œ<code>willChangeValueForKey:</code>è¢«è°ƒç”¨ï¼Œé€šçŸ¥ç³»ç»Ÿè¯¥ <code>keyPath</code> çš„å±æ€§å€¼å³å°†å˜æ›´ï¼›<br> å½“æ”¹å˜å‘ç”Ÿåï¼Œ <code>didChangeValueForKey:</code> è¢«è°ƒç”¨ï¼Œé€šçŸ¥ç³»ç»Ÿè¯¥<code>keyPath</code> çš„å±æ€§å€¼å·²ç»å˜æ›´ï¼›ä¹‹åï¼Œ <code>observeValueForKey:ofObject:change:context:</code>ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ä¸”é‡å†™è§‚å¯Ÿå±æ€§çš„<code>setter</code> æ–¹æ³•è¿™ç§ç»§æ‰¿æ–¹å¼çš„æ³¨å…¥æ˜¯åœ¨è¿è¡Œæ—¶è€Œä¸æ˜¯ç¼–è¯‘æ—¶å®ç°çš„ã€‚</p>
<p><code>KVO</code> ä¸ºå­ç±»çš„è§‚å¯Ÿè€…å±æ€§é‡å†™è°ƒç”¨å­˜å–æ–¹æ³•çš„å·¥ä½œåŸç†åœ¨ä»£ç ä¸­ç›¸å½“äºï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setName:(NSString *)newName &#123; </span><br><span class="line">      [self willChangeValueForKey:@<span class="string">"name"</span>];    <span class="comment">//KVO åœ¨è°ƒç”¨å­˜å–æ–¹æ³•ä¹‹å‰æ€»è°ƒç”¨ </span></span><br><span class="line">      [super setValue:newName forKey:@<span class="string">"name"</span>]; <span class="comment">//è°ƒç”¨çˆ¶ç±»çš„å­˜å–æ–¹æ³• </span></span><br><span class="line">      [self didChangeValueForKey:@<span class="string">"name"</span>];     <span class="comment">//KVO åœ¨è°ƒç”¨å­˜å–æ–¹æ³•ä¹‹åæ€»è°ƒç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    

    
    
    

    

    
      
    
    

    
      <div>
        




  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>PerryWang</li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    
    <a href="http://yoursite.com/2019/07/11/RuntimeåŸç†åŠåº”ç”¨/" title="RuntimeåŸç†åŠåº”ç”¨">http://yoursite.com/2019/07/11/RuntimeåŸç†åŠåº”ç”¨/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li>
</ul>

      </div>
    
    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------æœ¬æ–‡ç»“æŸ<i class="fa fa-paw"></i>æ„Ÿè°¢æ‚¨çš„é˜…è¯»-------------</div>
    
</div>


      
    </div>

    <footer class="post-footer">
      
        
          
        
        <div class="post-tags">
          
            <a href="/tags/iOS/" rel="tag"># iOS</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/11/Dispatch/" rel="next" title="iOS || Grand Central Dispatch (GCD)">
                <i class="fa fa-chevron-left"></i> iOS || Grand Central Dispatch (GCD)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/11/iOS-RunLoop/" rel="prev" title="iOS || RunLoop">
                iOS || RunLoop <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/å¤´åƒ.png" alt="PerryWang">
            
              <p class="site-author-name" itemprop="name">PerryWang</p>
              <div class="site-description motion-element" itemprop="description">sysu-student</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">89</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">åˆ†ç±»</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">20</span>
                    <span class="site-state-item-name">æ ‡ç­¾</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/WangPerryWPY" title="GitHub &rarr; https://github.com/WangPerryWPY" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://blog.csdn.net/perry0528" title="CSDN &rarr; https://blog.csdn.net/perry0528" rel="noopener" target="_blank"><i class="fa fa-fw fa-crosshairs"></i>CSDN</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:1731611872@qq.com" title="E-Mail &rarr; mailto:1731611872@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Runtimeä»‹ç»"><span class="nav-number">1.</span> <span class="nav-text">Runtimeä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Runtimeæ¶ˆæ¯ä¼ é€’"><span class="nav-number">2.</span> <span class="nav-text">Runtimeæ¶ˆæ¯ä¼ é€’</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#æ¶ˆæ¯ä¼ é€’ä¸­çš„æ¦‚å¿µï¼š"><span class="nav-number">2.1.</span> <span class="nav-text">æ¶ˆæ¯ä¼ é€’ä¸­çš„æ¦‚å¿µï¼š</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ç±»å¯¹è±¡-objc-class"><span class="nav-number">2.1.1.</span> <span class="nav-text">ç±»å¯¹è±¡(objc_class)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#å®ä¾‹-objc-object"><span class="nav-number">2.1.2.</span> <span class="nav-text">å®ä¾‹(objc_object)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#å…ƒç±»-Meta-Class"><span class="nav-number">2.1.3.</span> <span class="nav-text">å…ƒç±»(Meta Class)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Method-objc-method"><span class="nav-number">2.1.4.</span> <span class="nav-text">Method(objc_method)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SEL-objc-selector"><span class="nav-number">2.1.5.</span> <span class="nav-text">SEL(objc_selector)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#IMP"><span class="nav-number">2.1.6.</span> <span class="nav-text">IMP</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ç±»ç¼“å­˜-objc-cache"><span class="nav-number">2.1.7.</span> <span class="nav-text">ç±»ç¼“å­˜(objc_cache)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Category-objc-category"><span class="nav-number">2.1.8.</span> <span class="nav-text">Category(objc_category)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Runtimeæ¶ˆæ¯è½¬å‘"><span class="nav-number">3.</span> <span class="nav-text">Runtimeæ¶ˆæ¯è½¬å‘</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#åŠ¨æ€æ–¹æ³•è§£æï¼š"><span class="nav-number">3.1.</span> <span class="nav-text">åŠ¨æ€æ–¹æ³•è§£æï¼š</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¤‡ç”¨æ¥æ”¶è€…"><span class="nav-number">3.2.</span> <span class="nav-text">å¤‡ç”¨æ¥æ”¶è€…</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å®Œæ•´æ¶ˆæ¯è½¬å‘"><span class="nav-number">3.3.</span> <span class="nav-text">å®Œæ•´æ¶ˆæ¯è½¬å‘</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Runtimeåº”ç”¨"><span class="nav-number">4.</span> <span class="nav-text">Runtimeåº”ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å…³è”å¯¹è±¡ç»™åˆ†ç±»å¢åŠ å±æ€§"><span class="nav-number">4.1.</span> <span class="nav-text">å…³è”å¯¹è±¡ç»™åˆ†ç±»å¢åŠ å±æ€§</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ–¹æ³•é­”æ³•-Method-Swizzling-æ–¹æ³•æ·»åŠ å’Œæ›¿æ¢å’ŒKVOå®ç°"><span class="nav-number">4.2.</span> <span class="nav-text">æ–¹æ³•é­”æ³•(Method Swizzling)æ–¹æ³•æ·»åŠ å’Œæ›¿æ¢å’ŒKVOå®ç°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#KVOå®ç°"><span class="nav-number">4.3.</span> <span class="nav-text">KVOå®ç°</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Perry</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    
    <span title="ç«™ç‚¹æ€»å­—æ•°">515k</span>
  

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="æ€»è®¿å®¢é‡">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="æ€»è®¿é—®é‡">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/affix.js?v=7.2.0"></script>

  <script src="/js/schemes/pisces.js?v=7.2.0"></script>




  
  <script src="/js/scrollspy.js?v=7.2.0"></script>
<script src="/js/post-details.js?v=7.2.0"></script>



  


  <script src="/js/next-boot.js?v=7.2.0"></script>


  

  

  

  
  
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unjkp.com/valine/dist/Valine.min.js"></script>  
  <script src="/js/src/Valine.min.js"></script> 

    
  
  <script src="/js/src/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'SsAWGcn6CHm6Oif4CGFKBhVv-gzGzoHsz',
        appKey: 'bniDOuxQuzVdGASyS3SyDFF8',
        placeholder: 'è¯´ç‚¹ä»€ä¹ˆå§ï¼',
        avatar:'wavatar',
        guest_info:['nick'] ,  
        pageSize:'10' || 10,
    });
    var infoEle = document.querySelector('#comments .info');
    if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0){
      infoEle.childNodes.forEach(function(item) {
        item.parentNode.removeChild(item);
      });
    }
  </script>




  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

  


  
   <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;"></canvas> 
   <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
   <script type="text/javascript" src="/js/src/fireworks.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body>
</html>
