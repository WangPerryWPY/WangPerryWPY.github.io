<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>PerryWangğŸåšå®¢</title>
  
  <subtitle>åˆ†äº«è½¯ä»¶å¼€å‘ä¸­å­¦åˆ°çš„ç‚¹æ»´çŸ¥è¯†</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-07-31T04:57:55.499Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>PerryWang</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>iOSvsFlutter</title>
    <link href="http://yoursite.com/2019/07/31/iOSvsFlutter/"/>
    <id>http://yoursite.com/2019/07/31/iOSvsFlutter/</id>
    <published>2019-07-31T04:52:08.000Z</published>
    <updated>2019-07-31T04:57:55.499Z</updated>
    
    <content type="html"><![CDATA[<h2 id="iOS-vs-Flutter-è¯­æ³•ç¯‡"><a href="#iOS-vs-Flutter-è¯­æ³•ç¯‡" class="headerlink" title="iOS vs Flutter(è¯­æ³•ç¯‡)"></a>iOS vs Flutter(è¯­æ³•ç¯‡)</h2><p>é¦–å…ˆè¯´ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆè¦å…³å¿ƒiOSå’ŒFlutterçš„åŒºåˆ«é—®é¢˜ã€‚å› ä¸ºç§»åŠ¨ç«¯å¼€å‘çš„ä¸šåŠ¡é€»è¾‘è®¾è®¡æ¨¡å¼ç­‰æ˜¯ä¸€è‡´çš„ï¼ŒåŒºåˆ«å¯èƒ½åªåœ¨äºä½¿ç”¨çš„è¯­è¨€ä¸åŒï¼Œå®ç°é€»è¾‘çš„é£æ ¼ä¸åŒè€Œå·²ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å…ˆåˆ†æä¸€ä¸‹iOSå’ŒFlutterçš„åŒºåˆ«åˆ°åº•æœ‰å“ªäº›ï¼Œæœ‰åˆ©äºæˆ‘ä»¬æ›´å¿«åœ°å»å…¥é—¨ã€‚</p><a id="more"></a><h3 id="ç”Ÿå‘½å‘¨æœŸï¼š"><a href="#ç”Ÿå‘½å‘¨æœŸï¼š" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸï¼š"></a>ç”Ÿå‘½å‘¨æœŸï¼š</h3><h4 id="é¡µé¢åŠ è½½çš„ç”Ÿå‘½å‘¨æœŸï¼š"><a href="#é¡µé¢åŠ è½½çš„ç”Ÿå‘½å‘¨æœŸï¼š" class="headerlink" title="é¡µé¢åŠ è½½çš„ç”Ÿå‘½å‘¨æœŸï¼š"></a>é¡µé¢åŠ è½½çš„ç”Ÿå‘½å‘¨æœŸï¼š</h4><p>ç§»åŠ¨ç«¯å¼€å‘é¦–å…ˆè¦å…³æ³¨çš„ä¸€ç‚¹è‚¯å®šè¦äº†è§£ä¸€ä¸ªé¡µé¢åŠ è½½çš„ç”Ÿå‘½å‘¨æœŸï¼Œå°±åƒäº†è§£iOSçš„viewcontrollerçš„ç”Ÿå‘½å‘¨æœŸåœ¨UIç»˜åˆ¶çš„åœºæ™¯ä¸­æœ‰å¤šä¹ˆé‡è¦ï¼š</p><h5 id="iOSï¼š"><a href="#iOSï¼š" class="headerlink" title="iOSï¼š"></a>iOSï¼š</h5><p>iOSçš„è®¾è®¡åˆè¡·å°±æ˜¯MVCï¼Œæ‰€ä»¥iOSä¸­çš„æ ¸å¿ƒæ˜¯Controllerã€‚æ¯ä¸ªControlleréƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">//ç±»çš„åˆå§‹åŒ–æ–¹æ³•</span><br><span class="line">+ (void)initialize;</span><br><span class="line">//å¯¹è±¡åˆå§‹åŒ–æ–¹æ³•</span><br><span class="line">- (instancetype)init;</span><br><span class="line">//ä»å½’æ¡£åˆå§‹åŒ–</span><br><span class="line">- (instancetype)initWithCoder:(NSCoder *)coder;</span><br><span class="line">//åŠ è½½è§†å›¾</span><br><span class="line">-(void)loadView;</span><br><span class="line">//å°†è¦åŠ è½½è§†å›¾</span><br><span class="line">- (void)viewDidLoad;</span><br><span class="line">//å°†è¦å¸ƒå±€å­è§†å›¾</span><br><span class="line">-(void)viewWillLayoutSubviews;</span><br><span class="line">//å·²ç»å¸ƒå±€å­è§†å›¾</span><br><span class="line">-(void)viewDidLayoutSubviews;</span><br><span class="line">//å†…å­˜è­¦å‘Š</span><br><span class="line">- (void)didReceiveMemoryWarning;</span><br><span class="line">//å·²ç»å±•ç¤º</span><br><span class="line">-(void)viewDidAppear:(BOOL)animated;</span><br><span class="line">//å°†è¦å±•ç¤º</span><br><span class="line">-(void)viewWillAppear:(BOOL)animated;</span><br><span class="line">//å°†è¦æ¶ˆå¤±</span><br><span class="line">-(void)viewWillDisappear:(BOOL)animated;</span><br><span class="line">//å·²ç»æ¶ˆå¤±</span><br><span class="line">-(void)viewDidDisappear:(BOOL)animated;</span><br><span class="line">//è¢«é‡Šæ”¾</span><br><span class="line">-(void)dealloc;</span><br></pre></td></tr></table></figure><h5 id="flutterï¼š"><a href="#flutterï¼š" class="headerlink" title="flutterï¼š"></a>flutterï¼š</h5><p>è¿™ä¸€ç‚¹flutteråˆ™æœ‰æ‰€ä¸åŒï¼Œflutteré¡µé¢åŠ è½½çš„æ ¸å¿ƒåˆ™æ˜¯buildä¸€æ£µæ¸²æŸ“æ ‘çš„è¿‡ç¨‹ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20190729161208558.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¦‚å›¾æ‰€ç¤ºå¤§ä½“ä¸Šå®ƒçš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªè¿‡ç¨‹ï¼šåˆå§‹åŒ–ï¼ŒçŠ¶æ€æ”¹å˜ï¼Œé”€æ¯ã€‚æ¯ä¸€æ¬¡buildéƒ½æ˜¯é¡µé¢çš„ä¸€æ¬¡åŠ è½½ã€‚</p><p><strong>didUpdateWidget</strong>: Flutterä¸­çš„Widgetåˆ†ä¸ºä¸¤ç§ï¼šstateful(çŠ¶æ€å¯å˜)å’Œstateless(çŠ¶æ€ä¸å¯å˜)ã€‚å¦‚æœæ˜¯statefulçš„widgetéœ€è¦å®ç°setStateæ–¹æ³•ã€‚å½“è°ƒç”¨äº† setState å°† Widget çš„çŠ¶æ€è¢«æ”¹å˜æ—¶ didUpdateWidget ä¼šè¢«è°ƒç”¨ï¼ŒFlutter ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Widget æ¥ç»‘å®šè¿™ä¸ª Stateï¼Œå¹¶åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¼ é€’æ—§çš„ Widget ï¼Œå› æ­¤å¦‚æœä½ æƒ³æ¯”å¯¹æ–°æ—§ Widget å¹¶ä¸”å¯¹ State åšä¸€äº›è°ƒæ•´ï¼Œä½ å¯ä»¥ç”¨å®ƒï¼Œå¦å¤–å¦‚æœä½ çš„æŸäº› Widget ä¸Šæ¶‰åŠåˆ° controller çš„å˜æ›´ï¼Œè¦ä¹ˆä¸€å®šè¦åœ¨è¿™ä¸ªå›è°ƒæ–¹æ³•ä¸­ç§»é™¤æ—§çš„ controller å¹¶åˆ›å»ºæ–°çš„ controller ç›‘å¬ã€‚</p><p><strong>dispose</strong>ï¼šæŸäº›æƒ…å†µä¸‹ä½ çš„ Widget è¢«é‡Šæ”¾äº†ï¼Œä¸€ä¸ªå¾ˆç»å…¸çš„ä¾‹å­æ˜¯ Navigator.pop è¢«è°ƒç”¨ï¼Œå¦‚æœè¢«é‡Šæ”¾çš„ Widget ä¸­æœ‰ä¸€äº›ç›‘å¬æˆ–æŒä¹…åŒ–çš„å˜é‡ï¼Œä½ éœ€è¦åœ¨ dispose ä¸­è¿›è¡Œé‡Šæ”¾ã€‚å¾ˆé‡è¦çš„ä¸€ä¸ªåº”ç”¨æ˜¯åœ¨ Bloc æˆ– Stream æ—¶åœ¨è¿™ä¸ªå›è°ƒæ–¹æ³•ä¸­å»å…³é—­ Streamã€‚</p><p>å¯å‚è€ƒåšå®¢ï¼š<a href="https://segmentfault.com/a/1190000015211309" target="_blank" rel="noopener">https://segmentfault.com/a/1190000015211309</a></p><h4 id="App-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#App-çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="App çš„ç”Ÿå‘½å‘¨æœŸ"></a>App çš„ç”Ÿå‘½å‘¨æœŸ</h4><p>iOSä¸­çš„APPçš„ç”Ÿå‘½å‘¨æœŸåœ¨appdelegateé‡Œè®¾ç½®ï¼Œè¿™é‡Œä¸å¤šè¯´ã€‚</p><p>è€Œåœ¨flutterä¸­å¦‚æœæˆ‘ä»¬æƒ³ç›‘å¬ App çº§åˆ«çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥é€šè¿‡å‘Binding ä¸­æ·»åŠ ä¸€ä¸ªôµô´¥ô°²ô±€ Observerï¼ŒåŒæ—¶è¦å®ç°didChangeAppLifecycleStateæ¥ç›‘å¬æŒ‡å®šäº‹ä»¶çš„åˆ°æ¥ï¼Œå¹¶ä¸”æœ€åè¿˜éœ€è¦åœ¨ dispose å›è°ƒæ–¹æ³•ä¸­ç§»é™¤è¿™ä¸ªç›‘å¬ã€‚ä½†é™åˆ¶æ˜¯å®ƒåœ¨iOSå¹³å°æ™ºèƒ½ç›‘å¬ä¸‰ç§çŠ¶æ€ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">class LifeCycleDemoState extends State&lt;MyHomePage&gt; with WidgetsBindingObserver &#123;</span><br><span class="line">     @override</span><br><span class="line">     void initState() &#123;</span><br><span class="line">       super.initState();</span><br><span class="line">       WidgetsBinding.instance.addObserver(this);</span><br><span class="line">     &#125;</span><br><span class="line">     @override</span><br><span class="line">     void didChangeAppLifecycleState(AppLifecycleState state) &#123;</span><br><span class="line">       super.didChangeAppLifecycleState(state);</span><br><span class="line">       switch (state) &#123;</span><br><span class="line">         case AppLifecycleState.inactive:</span><br><span class="line">           print(&apos;Application Lifecycle inactive&apos;);</span><br><span class="line">           break;</span><br><span class="line">         case AppLifecycleState.paused:</span><br><span class="line">           print(&apos;Application Lifecycle paused&apos;);</span><br><span class="line">           break;</span><br><span class="line">         case AppLifecycleState.resumed:</span><br><span class="line">           print(&apos;Application Lifecycle resumed&apos;);</span><br><span class="line">           break;</span><br><span class="line">         default:</span><br><span class="line">           print(&apos;Application Lifecycle other&apos;);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br><span class="line">    @override</span><br><span class="line">    void dispose()&#123;</span><br><span class="line">      WidgetsBinding.instance.removeObserver(this);</span><br><span class="line">      super.dispose();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¦ç»†ä½¿ç”¨æºç çœ‹è¿™é‡Œï¼š<a href="https://github.com/flutter/flutter/blob/master/packages/flutter/lib/src/widgets/binding.dart" target="_blank" rel="noopener">https://github.com/flutter/flutter/blob/master/packages/flutter/lib/src/widgets/binding.dart</a></p><h3 id="å¸ƒå±€ï¼š"><a href="#å¸ƒå±€ï¼š" class="headerlink" title="å¸ƒå±€ï¼š"></a>å¸ƒå±€ï¼š</h3><p>Flutterçš„å¸ƒå±€é¦–å…ˆè¦å»ºç«‹ä¸€æ£µWidgetæ ‘(åˆ†æä¸€ä¸‹UIå›¾å»ºç«‹ä¸€æ£µæ§ä»¶æ ‘)ï¼Œæ ¹æ®æ ‘çš„ç»“æ„å±‚å±‚åµŒå¥—Widgetæ§ä»¶ã€‚marginå’Œpaddingç­‰çš„çº¦æŸå¸ƒå±€è®¾ç½®åˆ™æœ‰ç‚¹ç±»ä¼¼cssã€‚</p><h4 id="UIView-gt-Widgets"><a href="#UIView-gt-Widgets" class="headerlink" title="UIView =&gt; Widgets"></a>UIView =&gt; Widgets</h4><p><strong>iOS</strong>ï¼šUIViewå¯å˜ï¼ŒUIViewå‘ç”Ÿæ”¹å˜æœ¬è´¨ä¸Šæ˜¯é—´æ¥è°ƒç”¨(å®˜æ–¹å»ºè®®ä¸è¦æ˜¾å¼è°ƒç”¨ï¼Œå› ä¸ºè¿™å¼€é”€å¾ˆå¤§)äº†LayoutSubviewsæ–¹æ³•è¿›è¡Œå¸ƒå±€ä¸Šçš„é‡æ„ï¼ŒdrawRectè¿›è¡Œæ˜¾ç¤ºä¸Šçš„é‡æ„ï¼ŒupdateConstrainsè¿›è¡Œçº¦æŸä¸Šçš„é‡æ„ã€‚ä¸‰è€…çš„æ›´æ–°ä¼šåœ¨æ¯æ¬¡RunLoopä¹‹åè¿›è¡Œupdate cycleæ“ä½œ(ä¹Ÿå¯ä»¥è°ƒç”¨layoutIfNeededç­‰æ–¹æ³•è¿›è¡Œç«‹åˆ»æ›´æ–°)ã€‚(æ¨èä¸€ç¯‡è®²è¿°å¸ƒå±€ä¸é”™çš„æ–‡ç« ï¼š<a href="https://juejin.im/post/5a951c655188257a804abf94" target="_blank" rel="noopener">https://juejin.im/post/5a951c655188257a804abf94</a>)</p><p><strong>Flutter</strong>ï¼šWidgetä¸å¯å˜ï¼Œä¹Ÿæ­£æ˜¯ç”±äºä¸å¯å˜æ€§ï¼Œä½¿å¾—Widgetæ¯”èµ·UIViewæ¥è¯´æ›´è½»é‡ï¼Œå› ä¸ºå®ƒä¸æ˜¯æ§ä»¶ï¼Œåªæ˜¯UIçš„æè¿°ã€‚</p><ul><li>widgetçš„åˆ†ä¸ºStateful(çŠ¶æ€å¯å˜)å’ŒStateless(çŠ¶æ€ä¸å¯å˜)ä¸¤ç§ï¼ŒStatefulæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸å¯å˜çš„ï¼Œå®ƒåªæ˜¯å°†çŠ¶æ€æ‹†åˆ†åˆ°Stateä¸­å»ç®¡ç†ã€‚Stateä¼šå­˜å‚¨Widgetçš„çŠ¶æ€æ•°æ®ï¼Œå¹¶åœ¨widgetæ ‘é‡å»ºæ—¶æºå¸¦ç€å®ƒï¼Œå› æ­¤çŠ¶æ€ä¸ä¼šä¸¢å¤±ã€‚</li><li>å³ä½¿ä¸€ä¸ªwidgetæ˜¯æœ‰çŠ¶æ€çš„ï¼ŒåŒ…å«å®ƒçš„çˆ¶äº²çš„widgetä¹Ÿå¯ä»¥æ˜¯æ— çŠ¶æ€çš„ï¼Œåªè¦çˆ¶widgetæœ¬èº«ä¸å“åº”è¿™äº›å˜åŒ–å³å¯ã€‚</li><li>åœ¨UIæ›´æ–°è¿™ä¸€ç‚¹ä¸Šæ„Ÿè§‰flutterä¼šæ¯”iOSè¦éº»çƒ¦ä¸€ç‚¹ï¼Œä¾‹å¦‚ç‚¹å‡»æŒ‰é’®å¯¼è‡´Textçš„æ–‡å­—å‘ç”Ÿå˜åŒ–ï¼ŒiOSåªéœ€è¦ç®€å•çš„target-actionå°±å¯ä»¥ï¼Œè€Œflutteråˆ™éœ€è¦å°†æ— çŠ¶æ€çš„textå¥—åœ¨ä¸€ä¸ªStatefulWidgetçˆ¶ç±»é‡Œé¢æ‰å¯ä»¥ã€‚</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SampleApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">'My App'</span>,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">      ),</span><br><span class="line">      home: SampleAppPage(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SampleAppPage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  SampleAppPage(&#123;Key key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _SampleAppPageState createState() =&gt; _SampleAppPageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_SampleAppPageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">SampleAppPage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// Default placeholder text</span></span><br><span class="line">  <span class="built_in">String</span> textToShow = <span class="string">"Flutter"</span>;</span><br><span class="line">  <span class="keyword">void</span> _updateText() &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      <span class="comment">// update the text</span></span><br><span class="line">      textToShow = <span class="string">"Text is changed!"</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">"My App"</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(child: Text(textToShow)),</span><br><span class="line">      floatingActionButton: FloatingActionButton(</span><br><span class="line">        onPressed: _updateText,</span><br><span class="line">        child: Icon(Icons.update),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="built_in">UIButton</span> *button = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeSystem</span>];</span><br><span class="line">    button.frame = <span class="built_in">CGRectMake</span>(<span class="number">300</span>, <span class="number">600</span>, <span class="number">80</span>, <span class="number">40</span>);</span><br><span class="line">    [button setTitle:<span class="string">@"ç‚¹å‡»"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [button addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(onClick) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:button];</span><br><span class="line">    <span class="keyword">self</span>.textField = [[<span class="built_in">UITextField</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">300</span>, <span class="number">200</span>, <span class="number">60</span>)];</span><br><span class="line">    <span class="keyword">self</span>.textField.text = <span class="string">@"iOS"</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.textField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>) onClick</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.textField.text = <span class="string">@"text has changed!"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨å¸ƒå±€æ–¹é¢ï¼ŒiOSåˆ†ä¸ºxibå’Œstoryboardè¿˜æœ‰ä»£ç å¸ƒå±€çš„æ–¹å¼ï¼Œflutteræ¯”è¾ƒç»Ÿä¸€ï¼Œé€šè¿‡å»ºç«‹ä¸€æ£µwidgetæ ‘è¿›è¡Œå¸ƒå±€ï¼ŒåŒæ—¶è¿˜æœ‰ç±»ä¼¼Centerï¼ŒColumnç­‰Widgetè¿›è¡Œå¸ƒå±€ã€‚æ·»åŠ çº¦æŸçš„è¯ï¼ŒiOSé€šè¿‡autolayoutæ¥æ·»åŠ çº¦æŸï¼Œè€Œflutteråˆ™æ˜¯é€šè¿‡ä½¿ç”¨containerå®¹å™¨æ·»åŠ paddingï¼Œmarginç­‰å±æ€§æ¥æ·»åŠ çº¦æŸã€‚è¿™ç‚¹éå¸¸ç±»ä¼¼htmlå’Œcssçš„å¸ƒå±€åŸç†ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul><p><img src="https://img-blog.csdnimg.cn/2019072916124644.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li><p>çˆ¶å­è§†å›¾çš„ç§»é™¤æ–¹é¢ï¼Œæ¯”å¦‚è¯´ä¸¾ä¸ªå¸¸è§çš„ä¾‹å­ï¼Œä¸€ä¸ªboolå€¼çš„æ”¹å˜å¯¼è‡´ä¸¤ä¸ªè§†å›¾çš„åˆ‡æ¢ï¼ŒiOSéœ€è¦åœ¨çˆ¶viewä¸­è°ƒç”¨addSubview()æˆ–åœ¨å­viewä¸­è°ƒç”¨removeFromSuperView() æ¥åŠ¨æ€æ·»åŠ æˆ–ç§»é™¤å­viewï¼Œå¦‚æœæ¶‰åŠåˆ°ä¸€äº›ä¼ å€¼é—®é¢˜å¯èƒ½è¿˜éœ€è¦é€šè¿‡è§‚å¯Ÿè€…æ¨¡å¼æ¥è§‚å¯Ÿboolå€¼çš„æ›´æ–°ã€‚è€Œåœ¨flutterä¸­åˆ™éœ€è¦å‘çˆ¶widgetä¸­ä¼ å…¥ä¸€ä¸ªè¿”å›widgetçš„å‡½æ•°ï¼Œå¹¶ç”¨boolæ¥æ§åˆ¶å­widgetçš„åˆ›å»ºã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SampleApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">'Sample App'</span>,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">      ),</span><br><span class="line">      home: SampleAppPage(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SampleAppPage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  SampleAppPage(&#123;Key key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _SampleAppPageState createState() =&gt; _SampleAppPageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_SampleAppPageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">SampleAppPage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">bool</span> toggle = <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">void</span> _toggle() &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      toggle = !toggle;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _getToggleChild() &#123;</span><br><span class="line">    <span class="keyword">if</span> (toggle) &#123;</span><br><span class="line">      <span class="keyword">return</span> Text(<span class="string">'View One'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> CupertinoButton(</span><br><span class="line">        onPressed: () &#123;&#125;,</span><br><span class="line">        child: Text(<span class="string">'View Two'</span>),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">"Sample App"</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: _getToggleChild(),</span><br><span class="line">      ),</span><br><span class="line">      floatingActionButton: FloatingActionButton(</span><br><span class="line">        onPressed: _toggle,</span><br><span class="line">        tooltip: <span class="string">'Update Text'</span>,</span><br><span class="line">        child: Icon(Icons.update),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="built_in">UIButton</span> *button = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeSystem</span>];</span><br><span class="line">    button.frame = <span class="built_in">CGRectMake</span>(<span class="number">350</span>, <span class="number">750</span>, <span class="number">50</span>, <span class="number">30</span>);</span><br><span class="line">    [button setTitle:<span class="string">@"åˆ‡æ¢"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [button addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(onClick) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:button];</span><br><span class="line">    <span class="keyword">self</span>.textField = [[<span class="built_in">UITextField</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">300</span>, <span class="number">200</span>, <span class="number">60</span>)];</span><br><span class="line">    <span class="keyword">self</span>.textField.text = <span class="string">@"View 1"</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview: <span class="keyword">self</span>.textField];</span><br><span class="line">    <span class="keyword">self</span>.button2 = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeSystem</span>];</span><br><span class="line">    <span class="keyword">self</span>.button2.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">300</span>, <span class="number">200</span>, <span class="number">60</span>);</span><br><span class="line">    [<span class="keyword">self</span>.button2 setTitle:<span class="string">@"View 2"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>) onClick</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.textField.superview) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.textField removeFromSuperview];</span><br><span class="line">        [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.button2];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="keyword">self</span>.button2 removeFromSuperview];</span><br><span class="line">        [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.textField];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="å¯¼èˆª"><a href="#å¯¼èˆª" class="headerlink" title="å¯¼èˆª"></a>å¯¼èˆª</h3><h4 id="UIViewController-gt-Scaffold"><a href="#UIViewController-gt-Scaffold" class="headerlink" title="UIViewController =&gt; Scaffold"></a>UIViewController =&gt; Scaffold</h4><p>Flutterä¸­æ²¡æœ‰ä¸“é—¨ç”¨æ¥ç®¡ç†è§†å›¾è€Œä¸”ç±»ä¼¼é‚£ç§å’ŒViewä¸€å¯¹ä¸€çš„Controllerç±»ã€‚æœ‰ç±»ä¼¼çš„Scaffoldï¼Œå…¶åŒ…å«æ§åˆ¶å™¨çš„appBarï¼Œä¹Ÿå¯ä»¥é€šè¿‡bodyè®¾ç½®ä¸€ä¸ªwidgetæ¥åšå…¶è§†å›¾ã€‚</p><h4 id="é¡µé¢è·³è½¬"><a href="#é¡µé¢è·³è½¬" class="headerlink" title="é¡µé¢è·³è½¬"></a>é¡µé¢è·³è½¬</h4><p>iOSæœ‰UINavigationControlleræ ˆè¿›è¡Œpushï¼Œpopæ“ä½œï¼Œå…¶å¹¶ä¸è´Ÿè´£æ˜¾ç¤ºï¼Œè€Œæ˜¯è´Ÿè´£å„ä¸ªé¡µé¢è·³è½¬ã€‚æˆ–è€…ä½¿ç”¨æ¨¡æ€è§†å›¾ã€‚</p><p>åŒæ—¶æ³¨æ„iOSé€šè¿‡navigationControllerå¯¼èˆªæ—¶è¦è®°å¾—æ·»åŠ NavigationControllerï¼Œå¯åœ¨stroyboardè®¾ç½®ï¼Œå¦‚æœä»£ç çš„è¯æ·»åŠ å¦‚ä¸‹ï¼š</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ViewController *vc = [ViewController new];</span><br><span class="line"><span class="built_in">UINavigationController</span> *navigation = [[<span class="built_in">UINavigationController</span> alloc] initWithRootViewController:vc];</span><br><span class="line"><span class="keyword">self</span>.window.rootViewController = navigation;</span><br><span class="line">[<span class="keyword">self</span>.window makeKeyWindow];</span><br></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// --------  ViewController  --------</span></span><br><span class="line">-(NextViewController *)next</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_next)</span><br><span class="line">    &#123;</span><br><span class="line">        _next = [NextViewController new];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    <span class="built_in">UIButton</span> *button = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeSystem</span>];</span><br><span class="line">    button.frame = <span class="built_in">CGRectMake</span>(<span class="number">350</span>, <span class="number">750</span>, <span class="number">50</span>, <span class="number">30</span>);</span><br><span class="line">    [button setTitle:<span class="string">@"åˆ‡æ¢"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [button addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(onClick) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:button];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>) onClick</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:<span class="keyword">self</span>.next animated:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">// [self presentViewController:self.next animated:YES completion:nil];</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// --------  NextViewController  --------</span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="built_in">UIButton</span> *button = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeSystem</span>];</span><br><span class="line">    button.frame = <span class="built_in">CGRectMake</span>(<span class="number">350</span>, <span class="number">750</span>, <span class="number">50</span>, <span class="number">30</span>);</span><br><span class="line">    [button setTitle:<span class="string">@"è¿”å›"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [button addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(onClick) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:button];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>) onClick</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">// [self dismissViewControllerAnimated:YES completion:nil];</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Flutterä¸­å¯ä»¥å°†MaterialAppç†è§£ä¸ºiOSçš„å¯¼èˆªæ§åˆ¶å™¨ï¼Œå…¶åŒ…å«ä¸€ä¸ªnavigationBarä»¥åŠå¯¼èˆªæ ˆï¼Œè¿™ç‚¹å’ŒiOSæ˜¯ä¸€æ ·çš„ã€‚</p><p>Flutterä¸­ä½¿ç”¨äº† <code>Navigator</code> å’Œ <code>Routes</code>ã€‚ä¸€ä¸ªè·¯ç”±æ˜¯ App ä¸­â€œå±å¹•â€æˆ–â€œé¡µé¢â€çš„æŠ½è±¡ï¼Œè€Œä¸€ä¸ª Navigator æ˜¯ç®¡ç†å¤šä¸ªè·¯ç”±çš„ widgetã€‚å¯ä»¥ç²—ç•¥åœ°æŠŠä¸€ä¸ªè·¯ç”±å¯¹åº”åˆ°ä¸€ä¸ª <code>UIViewController</code>ã€‚Navigator çš„å·¥ä½œåŸç†å’Œ iOS ä¸­ <code>UINavigationController</code> éå¸¸ç›¸ä¼¼ï¼Œå½“ä½ æƒ³è·³è½¬åˆ°æ–°é¡µé¢æˆ–è€…ä»æ–°é¡µé¢è¿”å›æ—¶ï¼Œå®ƒå¯ä»¥ <code>push()</code> å’Œ <code>pop()</code> è·¯ç”±ã€‚</p><p>åœ¨é¡µé¢ä¹‹é—´è·³è½¬ï¼Œæœ‰å¦‚ä¸‹é€‰æ‹©ï¼š</p><ul><li>å…·ä½“æŒ‡å®šä¸€ä¸ªç”±è·¯ç”±åæ„æˆçš„ <code>Map</code>ã€‚ï¼ˆMaterialAppï¼‰</li><li>ç›´æ¥è·³è½¬åˆ°ä¸€ä¸ªè·¯ç”±ã€‚ï¼ˆWidgetAppï¼‰</li></ul><p>ä¸‹é¢æ˜¯æ„å»ºä¸€ä¸ª Map çš„ä¾‹å­ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(MaterialApp(</span><br><span class="line">    home: MyAppHome(), <span class="comment">// becomes the route named '/'</span></span><br><span class="line">    routes: &lt;<span class="built_in">String</span>, WidgetBuilder&gt; &#123;</span><br><span class="line">      <span class="string">'/a'</span>: (BuildContext context) =&gt; MyPage(title: <span class="string">'page A'</span>),</span><br><span class="line">      <span class="string">'/b'</span>: (BuildContext context) =&gt; MyPage(title: <span class="string">'page B'</span>),</span><br><span class="line">      <span class="string">'/c'</span>: (BuildContext context) =&gt; MyPage(title: <span class="string">'page C'</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æŠŠè·¯ç”±çš„åå­— <code>push</code> ç»™ä¸€ä¸ª <code>Navigator</code> æ¥è·³è½¬ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Navigator.of(context).pushNamed(<span class="string">'/b'</span>);</span><br></pre></td></tr></table></figure><h4 id="é¡µé¢ä¼ å€¼"><a href="#é¡µé¢ä¼ å€¼" class="headerlink" title="é¡µé¢ä¼ å€¼"></a>é¡µé¢ä¼ å€¼</h4><p>iOSä¸­é¡µé¢ä¼ å€¼æ­£å‘ç›´æ¥é€šè¿‡å±æ€§ä¼ è¾“å³å¯ï¼Œåå‘çš„è¯å¯ä»¥é€šè¿‡Blockï¼Œdelegateï¼Œé€šçŸ¥ç­‰æ–¹å¼è¿›è¡Œä¼ å€¼ã€‚</p><p>è€Œåœ¨Flutterä¸­åå‘ä¼ å€¼å°±ç®€å•äº†å¾ˆå¤šï¼Œä¸¾ä¸ªä¾‹å­ï¼Œè¦è·³è½¬åˆ°â€œä½ç½®â€è·¯ç”±æ¥è®©ç”¨æˆ·é€‰æ‹©ä¸€ä¸ªåœ°ç‚¹ï¼Œå¯èƒ½è¦è¿™ä¹ˆåšï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Map</span> coordinates = <span class="keyword">await</span> Navigator.of(context).pushNamed(<span class="string">'/location'</span>);</span><br></pre></td></tr></table></figure><p>ä¹‹åï¼Œåœ¨ location è·¯ç”±ä¸­ï¼Œä¸€æ—¦ç”¨æˆ·é€‰æ‹©äº†åœ°ç‚¹ï¼Œæºå¸¦ç»“æœä¸€èµ· <code>pop()</code> å‡ºæ ˆï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Navigator.of(context).pop(&#123;<span class="string">"lat"</span>:<span class="number">43.821757</span>,<span class="string">"long"</span>:<span class="number">-79.226392</span>&#125;);</span><br></pre></td></tr></table></figure><h3 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h3><h4 id="RunLoop-VS-EventLoop"><a href="#RunLoop-VS-EventLoop" class="headerlink" title="RunLoop VS EventLoop"></a><code>RunLoop</code> <strong>VS</strong> <code>EventLoop</code></h4><p>è¯´èµ·Flutterçš„å¤šçº¿ç¨‹å‰å…ˆè°ˆä¸€ä¸‹Flutterä¸­çš„Event Loopã€‚æˆ‘ä»¬éƒ½çŸ¥é“å‰ç«¯å¼€å‘æ¡†æ¶å¤§éƒ½æ˜¯äº‹ä»¶é©±åŠ¨çš„ã€‚æ„å‘³ç€ç¨‹åºä¸­å¿…ç„¶å­˜åœ¨äº‹ä»¶å¾ªç¯å’Œäº‹ä»¶é˜Ÿåˆ—ã€‚äº‹ä»¶å¾ªç¯ä¼šä¸æ–­åœ°ä»äº‹ä»¶é˜Ÿåˆ—ä¸­è·å–å’Œå¤„ç†å„ç§äº‹ä»¶ã€‚</p><p><strong>iOS</strong>ï¼šiOSä¸­çš„ç±»ä¼¼æœºåˆ¶æ˜¯RunLoopï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªRunLoopObserveræ¥å®ç°å¯¹RunLoopçš„è§‚å¯Ÿï¼Œå½“é‡åˆ°Source0ï¼ŒSource1æˆ–è€…Timerç­‰äº‹ä»¶ä¼šè¿›è¡Œå¤„ç†ã€‚ä¸‹é¢å›¾å¯ä»¥å¾ˆæ¸…æ™°çš„ç†è§£æ•´ä¸ªè¿‡ç¨‹ã€‚(å…³äºRunLoopçš„è®²è§£æ¨èä¸€ç¯‡å¾ˆè¯¦ç»†çš„æ–‡ç« ï¼š<a href="https://juejin.im/post/5add46606fb9a07abf721d1d" target="_blank" rel="noopener">https://juejin.im/post/5add46606fb9a07abf721d1d</a>)</p><p><img src="https://img-blog.csdnimg.cn/20190729161323870.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>Flutter</strong>ï¼šFlutterä¸­çš„Event Loopå’ŒJavaScriptçš„åŸºæœ¬ä¸€æ ·ã€‚å¾ªç¯ä¸­æœ‰ä¸¤ä¸ªé˜Ÿåˆ—ã€‚ä¸€ä¸ªæ˜¯å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆMicroTask queueï¼‰ï¼Œä¸€ä¸ªæ˜¯äº‹ä»¶é˜Ÿåˆ—(Event queue)ã€‚è¿™é‡Œç±»ä¼¼iOSä¸­å­˜åœ¨seté‡Œé¢çš„Source0å’ŒSource1ã€‚</p><ul><li>event queue: ä¸»è¦æ˜¯å¤–éƒ¨äº‹ä»¶ï¼Œè´Ÿè´£å¤„ç†I/Oäº‹ä»¶ã€ç»˜åˆ¶äº‹ä»¶ã€æ‰‹åŠ¿äº‹ä»¶ã€Timerç­‰</li><li>microtask queueï¼šå¯ä»¥è‡ªå·±å‘<code>isolate</code>å†…éƒ¨æ·»åŠ äº‹ä»¶ï¼Œäº‹ä»¶çš„ä¼˜å…ˆçº§æ¯”<code>event queue</code>é«˜ã€‚</li></ul><p><img src="https://img-blog.csdnimg.cn/2019072916142898.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä¸¤ä¸ªé˜Ÿåˆ—æ˜¯æœ‰ä¼˜å…ˆçº§çš„ï¼Œå½“<code>isolate</code>å¼€å§‹æ‰§è¡Œåï¼Œä¼šå…ˆå¤„ç†<code>microtask</code>çš„äº‹ä»¶ï¼Œå½“<code>microtask</code>é˜Ÿåˆ—ä¸­æ²¡æœ‰äº‹ä»¶åï¼Œæ‰ä¼šå¤„ç†<code>event</code>é˜Ÿåˆ—ä¸­çš„äº‹ä»¶ï¼Œå¹¶æŒ‰ç…§è¿™ä¸ªé¡ºåºåå¤æ‰§è¡Œã€‚å½“æ‰§è¡Œ<code>microtask</code>çš„äº‹ä»¶æ—¶ä¼šé˜»å¡<code>event</code>é˜Ÿåˆ—ï¼Œè¿™ä¼šå¯¼è‡´æ¸²æŸ“å“åº”æ‰‹åŠ¿ç­‰<code>event</code>äº‹ä»¶å“åº”å»¶è¿Ÿã€‚ä¸ºä¿è¯æ¸²æŸ“å’Œæ‰‹åŠ¿å“åº”ï¼Œæ‰€ä»¥åº”å°½é‡å°†è€—æ—¶æ“ä½œæ”¾åˆ°<code>event</code>é˜Ÿåˆ—ä¸­ã€‚</p><h4 id="çº¿ç¨‹å’Œåç¨‹ï¼š"><a href="#çº¿ç¨‹å’Œåç¨‹ï¼š" class="headerlink" title="çº¿ç¨‹å’Œåç¨‹ï¼š"></a>çº¿ç¨‹å’Œåç¨‹ï¼š</h4><p>Flutterä¸­çš„å¤šçº¿ç¨‹å’Œå¼‚æ­¥æ˜¯æ¯”è¾ƒéš¾ç†è§£çš„ä¸€å—ã€‚å…ˆçœ‹ä¸¤ä¸ªè¯­æ³•ç³–ï¼š</p><ol><li><p>Futureï¼š</p><p>å­¦è¿‡jsçš„ç«¥é‹åº”è¯¥å¾ˆå®¹æ˜“ç†è§£è¿™å—äº†ï¼ŒFutureå°±æ˜¯jsé‡Œçš„Promiseï¼Œæ›¾ç»jsé‡Œé¢å»¶æ—¶åªèƒ½å±‚å±‚å›è°ƒï¼Œè¿™æ ·å¾ˆå®¹æ˜“é€ æˆå›è°ƒåœ°ç‹±ã€‚æ‰€ä»¥åº”è¿è€Œç”Ÿäº†Promise(Future)ï¼Œå®ƒæ˜¯ä¸€ä¸ªé“¾å¼æ“ä½œï¼Œå¯ä»¥é€šè¿‡è¿½åŠ thenæ–¹æ³•è¿›è¡Œå¤šå±‚å¤„ç†ã€‚</p></li><li><p>async/awaitï¼šç”¨æ³•å®Œå…¨æ²¿ç”¨è‡ªjsã€‚</p></li></ol><p><strong>å¤šåç¨‹ï¼š</strong></p><p>æˆ‘ä»¬æ‹†å¼€æ¥çœ‹ï¼Œé¦–å…ˆå¯¹äºå¼‚æ­¥æ“ä½œè¿™å—ï¼ŒflutteråŸºæœ¬ä¸Šæ˜¯æ²¿ç”¨ES6çš„asyncå’Œawaitè¿™äº›å¼‚æ­¥è¯­æ³•ç³–ä»¥åŠFutureã€‚è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªå’Œä¼ ç»Ÿæ„ä¹‰ä¸ä¸€æ ·çš„æ¦‚å¿µâ€”â€”åç¨‹(<a href="https://www.itcodemonkey.com/article/4620.htmlè¿™ç¯‡æ¼«ç”»è®²çš„æ¯”è¾ƒç”ŸåŠ¨ï¼Œhttps://www.zhihu.com/question/308641794è®²è§£ä¸ºä»€ä¹ˆåç¨‹æ¯”çº¿ç¨‹è¦å¥½)ï¼Œæœ€æ—©æ¥è§¦æ˜¯åœ¨pythoné‡Œæœ‰é‡åˆ°è¿‡ï¼Œåœ¨Flutterä¸­ï¼Œæ‰§è¡Œåˆ°asyncåˆ™è¡¨ç¤ºè¿›å…¥ä¸€ä¸ªåç¨‹ï¼Œä¼šåŒæ­¥æ‰§è¡Œasyncçš„ä»£ç å—ã€‚å½“æ‰§è¡Œåˆ°awaitæ—¶ï¼Œåˆ™è¡¨ç¤ºæœ‰ä»»åŠ¡éœ€è¦ç­‰å¾…ï¼ŒCPUåˆ™å»è°ƒåº¦æ‰§è¡Œå…¶ä»–IOã€‚è¿‡ä¸€æ®µæ—¶é—´CPUä¼šè½®è¯¢ä¸€æ¬¡æŸ¥çœ‹æŸä¸ªåç¨‹æ˜¯å¦ä»»åŠ¡å·²ç»å¤„ç†å®Œæˆï¼Œæœ‰è¿”å›ç»“æœå¯ä»¥è¢«ç»§ç»­æ‰§è¡Œï¼Œå¦‚æœå¯ä»¥è¢«ç»§ç»­æ‰§è¡Œçš„è¯ï¼Œåˆ™ä¼šæ²¿ç€ä¸Šæ¬¡ç¦»å¼€æ—¶æŒ‡é’ˆæŒ‡å‘çš„ä½ç½®ç»§ç»­æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯awaitæ ‡å¿—çš„ä½ç½®ã€‚" target="_blank" rel="noopener">https://www.itcodemonkey.com/article/4620.htmlè¿™ç¯‡æ¼«ç”»è®²çš„æ¯”è¾ƒç”ŸåŠ¨ï¼Œhttps://www.zhihu.com/question/308641794è®²è§£ä¸ºä»€ä¹ˆåç¨‹æ¯”çº¿ç¨‹è¦å¥½)ï¼Œæœ€æ—©æ¥è§¦æ˜¯åœ¨pythoné‡Œæœ‰é‡åˆ°è¿‡ï¼Œåœ¨Flutterä¸­ï¼Œæ‰§è¡Œåˆ°asyncåˆ™è¡¨ç¤ºè¿›å…¥ä¸€ä¸ªåç¨‹ï¼Œä¼šåŒæ­¥æ‰§è¡Œasyncçš„ä»£ç å—ã€‚å½“æ‰§è¡Œåˆ°awaitæ—¶ï¼Œåˆ™è¡¨ç¤ºæœ‰ä»»åŠ¡éœ€è¦ç­‰å¾…ï¼ŒCPUåˆ™å»è°ƒåº¦æ‰§è¡Œå…¶ä»–IOã€‚è¿‡ä¸€æ®µæ—¶é—´CPUä¼šè½®è¯¢ä¸€æ¬¡æŸ¥çœ‹æŸä¸ªåç¨‹æ˜¯å¦ä»»åŠ¡å·²ç»å¤„ç†å®Œæˆï¼Œæœ‰è¿”å›ç»“æœå¯ä»¥è¢«ç»§ç»­æ‰§è¡Œï¼Œå¦‚æœå¯ä»¥è¢«ç»§ç»­æ‰§è¡Œçš„è¯ï¼Œåˆ™ä¼šæ²¿ç€ä¸Šæ¬¡ç¦»å¼€æ—¶æŒ‡é’ˆæŒ‡å‘çš„ä½ç½®ç»§ç»­æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯awaitæ ‡å¿—çš„ä½ç½®ã€‚</a></p><p>iOSä¸­æœ‰æ²¡æœ‰ç±»ä¼¼çš„å®ç°å‘¢ï¼Œå…¶å®æ˜¯æœ‰çš„ï¼Œä¸ªäººæ„Ÿè§‰æ˜¯ä¸²è¡Œé˜Ÿåˆ—ä¸­çš„<code>dispatch_async</code>æ“ä½œï¼Œé‡åˆ°è€—æ—¶æ“ä½œä¹Ÿä¸ä¼šé˜»å¡ï¼Œè€Œæ˜¯æ”¾åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­ç­‰å¾…å½“å‰æ“ä½œæ‰§è¡Œå®Œå†ç»§ç»­æ‰§è¡Œã€‚Flutteråœ¨å½“æ‰§è¡Œåˆ°<code>await</code>æ—¶ï¼Œä¿å­˜å½“å‰çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶å°†å½“å‰ä½ç½®æ ‡è®°ä¸ºå¾…å¤„ç†ä»»åŠ¡ï¼Œç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å½“å‰ä½ç½®ï¼Œå¹¶å°†å¾…å¤„ç†ä»»åŠ¡æ”¾å…¥å½“å‰çº¿ç¨‹çš„é˜Ÿåˆ—ä¸­ã€‚åœ¨æ¯ä¸ªäº‹ä»¶å¾ªç¯æ—¶éƒ½å»è¯¢é—®è¿™ä¸ªä»»åŠ¡ï¼Œå¦‚æœéœ€è¦è¿›è¡Œå¤„ç†ï¼Œå°±æ¢å¤ä¸Šä¸‹æ–‡è¿›è¡Œä»»åŠ¡å¤„ç†ã€‚</p><p><strong>å¤šçº¿ç¨‹ï¼š</strong></p><p>è€Œasyncå’Œawaitæ˜¯æ²¿ç”¨è‡ªjsçš„ï¼Œä½†æœ‰ä¸€ç‚¹è¦æ³¨æ„çš„æ˜¯ï¼Œjsæ˜¯è„šæœ¬è¯­è¨€ï¼Œæ‰€ä»¥å¿…é¡»æ˜¯å•çº¿ç¨‹çš„ï¼Œåˆ°è¿™é‡Œå°±è¶³å¤Ÿäº†ã€‚è€Œflutteræ˜¯æ‰‹æœºæ¡†æ¶ï¼Œå¾ˆå¯èƒ½æˆ‘ä»¬è¦è¿›è¡Œå¾ˆè€—æ—¶çš„IOæ“ä½œï¼Œè¿™ä»…ä»…å‡­å¼‚æ­¥æ˜¯è§£å†³ä¸äº†çš„ï¼Œå¿…é¡»è¦å¤šçº¿ç¨‹ã€‚è¿™é‡Œflutterå¼•å…¥äº†æ–°çš„æ–¹æ¡ˆï¼Œå«åšisolateã€‚</p><p>ä½†isolateå’Œæ™®é€šçš„Threadè¿˜ä¸åŒï¼Œå®ƒå…·æœ‰ç‹¬ç«‹çš„å†…å­˜ï¼Œisolateé—´çš„é€šä¿¡é€šè¿‡portæ¥å®ç°ï¼Œè¿™ä¸ªportæ¶ˆæ¯ä¼ é€’çš„è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ã€‚å®ä¾‹åŒ–ä¸€ä¸ªisolateçš„è¿‡ç¨‹ä¹Ÿå°±æ˜¯å®ä¾‹åŒ–isolateè¿™ä¸ªç»“æ„ä½“ã€åœ¨å †ä¸­åˆ†é…çº¿ç¨‹å†…å­˜ï¼Œé…ç½®portã€‚</p><p>æ„Ÿè§‰ä»æ“ä½œæ¥çœ‹å…¶å®isolateæ›´åƒæ˜¯è¿›ç¨‹ï¼Œè€Œå®é™…asyncåˆ™æ›´åƒæ˜¯çº¿ç¨‹æ“ä½œã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">loadData() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡spawnæ–°å»ºä¸€ä¸ªisolateï¼Œå¹¶ç»‘å®šé™æ€æ–¹æ³•</span></span><br><span class="line">    ReceivePort receivePort =ReceivePort();</span><br><span class="line">    <span class="keyword">await</span> Isolate.spawn(dataLoader, receivePort.sendPort);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–æ–°isolateçš„ç›‘å¬port</span></span><br><span class="line">    SendPort sendPort = <span class="keyword">await</span> receivePort.first;</span><br><span class="line">    <span class="comment">// è°ƒç”¨sendReceiveè‡ªå®šä¹‰æ–¹æ³•</span></span><br><span class="line">    <span class="built_in">List</span> dataList = <span class="keyword">await</span> sendReceive(sendPort, <span class="string">'https://jsonplaceholder.typicode.com/posts'</span>);</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'dataList <span class="subst">$dataList</span>'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isolateçš„ç»‘å®šæ–¹æ³•</span></span><br><span class="line"><span class="keyword">static</span> dataLoader(SendPort sendPort) <span class="keyword">async</span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºç›‘å¬portï¼Œå¹¶å°†sendPortä¼ ç»™å¤–ç•Œç”¨æ¥è°ƒç”¨</span></span><br><span class="line">    ReceivePort receivePort =ReceivePort();</span><br><span class="line">    sendPort.send(receivePort.sendPort);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç›‘å¬å¤–ç•Œè°ƒç”¨</span></span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">for</span> (<span class="keyword">var</span> msg <span class="keyword">in</span> receivePort) &#123;</span><br><span class="line">      <span class="built_in">String</span> requestURL =msg[<span class="number">0</span>];</span><br><span class="line">      SendPort callbackPort =msg[<span class="number">1</span>];</span><br><span class="line">    </span><br><span class="line">      Client client = Client();</span><br><span class="line">      Response response = <span class="keyword">await</span> client.<span class="keyword">get</span>(requestURL);</span><br><span class="line">      <span class="built_in">List</span> dataList = json.decode(response.body);</span><br><span class="line">      <span class="comment">// å›è°ƒè¿”å›å€¼ç»™è°ƒç”¨è€…</span></span><br><span class="line">      callbackPort.send(dataList);</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºè‡ªå·±çš„ç›‘å¬portï¼Œå¹¶ä¸”å‘æ–°isolateå‘é€æ¶ˆæ¯</span></span><br><span class="line">Future sendReceive(SendPort sendPort, <span class="built_in">String</span> url) &#123;</span><br><span class="line">    ReceivePort receivePort =ReceivePort();</span><br><span class="line">    sendPort.send([url, receivePort.sendPort]);</span><br><span class="line">    <span class="comment">// æ¥æ”¶åˆ°è¿”å›å€¼ï¼Œè¿”å›ç»™è°ƒç”¨è€…</span></span><br><span class="line">    <span class="keyword">return</span> receivePort.first;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(ä»£ç å¼•ç”¨è‡ª<a href="https://lequ7.com/2019/04/26/richang/shen-ru-li-jie-Flutter-duo-xian-cheng/" target="_blank" rel="noopener">https://lequ7.com/2019/04/26/richang/shen-ru-li-jie-Flutter-duo-xian-cheng/</a>)</p><h4 id="ç½‘ç»œè¯·æ±‚å’Œæ•°æ®è§£æ"><a href="#ç½‘ç»œè¯·æ±‚å’Œæ•°æ®è§£æ" class="headerlink" title="ç½‘ç»œè¯·æ±‚å’Œæ•°æ®è§£æ"></a>ç½‘ç»œè¯·æ±‚å’Œæ•°æ®è§£æ</h4><p>è¿™ç‚¹ä¸åšè¯¦è¿°ï¼Œç†è§£äº†Dartçš„å¤šçº¿ç¨‹ä»¥åŠç½‘ç»œè¯·æ±‚çš„åŸºæœ¬åŸç†ä¹Ÿå¾ˆå®¹æ˜“ææ‡‚è¿™å—(<a href="https://flutterchina.club/networking/)ã€‚" target="_blank" rel="noopener">https://flutterchina.club/networking/)ã€‚</a></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ–‡ç« ä¸ä»æ€§èƒ½è¿›è¡Œåˆ†æï¼Œè€Œæ˜¯ä»…ä»…ä»è¯­æ³•æ–¹é¢è¿›è¡Œå…¥é—¨æ¯”å¯¹ã€‚å…¶å®å¦‚æœåšè¿‡Webå‰ç«¯çš„ç«¥é‹å­¦æœŸFlutteræ¥è¯´åº”è¯¥ä¼šæ¯”è¾ƒç®€å•ï¼Œå› ä¸ºFlutterä¸­çš„Widgetå¸ƒå±€æ–¹å¼å®Œå…¨ç±»ä¼¼äºhtmlå’Œcssã€‚è€ŒDartè¯­è¨€æœ¬èº«æœ‰éå¸¸åƒjsï¼Œå°¤å…¶æ˜¯ES6ç‰¹æ€§å¼•å…¥å¾ˆå¤šè¯­æ³•ç³–åçš„jsï¼Œè¿™äº›è¯­æ³•ç³–å¤§å¤§ç®€åŒ–äº†ä»£ç çš„å¤æ‚åº¦ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;iOS-vs-Flutter-è¯­æ³•ç¯‡&quot;&gt;&lt;a href=&quot;#iOS-vs-Flutter-è¯­æ³•ç¯‡&quot; class=&quot;headerlink&quot; title=&quot;iOS vs Flutter(è¯­æ³•ç¯‡)&quot;&gt;&lt;/a&gt;iOS vs Flutter(è¯­æ³•ç¯‡)&lt;/h2&gt;&lt;p&gt;é¦–å…ˆè¯´ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆè¦å…³å¿ƒiOSå’ŒFlutterçš„åŒºåˆ«é—®é¢˜ã€‚å› ä¸ºç§»åŠ¨ç«¯å¼€å‘çš„ä¸šåŠ¡é€»è¾‘è®¾è®¡æ¨¡å¼ç­‰æ˜¯ä¸€è‡´çš„ï¼ŒåŒºåˆ«å¯èƒ½åªåœ¨äºä½¿ç”¨çš„è¯­è¨€ä¸åŒï¼Œå®ç°é€»è¾‘çš„é£æ ¼ä¸åŒè€Œå·²ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å…ˆåˆ†æä¸€ä¸‹iOSå’ŒFlutterçš„åŒºåˆ«åˆ°åº•æœ‰å“ªäº›ï¼Œæœ‰åˆ©äºæˆ‘ä»¬æ›´å¿«åœ°å»å…¥é—¨ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Flutter" scheme="http://yoursite.com/categories/Flutter/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
      <category term="Flutter" scheme="http://yoursite.com/tags/Flutter/"/>
    
      <category term="Dart" scheme="http://yoursite.com/tags/Dart/"/>
    
      <category term="Objective" scheme="http://yoursite.com/tags/Objective/"/>
    
  </entry>
  
  <entry>
    <title>iOS || ç¼“å­˜NSCacheè¯¦è§£</title>
    <link href="http://yoursite.com/2019/07/11/%E7%BC%93%E5%AD%98NSCache%E8%AF%A6%E8%A7%A3/"/>
    <id>http://yoursite.com/2019/07/11/ç¼“å­˜NSCacheè¯¦è§£/</id>
    <published>2019-07-10T16:26:23.000Z</published>
    <updated>2019-07-10T16:36:12.524Z</updated>
    
    <content type="html"><![CDATA[<h3 id="NSCache"><a href="#NSCache" class="headerlink" title="NSCache"></a>NSCache</h3><p>NSCacheä½¿ç”¨å¾ˆæ–¹ä¾¿ï¼Œæä¾›äº†ç±»ä¼¼å¯å˜å­—å…¸çš„å®ç°æ–¹å¼ï¼Œä½†å®ƒæ¯”å¯å˜å­—å…¸æ›´é€‚ç”¨äºå®ç°ç¼“å­˜ã€‚</p><ul><li>æœ€é‡è¦çš„åŸå› æ˜¯<code>NSCache</code>æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½¿ç”¨<code>NSMutableDictionary</code>è‡ªå®šä¹‰å®ç°ç¼“å­˜çš„æ—¶å€™éœ€è¦è€ƒè™‘åŠ é”å’Œé‡Šæ”¾é”ï¼Œ<code>NSCache</code>å·²ç»å¸®æˆ‘ä»¬åšå¥½äº†è¿™ä¸€æ­¥ã€‚</li><li>å…¶æ¬¡ï¼Œå†…å­˜ä¸è¶³æ—¶<code>NSCache</code>ä¼šè‡ªåŠ¨é‡Šæ”¾å­˜å‚¨çš„å¯¹è±¡ï¼Œä¸éœ€è¦æ‰‹åŠ¨å¹²é¢„ï¼Œå¦‚æœæ˜¯è‡ªå®šä¹‰å®ç°éœ€è¦ç›‘å¬å†…å­˜çŠ¶æ€ç„¶ååšè¿›ä¸€æ­¥åˆ é™¤å¯¹è±¡çš„æ“ä½œã€‚</li><li>è¿˜æœ‰ä¸€ç‚¹<code>NSCache</code>çš„é”®<code>key</code>ä¸ä¼šè¢«å¤åˆ¶ï¼Œæ‰€ä»¥<code>key</code>ä¸éœ€è¦å®ç°<code>NSCopying</code>åè®®ã€‚</li></ul><p>ä»¥ä¸Šä¸‰ç‚¹å°±æ˜¯<code>NSCache</code>ç›¸æ¯”äº<code>NSMutableDictionary</code>å®ç°ç¼“å­˜åŠŸèƒ½çš„ä¼˜ç‚¹ï¼Œåœ¨éœ€è¦å®ç°ç¼“å­˜çš„æ—¶å€™åº”ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨<code>NSCache</code>ã€‚</p><a id="more"></a><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åç§°</span></span><br><span class="line">@property (copy) NSString *name;</span><br><span class="line"></span><br><span class="line"><span class="comment">//NSCacheDelegateä»£ç†</span></span><br><span class="line">@property (nullable, assign) id&lt;NSCacheDelegate&gt; delegate;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€šè¿‡keyè·å–valueï¼Œç±»ä¼¼äºå­—å…¸ä¸­é€šè¿‡keyå–valueçš„æ“ä½œ</span></span><br><span class="line">- (nullable ObjectType)objectForKey:(KeyType)key;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾ç½®keyã€value</span></span><br><span class="line">- (<span class="keyword">void</span>)setObject:(ObjectType)obj forKey:(KeyType)key; <span class="comment">// 0 cost</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">è®¾ç½®keyã€value</span></span><br><span class="line"><span class="comment">costè¡¨ç¤ºobjè¿™ä¸ªvalueå¯¹è±¡çš„å ç”¨çš„æ¶ˆè€—ï¼Ÿå¯ä»¥è‡ªè¡Œè®¾ç½®æ¯ä¸ªéœ€è¦æ·»åŠ è¿›ç¼“å­˜çš„å¯¹è±¡çš„costå€¼</span></span><br><span class="line"><span class="comment">è¿™ä¸ªå€¼ä¸åé¢çš„totalCostLimitå¯¹åº”ï¼Œå¦‚æœæ·»åŠ è¿›ç¼“å­˜çš„costæ€»å€¼å¤§äºtotalCostLimitå°±ä¼šè‡ªåŠ¨è¿›è¡Œåˆ é™¤</span></span><br><span class="line"><span class="comment">æ„Ÿè§‰åœ¨å®é™…å¼€å‘ä¸­ç›´æ¥ä½¿ç”¨setObject:forKey:æ–¹æ³•å°±å¯ä»¥è§£å†³é—®é¢˜äº†</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)setObject:(ObjectType)obj forKey:(KeyType)key cost:(NSUInteger)g;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¹æ®keyåˆ é™¤valueå¯¹è±¡</span></span><br><span class="line">- (<span class="keyword">void</span>)removeObjectForKey:(KeyType)key;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ é™¤ä¿å­˜çš„æ‰€æœ‰çš„key-value</span></span><br><span class="line">- (<span class="keyword">void</span>)removeAllObjects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">NSCacheèƒ½å¤Ÿå ç”¨çš„æ¶ˆè€—ï¼Ÿçš„é™åˆ¶</span></span><br><span class="line"><span class="comment">å½“NSCacheç¼“å­˜çš„å¯¹è±¡çš„æ€»costå€¼å¤§äºè¿™ä¸ªå€¼åˆ™ä¼šè‡ªåŠ¨é‡Šæ”¾ä¸€éƒ¨åˆ†å¯¹è±¡ç›´åˆ°å ç”¨å°äºè¯¥å€¼</span></span><br><span class="line"><span class="comment">éä¸¥æ ¼é™åˆ¶æ„å‘³ç€å¦‚æœä¿å­˜çš„å¯¹è±¡è¶…å‡ºè¿™ä¸ªå¤§å°ä¹Ÿä¸ä¸€å®šä¼šè¢«åˆ é™¤</span></span><br><span class="line"><span class="comment">è¿™ä¸ªå€¼å°±æ˜¯ä¸å‰é¢setObject:forKey:cost:æ–¹æ³•å¯¹åº”</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">@property NSUInteger totalCostLimit;    <span class="comment">// limits are imprecise/not strict</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç¼“å­˜èƒ½å¤Ÿä¿å­˜çš„key-valueä¸ªæ•°çš„æœ€å¤§æ•°é‡</span></span><br><span class="line"><span class="comment">å½“ä¿å­˜çš„æ•°é‡å¤§äºè¯¥å€¼å°±ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾</span></span><br><span class="line"><span class="comment">éä¸¥æ ¼é™åˆ¶æ„å‘³ç€å¦‚æœè¶…å‡ºäº†è¿™ä¸ªæ•°é‡ä¹Ÿä¸ä¸€å®šä¼šè¢«åˆ é™¤</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">@property NSUInteger countLimit;    <span class="comment">// limits are imprecise/not strict</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">è¿™ä¸ªå€¼ä¸NSDiscardableContentåè®®æœ‰å…³ï¼Œé»˜è®¤ä¸ºYES</span></span><br><span class="line"><span class="comment">å½“ä¸€ä¸ªç±»å®ç°äº†è¯¥åè®®ï¼Œå¹¶ä¸”è¿™ä¸ªç±»çš„å¯¹è±¡ä¸å†è¢«ä½¿ç”¨æ—¶æ„å‘³ç€å¯ä»¥è¢«é‡Šæ”¾</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">@property BOOL evictsObjectsWithDiscardedContent;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"><span class="comment">//NSCacheDelegateåè®®</span></span><br><span class="line">@protocol NSCacheDelegate &lt;NSObject&gt;</span><br><span class="line">@optional</span><br><span class="line"><span class="comment">//ä¸Šè¿°åè®®åªæœ‰è¿™ä¸€ä¸ªæ–¹æ³•ï¼Œç¼“å­˜ä¸­çš„ä¸€ä¸ªå¯¹è±¡å³å°†è¢«åˆ é™¤æ—¶è¢«å›è°ƒ</span></span><br><span class="line">- (<span class="keyword">void</span>)cache:(NSCache *)cache willEvictObject:(id)obj;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ¥å£å¯ä»¥çœ‹å‡ºï¼Œ<code>NSCache</code>æä¾›çš„æ–¹æ³•éƒ½å¾ˆç®€å•ï¼Œå±æ€§çš„æ„ä¹‰ä¹Ÿå¾ˆæ˜ç¡®ï¼Œæ¥ä¸‹æ¥ä¸¾ä¸€ä¸ªç®€å•çš„æ —å­:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ------ Testç±»å®ç°Cacheåè®®</span></span><br><span class="line">@interface CacheTest : NSObject &lt;NSCacheDelegate&gt;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CacheTest.h"</span></span></span><br><span class="line"></span><br><span class="line">@implementation CacheTest</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“ç¼“å­˜ä¸­çš„ä¸€ä¸ªå¯¹è±¡å³å°†è¢«åˆ é™¤æ—¶ä¼šå›è°ƒæ­¤æ–¹æ³•</span></span><br><span class="line">- (<span class="keyword">void</span>)cache:(NSCache *)cache willEvictObject:(nonnull id)obj</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@<span class="string">"Remove Object %@"</span>, obj);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------ ä½¿ç”¨</span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    NSCache *cache = [[NSCache alloc] init];</span><br><span class="line">    [cache setCountLimit:<span class="number">5</span>];</span><br><span class="line">    CacheTest *ct = [[CacheTest alloc] init];</span><br><span class="line">    cache.delegate = ct;</span><br><span class="line">    NSString *test = @<span class="string">"Hello World"</span>;</span><br><span class="line">    [cache setObject:test forKey:@<span class="string">"Test"</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        [cache setObject:[NSString stringWithFormat:@<span class="string">"World%d"</span>, i] forKey:[NSString stringWithFormat:@<span class="string">"Hello%d"</span>, i]];</span><br><span class="line">        NSLog(@<span class="string">"Add key:%@  value:%@ to Cache"</span>, [NSString stringWithFormat:@<span class="string">"Hello%d"</span>, i], [NSString stringWithFormat:@<span class="string">"World%d"</span>, i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        NSLog(@<span class="string">"Get value:%@ for key :%@"</span>, [cache objectForKey:[NSString stringWithFormat:@<span class="string">"Hello%d"</span>, i]], [NSString stringWithFormat:@<span class="string">"Hello%d"</span>, i]);</span><br><span class="line">    &#125;</span><br><span class="line">    [cache removeAllObjects];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        NSLog(@<span class="string">"Get value:%@ for key:%@"</span>, [cache objectForKey:[NSString stringWithFormat:@<span class="string">"World%d"</span>, i]], [NSString stringWithFormat:@<span class="string">"World%d"</span>, i]);</span><br><span class="line">    &#125;</span><br><span class="line">    NSLog(@<span class="string">"Test %@"</span>, test);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯å…¨éƒ¨çš„æ‰“å°ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">2019-06-06 14:25:14.767790+0800 TestDemo[3677:137719] Add key:Hello0  value:World0 to Cache</span><br><span class="line">2019-06-06 14:25:14.767904+0800 TestDemo[3677:137719] Add key:Hello1  value:World1 to Cache</span><br><span class="line">2019-06-06 14:25:14.767989+0800 TestDemo[3677:137719] Add key:Hello2  value:World2 to Cache</span><br><span class="line">2019-06-06 14:25:14.768062+0800 TestDemo[3677:137719] Add key:Hello3  value:World3 to Cache</span><br><span class="line">2019-06-06 14:25:14.768131+0800 TestDemo[3677:137719] Remove Object Hello World</span><br><span class="line">2019-06-06 14:25:14.768227+0800 TestDemo[3677:137719] Add key:Hello4  value:World4 to Cache</span><br><span class="line">2019-06-06 14:25:14.768333+0800 TestDemo[3677:137719] Remove Object World0</span><br><span class="line">2019-06-06 14:25:14.768415+0800 TestDemo[3677:137719] Add key:Hello5  value:World5 to Cache</span><br><span class="line">2019-06-06 14:25:14.768497+0800 TestDemo[3677:137719] Remove Object World1</span><br><span class="line">2019-06-06 14:25:14.768573+0800 TestDemo[3677:137719] Add key:Hello6  value:World6 to Cache</span><br><span class="line">2019-06-06 14:25:14.768641+0800 TestDemo[3677:137719] Remove Object World2</span><br><span class="line">2019-06-06 14:25:14.768704+0800 TestDemo[3677:137719] Add key:Hello7  value:World7 to Cache</span><br><span class="line">2019-06-06 14:25:14.768793+0800 TestDemo[3677:137719] Remove Object World3</span><br><span class="line">2019-06-06 14:25:14.768856+0800 TestDemo[3677:137719] Add key:Hello8  value:World8 to Cache</span><br><span class="line">2019-06-06 14:25:14.768941+0800 TestDemo[3677:137719] Remove Object World4</span><br><span class="line">2019-06-06 14:25:14.769004+0800 TestDemo[3677:137719] Add key:Hello9  value:World9 to Cache</span><br><span class="line">2019-06-06 14:25:14.769072+0800 TestDemo[3677:137719] Get value:(null) for key :Hello0</span><br><span class="line">2019-06-06 14:25:14.771311+0800 TestDemo[3677:137719] Get value:(null) for key :Hello1</span><br><span class="line">2019-06-06 14:25:14.771400+0800 TestDemo[3677:137719] Get value:(null) for key :Hello2</span><br><span class="line">2019-06-06 14:25:14.771474+0800 TestDemo[3677:137719] Get value:(null) for key :Hello3</span><br><span class="line">2019-06-06 14:25:14.771552+0800 TestDemo[3677:137719] Get value:(null) for key :Hello4</span><br><span class="line">2019-06-06 14:25:14.771650+0800 TestDemo[3677:137719] Get value:World5 for key :Hello5</span><br><span class="line">2019-06-06 14:25:14.771731+0800 TestDemo[3677:137719] Get value:World6 for key :Hello6</span><br><span class="line">2019-06-06 14:25:14.771817+0800 TestDemo[3677:137719] Get value:World7 for key :Hello7</span><br><span class="line">2019-06-06 14:25:14.771906+0800 TestDemo[3677:137719] Get value:World8 for key :Hello8</span><br><span class="line">2019-06-06 14:25:14.771982+0800 TestDemo[3677:137719] Get value:World9 for key :Hello9</span><br><span class="line">2019-06-06 14:25:14.772050+0800 TestDemo[3677:137719] Remove Object World6</span><br><span class="line">2019-06-06 14:25:14.772119+0800 TestDemo[3677:137719] Remove Object World7</span><br><span class="line">2019-06-06 14:25:14.772196+0800 TestDemo[3677:137719] Remove Object World8</span><br><span class="line">2019-06-06 14:25:14.772261+0800 TestDemo[3677:137719] Remove Object World9</span><br><span class="line">2019-06-06 14:25:14.772336+0800 TestDemo[3677:137719] Remove Object World5</span><br><span class="line">2019-06-06 14:25:14.772411+0800 TestDemo[3677:137719] Get value:(null) for key:World0</span><br><span class="line">2019-06-06 14:25:14.772491+0800 TestDemo[3677:137719] Get value:(null) for key:World1</span><br><span class="line">2019-06-06 14:25:14.772656+0800 TestDemo[3677:137719] Get value:(null) for key:World2</span><br><span class="line">2019-06-06 14:25:14.772858+0800 TestDemo[3677:137719] Get value:(null) for key:World3</span><br><span class="line">2019-06-06 14:25:14.773018+0800 TestDemo[3677:137719] Get value:(null) for key:World4</span><br><span class="line">2019-06-06 14:25:14.773193+0800 TestDemo[3677:137719] Get value:(null) for key:World5</span><br><span class="line">2019-06-06 14:25:14.773418+0800 TestDemo[3677:137719] Get value:(null) for key:World6</span><br><span class="line">2019-06-06 14:25:14.773570+0800 TestDemo[3677:137719] Get value:(null) for key:World7</span><br><span class="line">2019-06-06 14:25:14.773704+0800 TestDemo[3677:137719] Get value:(null) for key:World8</span><br><span class="line">2019-06-06 14:25:14.773846+0800 TestDemo[3677:137719] Get value:(null) for key:World9</span><br><span class="line">2019-06-06 14:25:14.773989+0800 TestDemo[3677:137719] Test Hello World</span><br></pre></td></tr></table></figure><ul><li><p>ä¸Šé¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ª<code>NSCache</code>å¯¹è±¡ï¼Œè®¾ç½®äº†å…¶æœ€å¤§å¯ç¼“å­˜å¯¹è±¡çš„ä¸ªæ•°ä¸º5ä¸ªï¼Œä»è¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œå½“æˆ‘ä»¬è¦æ·»åŠ ç¬¬å…­ä¸ªå¯¹è±¡æ—¶<code>NSCache</code>è‡ªåŠ¨åˆ é™¤äº†æˆ‘ä»¬æ·»åŠ çš„ç¬¬ä¸€ä¸ªå¯¹è±¡å¹¶è§¦å‘äº†<code>NSCacheDelegate</code>çš„å›è°ƒæ–¹æ³•ï¼Œæ·»åŠ ç¬¬ä¸ƒä¸ªæ—¶ä¹Ÿæ˜¯åŒæ ·çš„ï¼Œåˆ é™¤äº†ç¼“å­˜ä¸­çš„ä¸€ä¸ªå¯¹è±¡æ‰èƒ½æ·»åŠ è¿›å»ã€‚</p></li><li><p>åœ¨ç¬¬äºŒä¸ª<code>forå¾ªç¯</code>ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡<code>key</code>å–å‡ºæ‰€æœ‰çš„ç¼“å­˜å¯¹è±¡ï¼Œå‰äº”ä¸ªå¯¹è±¡å–å‡ºéƒ½ä¸º<code>nil</code>ï¼Œå› ä¸ºåœ¨æ·»åŠ åé¢çš„å¯¹è±¡æ—¶å‰é¢çš„è¢«åˆ é™¤äº†ï¼Œæ‰€ä»¥ï¼Œå½“æˆ‘ä»¬ä»ç¼“å­˜ä¸­è·å–å¯¹è±¡æ—¶ä¸€å®šè¦åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œæˆ‘ä»¬æ— æ³•ä¿è¯ç¼“å­˜ä¸­çš„æŸä¸ªå¯¹è±¡ä¸ä¼šè¢«åˆ é™¤ã€‚</p></li><li><p>æ¥ç€è°ƒç”¨äº†<code>NSCache</code>çš„<code>removeAllObjects</code>æ–¹æ³•ï¼Œä¸€æ—¦è°ƒç”¨è¯¥æ–¹æ³•ï¼Œ<code>NSCache</code>å°±ä¼šå°†å…¶ä¸­ä¿å­˜çš„æ‰€æœ‰å¯¹è±¡éƒ½é‡Šæ”¾æ‰ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥çœ‹åˆ°è°ƒç”¨è¯¥æ–¹æ³•å<code>NSCacheDelegate</code>çš„å›è°ƒæ–¹æ³•æ‰§è¡Œäº†äº”æ¬¡ï¼Œå°†<code>NSCache</code>ä¸­çš„æ‰€æœ‰ç¼“å­˜å¯¹è±¡éƒ½æ¸…ç©ºäº†ã€‚</p></li><li><p>åœ¨æœ€åä¸€ä¸ª<code>forå¾ªç¯</code>ä¸­ï¼Œæ ¹æ®<code>key</code>è·å–ç¼“å­˜ä¸­çš„å¯¹è±¡æ—¶å¯ä»¥å‘ç°éƒ½ä¸ºç©ºäº†ï¼Œå› ä¸ºéƒ½è¢«é‡Šæ”¾äº†ã€‚</p></li><li><p>ï¼å‰é¢è¿˜åˆ›å»ºäº†ä¸€ä¸ªå­—ç¬¦ä¸²çš„å±€éƒ¨å˜é‡ï¼Œåœ¨æœ€å¼€å§‹å°†å…¶åŠ å…¥åˆ°äº†ç¼“å­˜ä¸­ï¼Œåæ¥éšç€å…¶ä»–å¯¹è±¡çš„æ·»åŠ ï¼Œè¯¥å­—ç¬¦ä¸²è¢«ç¼“å­˜é‡Šæ”¾äº†ï¼Œä½†ç”±äºå±€éƒ¨å˜é‡å¯¹å…¶æŒæœ‰å¼ºå¼•ç”¨æ‰€ä»¥ä½¿ç”¨<code>test</code>è¿˜æ˜¯å¯ä»¥è®¿é—®åˆ°çš„ï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„<code>ARC</code>çŸ¥è¯†ï¼Œæ‰€ä»¥ï¼Œ<code>NSCache</code>åœ¨é‡Šæ”¾ä¸€ä¸ªå¯¹è±¡æ—¶åªæ˜¯ä¸å†æŒ‡å‘è¿™ä¸ªå¯¹è±¡ï¼Œå³ï¼Œè¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å‡ä¸€ï¼Œå¦‚æœæœ‰å…¶ä»–æŒ‡é’ˆæŒ‡å‘å®ƒï¼Œè¿™ä¸ªå¯¹è±¡ä¸ä¼šè¢«é‡Šæ”¾ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´cacheä¸­keyæŒæœ‰å¯¹å…¶ä»–objectå¯¹è±¡çš„å¼•ç”¨ï¼Œæ‰€ä»¥ä¸éœ€è¦å®ç°NSCopyingåè®®ã€‚</p></li><li><p>ä¸Šé¢å°±æ˜¯<code>NSCache</code>çš„åŸºæœ¬ç”¨æ³•äº†ï¼Œæˆ‘ä»¬åªéœ€è¦è®¾ç½®å¯¹è±¡å’Œè·å–å¯¹è±¡ï¼Œå…¶ä»–äº‹æƒ…<code>NSCache</code>éƒ½å¸®æˆ‘ä»¬åšå®Œäº†ï¼Œå› æ­¤ï¼Œå®ç°ç¼“å­˜åŠŸèƒ½æ—¶ï¼Œä½¿ç”¨<code>NSCache</code>å°±æ˜¯æˆ‘ä»¬çš„ä¸äºŒä¹‹é€‰ã€‚</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewWillAppear:(BOOL)animated</span><br><span class="line">&#123;</span><br><span class="line">    self.cache = [[NSCache alloc] init];</span><br><span class="line">    [self.cache setCountLimit:<span class="number">5</span>];</span><br><span class="line">    self.cache.delegate = self;</span><br><span class="line">    [self.cache setObject:@<span class="string">"AA"</span> forKey:@<span class="string">"BBB"</span>];</span><br><span class="line">    [self.cache setObject:@<span class="string">"MMMM"</span> forKey:@<span class="string">"CCC"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)cache:(NSCache *)cache willEvictObject:(id)obj</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@<span class="string">"REMOVE %@"</span>, obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®°ä½æ­¤æ—¶ä¸€å®šä¸è¦æŠŠä»£ç†åƒä¸Šä¸€ä¸ªç±»ä¸€æ ·äº¤ç»™CacheTestæ¥åšï¼Œå› ä¸ºæœ€åæ²¡æœ‰removeAllObjectã€‚</p><p>è€Œdelegateçš„å±æ€§æ˜¯assignï¼Œå®¹æ˜“é€ æˆé‡æŒ‡é’ˆå¯¼è‡´å´©æºƒã€‚</p><p><strong>ç‚¹å‡»Homeé”®æ‰“å°ç»“æœï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-06</span> <span class="number">14</span>:<span class="number">56</span>:<span class="number">40.166418</span>+<span class="number">0800</span> TestDemo[<span class="number">4151</span>:<span class="number">162111</span>] REMOVE MMMM</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-06</span> <span class="number">14</span>:<span class="number">56</span>:<span class="number">40.166561</span>+<span class="number">0800</span> TestDemo[<span class="number">4151</span>:<span class="number">162111</span>] REMOVE AA</span><br></pre></td></tr></table></figure><p>å½“ç‚¹å‡»<code>home</code>é”®ï¼Œç¨‹åºè¿›å…¥åå°åï¼Œå¯ä»¥å‘ç°<code>NSCacheDelegate</code>çš„å›è°ƒå‡½æ•°è§¦å‘äº†ï¼Œæ‰€ä»¥ï¼Œå½“ç¨‹åºè¿›å…¥åå°ï¼Œ<code>NSCache</code>å¯¹è±¡ä¼šè‡ªåŠ¨é‡Šæ”¾æ‰€æœ‰çš„å¯¹è±¡ã€‚å¦‚æœåœ¨æ¨¡æ‹Ÿå™¨ä¸Šæ¨¡æ‹Ÿå†…å­˜è­¦å‘Šï¼Œä¹Ÿå¯ä»¥å‘ç°<code>NSCache</code>ä¼šé‡Šæ”¾æ‰€æœ‰çš„å¯¹è±¡ã€‚æ‰€ä»¥<code>NSCache</code>åˆ é™¤ç¼“å­˜ä¸­çš„å¯¹è±¡ä¼šåœ¨ä»¥ä¸‹æƒ…å½¢ä¸­å‘ç”Ÿã€‚</p><ul><li>NSCacheç¼“å­˜å¯¹è±¡è‡ªèº«è¢«é‡Šæ”¾</li><li>æ‰‹åŠ¨è°ƒç”¨removeObjectForKey:æ–¹æ³•</li><li>æ‰‹åŠ¨è°ƒç”¨removeAllObjects</li><li>ç¼“å­˜ä¸­å¯¹è±¡çš„ä¸ªæ•°å¤§äºcountLimitï¼Œæˆ–ï¼Œç¼“å­˜ä¸­å¯¹è±¡çš„æ€»costå€¼å¤§äºtotalCostLimit</li><li>ç¨‹åºè¿›å…¥åå°å</li><li>æ”¶åˆ°ç³»ç»Ÿçš„å†…å­˜è­¦å‘Š</li></ul><p>è½¬è½½è‡ªï¼š<a href="https://www.jianshu.com/p/239226822bc6" target="_blank" rel="noopener">https://www.jianshu.com/p/239226822bc6</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;NSCache&quot;&gt;&lt;a href=&quot;#NSCache&quot; class=&quot;headerlink&quot; title=&quot;NSCache&quot;&gt;&lt;/a&gt;NSCache&lt;/h3&gt;&lt;p&gt;NSCacheä½¿ç”¨å¾ˆæ–¹ä¾¿ï¼Œæä¾›äº†ç±»ä¼¼å¯å˜å­—å…¸çš„å®ç°æ–¹å¼ï¼Œä½†å®ƒæ¯”å¯å˜å­—å…¸æ›´é€‚ç”¨äºå®ç°ç¼“å­˜ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ€é‡è¦çš„åŸå› æ˜¯&lt;code&gt;NSCache&lt;/code&gt;æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½¿ç”¨&lt;code&gt;NSMutableDictionary&lt;/code&gt;è‡ªå®šä¹‰å®ç°ç¼“å­˜çš„æ—¶å€™éœ€è¦è€ƒè™‘åŠ é”å’Œé‡Šæ”¾é”ï¼Œ&lt;code&gt;NSCache&lt;/code&gt;å·²ç»å¸®æˆ‘ä»¬åšå¥½äº†è¿™ä¸€æ­¥ã€‚&lt;/li&gt;
&lt;li&gt;å…¶æ¬¡ï¼Œå†…å­˜ä¸è¶³æ—¶&lt;code&gt;NSCache&lt;/code&gt;ä¼šè‡ªåŠ¨é‡Šæ”¾å­˜å‚¨çš„å¯¹è±¡ï¼Œä¸éœ€è¦æ‰‹åŠ¨å¹²é¢„ï¼Œå¦‚æœæ˜¯è‡ªå®šä¹‰å®ç°éœ€è¦ç›‘å¬å†…å­˜çŠ¶æ€ç„¶ååšè¿›ä¸€æ­¥åˆ é™¤å¯¹è±¡çš„æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;è¿˜æœ‰ä¸€ç‚¹&lt;code&gt;NSCache&lt;/code&gt;çš„é”®&lt;code&gt;key&lt;/code&gt;ä¸ä¼šè¢«å¤åˆ¶ï¼Œæ‰€ä»¥&lt;code&gt;key&lt;/code&gt;ä¸éœ€è¦å®ç°&lt;code&gt;NSCopying&lt;/code&gt;åè®®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šä¸‰ç‚¹å°±æ˜¯&lt;code&gt;NSCache&lt;/code&gt;ç›¸æ¯”äº&lt;code&gt;NSMutableDictionary&lt;/code&gt;å®ç°ç¼“å­˜åŠŸèƒ½çš„ä¼˜ç‚¹ï¼Œåœ¨éœ€è¦å®ç°ç¼“å­˜çš„æ—¶å€™åº”ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨&lt;code&gt;NSCache&lt;/code&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS || äº‹ä»¶ä¼ é€’ä¸å“åº”è€…é“¾ä¸­çš„hitTestæ–¹æ³•å’ŒpointInsideæ–¹æ³•</title>
    <link href="http://yoursite.com/2019/07/11/%E4%BA%8B%E4%BB%B6%E4%BC%A0%E9%80%92%E4%B8%8E%E5%93%8D%E5%BA%94%E8%80%85%E9%93%BE%E4%B8%AD%E7%9A%84hitTest%E6%96%B9%E6%B3%95%E5%92%8CpointInside%E6%96%B9%E6%B3%95/"/>
    <id>http://yoursite.com/2019/07/11/äº‹ä»¶ä¼ é€’ä¸å“åº”è€…é“¾ä¸­çš„hitTestæ–¹æ³•å’ŒpointInsideæ–¹æ³•/</id>
    <published>2019-07-10T16:25:17.000Z</published>
    <updated>2019-07-10T16:25:55.366Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸»è¦æ¦‚å¿µ"><a href="#ä¸»è¦æ¦‚å¿µ" class="headerlink" title="ä¸»è¦æ¦‚å¿µ"></a>ä¸»è¦æ¦‚å¿µ</h3><h4 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h4><p>ç”¨æˆ·ä½¿ç”¨appçš„è¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿå„ç§å„æ ·çš„äº‹ä»¶ï¼ŒiOSäº‹ä»¶å¤§ä½“åˆ†ä¸º3ç§ç±»å‹</p><ul><li>è§¦æ‘¸äº‹ä»¶</li><li>åŠ é€Ÿè®¡äº‹ä»¶</li><li>è¿œç¨‹æ§åˆ¶äº‹ä»¶</li></ul><p>åŠ é€Ÿè®¡äº‹ä»¶å¯ä»¥ç”¨æ¥åšæ‘‡ä¸€æ‘‡ç­‰åŠŸèƒ½ï¼Œè€Œè€³æœºæ§åˆ¶éŸ³é‡å¤§å°ç­‰åˆ™å±äºè¿œç¨‹æ§åˆ¶äº‹ä»¶ã€‚</p><a id="more"></a><h4 id="å“åº”è€…å¯¹è±¡"><a href="#å“åº”è€…å¯¹è±¡" class="headerlink" title="å“åº”è€…å¯¹è±¡"></a>å“åº”è€…å¯¹è±¡</h4><p>åœ¨iOSä¸­ä¸æ˜¯ä»»ä½•å¯¹è±¡éƒ½èƒ½å¤„ç†äº‹ä»¶ï¼Œåªæœ‰ç»§æ‰¿äº†UIResponderçš„å¯¹è±¡æ‰èƒ½æ¥æ”¶å¹¶å¤„ç†äº‹ä»¶ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œå“åº”è€…å¯¹è±¡â€ï¼Œä¾‹å¦‚UIApplicationã€UIViewControllerã€UIViewéƒ½ç»§æ‰¿è‡ªUIResponderï¼Œå› æ­¤å®ƒä»¬éƒ½æ˜¯å“åº”è€…åº¦å–œåº†ï¼Œéƒ½èƒ½æ¥æ”¶å¹¶å¤„ç†äº‹ä»¶ã€‚</p><h5 id="UIResponder"><a href="#UIResponder" class="headerlink" title="UIResponder"></a>UIResponder</h5><p>è§¦æ‘¸äº‹ä»¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event;</span><br><span class="line">- (<span class="keyword">void</span>)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event;</span><br><span class="line">- (<span class="keyword">void</span>)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event;</span><br><span class="line">- (<span class="keyword">void</span>)touchesCancelled:(NSSet *)touches withEvent:(UIEvent *)event;</span><br></pre></td></tr></table></figure><p>åŠ é€Ÿè®¡äº‹ä»¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)motionBegan:(UIEventSubtype)motion withEvent:(UIEvent *)event;</span><br><span class="line">- (<span class="keyword">void</span>)motionEnded:(UIEventSubtype)motion withEvent:(UIEvent *)event;</span><br><span class="line">- (<span class="keyword">void</span>)motionCancelled:(UIEventSubtype)motion withEvent:(UIEvent *)event;</span><br></pre></td></tr></table></figure><p>è¿œç¨‹æ§åˆ¶äº‹ä»¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)remoteControlReceivedWithEvent:(UIEvent *)event;</span><br></pre></td></tr></table></figure><h5 id="UIViewçš„è§¦æ‘¸äº‹ä»¶å¤„ç†"><a href="#UIViewçš„è§¦æ‘¸äº‹ä»¶å¤„ç†" class="headerlink" title="UIViewçš„è§¦æ‘¸äº‹ä»¶å¤„ç†"></a>UIViewçš„è§¦æ‘¸äº‹ä»¶å¤„ç†</h5><p>UIViewæ˜¯UIResponderçš„å­ç±»ï¼Œå¯ä»¥è¦†ç›–ä¸‹åˆ—4ä¸ªæ–¹æ³•å¤„ç†ä¸åŒçš„è§¦æ‘¸äº‹ä»¶</p><ul><li>ä¸€æ ¹æˆ–è€…å¤šæ ¹æ‰‹æŒ‡å¼€å§‹è§¦æ‘¸viewï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç»™è°ƒç”¨viewä¸‹é¢çš„æ–¹æ³•</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event</span><br></pre></td></tr></table></figure><ul><li>ä¸€æ ¹æˆ–è€…å¤šæ ¹æ‰‹æŒ‡åœ¨viewä¸Šç§»åŠ¨ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨viewçš„ä¸‹é¢æ–¹æ³•ï¼ˆéšç€æ‰‹æŒ‡çš„ç§»åŠ¨ï¼Œä¼šæŒç»­è°ƒç”¨è¯¥æ–¹æ³•ï¼‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event</span><br></pre></td></tr></table></figure><ul><li>ä¸€æ ¹æˆ–è€…å¤šæ ¹æ‰‹æŒ‡ç¦»å¼€viewï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨viewçš„ä¸‹é¢æ–¹æ³•</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event</span><br></pre></td></tr></table></figure><ul><li>è§¦æ‘¸ç»“æŸå‰ï¼ŒæŸä¸ªç³»ç»Ÿäº‹ä»¶(ä¾‹å¦‚ç”µè¯å‘¼å…¥)ä¼šæ‰“æ–­è§¦æ‘¸è¿‡ç¨‹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨viewçš„ä¸‹é¢</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)touchesCancelled:(NSSet *)touches withEvent:(UIEvent *)event</span><br></pre></td></tr></table></figure><p><strong>PS:</strong> touchä¸­å­˜æ”¾çš„éƒ½æ˜¯ UITouch å¯¹è±¡ã€‚</p><h4 id="UITouch"><a href="#UITouch" class="headerlink" title="UITouch"></a>UITouch</h4><h5 id="UITouch-1"><a href="#UITouch-1" class="headerlink" title="UITouch"></a>UITouch</h5><ul><li>å½“ç”¨æˆ·ç”¨ä¸€æ ¹æ‰‹æŒ‡è§¦æ‘¸å±å¹•æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªä¸æ‰‹æŒ‡ç›¸å…³è”çš„UITouchå¯¹è±¡</li><li>ä¸€æ ¹æ‰‹æŒ‡å¯¹åº”ä¸€ä¸ªUITouchå¯¹è±¡</li><li>UITouchä½œç”¨ï¼šä¿å­˜ç€è·Ÿæ‰‹æŒ‡ç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è§¦æ‘¸çš„ä½ç½®ã€æ—¶é—´ã€é˜¶æ®µ</li><li>å½“æ‰‹æŒ‡ç§»åŠ¨æ—¶ï¼Œç³»ç»Ÿä¼šæ›´æ–°åŒä¸€ä¸ªUITouchå¯¹è±¡ï¼Œä½¿ä¹‹èƒ½å¤Ÿä¸€ç›´ä¿å­˜è¯¥æ‰‹æŒ‡åœ¨çš„è§¦æ‘¸ä½ç½®ã€‚</li><li>å½“æ‰‹æŒ‡ç¦»å¼€å±å¹•æ—¶ï¼Œç³»ç»Ÿä¼šé”€æ¯å“åº”çš„UITouchå¯¹è±¡</li></ul><h5 id="UITouch-é‡è¦å±æ€§"><a href="#UITouch-é‡è¦å±æ€§" class="headerlink" title="UITouch é‡è¦å±æ€§"></a>UITouch é‡è¦å±æ€§</h5><ul><li><p>è§¦æ‘¸äº§ç”Ÿæ—¶æ‰€å¤„çš„çª—å£</p><p><code>@property(nonatomic, readonly, retain) UIWindow *window;</code></p></li><li><p>è§¦æ‘¸äº§ç”Ÿæ—¶æ‰€å¤„çš„è§†å›¾</p><p><code>@property(nonatomic, readonly, retain) UIView *view;</code></p></li><li><p>çŸ­æ—¶é—´å†…ç‚¹æŒ‰å±å¹•çš„æ¬¡æ•°ï¼Œå¯ä»¥æ ¹æ®tapCountåˆ¤æ–­å•å‡»ã€åŒå‡»æˆ–è€…æ›´å¤šç‚¹å‡»</p><p><code>@property(nonatomic, readonly) NSUInteger tapCount;</code></p></li><li><p>è®°å½•äº†è§¦æ‘¸äº‹ä»¶äº§ç”Ÿæˆ–å˜åŒ–æ—¶çš„æ—¶é—´ï¼Œå•ä½æ˜¯ç§’</p><p><code>@property(nonatomic, readonly) NSTimeInterval timestamp;</code></p></li><li><p>å½“å‰è§¦æ‘¸äº‹ä»¶æ‰€å¤„çš„çŠ¶æ€</p><p><code>@property(nonatomic, readonly) UITouchPhase phase;</code></p></li></ul><h5 id="UITouch-é‡è¦æ–¹æ³•"><a href="#UITouch-é‡è¦æ–¹æ³•" class="headerlink" title="UITouch é‡è¦æ–¹æ³•"></a>UITouch é‡è¦æ–¹æ³•</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (CGPoint)locationInView:(UIView *)view;</span><br><span class="line"><span class="comment">// è¿”å›å€¼è¡¨ç¤ºè§¦æ‘¸åœ¨viewä¸Šçš„ä½ç½®ï¼Œè¿™é‡Œè¿”å›çš„ä½ç½®æ˜¯é’ˆå¯¹viewçš„åæ ‡ç³»çš„(ä»¥viewçš„å·¦ä¸Šè§’ä¸ºåŸç‚¹(0,0))</span></span><br><span class="line"><span class="comment">// è°ƒç”¨æ—¶ä¼ å…¥çš„viewå‚æ•°ä¸ºnilçš„è¯ï¼Œè¿”å›çš„è§¦æ‘¸ç‚¹æ˜¯åœ¨UIWindowçš„ä½ç½®</span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (CGPoint)previousLocationInView:(UIView *)view;</span><br><span class="line"><span class="comment">// è¯¥æ–¹æ³•è®°å½•äº†å‰ä¸€ä¸ªè§¦æ‘¸ç‚¹çš„ä½ç½®</span></span><br></pre></td></tr></table></figure><h4 id="UIEvent"><a href="#UIEvent" class="headerlink" title="UIEvent"></a>UIEvent</h4><ul><li>æ¯äº§ç”Ÿä¸€ä¸ªäº‹ä»¶ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªUIEventå¯¹è±¡</li><li>UIEventï¼šç§°ä¸ºäº‹ä»¶å¯¹è±¡ï¼Œè®°å½•äº‹ä»¶äº§ç”Ÿçš„æ—¶åˆ»å’Œç±»å‹</li></ul><h5 id="UIEvent-å¸¸è§å±æ€§"><a href="#UIEvent-å¸¸è§å±æ€§" class="headerlink" title="UIEvent å¸¸è§å±æ€§"></a>UIEvent å¸¸è§å±æ€§</h5><ul><li><p>äº‹ä»¶ç±»å‹</p><p><code>@property(nonatomic, readonly) UIEventType type;</code></p><p><code>@property(nonatomic, readonly) UIEventSubtype subtype;</code></p></li><li><p>äº‹ä»¶äº§ç”Ÿçš„æ—¶é—´</p><p><code>@property(nonatomic, readonly) NSTimeInterval timestamp;</code></p></li><li><p>UIEvent è¿˜æä¾›äº†ç›¸åº”çš„æ–¹æ³•å¯ä»¥è·å¾—åœ¨æŸä¸ªviewä¸Šé¢çš„è§¦æ‘¸å¯¹è±¡ï¼ˆUITouchï¼‰ä¸€æ¬¡å®Œæ•´çš„è§¦æ‘¸è¿‡ç¨‹ï¼Œä¼šç»å†ä¸‰ä¸ªçŠ¶æ€ï¼š</p><p>è§¦æ‘¸å¼€å§‹ï¼š- (void)touchesBegan:(NSSet )touches withEvent:(UIEvent )event<br>è§¦æ‘¸ç§»åŠ¨ï¼š- (void)touchesMoved:(NSSet )touches withEvent:(UIEvent )event<br>è§¦æ‘¸ç»“æŸï¼š- (void)touchesEnded:(NSSet )touches withEvent:(UIEvent )event </p><p>è§¦æ‘¸å–æ¶ˆï¼ˆ<strong>å¯èƒ½ä¼šç»å†</strong>ï¼‰ï¼š- (void)touchesCancelled:(NSSet )touches withEvent:(UIEvent )event </p></li></ul><p>4ä¸ªè§¦æ‘¸äº‹ä»¶å¤„ç†æ–¹æ³•ä¸­ï¼Œéƒ½æœ‰NSSet *toucheså’ŒUIEvent *eventä¸¤ä¸ªå‚æ•° </p><p>ä¸€æ¬¡å®Œæ•´çš„è§¦æ‘¸è¿‡ç¨‹ä¸­ï¼Œåªä¼šäº§ç”Ÿä¸€ä¸ªäº‹ä»¶å¯¹è±¡ï¼Œ4ä¸ªè§¦æ‘¸æ–¹æ³•éƒ½æ˜¯åŒä¸€ä¸ªeventå‚æ•°</p><ul><li><p>å¦‚æœä¸¤æ ¹æ‰‹æŒ‡åŒæ—¶è§¦æ‘¸ä¸€ä¸ªviewï¼Œé‚£ä¹ˆviewåªä¼šè°ƒç”¨ä¸€æ¬¡touchesBegan:withEvent:æ–¹æ³•ï¼Œtoucheså‚æ•°ä¸­è£…ç€2ä¸ªUITouchå¯¹è±¡</p></li><li><p>å¦‚æœè¿™ä¸¤æ ¹æ‰‹æŒ‡ä¸€å‰ä¸€ååˆ†å¼€è§¦æ‘¸åŒä¸€ä¸ªviewï¼Œé‚£ä¹ˆviewä¼šåˆ†åˆ«è°ƒç”¨2æ¬¡touchesBegan:withEvent:æ–¹æ³•ï¼Œå¹¶ä¸”æ¯æ¬¡è°ƒç”¨æ—¶çš„toucheså‚æ•°ä¸­åªåŒ…å«ä¸€ä¸ªUITouchå¯¹è±¡</p></li></ul><p>æ ¹æ®touchesä¸­UITouchçš„ä¸ªæ•°å¯ä»¥åˆ¤æ–­å‡ºæ˜¯å•ç‚¹è§¦æ‘¸è¿˜æ˜¯å¤šç‚¹è§¦æ‘¸</p><h3 id="äº‹ä»¶ä¼ é€’"><a href="#äº‹ä»¶ä¼ é€’" class="headerlink" title="äº‹ä»¶ä¼ é€’"></a>äº‹ä»¶ä¼ é€’</h3><ul><li>å‘ç”Ÿè§¦æ‘¸äº‹ä»¶åï¼Œç³»ç»Ÿä¼šå°†è¯¥äº‹ä»¶åŠ å…¥åˆ°ä¸€ä¸ªç”± UIApplication ç®¡ç†çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ã€‚</li><li>UIApplication ä¼šä»äº‹ä»¶é˜Ÿåˆ—ä¸­å–å‡ºæœ€å‰é¢çš„äº‹ä»¶ï¼Œå¹¶å°†äº‹ä»¶åˆ†å‘ä¸‹å»ä»¥ä¾¿å¤„ç†ï¼Œé€šå¸¸ï¼Œå…ˆå‘é€äº‹ä»¶ç»™åº”ç”¨ç¨‹åºçš„ä¸»çª—å£(keyWindow)</li><li>ä¸»çª—å£ä¼šåœ¨è§†å›¾å±‚æ¬¡ç»“æ„ä¸­æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„è§†å›¾æ¥å¤„ç†è§¦æ‘¸äº‹ä»¶ï¼Œè¿™ä¹Ÿæ˜¯æ•´ä¸ªäº‹ä»¶å¤„ç†è¿‡ç¨‹çš„ç¬¬ä¸€æ­¥ã€‚</li><li>æ‰¾åˆ°åˆé€‚çš„è§†å›¾æ§ä»¶åï¼Œå°±ä¼šè°ƒç”¨è§†å›¾æ§ä»¶çš„toucheræ–¹æ³•æ¥åšå…·ä½“çš„äº‹ä»¶å¤„ç†<ul><li>touchesBegin</li><li>touchesMoved</li><li>touchesEnded</li></ul></li></ul><h4 id="å¦‚ä½•æ‰¾åˆ°ä¸€ä¸ªæœ€åˆé€‚çš„è§†å›¾ï¼Œå¦‚ä½•åˆ¤æ–­"><a href="#å¦‚ä½•æ‰¾åˆ°ä¸€ä¸ªæœ€åˆé€‚çš„è§†å›¾ï¼Œå¦‚ä½•åˆ¤æ–­" class="headerlink" title="å¦‚ä½•æ‰¾åˆ°ä¸€ä¸ªæœ€åˆé€‚çš„è§†å›¾ï¼Œå¦‚ä½•åˆ¤æ–­"></a>å¦‚ä½•æ‰¾åˆ°ä¸€ä¸ªæœ€åˆé€‚çš„è§†å›¾ï¼Œå¦‚ä½•åˆ¤æ–­</h4><h5 id="hitTest"><a href="#hitTest" class="headerlink" title="hitTest"></a>hitTest</h5><p>å…¶å®ç³»ç»Ÿå°±æ˜¯é€šè¿‡ <code>-(UIView *)hitTest:(CGPoint)point withEvent:(UIEvent* )event</code>æ–¹æ³•æ¥å¯»æ‰¾æœ€åˆé€‚viewçš„ã€‚</p><p>è¯¥å‡½æ•°çš„å†…éƒ¨å®ç°ï¼š</p><ul><li>è‡ªå·±èƒ½å¦æ¥æ”¶è§¦æ‘¸äº‹ä»¶(å¦‚æœè‡ªå·±éƒ½ä¸èƒ½æ¥æ”¶é‚£ä¹ˆå­è§†å›¾å°±ä¸èƒ½æ¥æ”¶å¤„ç†äº‹ä»¶)</li><li>è§¦æ‘¸ç‚¹æ˜¯å¦åœ¨è‡ªå·±èº«ä¸Š</li><li>ä»åå¾€å‰éå†å­æ§ä»¶ï¼Œé‡å¤å‰é¢ä¸¤ä¸ªæ­¥éª¤</li><li>å¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å­æ§ä»¶ï¼Œé‚£ä¹ˆå°±è‡ªå·±å¤„ç†æœ€åˆé€‚</li></ul><p><img src="https://img-blog.csdnimg.cn/20190605154903358.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½œç”¨:å»å¯»æ‰¾æœ€é€‚åˆçš„View</span></span><br><span class="line"><span class="comment">//ä»€ä¹ˆæ—¶å€™è°ƒç”¨:å½“ä¸€ä¸ªäº‹ä»¶ä¼ é€’ç»™å½“å‰View,å°±ä¼šè°ƒç”¨.</span></span><br><span class="line"><span class="comment">//è¿”å›å€¼:è¿”å›çš„æ˜¯è°,è°å°±æ˜¯æœ€é€‚åˆçš„View(å°±ä¼šè°ƒç”¨æœ€é€‚åˆçš„Viewçš„touchæ–¹æ³•)</span></span><br><span class="line">-(UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event&#123;</span><br><span class="line">    NSLog(@<span class="string">"%s"</span>,__func__);</span><br><span class="line">    <span class="keyword">return</span> [super hitTest:point withEvent:event];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="PointInside"><a href="#PointInside" class="headerlink" title="PointInside"></a>PointInside</h5><p>ç³»ç»Ÿé€šè¿‡<code>-(BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event</code>æ–¹æ³•æ¥åˆ¤æ–­è§¦æ‘¸ç‚¹æ˜¯å¦åœ¨è‡ªå·±èº«ä¸Šã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  ä½œç”¨:åˆ¤æ–­å½“å‰ç‚¹åœ¨ä¸åœ¨å®ƒè°ƒç”¨View,(è°è°ƒç”¨pointInside,è¿™ä¸ªViewå°±æ˜¯è°)</span></span><br><span class="line"><span class="comment"> *  ä»€ä¹ˆæ—¶å€™è°ƒç”¨:å®ƒæ˜¯åœ¨hitTestæ–¹æ³•å½“ä¸­è°ƒç”¨çš„.</span></span><br><span class="line"><span class="comment"> *  æ³¨æ„:pointç‚¹å¿…é¡»å¾—è¦è·Ÿå®ƒæ–¹æ³•è°ƒç”¨è€…åœ¨åŒä¸€ä¸ªåæ ‡ç³»é‡Œé¢</span></span><br><span class="line"><span class="comment"> *  @param point &lt;#point description#&gt;</span></span><br><span class="line"><span class="comment"> *  @param event &lt;#event description#&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  @return &lt;#return value description#&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">-(BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event&#123;</span><br><span class="line"><span class="comment">//    NSLog(@"%s",__func__);</span></span><br><span class="line"><span class="comment">//    return [super pointInside:point withEvent:event];</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    </span></span><br><span class="line"><span class="comment">//    //å¦‚æœè¿”å›NOå°±ä»£è¡¨ï¼Œå½“å‰ç‚¹ä¸åœ¨çº¢è‰²viewï¼ˆselfï¼‰ä¸Šé¢ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ç¡®å®ç‚¹å‡»çº¢è‰²viewï¼Œçº¢è‰²viewä¹Ÿä¸ä¼šå“åº”äº‹ä»¶ã€‚</span></span><br><span class="line"><span class="comment">//    return NO;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¦‚æœè¿”å›YESå°±ä»£è¡¨ï¼Œå½“å‰ç‚¹åœ¨çº¢è‰²viewï¼ˆselfï¼‰ä¸Šé¢ï¼Œé‚£ä¹ˆå³ä½¿æˆ‘ä»¬æ²¡æœ‰ç‚¹å‡»çº¢è‰²viewï¼Œçº¢è‰²viewä¹Ÿä¼šå“åº”äº‹ä»¶ã€‚</span></span><br><span class="line">    <span class="keyword">return</span> YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å“åº”è€…é“¾"><a href="#å“åº”è€…é“¾" class="headerlink" title="å“åº”è€…é“¾"></a>å“åº”è€…é“¾</h3><h4 id="å“åº”è€…é“¾-1"><a href="#å“åº”è€…é“¾-1" class="headerlink" title="å“åº”è€…é“¾"></a>å“åº”è€…é“¾</h4><p>å“åº”è€…é“¾æ¡ï¼šæ˜¯ç”±å¤šä¸ªå“åº”è€…å¯¹è±¡è¿æ¥èµ·æ¥çš„é“¾æ¡ï¼Œå“åº”è€…é“¾åˆšå¥½ä¸äº‹ä»¶çš„ä¼ é€’ç›¸åï¼Œä¸¤è€…å½¢æˆä¸€ä¸ªç¯ã€‚</p><p>ä½œç”¨ï¼šèƒ½å¾ˆæ¸…æ¥šåœ°çœ‹è§æ¯ä¸ªå“åº”è€…ä¹‹é—´çš„è”ç³»ï¼Œå¹¶ä¸”å¯ä»¥è®©ä¸€ä¸ªäº‹ä»¶å¤šä¸ªå¯¹è±¡å¤„ç†ã€‚</p><p>å“åº”è€…å¯¹è±¡ï¼šèƒ½å¤„ç†äº‹ä»¶çš„å¯¹è±¡ã€‚</p><ul><li><ol><li>æ‰¾åˆ°æœ€é€‚åˆçš„å“åº”è§†å›¾åäº‹ä»¶ä¼šä»æ­¤è§†å›¾å¼€å§‹æ²¿ç€å“åº”é“¾nextResponderä¼ é€’ï¼Œç›´åˆ°æ‰¾åˆ°å¤„ç†äº‹ä»¶çš„è§†å›¾,å¦‚æœæ²¡æœ‰å¤„ç†çš„äº‹ä»¶ä¼šè¢«ä¸¢å¼ƒã€‚ </li></ol></li><li><ol start="2"><li>å¦‚æœæ‰¾åˆ°äº†èƒ½å¤„ç†è¯¥äº‹ä»¶çš„è§†å›¾ï¼Œåˆ™è¿”å›è¯¥è§†å›¾åœæ­¢ä¼ é€’ã€‚</li></ol></li><li><ol start="3"><li>å¦‚æœå½“å‰è¿™ä¸ªviewæ˜¯æ§åˆ¶å™¨çš„view,é‚£ä¹ˆæ§åˆ¶å™¨å°±æ˜¯ä¸Šä¸€ä¸ªå“åº”è€…ï¼›å¦‚æœå½“å‰è¿™ä¸ªviewä¸æ˜¯æ§åˆ¶å™¨çš„view,é‚£ä¹ˆçˆ¶æ§ä»¶å°±æ˜¯ä¸Šä¸€ä¸ªå“åº”è€…ã€‚</li></ol></li><li><ol start="4"><li>å¦‚æœviewçš„æ§åˆ¶å™¨å­˜åœ¨ï¼Œå°±ä¼ é€’ç»™æ§åˆ¶å™¨ï¼›å¦‚æœæ§åˆ¶å™¨ä¸å­˜åœ¨ï¼Œåˆ™å°†å…¶ä¼ é€’ç»™å®ƒçš„çˆ¶è§†å›¾<br>åœ¨è§†å›¾å±‚æ¬¡ç»“æ„çš„æœ€é¡¶çº§è§†å›¾ï¼Œå¦‚æœä¹Ÿä¸èƒ½å¤„ç†æ”¶åˆ°çš„äº‹ä»¶æˆ–æ¶ˆæ¯ï¼Œåˆ™å…¶å°†äº‹ä»¶æˆ–æ¶ˆæ¯ä¼ é€’ç»™windowå¯¹è±¡è¿›è¡Œå¤„ç†ã€‚</li></ol></li><li><ol start="5"><li>å¦‚æœwindowå¯¹è±¡ä¹Ÿä¸å¤„ç†ï¼Œåˆ™å…¶å°†äº‹ä»¶æˆ–æ¶ˆæ¯ä¼ é€’ç»™UIApplicationå¯¹è±¡ï¼Œå¦‚æœUIApplicationä¹Ÿä¸èƒ½å¤„ç†è¯¥äº‹ä»¶æˆ–æ¶ˆæ¯ï¼Œåˆ™å°†å…¶ä¸¢å¼ƒã€‚</li></ol></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä¸»è¦æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#ä¸»è¦æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;ä¸»è¦æ¦‚å¿µ&quot;&gt;&lt;/a&gt;ä¸»è¦æ¦‚å¿µ&lt;/h3&gt;&lt;h4 id=&quot;äº‹ä»¶&quot;&gt;&lt;a href=&quot;#äº‹ä»¶&quot; class=&quot;headerlink&quot; title=&quot;äº‹ä»¶&quot;&gt;&lt;/a&gt;äº‹ä»¶&lt;/h4&gt;&lt;p&gt;ç”¨æˆ·ä½¿ç”¨appçš„è¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿå„ç§å„æ ·çš„äº‹ä»¶ï¼ŒiOSäº‹ä»¶å¤§ä½“åˆ†ä¸º3ç§ç±»å‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è§¦æ‘¸äº‹ä»¶&lt;/li&gt;
&lt;li&gt;åŠ é€Ÿè®¡äº‹ä»¶&lt;/li&gt;
&lt;li&gt;è¿œç¨‹æ§åˆ¶äº‹ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŠ é€Ÿè®¡äº‹ä»¶å¯ä»¥ç”¨æ¥åšæ‘‡ä¸€æ‘‡ç­‰åŠŸèƒ½ï¼Œè€Œè€³æœºæ§åˆ¶éŸ³é‡å¤§å°ç­‰åˆ™å±äºè¿œç¨‹æ§åˆ¶äº‹ä»¶ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS || RunLoop</title>
    <link href="http://yoursite.com/2019/07/11/iOS-RunLoop/"/>
    <id>http://yoursite.com/2019/07/11/iOS-RunLoop/</id>
    <published>2019-07-10T16:23:54.000Z</published>
    <updated>2019-07-10T16:32:43.132Z</updated>
    
    <content type="html"><![CDATA[<h2 id="RunLoop"><a href="#RunLoop" class="headerlink" title="RunLoop"></a>RunLoop</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>RunLoopå°±æ˜¯æ§åˆ¶çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸå¹¶æ¥æ”¶äº‹ä»¶è¿›è¡Œå¤„ç†çš„æœºåˆ¶ã€‚</p><p>ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰æƒ³è¿‡è¿™ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªåº”ç”¨å¼€å§‹è¿è¡Œä»¥åæ”¾åœ¨é‚£é‡Œï¼Œå¦‚æœä¸å¯¹å®ƒè¿›è¡Œä»»ä½•æ“ä½œï¼Œè¿™ä¸ªåº”ç”¨å°±åƒé™æ­¢äº†ä¸€æ ·ï¼Œä¸ä¼šè‡ªå‘çš„æœ‰ä»»ä½•åŠ¨ä½œå‘ç”Ÿï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç‚¹å‡»ç•Œé¢ä¸Šçš„ä¸€ä¸ªæŒ‰é’®ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šæœ‰å¯¹åº”çš„æŒ‰é’®å“åº”äº‹ä»¶å‘ç”Ÿã€‚ç»™æˆ‘ä»¬çš„æ„Ÿè§‰å°±åƒåº”ç”¨ä¸€ç›´å¤„äºéšæ—¶å¾…å‘½çš„çŠ¶æ€ï¼Œåœ¨æ²¡äººæ“ä½œçš„æ—¶å€™å®ƒä¸€ç›´åœ¨ä¼‘æ¯ï¼Œåœ¨è®©å®ƒå¹²æ´»çš„æ—¶å€™ï¼Œå®ƒå°±èƒ½ç«‹åˆ»å“åº”ã€‚å…¶å®ï¼Œè¿™å°±æ˜¯run loopçš„åŠŸåŠ³ã€‚</p><p>è¿è¡Œå¾ªç¯ï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å¾ªç¯åšä¸€äº›äº‹æƒ…ï¼Œå¦‚æœæ²¡æœ‰Runloopç¨‹åºæ‰§è¡Œå®Œæ¯•å°±ä¼šç«‹å³é€€å‡ºï¼Œå¦‚æœæœ‰Runloopç¨‹åºä¼šä¸€ç›´è¿è¡Œï¼Œå¹¶ä¸”æ—¶æ—¶åˆ»åˆ»åœ¨ç­‰å¾…ç”¨æˆ·çš„è¾“å…¥æ“ä½œã€‚RunLoopå¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™è‡ªå·±è·‘èµ·æ¥è¿è¡Œï¼Œåœ¨æ²¡æœ‰æ“ä½œçš„æ—¶å€™å°±åœä¸‹æ¥ä¼‘æ¯ã€‚å……åˆ†èŠ‚çœCPUèµ„æºï¼Œæé«˜ç¨‹åºæ€§èƒ½ã€‚</p><a id="more"></a><h3 id="åŸºæœ¬ä½œç”¨"><a href="#åŸºæœ¬ä½œç”¨" class="headerlink" title="åŸºæœ¬ä½œç”¨"></a>åŸºæœ¬ä½œç”¨</h3><ol><li><strong>ä¿æŒç¨‹åºæŒç»­è¿è¡Œ</strong>ï¼Œç¨‹åºä¸€å¯åŠ¨å°±ä¼šå¼€ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹ä¸€å¼€èµ·æ¥å°±ä¼šè·‘ä¸€ä¸ªä¸»çº¿ç¨‹å¯¹åº”çš„RunLoopï¼ŒRunLoopä¿è¯ä¸»çº¿ç¨‹ä¸ä¼šè¢«é”€æ¯ï¼Œä¹Ÿå°±ä¿è¯äº†ç¨‹åºçš„æŒç»­è¿è¡Œã€‚</li><li><strong>å¤„ç†Appä¸­çš„å„ç§äº‹ä»¶</strong>ï¼ˆæ¯”å¦‚ï¼šè§¦æ‘¸äº‹ä»¶ï¼Œå®šæ—¶å™¨äº‹ä»¶ï¼ŒSelectoräº‹ä»¶ç­‰ï¼‰</li><li><strong>èŠ‚çœCPUèµ„æºï¼Œæé«˜ç¨‹åºæ€§èƒ½</strong>ï¼Œç¨‹åºè¿è¡Œèµ·æ¥æ—¶ï¼Œå½“ä»€ä¹ˆæ“ä½œéƒ½æ²¡æœ‰åšçš„æ—¶å€™ï¼ŒRunLoopå°±å‘Šè¯‰CPUï¼Œç°åœ¨æ²¡äº‹æƒ…åšï¼Œæˆ‘è¦å»ä¼‘æ¯ï¼Œè¿™æ—¶CPUå°±ä¼šå°†å…¶èµ„æºé‡Šæ”¾å‡ºæ¥å»åšå…¶ä»–çš„äº‹æƒ…ï¼Œå½“æœ‰äº‹æ—¶Runloopå°±ä¼šç«‹é©¬èµ·æ¥å»åšäº‹æƒ…ã€‚</li></ol><h3 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h3><ul><li>ä¸»çº¿ç¨‹çš„RunLoopåœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨åˆ›å»º</li><li>å…¶ä»–çº¿ç¨‹çš„åˆ™éœ€è¦åœ¨è¯¥çº¿ç¨‹ä¸‹è‡ªå·±å¯åŠ¨</li><li>ä¸èƒ½è‡ªå·±åˆ›å»ºRunLoop</li><li>RunLoopä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥éœ€è¦é¿å…åœ¨å…¶ä»–çº¿ç¨‹ä¸Šè°ƒç”¨å½“å‰çº¿ç¨‹çš„RunLoop</li><li>RunLoopè´Ÿè´£ç®¡ç†autorelease pool</li><li>RunLoopè´Ÿè´£å¤„ç†æ¶ˆæ¯äº‹ä»¶ï¼Œå³è¾“å…¥æºäº‹ä»¶å’Œè®¡æ—¶å™¨äº‹ä»¶</li></ul><h3 id="æœºåˆ¶"><a href="#æœºåˆ¶" class="headerlink" title="æœºåˆ¶"></a>æœºåˆ¶</h3><p>RunLoopè¿è¡Œæ—¶ä¸»è¦æœ‰ä»¥ä¸‹å…­ç§çŠ¶æ€ï¼š</p><ul><li>kCFRunLoopEntry â€“ è¿›å…¥runloopå¾ªç¯</li><li>kCFRunLoopBeforeTimers â€“ å¤„ç†å®šæ—¶è°ƒç”¨å‰å›è°ƒ</li><li>kCFRunLoopBeforeSources â€“ å¤„ç†input sourcesçš„äº‹ä»¶</li><li>kCFRunLoopBeforeWaiting â€“ runloopç¡çœ å‰è°ƒç”¨</li><li>kCFRunLoopAfterWaiting â€“ runloopå”¤é†’åè°ƒç”¨</li><li>kCFRunLoopExit â€“ é€€å‡ºrunloop</li></ul><p><img src="https://img-blog.csdnimg.cn/20190605135016860.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>RunLoopObserverä¸Autorelease Poolçš„å…³ç³»<ul><li>UIKit é€šè¿‡ RunLoopObserver åœ¨ RunLoop ä¸¤æ¬¡ Sleep é—´å¯¹ Autorelease Pool è¿›è¡Œ Pop å’Œ Push å°†è¿™æ¬¡ Loop ä¸­äº§ç”Ÿçš„ Autorelease å¯¹è±¡é‡Šæ”¾ã€‚</li></ul></li><li>RunLoopçš„æŒ‚èµ·ä¸å”¤é†’<ul><li>æŒ‡å®šç”¨äºå”¤é†’çš„ <strong>mach_port</strong> ç«¯å£</li><li>è°ƒç”¨ <strong>mach_msg</strong> ç›‘å¬å”¤é†’ç«¯å£ï¼Œè¢«å”¤é†’å‰ç³»ç»Ÿå†…æ ¸å°†è¿™ä¸ªçº¿ç¨‹æŒ‚èµ·ï¼Œåœç•™åœ¨<strong>mach_msg_trap</strong>çŠ¶æ€ã€‚<br>ç”±å¦ä¸€ä¸ªçº¿ç¨‹å‘å†…æ ¸å‘é€è¿™ä¸ªç«¯å£çš„msgåï¼ŒtrapçŠ¶æ€è¢«å”¤é†’ï¼ŒRunLoopç»§ç»­å·¥ä½œã€‚</li></ul></li></ul><h3 id="RunLoopæ”¯æŒçš„æ¶ˆæ¯äº‹ä»¶"><a href="#RunLoopæ”¯æŒçš„æ¶ˆæ¯äº‹ä»¶" class="headerlink" title="RunLoopæ”¯æŒçš„æ¶ˆæ¯äº‹ä»¶"></a>RunLoopæ”¯æŒçš„æ¶ˆæ¯äº‹ä»¶</h3><ul><li>RunLoop</li></ul><p><img src="https://img-blog.csdnimg.cn/20190605135044755.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>æ”¯æŒæ¥æ”¶å¤„ç†è¾“å…¥æºï¼ˆInput Sourceï¼‰äº‹ä»¶ï¼ŒåŒ…æ‹¬<ul><li>ç³»ç»Ÿçš„Mach Portäº‹ä»¶ï¼Œæ˜¯ä¸€ç§é€šè®¯äº‹ä»¶</li><li>è‡ªå®šä¹‰è¾“å…¥äº‹ä»¶</li></ul></li><li>æ”¯æŒæ¥å—å¤„ç†å®šæ—¶æºï¼ˆTimerï¼‰äº‹ä»¶</li><li>åœ¨å¯åŠ¨RunLoopä¹‹å‰ï¼Œå¿…é¡»æ·»åŠ ç›‘å¬çš„è¾“å…¥æºäº‹ä»¶æˆ–è€…å®šæ—¶æºäº‹ä»¶ï¼Œå¦åˆ™è°ƒç”¨[runLoop run]ä¼šç›´æ¥è¿”å›ï¼Œè€Œä¸ä¼šè¿›å…¥å¾ªç¯è®©çº¿ç¨‹å¸¸é©»ã€‚</li><li>å¦‚æœæ²¡æœ‰æ·»åŠ ä»»ä½•è¾“å…¥æºäº‹ä»¶æˆ–Timeräº‹ä»¶ï¼Œçº¿ç¨‹ä¼šä¸€ç›´åœ¨æ— é™å¾ªç¯ç©ºè½¬ä¸­ï¼Œä¼šä¸€ç›´å ç”¨CPUæ—¶é—´ç‰‡ï¼Œæ²¡æœ‰å®ç°èµ„æºçš„åˆç†åˆ†é…ã€‚<br>æ²¡æœ‰whileå¾ªç¯ä¸”æ²¡æœ‰æ·»åŠ ä»»ä½•è¾“å…¥æºæˆ–Timerçš„çº¿ç¨‹ï¼Œçº¿ç¨‹ä¼šç›´æ¥å®Œæˆï¼Œè¢«ç³»ç»Ÿå›æ”¶ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯åšæ³•</span></span><br><span class="line">NSRunLoop *runloop = [NSRunLoop currentRunLoop];</span><br><span class="line"><span class="keyword">while</span> (!self.isCancelled &amp;&amp; !self.isFinished) &#123;</span><br><span class="line">    [runloop runUntilDate:[NSDate dateWithTimeIntervalSinceNow:<span class="number">3</span>];]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®åšæ³•</span></span><br><span class="line">NSRunLoop *runloop = [NSRunLoop currentRunLoop];</span><br><span class="line">[runloop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode];</span><br><span class="line"><span class="keyword">while</span> (!self.isCancelled &amp;&amp; !self.isFinished) &#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        [runloop runUntilDate:[NSDate dateWithTimeIntervalSinceNow:<span class="number">3</span>];]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Run-Loop-Modes"><a href="#Run-Loop-Modes" class="headerlink" title="Run Loop Modes"></a>Run Loop Modes</h3><ul><li><p>ç†è§£<br>Run Loop Modeå°±æ˜¯æµæ°´çº¿ä¸Šæ”¯æŒç”Ÿäº§çš„äº§å“ç±»å‹ï¼Œæµæ°´çº¿åœ¨ä¸€ä¸ªæ—¶åˆ»åªèƒ½åœ¨ä¸€ç§æ¨¡å¼ä¸‹è¿è¡Œï¼Œç”Ÿäº§æŸä¸€ç±»å‹çš„äº§å“ã€‚æ¶ˆæ¯äº‹ä»¶å°±æ˜¯è®¢å•ã€‚</p></li><li><p>Cocoaå®šä¹‰äº†å››ä¸­Mode</p><blockquote><p>Defaultï¼šNSDefaultRunLoopModeï¼Œé»˜è®¤æ¨¡å¼ï¼Œåœ¨Run Loopæ²¡æœ‰æŒ‡å®šModeçš„æ—¶å€™ï¼Œé»˜è®¤å°±è·‘åœ¨Default Modeä¸‹<br>Connectionï¼šNSConnectionReplyModeï¼Œç”¨æ¥ç›‘å¬å¤„ç†ç½‘ç»œè¯·æ±‚NSConnectionçš„äº‹ä»¶<br>Modalï¼šNSModalPanelRunLoopModeï¼ŒOS Xçš„Modalé¢æ¿äº‹ä»¶<br>Event trackingï¼šUITrackingRunLoopModeï¼Œæ‹–åŠ¨äº‹ä»¶<br>Common modeï¼šNSRunLoopCommonModesï¼Œæ˜¯ä¸€ä¸ªæ¨¡å¼é›†åˆï¼Œå½“ç»‘å®šä¸€ä¸ªäº‹ä»¶æºåˆ°è¿™ä¸ªæ¨¡å¼é›†åˆçš„æ—¶å€™å°±ç›¸å½“äºç»‘å®šåˆ°äº†é›†åˆå†…çš„æ¯ä¸€ä¸ªæ¨¡å¼</p></blockquote></li><li><p>RunLoopå¯ä»¥é€šè¿‡[acceptInputForMode:beforeDate:]å’Œ[runMode:beforeDate:]æ¥æŒ‡å®šåœ¨ä¸€æ®µæ—¶é—´å†…çš„è¿è¡Œæ¨¡å¼ã€‚å¦‚æœä¸æŒ‡å®šçš„è¯ï¼ŒRunLoopé»˜è®¤ä¼šè¿è¡Œåœ¨Defaultä¸‹ï¼ˆä¸æ–­é‡å¤è°ƒç”¨runMode:NSDefaultRunLoopMode beforDate:ï¼‰</p></li><li><p>åœ¨ä¸»çº¿ç¨‹å¯åŠ¨ä¸€ä¸ªè®¡æ—¶å™¨Timerï¼Œç„¶åæ‹–åŠ¨UITableViewæˆ–è€…UIScrollViewï¼Œè®¡æ—¶å™¨ä¸æ‰§è¡Œã€‚è¿™æ˜¯å› ä¸ºï¼Œä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­Event trackingæ¨¡å¼çš„ä¼˜å…ˆçº§æœ€é«˜ã€‚åœ¨ç”¨æˆ·æ‹–åŠ¨æ§ä»¶æ—¶ï¼Œä¸»çº¿ç¨‹çš„Run Loopæ˜¯è¿è¡Œåœ¨Event tracking Modeä¸‹ï¼Œè€Œåˆ›å»ºçš„Timeræ˜¯é»˜è®¤å…³è”ä¸ºDefault Modeï¼Œå› æ­¤ç³»ç»Ÿä¸ä¼šç«‹å³æ‰§è¡ŒDefault Modeä¸‹æ¥æ”¶çš„äº‹ä»¶ã€‚è§£å†³æ–¹æ³•ï¼š</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">NSTimer * timer = [NSTimer scheduledTimerWithTimeInterval:<span class="number">1.0</span></span><br><span class="line">                                                   target:self</span><br><span class="line">                                                 selector:@selector(timerFireMethod:)</span><br><span class="line">                                                 userInfo:nil</span><br><span class="line">                                                  repeats:YES];</span><br><span class="line">                                                  </span><br><span class="line">[[NSRunLoop mainRunLoop] addTimer:timer forMode:NSRunLoopCommonModes]; </span><br><span class="line"><span class="comment">//æˆ– </span></span><br><span class="line">[[NSRunLoop currentRunLoop] addTimer:timer forMode:UITrackingRunLoopMode];</span><br><span class="line"></span><br><span class="line">[timer fire];</span><br></pre></td></tr></table></figure><h3 id="RunLoop-åº”ç”¨å®è·µ"><a href="#RunLoop-åº”ç”¨å®è·µ" class="headerlink" title="RunLoop åº”ç”¨å®è·µ"></a>RunLoop åº”ç”¨å®è·µ</h3><ul><li>ç»´æŠ¤çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œè®©çº¿ç¨‹ä¸è‡ªåŠ¨é€€å‡ºï¼ŒisFinishedä¸ºYesæ—¶é€€å‡ºã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NSRunLoop *runLoop = [NSRunLoop currentRunLoop];</span><br><span class="line">[runLoop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode];</span><br><span class="line"><span class="keyword">while</span> (!self.isCancelled &amp;&amp; !self.isFinished) &#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">            [runLoop runUntilDate:[NSDate dateWithTimeIntervalSinceNow:<span class="number">3</span>]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºå¸¸é©»çº¿ç¨‹ï¼Œæ‰§è¡Œä¸€äº›ä¼šä¸€ç›´å­˜åœ¨çš„ä»»åŠ¡ã€‚è¯¥çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸè·ŸAppç›¸åŒ</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@autoreleasepool &#123;</span><br><span class="line">        NSRunLoop *runLoop = [NSRunLoop currentRunLoop];</span><br><span class="line">        [runLoop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode];</span><br><span class="line">        [runLoop run];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨ä¸€å®šæ—¶é—´å†…ç›‘å¬æŸç§äº‹ä»¶ï¼Œæˆ–æ‰§è¡ŒæŸç§ä»»åŠ¡çš„çº¿ç¨‹ã€‚<br>å¦‚ä¸‹ä»£ç ï¼Œåœ¨30åˆ†é’Ÿå†…ï¼Œæ¯éš”30sæ‰§è¡ŒonTimerFired:ã€‚è¿™ç§åœºæ™¯ä¸€èˆ¬ä¼šå‡ºç°åœ¨ï¼Œå¦‚æˆ‘éœ€è¦åœ¨åº”ç”¨å¯åŠ¨ä¹‹åï¼Œåœ¨ä¸€å®šæ—¶é—´å†…æŒç»­æ›´æ–°æŸé¡¹æ•°æ®ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@autoreleasepool &#123;</span><br><span class="line">    NSRunLoop * runLoop = [NSRunLoop currentRunLoop];</span><br><span class="line">    NSTimer * udpateTimer = [NSTimer timerWithTimeInterval:<span class="number">30</span></span><br><span class="line">                                                    target:self</span><br><span class="line">                                                  selector:@selector(onTimerFired:)</span><br><span class="line">                                                  userInfo:nil</span><br><span class="line">                                                   repeats:YES];</span><br><span class="line">    [runLoop addTimer:udpateTimer forMode:NSRunLoopCommonModes];</span><br><span class="line">    [runLoop runUntilDate:[NSDate dateWithTimeIntervalSinceNow:<span class="number">60</span>*<span class="number">30</span>]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;RunLoop&quot;&gt;&lt;a href=&quot;#RunLoop&quot; class=&quot;headerlink&quot; title=&quot;RunLoop&quot;&gt;&lt;/a&gt;RunLoop&lt;/h2&gt;&lt;h3 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h3&gt;&lt;p&gt;RunLoopå°±æ˜¯æ§åˆ¶çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸå¹¶æ¥æ”¶äº‹ä»¶è¿›è¡Œå¤„ç†çš„æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰æƒ³è¿‡è¿™ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªåº”ç”¨å¼€å§‹è¿è¡Œä»¥åæ”¾åœ¨é‚£é‡Œï¼Œå¦‚æœä¸å¯¹å®ƒè¿›è¡Œä»»ä½•æ“ä½œï¼Œè¿™ä¸ªåº”ç”¨å°±åƒé™æ­¢äº†ä¸€æ ·ï¼Œä¸ä¼šè‡ªå‘çš„æœ‰ä»»ä½•åŠ¨ä½œå‘ç”Ÿï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç‚¹å‡»ç•Œé¢ä¸Šçš„ä¸€ä¸ªæŒ‰é’®ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šæœ‰å¯¹åº”çš„æŒ‰é’®å“åº”äº‹ä»¶å‘ç”Ÿã€‚ç»™æˆ‘ä»¬çš„æ„Ÿè§‰å°±åƒåº”ç”¨ä¸€ç›´å¤„äºéšæ—¶å¾…å‘½çš„çŠ¶æ€ï¼Œåœ¨æ²¡äººæ“ä½œçš„æ—¶å€™å®ƒä¸€ç›´åœ¨ä¼‘æ¯ï¼Œåœ¨è®©å®ƒå¹²æ´»çš„æ—¶å€™ï¼Œå®ƒå°±èƒ½ç«‹åˆ»å“åº”ã€‚å…¶å®ï¼Œè¿™å°±æ˜¯run loopçš„åŠŸåŠ³ã€‚&lt;/p&gt;
&lt;p&gt;è¿è¡Œå¾ªç¯ï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å¾ªç¯åšä¸€äº›äº‹æƒ…ï¼Œå¦‚æœæ²¡æœ‰Runloopç¨‹åºæ‰§è¡Œå®Œæ¯•å°±ä¼šç«‹å³é€€å‡ºï¼Œå¦‚æœæœ‰Runloopç¨‹åºä¼šä¸€ç›´è¿è¡Œï¼Œå¹¶ä¸”æ—¶æ—¶åˆ»åˆ»åœ¨ç­‰å¾…ç”¨æˆ·çš„è¾“å…¥æ“ä½œã€‚RunLoopå¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™è‡ªå·±è·‘èµ·æ¥è¿è¡Œï¼Œåœ¨æ²¡æœ‰æ“ä½œçš„æ—¶å€™å°±åœä¸‹æ¥ä¼‘æ¯ã€‚å……åˆ†èŠ‚çœCPUèµ„æºï¼Œæé«˜ç¨‹åºæ€§èƒ½ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>RuntimeåŸç†åŠåº”ç”¨</title>
    <link href="http://yoursite.com/2019/07/11/Runtime%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/"/>
    <id>http://yoursite.com/2019/07/11/RuntimeåŸç†åŠåº”ç”¨/</id>
    <published>2019-07-10T16:22:09.000Z</published>
    <updated>2019-07-10T16:23:03.471Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Runtimeä»‹ç»"><a href="#Runtimeä»‹ç»" class="headerlink" title="Runtimeä»‹ç»"></a>Runtimeä»‹ç»</h3><p>é«˜çº§ç¼–ç¨‹è¯­è¨€æƒ³è¦æˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶éœ€å…ˆç¼–è¯‘ä¸ºæ±‡ç¼–è¯­è¨€å†æ±‡ç¼–ä¸ºæœºå™¨è¯­è¨€ï¼Œæœºå™¨è¯­è¨€ä¹Ÿæ˜¯è®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«çš„å”¯ä¸€è¯­è¨€ï¼Œä½†æ˜¯OCå¹¶ä¸èƒ½ç›´æ¥ç¼–è¯‘ä¸ºæ±‡ç¼–è¯­è¨€ï¼Œè€Œæ˜¯è¦å…ˆè½¬å†™ä¸ºçº¯cè¯­è¨€å†è¿›è¡Œç¼–è¯‘å’Œæ±‡ç¼–æ“ä½œï¼Œä»OCåˆ°Cè¯­è¨€çš„è¿‡æ¸¡å°±æ˜¯runtimeæ¥å®ç°çš„ã€‚ç„¶è€Œæˆ‘ä»¬ä½¿ç”¨OCè¿›è¡Œé¢å‘å¯¹è±¡å¼€å‘ï¼Œè€ŒCè¯­è¨€æ›´å¤šçš„æ˜¯é¢å‘è¿‡ç¨‹å¼€å‘ï¼Œè¿™å°±éœ€è¦å°†é¢å‘å¯¹è±¡çš„ç±»è½¬å˜ä¸ºé¢å‘è¿‡ç¨‹çš„ç»“æ„ä½“ã€‚</p><a id="more"></a><h3 id="Runtimeæ¶ˆæ¯ä¼ é€’"><a href="#Runtimeæ¶ˆæ¯ä¼ é€’" class="headerlink" title="Runtimeæ¶ˆæ¯ä¼ é€’"></a>Runtimeæ¶ˆæ¯ä¼ é€’</h3><p>ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•åƒè¿™æ ·[obj foo]ï¼Œç¼–è¯‘å™¨è½¬æˆæ¶ˆæ¯å‘é€<code>objc_msgSend(obj, foo)</code>, Runtimeæ—¶æ‰§è¡Œçš„æµç¨‹æ˜¯è¿™æ ·çš„ã€‚</p><ul><li>é¦–å…ˆï¼Œé€šè¿‡<code>obj</code>çš„<code>isa</code>æŒ‡é’ˆæ‰¾åˆ°å®ƒçš„<code>class</code>;</li><li>åœ¨<code>class</code>çš„<code>method List</code>æ‰¾fooï¼›</li><li>å¦‚æœ<code>class</code>ä¸­æ²¡æœ‰fooï¼Œå°±ç»§ç»­å‰å¾€å®ƒçš„<code>superclass</code>ä¸­å»æŸ¥æ‰¾;</li><li>ä¸€æ—¦æ‰¾åˆ°fooè¿™ä¸ªå‡½æ•°ï¼Œå°±å»æ‰§è¡Œå®ƒçš„å®ç°IMPã€‚</li></ul><p>ä½†æ˜¯è¿™ç§å®ç°æœ‰ä¸ªé—®é¢˜ï¼Œæ•ˆç‡ä½ã€‚ä¸€ä¸ªClass å¾€å¾€åªæœ‰20%çš„å‡½æ•°ä¼šè¢«ç»å¸¸è°ƒç”¨ï¼Œå¯èƒ½å æ€»è°ƒç”¨æ¬¡æ•°çš„80%ã€‚æ¯æ¬¡æ¶ˆæ¯éƒ½éœ€è¦éå†ä¸€æ¬¡<code>objc_method_list</code> å¹¶ä¸åˆç†ã€‚å¦‚æœæŠŠç»å¸¸è¢«è°ƒç”¨çš„å‡½æ•°ç¼“å­˜ä¸‹æ¥ï¼Œé‚£å¯ä»¥å¤§å¤§æé«˜å‡½æ•°æŸ¥è¯¢çš„æ•ˆç‡ã€‚è¿™å°±æ˜¯<code>objc_class</code>ä¸­å¦ä¸€ä¸ªé‡è¦æˆå‘˜<code>objc_cache</code>åšçš„äº‹æƒ…ï¼Œå†æ‰¾åˆ°fooä¹‹åï¼ŒæŠŠfooçš„methed_nameä½œä¸ºkeyï¼Œmethod_impä½œä¸ºvalueç¼“å­˜èµ·æ¥ã€‚å½“å†æ¬¡æ”¶åˆ°fooæ¶ˆæ¯çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥åœ¨cacheé‡Œæ‰¾åˆ°ï¼Œé¿å…å»éå†objc_method_listã€‚</p><p><strong>objc_msgSendçš„æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">OBJC_EXPORT id <span class="title">objc_msgSend</span><span class="params">(id self, SEL op, ...)</span></span></span><br></pre></td></tr></table></figure><p>é‚£æ¶ˆæ¯ä¼ é€’æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿæˆ‘ä»¬çœ‹çœ‹å¯¹è±¡(object)ï¼Œç±»(class)ï¼Œæ–¹æ³•(method)è¿™å‡ ä¸ªçš„ç»“æ„ä½“ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯¹è±¡</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_object</span> &#123;</span></span><br><span class="line">    Class isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_class</span> &#123;</span></span><br><span class="line">    Class isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !__OBJC2__</span></span><br><span class="line">    Class super_class                                        OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name                                         OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> version                                             OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> info                                                OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> instance_size                                       OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_ivar_list</span> *<span class="title">ivars</span>                             <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_method_list</span> **<span class="title">methodLists</span>                    <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_cache</span> *<span class="title">cache</span>                                 <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_protocol_list</span> *<span class="title">protocols</span>                     <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125; OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="comment">//æ–¹æ³•åˆ—è¡¨</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_method_list</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_method_list</span> *<span class="title">obsolete</span>                        <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line">    <span class="keyword">int</span> method_count                                         OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __LP64__</span></span><br><span class="line">    <span class="keyword">int</span> space                                                OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">/* variable length structure */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_method</span> <span class="title">method_list</span>[1]                        <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line">&#125;                                                            OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="comment">//æ–¹æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_method</span> &#123;</span></span><br><span class="line">    SEL method_name                                          OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">char</span> *method_types                                       OBJC2_UNAVAILABLE;</span><br><span class="line">    IMP method_imp                                           OBJC2_UNAVAILABLE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ç³»ç»Ÿé¦–å…ˆæ‰¾åˆ°æ¶ˆæ¯çš„æ¥å—å¯¹è±¡ï¼Œç„¶åé€šè¿‡å¯¹è±¡çš„isaæ‰¾åˆ°å®ƒçš„ç±»ã€‚</li><li>åœ¨å®ƒçš„ç±»ä¸­æŸ¥æ‰¾<code>method_list</code>ï¼Œæ˜¯å¦æœ‰<code>selector</code>æ–¹æ³•ã€‚</li><li>æ²¡æœ‰åˆ™æŸ¥æ‰¾çˆ¶ç±»çš„<code>method_list</code></li><li>æ‰¾åˆ°å¯¹åº”çš„<code>method</code>ï¼Œæ‰§è¡Œå®ƒçš„IMP</li><li>è½¬å‘IMPçš„returnå€¼ã€‚</li></ol><h4 id="æ¶ˆæ¯ä¼ é€’ä¸­çš„æ¦‚å¿µï¼š"><a href="#æ¶ˆæ¯ä¼ é€’ä¸­çš„æ¦‚å¿µï¼š" class="headerlink" title="æ¶ˆæ¯ä¼ é€’ä¸­çš„æ¦‚å¿µï¼š"></a>æ¶ˆæ¯ä¼ é€’ä¸­çš„æ¦‚å¿µï¼š</h4><h5 id="ç±»å¯¹è±¡-objc-class"><a href="#ç±»å¯¹è±¡-objc-class" class="headerlink" title="ç±»å¯¹è±¡(objc_class)"></a>ç±»å¯¹è±¡(objc_class)</h5><p>ocç±»æ˜¯ç”±Classç±»å‹è¡¨ç¤ºçš„ï¼Œå®ƒå®é™…ä¸Šä¸€ä¸ªæŒ‡å‘<code>objc_class</code>ç»“æ„ä½“çš„æŒ‡é’ˆã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">objc_class</span> *<span class="title">Class</span>;</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹<code>objc/runtime.h</code>ä¸­<code>objc_class</code>ç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_class</span> &#123;</span></span><br><span class="line">    Class _Nonnull isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !__OBJC2__</span></span><br><span class="line">    Class _Nullable super_class                              OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> * _Nonnull name                               OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> version                                             OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> info                                                OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> instance_size                                       OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_ivar_list</span> * _<span class="title">Nullable</span> <span class="title">ivars</span>                  <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_method_list</span> * _<span class="title">Nullable</span> * _<span class="title">Nullable</span> <span class="title">methodLists</span>                    <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_cache</span> * _<span class="title">Nonnull</span> <span class="title">cache</span>                       <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">objc_protocol_list</span> * _<span class="title">Nullable</span> <span class="title">protocols</span>          <span class="title">OBJC2_UNAVAILABLE</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">&#125; OBJC2_UNAVAILABLE;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºç±»å¯¹è±¡å°±æ˜¯ä¸€ä¸ªç»“æ„ä½“<code>struct objc_class</code>ï¼Œè¿™ä¸ªç»“æ„ä½“å­˜æ”¾çš„æ•°æ®ç§°ä¸ºå…ƒæ•°æ®(metadata)ï¼Œè¯¥ç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡ä¹Ÿæ˜¯isaæŒ‡é’ˆï¼Œè¿™å°±è¯´æ˜äº†<code>Class</code>æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç±»å¯¹è±¡ï¼Œç±»å¯¹è±¡åœ¨ç¼–è¯‘æœŸäº§ç”Ÿç”¨äºåˆ›å»ºå®ä¾‹å¯¹è±¡ï¼Œæ˜¯å•ä¾‹ã€‚</p><h5 id="å®ä¾‹-objc-object"><a href="#å®ä¾‹-objc-object" class="headerlink" title="å®ä¾‹(objc_object)"></a>å®ä¾‹(objc_object)</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Represents an instance of a class.</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_object</span> &#123;</span></span><br><span class="line">    Class isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// A pointer to an instance of a class.</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">objc_object</span> *<span class="title">id</span>;</span></span><br></pre></td></tr></table></figure><p>ç±»å¯¹è±¡ä¸­çš„å…ƒæ•°æ®å­˜å‚¨çš„éƒ½æ˜¯å¦‚ä½•åˆ›å»ºä¸€ä¸ªå®ä¾‹çš„ç›¸å…³ä¿¡æ¯ï¼Œé‚£ä¹ˆç±»å¯¹è±¡å’Œç±»æ–¹æ³•åº”è¯¥ä»å“ªé‡Œåˆ›å»ºå‘¢ï¼Ÿ</p><p>å°±æ˜¯ä»isaæŒ‡é’ˆæŒ‡å‘çš„ç»“æ„ä½“åˆ›å»ºï¼Œç±»å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘çš„æˆ‘ä»¬ç§°ä¹‹ä¸ºå…ƒç±»(metaclass)ã€‚</p><p>å…ƒç±»ä¸­ä¿å­˜äº†åˆ›å»ºç±»å¯¹è±¡ä»¥åŠç±»æ–¹æ³•æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><h5 id="å…ƒç±»-Meta-Class"><a href="#å…ƒç±»-Meta-Class" class="headerlink" title="å…ƒç±»(Meta Class)"></a>å…ƒç±»(Meta Class)</h5><p>æ•´ä¸ªç³»ç»Ÿå½¢æˆäº†ä¸€ä¸ªè‡ªé—­ç¯ï¼Œstruct objc_object ç»“æ„ä½“å®ä¾‹çš„isaæŒ‡é’ˆæŒ‡å‘ç±»å¯¹è±¡ã€‚</p><p>ç±»å¯¹è±¡çš„ isa æŒ‡é’ˆæŒ‡å‘å…ƒç±»ï¼Œsuper_class æŒ‡é’ˆæŒ‡å‘çˆ¶ç±»çš„ç±»å¯¹è±¡ã€‚</p><p>å…ƒç±»çš„ super_class æŒ‡é’ˆæŒ‡å‘çˆ¶ç±»çš„å…ƒç±»ï¼Œè€Œå…ƒç±»çš„isaæŒ‡é’ˆåˆæŒ‡å‘äº†è‡ªå·±ã€‚</p><p>å…ƒç±»(Meta Class)æ˜¯ä¸€ä¸ªç±»å¯¹è±¡çš„ç±»ã€‚è€Œæ‰€æœ‰çš„ç±»è‡ªèº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å‘è¿™ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯(å³è°ƒç”¨ç±»æ–¹æ³•)ã€‚</p><p>ä¸ºäº†è°ƒç”¨ç±»æ–¹æ³•ï¼Œè¿™ä¸ªç±»çš„isaæŒ‡é’ˆå¿…é¡»æŒ‡å‘ä¸€ä¸ªåŒ…å«è¿™äº›ç±»æ–¹æ³•çš„ä¸€ä¸ªobjc_class ç»“æ„ä½“ã€‚è¿™å°±å¼•å‡ºäº† meta-class çš„æ¦‚å¿µï¼Œå…ƒç±»ä¸­ä¿å­˜äº†åˆ›å»ºç±»å¯¹è±¡ä»¥åŠç±»æ–¹æ³•æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><p>ä»»ä½•NSObject ç»§æ‰¿ä½“ç³»ä¸‹çš„ meta-class éƒ½ä½¿ç”¨ NSObject çš„meta-class ä½œä¸ºè‡ªå·±çš„æ‰€å±ç±»ï¼Œè€ŒåŸºç±»çš„ meta-class çš„ isa æŒ‡é’ˆæ˜¯æŒ‡å‘å®ƒè‡ªå·±ã€‚</p><h5 id="Method-objc-method"><a href="#Method-objc-method" class="headerlink" title="Method(objc_method)"></a>Method(objc_method)</h5><p>å®šä¹‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// An opaque type that represents a method in a class definition.ä»£è¡¨ç±»å®šä¹‰ä¸­ä¸€ä¸ªæ–¹æ³•çš„ä¸é€æ˜ç±»å‹</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">objc_method</span> *<span class="title">Method</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_method</span> &#123;</span></span><br><span class="line">    SEL method_name        OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">char</span> *method_types     OBJC2_UNAVAILABLE;</span><br><span class="line">    IMP method_imp         OBJC2_UNAVAILABLE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æ„ä½“ä¸­çš„å†…å®¹ï¼š</p><ul><li>SEL method_name æ–¹æ³•å</li><li>char *method_types æ–¹æ³•ç±»å‹</li><li>IMP method_imp æ–¹æ³•å®ç°</li></ul><h5 id="SEL-objc-selector"><a href="#SEL-objc-selector" class="headerlink" title="SEL(objc_selector)"></a>SEL(objc_selector)</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">objc.h</span><br><span class="line"><span class="comment">/// An opaque type that represents a method selector.ä»£è¡¨ä¸€ä¸ªæ–¹æ³•çš„ä¸é€æ˜ç±»å‹</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">objc_selector</span> *<span class="title">SEL</span>;</span></span><br></pre></td></tr></table></figure><p><code>Objc_msgSend</code>å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºSELï¼Œå®ƒæ˜¯selectoråœ¨ocä¸­è¡¨ç¤ºç±»å‹ã€‚selector æ˜¯æ–¹æ³•é€‰æ‹©å™¨ï¼Œå¯ä»¥ç†è§£ä¸ºåŒºåˆ†æ–¹æ³•çš„IDï¼Œè€Œè¿™ä¸ªIDçš„æ•°æ®ç»“æ„ä¸ºSELã€‚</p><p>å…¶å®selector å°±æ˜¯æ˜ å°„åˆ°æ–¹æ³•çš„ c å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨ <code>Objective-C</code> ç¼–è¯‘å™¨å‘½ä»¤<code>@selector()</code>æˆ–è€… <code>Runtime</code> ç³»ç»Ÿçš„<code>sel_registerName</code>å‡½æ•°æ¥è·å¾—ä¸€ä¸ª <code>SEL</code> ç±»å‹çš„æ–¹æ³•é€‰æ‹©å™¨ã€‚</p><p><code>selector</code>æ˜¯ä¸€ä¸ª<code>string</code>ï¼Œæ˜¯ç±»ä¼¼<code>className+method</code>çš„ç»„åˆï¼Œå‘½åè§„åˆ™æœ‰ä¸¤æ¡ï¼š</p><ul><li>åŒä¸€ä¸ªç±»ï¼Œselectorä¸èƒ½é‡å¤</li><li>ä¸åŒçš„ç±»ï¼Œselectorå¯ä»¥é‡å¤</li></ul><p>è¿™ä¹Ÿå¸¦æ¥ä¸€ä¸ªå¼Šç«¯ï¼ŒObjective-cä¸­æ˜¯æ²¡æœ‰å‡½æ•°é‡è½½çš„(å‡½æ•°åç›¸åŒï¼Œå‚æ•°ä¸åŒ)ï¼Œå› ä¸ºselectoråªè®°å½•äº†å‡½æ•°çš„nameæ²¡æœ‰è®°å½•å‚æ•°ï¼Œæ‰€ä»¥æ²¡åŠæ³•åŒºåˆ†ä¸åŒçš„ methodã€‚</p><p>æ¯”å¦‚ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)caculate(NSInteger)num;</span><br><span class="line">- (<span class="keyword">void</span>)caculate(CGFloat)num;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¼šæŠ¥é”™çš„ã€‚</p><p>æˆ‘ä»¬åªèƒ½é€šè¿‡å‘½åæ¥åŒºåˆ«ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)caculateWithInt(NSInteger)num;</span><br><span class="line">- (<span class="keyword">void</span>)caculateWithFloat(CGFloat)num;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸åŒç±»ä¸­ç›¸åŒåå­—çš„æ–¹æ³•æ‰€å¯¹åº”çš„æ–¹æ³•é€‰æ‹©å™¨æ˜¯ç›¸åŒçš„ï¼Œå³ä½¿æ–¹æ³•åå­—ç›¸åŒè€Œå˜é‡ç±»å‹ä¸åŒä¹Ÿä¼šå¯¼è‡´å®ƒä»¬å…·æœ‰ç›¸åŒçš„æ–¹æ³•é€‰æ‹©å™¨ã€‚</p><h5 id="IMP"><a href="#IMP" class="headerlink" title="IMP"></a>IMP</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A pointer to the function of a method implementation.  æŒ‡å‘ä¸€ä¸ªæ–¹æ³•å®ç°çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">id</span> <span class="params">(*IMP)</span><span class="params">(id, SEL, ...)</span></span>; </span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>å°±æ˜¯æŒ‡å‘æœ€ç»ˆå®ç°ç¨‹åºçš„å†…å­˜åœ°å€çš„æŒ‡é’ˆã€‚</p><p>åœ¨<code>iOS</code>çš„<code>Runtime</code>ä¸­ï¼Œ<code>Method</code>é€šè¿‡<code>selector</code>å’Œ<code>IMP</code>ä¸¤ä¸ªå±æ€§ï¼Œå®ç°äº†å¿«é€ŸæŸ¥è¯¢æ–¹æ³•åŠå®ç°ï¼Œç›¸å¯¹æé«˜äº†æ€§èƒ½ï¼Œåˆä¿æŒäº†çµæ´»æ€§ã€‚</p><h5 id="ç±»ç¼“å­˜-objc-cache"><a href="#ç±»ç¼“å­˜-objc-cache" class="headerlink" title="ç±»ç¼“å­˜(objc_cache)"></a>ç±»ç¼“å­˜(objc_cache)</h5><p>å½“objective-cè¿è¡Œæ—¶é€šè¿‡è·Ÿè¸ªå®ƒçš„isaæŒ‡é’ˆæ£€æŸ¥å¯¹è±¡æ—¶ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå®ç°å¾ˆå¤šæ–¹æ³•çš„å¯¹è±¡ã€‚ç„¶è€Œï¼Œä½ å¯èƒ½åªè°ƒç”¨ä»–ä»¬çš„ä¸€å°éƒ¨åˆ†ï¼Œå¹¶ä¸”æ¯æ¬¡æ£€æŸ¥æ—¶ï¼Œæœç´¢æ‰€æœ‰é€‰æ‹©å™¨çš„ç±»åˆ†æ´¾è¡¨æ²¡æœ‰æ„ä¹‰ã€‚æ‰€ä»¥ç±»å®ç°ä¸€ä¸ªç¼“å­˜ï¼Œæ¯å½“ä½ æœç´¢ä¸€ä¸ªç±»åˆ†æ´¾è¡¨ï¼Œå¹¶æ‰¾åˆ°ç›¸åº”çš„é€‰æ‹©å™¨ï¼Œå®ƒæŠŠå®ƒæ”¾å…¥å®ƒçš„ç¼“å­˜ã€‚æ‰€ä»¥å½“objc_msgæŸ¥æ‰¾ä¸€ä¸ªç±»çš„é€‰æ‹©å™¨ï¼Œå®ƒä¼šå…ˆæœç´¢ç±»ç¼“å­˜ã€‚è¿™æ˜¯åŸºäºè¿™æ ·çš„ç†è®ºï¼šå¦‚æœä½ åœ¨ç±»ä¸Šè°ƒç”¨ä¸€ä¸ªæ¶ˆæ¯ï¼Œä½ å¯èƒ½ä»¥åå†æ¬¡è°ƒç”¨è¯¥æ¶ˆæ¯ã€‚</p><p>ä¸ºäº†åŠ é€Ÿæ¶ˆæ¯åˆ†å‘ï¼Œç³»ç»Ÿä¼šå¯¹æ–¹æ³•å’Œå¯¹åº”çš„åœ°å€è¿›è¡Œç¼“å­˜ï¼Œæ”¾åœ¨objc_cacheä¸­ï¼Œæ‰€ä»¥å®é™…è¿è¡Œä¸­ï¼Œå¤§éƒ¨åˆ†å¸¸ç”¨çš„æ–¹æ³•éƒ½ä¼šè¢«ç¼“å­˜èµ·æ¥ï¼ŒRuntime ç³»ç»Ÿå®é™…ä¸Šéå¸¸å¿«ï¼Œæ¥è¿‘ç›´æ¥æ‰§è¡Œå†…å­˜åœ°å€çš„ç¨‹åºé€Ÿåº¦ã€‚</p><h5 id="Category-objc-category"><a href="#Category-objc-category" class="headerlink" title="Category(objc_category)"></a>Category(objc_category)</h5><p>Category æ˜¯è¡¨ç¤ºä¸€ä¸ªæŒ‡å‘åˆ†ç±»çš„ç»“æ„ä½“æŒ‡é’ˆï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">category_t</span> &#123;</span> </span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name; </span><br><span class="line">    <span class="keyword">classref_t</span> cls; </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">method_list_t</span> *<span class="title">instanceMethods</span>;</span> </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">method_list_t</span> *<span class="title">classMethods</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">protocol_list_t</span> *<span class="title">protocols</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">property_list_t</span> *<span class="title">instanceProperties</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>nameï¼šæ˜¯æŒ‡ class_name è€Œä¸æ˜¯ category_nameã€‚ </li><li>clsï¼šè¦æ‰©å±•çš„ç±»å¯¹è±¡ï¼Œç¼–è¯‘æœŸé—´æ˜¯ä¸ä¼šå®šä¹‰çš„ï¼Œè€Œæ˜¯åœ¨Runtimeé˜¶æ®µé€šè¿‡nameå¯¹ åº”åˆ°å¯¹åº”çš„ç±»å¯¹è±¡ã€‚ </li><li>instanceMethodsï¼šcategoryä¸­æ‰€æœ‰ç»™ç±»æ·»åŠ çš„å®ä¾‹æ–¹æ³•çš„åˆ—è¡¨ã€‚ </li><li>classMethodsï¼šcategoryä¸­æ‰€æœ‰æ·»åŠ çš„ç±»æ–¹æ³•çš„åˆ—è¡¨ã€‚ </li><li>protocolsï¼šcategoryå®ç°çš„æ‰€æœ‰åè®®çš„åˆ—è¡¨ã€‚</li><li>instancePropertiesï¼šè¡¨ç¤ºCategoryé‡Œæ‰€æœ‰çš„propertiesï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡objc_setAssociatedObjectå’Œobjc_getAssociatedObjectå¢åŠ å®ä¾‹å˜é‡çš„åŸå› ï¼Œä¸è¿‡è¿™ä¸ªå’Œä¸€èˆ¬çš„å®ä¾‹å˜é‡æ˜¯ä¸ä¸€æ ·çš„ã€‚</li></ul><p><strong>ä»ä¸Šé¢çš„category_tçš„ç»“æ„ä½“ä¸­å¯ä»¥çœ‹å‡ºï¼Œåˆ†ç±»ä¸­å¯ä»¥æ·»åŠ å®ä¾‹æ–¹æ³•ï¼Œç±»æ–¹æ³•ï¼Œç”šè‡³å¯ä»¥å®ç°åè®®ï¼Œæ·»åŠ å±æ€§ï¼Œä¸å¯ä»¥æ·»åŠ æˆå‘˜å˜é‡ã€‚</strong></p><h3 id="Runtimeæ¶ˆæ¯è½¬å‘"><a href="#Runtimeæ¶ˆæ¯è½¬å‘" class="headerlink" title="Runtimeæ¶ˆæ¯è½¬å‘"></a>Runtimeæ¶ˆæ¯è½¬å‘</h3><p>è¿›è¡Œä¸€æ¬¡å‘é€æ¶ˆæ¯ä¼šåœ¨ç›¸å…³çš„ç±»å¯¹è±¡ä¸­æœç´¢æ–¹æ³•åˆ—è¡¨ï¼Œå¦‚æœæ‰¾ä¸åˆ°åˆ™ä¼šæ²¿ç€ç»§æ‰¿æ ‘ä¸€ç›´æœç´¢ç›´åˆ°ç»§æ‰¿æ ‘çš„æ ¹éƒ¨(é€šå¸¸ä¸ºNSObject)ï¼Œå¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°å¹¶ä¸”æ¶ˆæ¯è½¬å‘éƒ½å¤±è´¥äº†å°±ä¼šæ‰§è¡Œ<code>doesNotRecognizeSelector:</code>æ–¹æ³•æŠ¥ <code>unrecongnized selector</code>ã€‚ä¸‹é¢è¯´ä¸€ä¸‹æ¶ˆæ¯è½¬å‘ï¼š</p><ul><li>åŠ¨æ€æ–¹æ³•è§£æ</li><li>å¤‡ç”¨æ¥æ”¶è€…</li><li>å®Œæ•´æ¶ˆæ¯è½¬å‘</li></ul><h4 id="åŠ¨æ€æ–¹æ³•è§£æï¼š"><a href="#åŠ¨æ€æ–¹æ³•è§£æï¼š" class="headerlink" title="åŠ¨æ€æ–¹æ³•è§£æï¼š"></a>åŠ¨æ€æ–¹æ³•è§£æï¼š</h4><p>é¦–å…ˆï¼Œ<code>Objective-C</code>è¿è¡Œæ—¶ä¼šè°ƒç”¨ <code>+resolveInstanceMethod:</code>æˆ–è€… <code>+resolveClassMethod:</code>ï¼Œè®©ä½ æœ‰æœºä¼šæä¾›ä¸€ä¸ªå‡½æ•°å®ç°ã€‚å¦‚æœä½ æ·»åŠ äº†å‡½æ•°å¹¶è¿”å›<code>YES</code>ï¼Œ é‚£è¿è¡Œæ—¶ç³»ç»Ÿå°±ä¼šé‡æ–°å¯åŠ¨ä¸€æ¬¡æ¶ˆæ¯å‘é€çš„è¿‡ç¨‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    [self performSelector:@selector(foo:)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (sel == @selector(foo:))</span><br><span class="line">    &#123;</span><br><span class="line">        class_addMethod([self class], sel, (IMP)fooMethod, <span class="string">"v@:"</span>);</span><br><span class="line">        <span class="keyword">return</span> YES;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [super resolveInstanceMethod:sel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fooMethod</span><span class="params">(id obj, SEL _cmd)</span> </span>&#123;</span><br><span class="line">    NSLog(@<span class="string">"Doing foo"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-05</span> <span class="number">03</span>:<span class="number">53</span>:<span class="number">29.815835</span>+<span class="number">0800</span> TestDemo[<span class="number">821</span>:<span class="number">15514</span>] Doing foo</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è™½ç„¶æ²¡æœ‰å®ç°foo:è¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯é€šè¿‡class_addMethod åŠ¨æ€æ·»åŠ äº†fooMethod å‡½æ•°ï¼Œå¹¶æ‰§è¡ŒfooMethod è¿™ä¸ªå‡½æ•°çš„IMPã€‚å¦‚æœresolve æ–¹æ³•è¿”å›NOï¼Œè¿è¡Œå°±ä¼šç§»åˆ°ä¸‹ä¸€æ­¥ï¼šforwardingTargetForSelectorã€‚</p><h4 id="å¤‡ç”¨æ¥æ”¶è€…"><a href="#å¤‡ç”¨æ¥æ”¶è€…" class="headerlink" title="å¤‡ç”¨æ¥æ”¶è€…"></a>å¤‡ç”¨æ¥æ”¶è€…</h4><p>å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†<code>forwardingTargetForSelector</code>ï¼Œ<code>Runtime</code>è¿™æ—¶å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œç»™ä½ æŠŠè¿™ä¸ªæ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡çš„æœºä¼šã€‚æ‰€ä»¥è¯´æ˜¯å¤‡ç”¨æ¥æ”¶è€…ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"objc/runtime.h"</span></span></span><br><span class="line"></span><br><span class="line">@interface Person : NSObject</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation Person</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)foo &#123;</span><br><span class="line">    NSLog(@<span class="string">"Doing foo"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@<span class="function">interface <span class="title">ViewController</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation ViewController</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    [self performSelector:@selector(foo)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)forwardingTargetForSelector:(SEL)aSelector</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (aSelector == @selector(foo))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> [Person <span class="keyword">new</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [super forwardingTargetForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é€šè¿‡<code>forwardingTargetForSelector</code>æŠŠå½“å‰ ViewController çš„æ–¹æ³•è½¬å‘ç»™äº† Person å»æ‰§è¡Œï¼Œå¹¶æˆåŠŸæ‰§è¡Œã€‚</p><h4 id="å®Œæ•´æ¶ˆæ¯è½¬å‘"><a href="#å®Œæ•´æ¶ˆæ¯è½¬å‘" class="headerlink" title="å®Œæ•´æ¶ˆæ¯è½¬å‘"></a>å®Œæ•´æ¶ˆæ¯è½¬å‘</h4><p>å¦‚æœåœ¨ä¸Šä¸€æ­¥è¿˜ä¸èƒ½å¤„ç†æœªçŸ¥æ¶ˆæ¯ï¼Œåˆ™å”¯ä¸€èƒ½åšçš„å°±æ˜¯å¯ç”¨å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶äº†ã€‚é¦–å…ˆå®ƒä¼šå‘é€<code>-methodSignatureForSelector:</code>æ¶ˆæ¯è·å¾—å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹ã€‚å¦‚æœ<code>-methodSignatureForSelector:</code>è¿”å›<code>nil</code> ï¼Œ<code>Runtime</code>åˆ™ä¼šå‘å‡º <code>-doesNotRecognizeSelector:</code> æ¶ˆæ¯ï¼Œç¨‹åºè¿™æ—¶ä¹Ÿå°±æŒ‚æ‰äº†ã€‚å¦‚æœè¿”å›äº†ä¸€ä¸ªå‡½æ•°ç­¾åï¼Œ<code>Runtime</code>å°±ä¼šåˆ›å»ºä¸€ä¸ª<code>NSInvocation</code> å¯¹è±¡å¹¶å‘é€ <code>-forwardInvocation:</code>æ¶ˆæ¯ç»™ç›®æ ‡å¯¹è±¡ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"objc/runtime.h"</span></span></span><br><span class="line"></span><br><span class="line">@interface Person : NSObject</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation Person</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)foo &#123;</span><br><span class="line">    NSLog(@<span class="string">"Doing foo"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@<span class="function">interface <span class="title">ViewController</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation ViewController</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    [self performSelector:@selector(foo)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)forwardingTargetForSelector:(SEL)aSelector</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> nil;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> NO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fooMethod</span><span class="params">(id obj, SEL _cmd)</span> </span>&#123;</span><br><span class="line">    NSLog(@<span class="string">"Doing foooo"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ([NSStringFromSelector(aSelector) isEqualToString:@<span class="string">"foo"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span> [NSMethodSignature signatureWithObjCTypes:<span class="string">"v@:"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [super methodSignatureForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)forwardInvocation:(NSInvocation *)anInvocation</span><br><span class="line">&#123;</span><br><span class="line">    SEL sel = anInvocation.selector;</span><br><span class="line">    Person *p = [Person <span class="keyword">new</span>];</span><br><span class="line">    <span class="keyword">if</span> ([p respondsToSelector:sel]) &#123;</span><br><span class="line">        [anInvocation invokeWithTarget:p];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        [self doesNotRecognizeSelector:sel];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-05</span> <span class="number">04</span>:<span class="number">14</span>:<span class="number">05.722619</span>+<span class="number">0800</span> TestDemo[<span class="number">1195</span>:<span class="number">29921</span>] Doing foo</span><br></pre></td></tr></table></figure><p>ä»æ‰“å°ç»“æœçœ‹ï¼Œå®ç°äº†å®Œæ•´çš„è½¬å‘ï¼Œé€šè¿‡ç­¾åï¼ŒRuntime ç”Ÿæˆäº†ä¸€ä¸ªå¯¹è±¡ <code>anInvocation</code>ï¼Œå‘é€ç»™äº†<code>forwardInvocation</code>ï¼Œæˆ‘ä»¬åœ¨<code>forwardInvocation</code>æ–¹æ³•é‡Œè®©Personå¯¹è±¡å»æ‰§è¡Œäº†fooå‡½æ•°ã€‚å…¶ä¸­ç­¾åå‚æ•°<code>v@</code>å°±æ˜¯æŒ‡voidç±»å‹ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯Runtimeçš„ä¸‰æ¬¡è½¬å‘æµç¨‹ã€‚</p><h3 id="Runtimeåº”ç”¨"><a href="#Runtimeåº”ç”¨" class="headerlink" title="Runtimeåº”ç”¨"></a>Runtimeåº”ç”¨</h3><p><code>Runtime</code>ç®€ç›´å°±æ˜¯åšå¤§å‹æ¡†æ¶çš„åˆ©å™¨ã€‚å®ƒçš„åº”ç”¨åœºæ™¯å¾ˆå¤šï¼Œä¸‹é¢ä»‹ç»ä¸€äº›å¸¸è§çš„åº”ç”¨åœºæ™¯ã€‚</p><ul><li>å…³è”å¯¹è±¡(OC Associated Objects)ç»™åˆ†ç±»å¢åŠ å±æ€§</li><li>æ–¹æ³•é­”æ³•(Method Swizzling)æ–¹æ³•æ·»åŠ å’Œæ›¿æ¢å’ŒKVOå®ç°</li><li>æ¶ˆæ¯è½¬å‘(çƒ­æ›´æ–°)è§£å†³Bug(JSPatch)</li><li>å®ç°NSCodingçš„è‡ªåŠ¨å½’æ¡£å’Œè‡ªåŠ¨è§£æ¡£</li><li>å®ç°å­—å…¸å’Œæ¨¡å‹çš„è‡ªåŠ¨è½¬æ¢</li></ul><h4 id="å…³è”å¯¹è±¡ç»™åˆ†ç±»å¢åŠ å±æ€§"><a href="#å…³è”å¯¹è±¡ç»™åˆ†ç±»å¢åŠ å±æ€§" class="headerlink" title="å…³è”å¯¹è±¡ç»™åˆ†ç±»å¢åŠ å±æ€§"></a>å…³è”å¯¹è±¡ç»™åˆ†ç±»å¢åŠ å±æ€§</h4><p>å…³è”å¯¹è±¡Runtimeæä¾›äº†ä¸‹é¢å‡ ä¸ªæ¥å£ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…³è”å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">objc_setAssociatedObject</span><span class="params">(id object, <span class="keyword">const</span> <span class="keyword">void</span> *key, id value, objc_AssociationPolicy policy)</span></span></span><br><span class="line"><span class="function"><span class="comment">//è·å–å…³è”çš„å¯¹è±¡</span></span></span><br><span class="line"><span class="function">id <span class="title">objc_getAssociatedObject</span><span class="params">(id object, <span class="keyword">const</span> <span class="keyword">void</span> *key)</span></span></span><br><span class="line"><span class="function"><span class="comment">//ç§»é™¤å…³è”çš„å¯¹è±¡</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">objc_removeAssociatedObjects</span><span class="params">(id object)</span></span></span><br></pre></td></tr></table></figure><p>å‚æ•°è§£é‡Šï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id objectï¼šè¢«å…³è”çš„å¯¹è±¡</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">void</span> *keyï¼šå…³è”çš„keyï¼Œè¦æ±‚å”¯ä¸€</span><br><span class="line">id valueï¼šå…³è”çš„å¯¹è±¡</span><br><span class="line">objc_AssociationPolicy policyï¼šå†…å­˜ç®¡ç†çš„ç­–ç•¥</span><br></pre></td></tr></table></figure><p>å†…å­˜ç®¡ç†çš„ç­–ç•¥ï¼š</p><table><thead><tr><th>å†…å­˜ç­–ç•¥</th><th>å±æ€§ä¿®é¥°</th><th>æè¿°</th></tr></thead><tbody><tr><td>OBJC_ASSOCIATION_ASSIGN</td><td>@property (assign) æˆ– @property (unsafe_unretained)</td><td>æŒ‡å®šä¸€ä¸ªå…³è”å¯¹è±¡çš„å¼±å¼•ç”¨ã€‚</td></tr><tr><td>OBJC_ASSOCIATION_RETAIN_NONATOMIC</td><td>@property (nonatomic, strong)</td><td>@property (nonatomic, strong)   æŒ‡å®šä¸€ä¸ªå…³è”å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œä¸èƒ½è¢«åŸå­åŒ–ä½¿ç”¨ã€‚</td></tr><tr><td>OBJC_ASSOCIATION_COPY_NONATOMIC</td><td>@property (nonatomic, copy)</td><td>æŒ‡å®šä¸€ä¸ªå…³è”å¯¹è±¡çš„copyå¼•ç”¨ï¼Œä¸èƒ½è¢«åŸå­åŒ–ä½¿ç”¨ã€‚</td></tr><tr><td>OBJC_ASSOCIATION_RETAIN</td><td>@property (atomic, strong)</td><td>æŒ‡å®šä¸€ä¸ªå…³è”å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œèƒ½è¢«åŸå­åŒ–ä½¿ç”¨ã€‚</td></tr><tr><td>OBJC_ASSOCIATION_COPY</td><td>@property (atomic, copy)</td><td>æŒ‡å®šä¸€ä¸ªå…³è”å¯¹è±¡çš„copyå¼•ç”¨ï¼Œèƒ½è¢«åŸå­åŒ–ä½¿ç”¨ã€‚</td></tr></tbody></table><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"objc/runtime.h"</span></span></span><br><span class="line"></span><br><span class="line">@<span class="function">interface <span class="title">UIView</span> <span class="params">(DefaultColor)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line">@property (nonatomic, strong) UIColor *defaultColor;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@<span class="function">implementation <span class="title">UIView</span> <span class="params">(DefaultColor)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">char</span> kDefaultColorKey</span>;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setDefaultColor:(UIColor *)defaultColor &#123;</span><br><span class="line">    objc_setAssociatedObject(self, &amp;kDefaultColorKey, defaultColor, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)defaultColor &#123;</span><br><span class="line">    <span class="keyword">return</span> objc_getAssociatedObject(self, &amp;kDefaultColorKey);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@<span class="function">interface <span class="title">ViewController</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation ViewController</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    </span><br><span class="line">    UIView *test = [UIView <span class="keyword">new</span>];</span><br><span class="line">    test.defaultColor = [UIColor blackColor];</span><br><span class="line">    NSLog(@<span class="string">"%@"</span>, test.defaultColor);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-05</span> <span class="number">09</span>:<span class="number">30</span>:<span class="number">29.002794</span>+<span class="number">0800</span> TestDemo[<span class="number">1131</span>:<span class="number">26732</span>] UIExtendedGrayColorSpace <span class="number">0</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="æ–¹æ³•é­”æ³•-Method-Swizzling-æ–¹æ³•æ·»åŠ å’Œæ›¿æ¢å’ŒKVOå®ç°"><a href="#æ–¹æ³•é­”æ³•-Method-Swizzling-æ–¹æ³•æ·»åŠ å’Œæ›¿æ¢å’ŒKVOå®ç°" class="headerlink" title="æ–¹æ³•é­”æ³•(Method Swizzling)æ–¹æ³•æ·»åŠ å’Œæ›¿æ¢å’ŒKVOå®ç°"></a>æ–¹æ³•é­”æ³•(Method Swizzling)æ–¹æ³•æ·»åŠ å’Œæ›¿æ¢å’ŒKVOå®ç°</h4><p>å®é™…ä¸Šæ·»åŠ æ–¹æ³•åˆšæ‰åœ¨è®²æ¶ˆæ¯è½¬å‘çš„æ—¶å€™ï¼ŒåŠ¨æ€æ–¹æ³•è§£æçš„æ—¶å€™å°±æåˆ°äº†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//class_addMethod(Class  _Nullable __unsafe_unretained cls, SEL  _Nonnull name, IMP  _Nonnull imp, const char * _Nullable types)</span></span><br><span class="line">class_addMethod([self class], sel, (IMP)fooMethod, <span class="string">"v@:"</span>);</span><br></pre></td></tr></table></figure><ul><li>cls è¢«æ·»åŠ æ–¹æ³•çš„ç±»</li><li>name æ·»åŠ çš„æ–¹æ³•çš„åç§°çš„SEL</li><li>impæ–¹æ³•çš„å®ç°ï¼Œè¯¥å‡½æ•°å¿…é¡»è‡³å°‘æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œselfï¼Œ_cmd</li><li>æ–¹æ³•ç±»å‹ </li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"objc/runtime.h"</span></span></span><br><span class="line"></span><br><span class="line">@implementation ViewController</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">dispatch_once_t</span> onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        Class class = [self class];</span><br><span class="line">        SEL originalSelector = @selector(viewDidLoad);</span><br><span class="line">        SEL swizzledSelector = @selector(jkviewDidLoad);</span><br><span class="line">        </span><br><span class="line">        Method originalMethod = class_getInstanceMethod(class,originalSelector);</span><br><span class="line">        Method swizzledMethod = class_getInstanceMethod(class,swizzledSelector);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//judge the method named  swizzledMethod is already existed.</span></span><br><span class="line">        BOOL didAddMethod = class_addMethod(class, originalSelector, method_getImplementation(swizzledMethod), method_getTypeEncoding(swizzledMethod));</span><br><span class="line">        <span class="comment">// if swizzledMethod is already existed.</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (didAddMethod) &#123;</span><br><span class="line">            class_replaceMethod(class, swizzledSelector, method_getImplementation(originalMethod), method_getTypeEncoding(originalMethod));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            method_exchangeImplementations(originalMethod, swizzledMethod);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)jkviewDidLoad &#123;</span><br><span class="line">    NSLog(@<span class="string">"æ›¿æ¢çš„æ–¹æ³•"</span>);</span><br><span class="line">    <span class="comment">// å¦‚æœä¸æ‰§è¡Œä¸‹ä¸€æ­¥åªä¼šæ‰§è¡Œæ‰“å°æ›¿æ¢çš„æ–¹æ³•</span></span><br><span class="line">    [self jkviewDidLoad];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    NSLog(@<span class="string">"è‡ªå¸¦çš„æ–¹æ³•"</span>);</span><br><span class="line">    </span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p><code>swizzling</code>åº”è¯¥åªåœ¨<code>+load</code>ä¸­å®Œæˆã€‚ åœ¨ <code>Objective-C</code> çš„è¿è¡Œæ—¶ä¸­ï¼Œæ¯ä¸ªç±»æœ‰ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè‡ªåŠ¨è°ƒç”¨ã€‚<code>+load</code> æ˜¯åœ¨ä¸€ä¸ªç±»è¢«åˆå§‹è£…è½½æ—¶è°ƒç”¨ï¼Œ<code>+initialize</code> æ˜¯åœ¨åº”ç”¨ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥ç±»çš„ç±»æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•å‰è°ƒç”¨çš„ã€‚ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯å¯é€‰çš„ï¼Œå¹¶ä¸”åªæœ‰åœ¨æ–¹æ³•è¢«å®ç°çš„æƒ…å†µä¸‹æ‰ä¼šè¢«è°ƒç”¨ã€‚</p><p><code>swizzling</code>åº”è¯¥åªåœ¨<code>dispatch_once</code> ä¸­å®Œæˆ,ç”±äº<code>swizzling</code> æ”¹å˜äº†å…¨å±€çš„çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç¡®ä¿æ¯ä¸ªé¢„é˜²æªæ–½åœ¨è¿è¡Œæ—¶éƒ½æ˜¯å¯ç”¨çš„ã€‚åŸå­æ“ä½œå°±æ˜¯è¿™æ ·ä¸€ä¸ªç”¨äºç¡®ä¿ä»£ç åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡çš„é¢„é˜²æªæ–½ï¼Œå°±ç®—æ˜¯åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ä¹Ÿèƒ½ç¡®ä¿ä»£ç åªæ‰§è¡Œä¸€æ¬¡ã€‚<code>Grand Central Dispatch çš„ dispatch_once</code>æ»¡è¶³äº†æ‰€éœ€è¦çš„éœ€æ±‚ï¼Œå¹¶ä¸”åº”è¯¥è¢«å½“åšä½¿ç”¨<code>swizzling</code> çš„åˆå§‹åŒ–å•ä¾‹æ–¹æ³•çš„æ ‡å‡†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-05</span> <span class="number">09</span>:<span class="number">50</span>:<span class="number">39.256374</span>+<span class="number">0800</span> TestDemo[<span class="number">1359</span>:<span class="number">36735</span>] æ›¿æ¢çš„æ–¹æ³•</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-05</span> <span class="number">09</span>:<span class="number">50</span>:<span class="number">39.256505</span>+<span class="number">0800</span> TestDemo[<span class="number">1359</span>:<span class="number">36735</span>] è‡ªå¸¦çš„æ–¹æ³•</span><br></pre></td></tr></table></figure><h4 id="KVOå®ç°"><a href="#KVOå®ç°" class="headerlink" title="KVOå®ç°"></a>KVOå®ç°</h4><blockquote><p>å…¨ç§°æ˜¯Key-value observingï¼Œç¿»è¯‘æˆé”®å€¼è§‚å¯Ÿã€‚æä¾›äº†ä¸€ç§å½“å…¶å®ƒå¯¹è±¡å±æ€§è¢«ä¿®æ”¹çš„æ—¶å€™èƒ½é€šçŸ¥å½“å‰å¯¹è±¡çš„æœºåˆ¶ã€‚å†MVCå¤§è¡Œå…¶é“çš„Cocoaä¸­ï¼ŒKVOæœºåˆ¶å¾ˆé€‚åˆå®ç°modelå’Œcontrollerç±»ä¹‹é—´çš„é€šè®¯ã€‚</p></blockquote><p>KVO çš„å®ç°ä¾èµ–äºOCçš„Runtimeï¼Œå½“è§‚å¯ŸæŸå¯¹è±¡Aæ—¶ï¼ŒKVO æœºåˆ¶åŠ¨æ€åˆ›å»ºä¸€ä¸ªå¯¹è±¡Aå½“å‰ç±»çš„å­ç±»ï¼Œå¹¶ä¸ºè¿™ä¸ªæ–°çš„å­ç±»é‡å†™äº†è¢«è§‚å¯Ÿå±æ€§ keyPath çš„ setter æ–¹æ³•ã€‚setter æ–¹æ³•éšåè´Ÿè´£é€šçŸ¥è§‚å¯Ÿå¯¹è±¡å±æ€§çš„æ”¹å˜çŠ¶å†µã€‚</p><p>Apple ä½¿ç”¨äº† isa-swizzling æ¥å®ç° KVOã€‚å½“è§‚å¯Ÿå¯¹è±¡ A æ—¶ï¼ŒKVOæœºåˆ¶åŠ¨æ€åˆ›å»ºä¸€ä¸ªæ–°çš„åä¸ºï¼šNSKVONofifying_A çš„æ–°ç±»ï¼Œè¯¥ç±»ç»§æ‰¿è‡ªå¯¹è±¡ A çš„æœ¬ç±»ï¼Œä¸” KVO ä¸ºNSKVONotifying_A é‡å†™è§‚å¯Ÿå±æ€§çš„ setter æ–¹æ³•ï¼Œsetter æ–¹æ³•ä¼šè´Ÿè´£åœ¨è°ƒç”¨åŸ setter æ–¹æ³•ä¹‹å‰å’Œä¹‹åï¼Œé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿå¯¹è±¡å±æ€§å€¼çš„æ›´æ”¹æƒ…å†µã€‚</p><ul><li>NSKVONotifying_Aç±»å‰–æï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSLog(@<span class="string">"self-&gt;isa:%@"</span>,self-&gt;isa);  </span><br><span class="line">NSLog(@<span class="string">"self class:%@"</span>,[self class]);</span><br></pre></td></tr></table></figure><p>åœ¨å»ºç«‹KVOç›‘å¬å‰ï¼Œæ‰“å°ç»“æœä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">self-&gt;isa:A</span><br><span class="line">self class:A</span><br></pre></td></tr></table></figure><p> åœ¨å»ºç«‹KVOç›‘å¬ä¹‹åï¼Œæ‰“å°ç»“æœä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">self-&gt;isa:NSKVONotifying_A</span><br><span class="line">self class:A</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ï¼Œè¢«è§‚å¯Ÿå¯¹è±¡çš„ <code>isa</code> æŒ‡é’ˆä»æŒ‡å‘åŸæ¥çš„ <code>A</code> ç±»ï¼Œè¢«<code>KVO</code> æœºåˆ¶ä¿®æ”¹ä¸ºæŒ‡å‘ç³»ç»Ÿæ–°åˆ›å»ºçš„å­ç±»<code>NSKVONotifying_A</code> ç±»ï¼Œæ¥å®ç°å½“å‰ç±»å±æ€§å€¼æ”¹å˜çš„ç›‘å¬ï¼›<br>æ‰€ä»¥å½“æˆ‘ä»¬ä»åº”ç”¨å±‚é¢ä¸Šçœ‹æ¥ï¼Œå®Œå…¨æ²¡æœ‰æ„è¯†åˆ°æœ‰æ–°çš„ç±»å‡ºç°ï¼Œè¿™æ˜¯ç³»ç»Ÿâ€œéšç’â€äº†å¯¹ <code>KVO</code> çš„åº•å±‚å®ç°è¿‡ç¨‹ï¼Œè®©æˆ‘ä»¬è¯¯ä»¥ä¸ºè¿˜æ˜¯åŸæ¥çš„ç±»ã€‚ä½†æ˜¯æ­¤æ—¶å¦‚æœæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„åä¸ºâ€œ<code>NSKVONotifying_A</code>â€çš„ç±»ï¼Œå°±ä¼šå‘ç°ç³»ç»Ÿè¿è¡Œåˆ°æ³¨å†Œ <code>KVO</code> çš„é‚£æ®µä»£ç æ—¶ç¨‹åºå°±å´©æºƒï¼Œå› ä¸ºç³»ç»Ÿåœ¨æ³¨å†Œç›‘å¬çš„æ—¶å€™åŠ¨æ€åˆ›å»ºäº†åä¸º <code>NSKVONotifying_A</code> çš„ä¸­é—´ç±»ï¼Œå¹¶æŒ‡å‘è¿™ä¸ªä¸­é—´ç±»äº†ã€‚</p><ul><li>å­ç±»setteræ–¹æ³•å‰–æ</li></ul><p><code>KVO</code> çš„é”®å€¼è§‚å¯Ÿé€šçŸ¥ä¾èµ–äº NSObject çš„ä¸¤ä¸ªæ–¹æ³•:<code>willChangeValueForKey:</code>å’Œ <code>didChangeValueForKey:</code> ï¼Œåœ¨å­˜å–æ•°å€¼çš„å‰ååˆ†åˆ«è°ƒç”¨ 2 ä¸ªæ–¹æ³•ï¼š<br> è¢«è§‚å¯Ÿå±æ€§å‘ç”Ÿæ”¹å˜ä¹‹å‰ï¼Œ<code>willChangeValueForKey:</code>è¢«è°ƒç”¨ï¼Œé€šçŸ¥ç³»ç»Ÿè¯¥ <code>keyPath</code> çš„å±æ€§å€¼å³å°†å˜æ›´ï¼›<br> å½“æ”¹å˜å‘ç”Ÿåï¼Œ <code>didChangeValueForKey:</code> è¢«è°ƒç”¨ï¼Œé€šçŸ¥ç³»ç»Ÿè¯¥<code>keyPath</code> çš„å±æ€§å€¼å·²ç»å˜æ›´ï¼›ä¹‹åï¼Œ <code>observeValueForKey:ofObject:change:context:</code>ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ä¸”é‡å†™è§‚å¯Ÿå±æ€§çš„<code>setter</code> æ–¹æ³•è¿™ç§ç»§æ‰¿æ–¹å¼çš„æ³¨å…¥æ˜¯åœ¨è¿è¡Œæ—¶è€Œä¸æ˜¯ç¼–è¯‘æ—¶å®ç°çš„ã€‚</p><p><code>KVO</code> ä¸ºå­ç±»çš„è§‚å¯Ÿè€…å±æ€§é‡å†™è°ƒç”¨å­˜å–æ–¹æ³•çš„å·¥ä½œåŸç†åœ¨ä»£ç ä¸­ç›¸å½“äºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setName:(NSString *)newName &#123; </span><br><span class="line">      [self willChangeValueForKey:@<span class="string">"name"</span>];    <span class="comment">//KVO åœ¨è°ƒç”¨å­˜å–æ–¹æ³•ä¹‹å‰æ€»è°ƒç”¨ </span></span><br><span class="line">      [super setValue:newName forKey:@<span class="string">"name"</span>]; <span class="comment">//è°ƒç”¨çˆ¶ç±»çš„å­˜å–æ–¹æ³• </span></span><br><span class="line">      [self didChangeValueForKey:@<span class="string">"name"</span>];     <span class="comment">//KVO åœ¨è°ƒç”¨å­˜å–æ–¹æ³•ä¹‹åæ€»è°ƒç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Runtimeä»‹ç»&quot;&gt;&lt;a href=&quot;#Runtimeä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;Runtimeä»‹ç»&quot;&gt;&lt;/a&gt;Runtimeä»‹ç»&lt;/h3&gt;&lt;p&gt;é«˜çº§ç¼–ç¨‹è¯­è¨€æƒ³è¦æˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶éœ€å…ˆç¼–è¯‘ä¸ºæ±‡ç¼–è¯­è¨€å†æ±‡ç¼–ä¸ºæœºå™¨è¯­è¨€ï¼Œæœºå™¨è¯­è¨€ä¹Ÿæ˜¯è®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«çš„å”¯ä¸€è¯­è¨€ï¼Œä½†æ˜¯OCå¹¶ä¸èƒ½ç›´æ¥ç¼–è¯‘ä¸ºæ±‡ç¼–è¯­è¨€ï¼Œè€Œæ˜¯è¦å…ˆè½¬å†™ä¸ºçº¯cè¯­è¨€å†è¿›è¡Œç¼–è¯‘å’Œæ±‡ç¼–æ“ä½œï¼Œä»OCåˆ°Cè¯­è¨€çš„è¿‡æ¸¡å°±æ˜¯runtimeæ¥å®ç°çš„ã€‚ç„¶è€Œæˆ‘ä»¬ä½¿ç”¨OCè¿›è¡Œé¢å‘å¯¹è±¡å¼€å‘ï¼Œè€ŒCè¯­è¨€æ›´å¤šçš„æ˜¯é¢å‘è¿‡ç¨‹å¼€å‘ï¼Œè¿™å°±éœ€è¦å°†é¢å‘å¯¹è±¡çš„ç±»è½¬å˜ä¸ºé¢å‘è¿‡ç¨‹çš„ç»“æ„ä½“ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS || Grand Central Dispatch (GCD)</title>
    <link href="http://yoursite.com/2019/07/11/Dispatch/"/>
    <id>http://yoursite.com/2019/07/11/Dispatch/</id>
    <published>2019-07-10T16:19:38.000Z</published>
    <updated>2019-07-10T16:33:08.487Z</updated>
    
    <content type="html"><![CDATA[<h3 id="è¿›ç¨‹å’Œçº¿ç¨‹ï¼š"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹ï¼š" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹ï¼š"></a>è¿›ç¨‹å’Œçº¿ç¨‹ï¼š</h3><p>è¿›ç¨‹æ˜¯ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ã€‚åº”ç”¨ç¨‹åºæ˜¯ä¸€ä¸ªæ²¡æœ‰ç”Ÿå‘½çš„å®ä½“ï¼Œåªæœ‰è¿è¡Œä¹‹åï¼Œæ‰èƒ½æˆä¸ºä¸€ä¸ªæ´»åŠ¨çš„å®ä½“ï¼Œä¹Ÿå°±æ˜¯è¿›ç¨‹ã€‚</p><p><strong>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºçš„åŸºæœ¬å•å…ƒ</strong>ã€‚è¿›ç¨‹åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­æ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜å•å…ƒï¼Œä¸€ä¸ªè¿›ç¨‹å´©æºƒåï¼Œä¸ä¼šå¯¹å…¶ä»–è¿›ç¨‹é€ æˆå½±å“ã€‚</p><p><strong>çº¿ç¨‹æ˜¯ç‹¬ç«‹è¿è¡Œå’Œç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½</strong>ï¼Œçº¿ç¨‹æ‰æ˜¯ç¨‹åºçœŸæ­£çš„æ‰§è¡Œå•å…ƒï¼Œè´Ÿè´£ä»£ç çš„æ‰§è¡Œã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ï¼ŒåŒä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹å…±äº«è¿›ç¨‹çš„å†…å­˜èµ„æºã€‚çº¿ç¨‹æ²¡æœ‰å•ç‹¬çš„åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªçº¿ç¨‹å´©æºƒæ•´ä¸ªè¿›ç¨‹å°±ä¼šå´©æºƒã€‚</p><h3 id="å¤šçº¿ç¨‹ï¼š"><a href="#å¤šçº¿ç¨‹ï¼š" class="headerlink" title="å¤šçº¿ç¨‹ï¼š"></a>å¤šçº¿ç¨‹ï¼š</h3><p>äº‹å®ä¸Šï¼ŒåŒä¸€æ—¶é—´å†…å•æ ¸CPUåªèƒ½æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œå¤šçº¿ç¨‹æ˜¯CPUå¿«é€Ÿçš„åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´è¿›è¡Œåˆ‡æ¢(è°ƒåº¦)ï¼Œé€ æˆäº†å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œçš„å‡è±¡ã€‚å¦‚æœæ˜¯å¤šæ ¸CPUå°±å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªçº¿ç¨‹äº†ã€‚å¤šçº¿ç¨‹æ˜¯ä¸ºäº†åŒæ­¥å®Œæˆå¤šé¡¹ä»»åŠ¡ï¼Œæé«˜ç³»ç»Ÿçš„èµ„æºåˆ©ç”¨ç‡æ¥æé«˜ç³»ç»Ÿæ•ˆç‡ã€‚</p><p>ä½†æ˜¯å¤šçº¿ç¨‹ä¹Ÿä¼šé€ æˆå„ç§é—®é¢˜ï¼Œæ¯”å¦‚å¤šä¸ªçº¿ç¨‹æ›´æ–°ç›¸åŒçš„èµ„æºä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´(æ•°æ®ç«äº‰)ï¼Œåœæ­¢ç­‰å¾…äº‹ä»¶çš„çº¿ç¨‹ä¼šå¯¼è‡´å¤šä¸ªçº¿ç¨‹ç›¸äº’æŒç»­ç­‰å¾…(æ­»é”)ã€ä½¿ç”¨å¤ªå¤šçº¿ç¨‹ä¼šæ¶ˆè€—å¤§é‡å†…å­˜ç­‰ã€‚</p><h3 id="å¤šçº¿ç¨‹ä¼˜ç¼ºç‚¹ï¼š"><a href="#å¤šçº¿ç¨‹ä¼˜ç¼ºç‚¹ï¼š" class="headerlink" title="å¤šçº¿ç¨‹ä¼˜ç¼ºç‚¹ï¼š"></a>å¤šçº¿ç¨‹ä¼˜ç¼ºç‚¹ï¼š</h3><p>å¤šçº¿ç¨‹å¯ä»¥æé«˜ç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„æ•ˆç‡ã€‚</p><p>ç¼ºç‚¹æ˜¯å¼€å¯å¤šçº¿ç¨‹è¦èŠ±è´¹æ—¶é—´å’Œç©ºé—´ï¼Œå¼€å¯è¿‡å¤šçš„çº¿ç¨‹åè€Œä¼šé™ä½æ€§èƒ½ï¼Œcpué¢‘ç¹åœ°åœ¨å¤šä¸ªçº¿ç¨‹ä¸­è°ƒåº¦ä¼šæ¶ˆè€—å¤§é‡çš„CPUèµ„æºï¼ŒæŠŠCPUç´¯æ­»ã€‚</p><h3 id="å¤šçº¿ç¨‹ä½¿ç”¨åœºæ™¯ï¼š"><a href="#å¤šçº¿ç¨‹ä½¿ç”¨åœºæ™¯ï¼š" class="headerlink" title="å¤šçº¿ç¨‹ä½¿ç”¨åœºæ™¯ï¼š"></a>å¤šçº¿ç¨‹ä½¿ç”¨åœºæ™¯ï¼š</h3><p>å®é™…å¼€å‘ä¸­å°†ä¸€äº›è€—æ—¶çš„æ“ä½œæ”¾åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œiosä¸­é»˜è®¤æœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œç”¨æ¥å“åº”ç”¨æˆ·çš„æ‰‹åŠ¿å’Œåˆ·æ–°UIï¼Œå¦‚æœåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œè€—æ—¶æ“ä½œä¼šæŠŠé¡µé¢å¡æ­»ï¼Œç›´åˆ°æ‰§è¡Œå®Œäº†è¿™ä¸ªæ“ä½œæ‰èƒ½æ“ä½œç•Œé¢ã€‚ä¸€å®šè¦åœ¨ä¸»çº¿ç¨‹åˆ·æ–°UIçš„åŸå› ï¼šiOSä¸ºäº†ä¿è¯æ•ˆç‡ï¼Œå¤šçº¿ç¨‹æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œåœ¨å­çº¿ç¨‹åˆ·æ–°UIå¯èƒ½å¯¼è‡´æœªçŸ¥é”™è¯¯ã€‚</p><h3 id="iOSä¸­å¤šçº¿ç¨‹çš„æ–¹æ¡ˆï¼Œå„è‡ªç‰¹ç‚¹ï¼š"><a href="#iOSä¸­å¤šçº¿ç¨‹çš„æ–¹æ¡ˆï¼Œå„è‡ªç‰¹ç‚¹ï¼š" class="headerlink" title="iOSä¸­å¤šçº¿ç¨‹çš„æ–¹æ¡ˆï¼Œå„è‡ªç‰¹ç‚¹ï¼š"></a>iOSä¸­å¤šçº¿ç¨‹çš„æ–¹æ¡ˆï¼Œå„è‡ªç‰¹ç‚¹ï¼š</h3><p>Pthreadæ˜¯ç”¨cè¯­è¨€å®ç°çš„ï¼Œåº•å±‚çš„å¤šçº¿ç¨‹å®ç°æ–¹æ¡ˆï¼Œéœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ(æ‰‹åŠ¨åˆ›å»ºå’Œé”€æ¯)ã€‚</p><p><strong>NSThread</strong> é¢å‘å¯¹è±¡ï¼Œéœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹ï¼Œä½†ä¸éœ€è¦æ‰‹åŠ¨é”€æ¯ã€‚å­çº¿ç¨‹é—´é€šä¿¡å¾ˆéš¾ã€‚</p><p>Cocoaæ¡†æ¶æä¾›äº†NSObjectç±»çš„<strong>performSelectorInBackground</strong>:withObject å®ä¾‹æ–¹æ³•å’Œ <strong>performSelectorOnMainThread</strong> å®ä¾‹æ–¹æ³•ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>) launchThreadByNSObject_performSelectorInBackground_withObject</span><br><span class="line">&#123;</span><br><span class="line">    [self performSelectorInBackground:@selector(doWork) withObject:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)doWork</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">    <span class="comment">// åšä¸€äº›è€—æ—¶æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ï¼Œæ•°æ®åº“è®¿é—®ç­‰ã€‚</span></span><br><span class="line">    [self performSelectorOnMainThread:@selector(doneWork) withObject:nil waitUntilDone:NO];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)doneWork</span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">// åˆ·æ–°ä¸»ç•Œé¢</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>GCD</strong>æ˜¯å¼‚æ­¥æ‰§è¡Œä»»åŠ¡çš„æŠ€æœ¯ä¹‹ä¸€ã€‚ä¸€èˆ¬å°†ç¨‹åºä¸­è®°è¿°çš„çº¿ç¨‹ç®¡ç†ç”¨çš„ä»£ç åœ¨ç³»ç»Ÿçº§ä¸­å®ç°ã€‚å¼€å‘è€…åªéœ€è¦å®šä¹‰æƒ³æ‰§è¡Œçš„ä»»åŠ¡å¹¶è¿½åŠ åˆ°é€‚å½“çš„Dispatch Queueä¸­ï¼ŒGCDå°±èƒ½ç”Ÿæˆå¿…è¦çš„çº¿ç¨‹å¹¶è®¡åˆ’æ‰§è¡Œä»»åŠ¡ã€‚ç”±äºçº¿ç¨‹ç®¡ç†æ˜¯ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†æ¥å®ç°çš„ï¼Œå› æ­¤å¯åŒæ„ç®¡ç†ï¼Œä¹Ÿå¯æ‰§è¡Œä»»åŠ¡ï¼Œè¿™æ ·å°±æ¯”ä»¥å‰çš„çº¿ç¨‹æ›´æœ‰æ•ˆç‡ã€‚</p><p>ä½¿ç”¨GCDå®ç°ä¸Šè¿°åŠŸèƒ½æ›´ä¸ºç®€æ´ã€‚å……åˆ†åˆ©ç”¨äº†è®¾å¤‡çš„å¤šæ ¸ï¼Œè‡ªåŠ¨ç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼Œæ›´ä¸ºé«˜æ•ˆã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    é•¿æ—¶é—´å¤„ç†ï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ï¼Œæ•°æ®åº“è®¿é—®ç­‰ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="comment">/*ç•Œé¢åˆ·æ–°ç­‰åªåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„å¤„ç†*/</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="GCDçš„API"><a href="#GCDçš„API" class="headerlink" title="GCDçš„API"></a>GCDçš„API</h3><h4 id="Dispatch-Queue"><a href="#Dispatch-Queue" class="headerlink" title="Dispatch Queue"></a>Dispatch Queue</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * æƒ³è¦æ‰§è¡Œçš„ä»»åŠ¡</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Dispatch Queue å°±æ˜¯æ‰§è¡Œå¤„ç†çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œç¨‹åºå‘˜åœ¨Blockè¯­æ³•å†…è®°è¿°æƒ³æ‰§è¡Œçš„å¤„ç†å¹¶å°†å…¶è¿½åŠ åˆ°Dispatch Queueä¸­ã€‚Dispatch Queue æŒ‰ç…§è¿½åŠ çš„é¡ºåº(å…ˆè¿›å…ˆå‡ºFIFO) æ‰§è¡Œå¤„ç†ã€‚</p><p>å¦å¤–åœ¨æ‰§è¡Œå¤„ç†æ—¶å­˜åœ¨ä¸¤ç§Dispatch Queueï¼Œä¸€ç§æ˜¯ç­‰å¾…ç°åœ¨æ‰§è¡Œä¸­å¤„ç†çš„ Serial Dispatch Queueï¼Œå®ƒåªä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼›å¦ä¸€ç§æ˜¯ä¸ç­‰å¾…ç°åœ¨æ‰§è¡Œä¸­å¤„ç†çš„ Concurrent Dispatch Queueï¼Œå®ƒä½¿ç”¨å¤šä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œå¤šä¸ªè¿½åŠ å¤„ç†ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸¤ç§é˜Ÿåˆ—çš„æµ‹è¯•ç»“æœï¼š</p><ul><li><strong>Serial</strong>ï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_queue_create(<span class="string">"hahaha"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"1"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"2"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"3"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"4"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"5"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"6"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"7"</span>);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">20</span>:<span class="number">31</span>:<span class="number">53.990446</span>+<span class="number">0800</span> Test[<span class="number">6938</span>:<span class="number">245001</span>] <span class="number">1</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">20</span>:<span class="number">31</span>:<span class="number">53.990629</span>+<span class="number">0800</span> Test[<span class="number">6938</span>:<span class="number">245001</span>] <span class="number">2</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">20</span>:<span class="number">31</span>:<span class="number">53.990718</span>+<span class="number">0800</span> Test[<span class="number">6938</span>:<span class="number">245001</span>] <span class="number">3</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">20</span>:<span class="number">31</span>:<span class="number">53.990780</span>+<span class="number">0800</span> Test[<span class="number">6938</span>:<span class="number">245001</span>] <span class="number">4</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">20</span>:<span class="number">31</span>:<span class="number">53.990856</span>+<span class="number">0800</span> Test[<span class="number">6938</span>:<span class="number">245001</span>] <span class="number">5</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">20</span>:<span class="number">31</span>:<span class="number">53.990936</span>+<span class="number">0800</span> Test[<span class="number">6938</span>:<span class="number">245001</span>] <span class="number">6</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">20</span>:<span class="number">31</span>:<span class="number">53.991013</span>+<span class="number">0800</span> Test[<span class="number">6938</span>:<span class="number">245001</span>] <span class="number">7</span></span><br></pre></td></tr></table></figure><ul><li><strong>Concurrent</strong>ï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_queue_create(<span class="string">"hahaha"</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"1"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"2"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"3"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"4"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"5"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"6"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"7"</span>);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">20</span>:<span class="number">30</span>:<span class="number">34.914632</span>+<span class="number">0800</span> Test[<span class="number">6904</span>:<span class="number">243733</span>] <span class="number">3</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">20</span>:<span class="number">30</span>:<span class="number">34.914632</span>+<span class="number">0800</span> Test[<span class="number">6904</span>:<span class="number">243732</span>] <span class="number">1</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">20</span>:<span class="number">30</span>:<span class="number">34.914633</span>+<span class="number">0800</span> Test[<span class="number">6904</span>:<span class="number">243702</span>] <span class="number">2</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">20</span>:<span class="number">30</span>:<span class="number">34.914649</span>+<span class="number">0800</span> Test[<span class="number">6904</span>:<span class="number">243734</span>] <span class="number">4</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">20</span>:<span class="number">30</span>:<span class="number">34.914686</span>+<span class="number">0800</span> Test[<span class="number">6904</span>:<span class="number">243738</span>] <span class="number">5</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">20</span>:<span class="number">30</span>:<span class="number">34.914722</span>+<span class="number">0800</span> Test[<span class="number">6904</span>:<span class="number">243739</span>] <span class="number">6</span></span><br></pre></td></tr></table></figure><h4 id><a href="#" class="headerlink" title=" "></a> </h4><h4 id="ç³»ç»Ÿæ ‡å‡†æä¾›çš„Dispatch-Queue"><a href="#ç³»ç»Ÿæ ‡å‡†æä¾›çš„Dispatch-Queue" class="headerlink" title="ç³»ç»Ÿæ ‡å‡†æä¾›çš„Dispatch Queue"></a>ç³»ç»Ÿæ ‡å‡†æä¾›çš„Dispatch Queue</h4><p>åˆ†åˆ«æ˜¯<code>Main Dispatch Queue</code> å’Œ <code>Global Dispatch Queue</code></p><p><code>Main Dispatch Queue</code> æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œçš„Dispatch Queueï¼Œä¸»çº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥å®ƒè‡ªç„¶ä¹Ÿæ˜¯Serial Dispatch Queueã€‚</p><p>å¦ä¸€ä¸ªæ˜¯<code>Global Dispatch Queue</code>ï¼Œå®ƒæ˜¯æ‰€æœ‰åº”ç”¨ç¨‹åºéƒ½èƒ½ä½¿ç”¨çš„Concurrent Dispatch Queueã€‚</p><p><code>Global Dispatch Queue</code>æœ‰å››ä¸ªæ‰§è¡Œä¼˜å…ˆçº§ï¼Œåˆ†åˆ«æ˜¯é«˜ä¼˜å…ˆçº§(High Priority)ã€é»˜è®¤ä¼˜å…ˆçº§(Default Priority)ã€ä½ä¼˜å…ˆçº§(Low Priority)å’Œåå°ä¼˜å…ˆçº§(Background Priority)ã€‚</p><h4 id="dispatch-set-target-queue"><a href="#dispatch-set-target-queue" class="headerlink" title="dispatch_set_target_queue"></a>dispatch_set_target_queue</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_queue_create(<span class="string">"Test"</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">dispatch_queue_t</span> globalQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, <span class="number">0</span>);</span><br><span class="line">    dispatch_set_target_queue(<span class="built_in">queue</span>, globalQueue);</span><br></pre></td></tr></table></figure><p><code>dispatch_set_target_queue</code> å¯ä»¥å˜æ›´å¤„ç†çš„ä¼˜å…ˆçº§ã€‚ä¸ä»…å¦‚æ­¤ï¼Œè¿˜å¯ä»¥ä½œæˆDispatch Queue çš„æ‰§è¡Œé˜¶å±‚ã€‚å¦‚æœåœ¨å¤šä¸ª Serial Dispatch Queue ä¸­ç”¨dispatch_set_target_queue å‡½æ•°æŒ‡å®šç›®æ ‡ä¸ºæŸä¸€ä¸ª Serial Dispatch Queueï¼Œé‚£ä¹ˆåŸæœ¬åº”å¹¶è¡Œæ‰§è¡Œçš„å¤šä¸ªSerial Dispatch Queueï¼Œåœ¨ç›®æ ‡Serial Dispatch Queueä¸Šåªèƒ½åŒæ—¶æ‰§è¡Œä¸€ä¸ªå¤„ç†ã€‚</p><p>åœ¨å¿…é¡»å°†ä¸å¯å¹¶è¡Œæ‰§è¡Œçš„å¤„ç†è¿½åŠ åˆ°å¤šä¸ª Serial Dispatch Queue ä¸­æ—¶ï¼Œå¦‚æœä½¿ç”¨dispatch_set_target_queue å‡½æ•°å°†ç›®æ ‡æŒ‡å®šä¸ºæŸä¸€ä¸ª Serial Dispatch Queueï¼Œå³å¯é˜²æ­¢å¤„ç†å¹¶è¡Œæ‰§è¡Œã€‚</p><h4 id="dispatch-after"><a href="#dispatch-after" class="headerlink" title="dispatch_after"></a>dispatch_after</h4><p>æƒ³åœ¨å‡ ç§’åæ‰§è¡Œæ“ä½œï¼Œå¯é€šè¿‡dispatch_after å‡½æ•°æ¥å®ç°ã€‚</p><p>åœ¨3ç§’åå°†æŒ‡å®šçš„ Block è¿½åŠ åˆ° <code>Main Dispatch Queue</code>ä¸­æºç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_time_t</span> time = dispatch_time(DISPATCH_TIME_NOW, <span class="number">3u</span>ll * NSEC_PER_SEC);</span><br><span class="line"></span><br><span class="line">dispatch_after(time, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    NSLog(@<span class="string">"Wait at least three seconds."</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>PS</strong>: dispatch_afterå‡½æ•°å¹¶ä¸æ˜¯åœ¨æŒ‡å®šçš„æ—¶é—´åæ‰§è¡Œå¤„ç†ï¼Œè€Œæ˜¯åœ¨æŒ‡å®šæ—¶é—´è¿½åŠ å¤„ç†åˆ°Dispatch Queueã€‚</p><h4 id="Dispatch-Group"><a href="#Dispatch-Group" class="headerlink" title="Dispatch Group"></a>Dispatch Group</h4><p>åœ¨è¿½åŠ åˆ° <code>Dispatch Queue</code> ä¸­çš„å¤šä¸ªå¤„ç†å…¨éƒ¨ç»“æŸåæƒ³æ‰§è¡Œç»“æŸå¤„ç†ï¼Œè¿™ç§æƒ…å†µä¼šç»å¸¸å‡ºç°ã€‚</p><p>åªä½¿ç”¨ä¸€ä¸ªSerial Dispatch Queue æ—¶ï¼Œåªè¦å°†æƒ³æ‰§è¡Œçš„å¤„ç†å…¨éƒ¨è¿½åŠ åˆ°è¯¥Serial Dispatch Queue ä¸­å¹¶åœ¨æœ€åè¿½åŠ ç»“æŸå¤„ç†ï¼Œå³å¯å®ç°ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨Concurrent Dispatch Queueæ—¶æˆ–åŒæ—¶ä½¿ç”¨å¤šä¸ªDispatch Queueæ—¶ï¼Œæºä»£ç å°±ä¼šå˜å¾—å¤æ‚ã€‚</p><p>è¿™æ˜¯å¯ä»¥ä½¿ç”¨Dispatch Groupã€‚å¦‚ä¸‹æ‰€ç¤ºï¼šè¿½åŠ 3ä¸ªBlockåˆ°Global Dispatch Queueï¼Œè¿™äº›Blockå¦‚æœå…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œå°±ä¼šæ‰§è¡ŒMain Dispatch Queue ä¸­ç»“æŸå¤„ç†ç”¨çš„Blockã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">dispatch_group_t</span> group = dispatch_group_create();</span><br><span class="line"></span><br><span class="line">dispatch_group_async(group, <span class="built_in">queue</span>, ^&#123;</span><br><span class="line">    NSLog(@<span class="string">"1"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_async(group, <span class="built_in">queue</span>, ^&#123;</span><br><span class="line">    NSLog(@<span class="string">"2"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_async(group, <span class="built_in">queue</span>, ^&#123;</span><br><span class="line">    NSLog(@<span class="string">"3"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    self.Label.text = @<span class="string">"å®Œæˆ"</span>;</span><br><span class="line">    NSLog(@<span class="string">"hahaha"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>è¿è¡Œç»“æœï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">21</span>:<span class="number">28</span>:<span class="number">10.728780</span>+<span class="number">0800</span> Test[<span class="number">7538</span>:<span class="number">275043</span>] <span class="number">3</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">21</span>:<span class="number">28</span>:<span class="number">10.728780</span>+<span class="number">0800</span> Test[<span class="number">7538</span>:<span class="number">275044</span>] <span class="number">1</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">21</span>:<span class="number">28</span>:<span class="number">10.728780</span>+<span class="number">0800</span> Test[<span class="number">7538</span>:<span class="number">275041</span>] <span class="number">2</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">21</span>:<span class="number">28</span>:<span class="number">10.738775</span>+<span class="number">0800</span> Test[<span class="number">7538</span>:<span class="number">274962</span>] hahaha</span><br></pre></td></tr></table></figure><h4 id="dispatch-barrier-async"><a href="#dispatch-barrier-async" class="headerlink" title="dispatch_barrier_async"></a>dispatch_barrier_async</h4><p>è®¿é—®æ•°æ®åº“æˆ–æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨Serial Dispatch Queue å¯é¿å…æ•°æ®ç«äº‰é—®é¢˜ã€‚</p><p>å†™å…¥å¤„ç†ç¡®å®ä¸å¯ä¸å…¶ä»–çš„å†™å…¥å¤„ç†ä»¥åŠåŒ…å«è¯»å–å¤„ç†çš„å…¶ä»–æŸäº›å¤„ç†å¹¶è¡Œæ‰§è¡Œã€‚ä½†æ˜¯å¦‚æœè¯»å–å¤„ç†åªæ˜¯ä¸è¯»å–å¤„ç†å¹¶è¡Œæ‰§è¡Œï¼Œé‚£ä¹ˆå¤šä¸ªå¹¶è¡Œæ‰§è¡Œå°±ä¸ä¼šå‘ç”Ÿé—®é¢˜ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ºäº†é«˜æ•ˆç‡åœ°è¿›è¡Œè®¿é—®ï¼Œè¯»å–å¤„ç†è¿½åŠ åˆ° Concurrent Dispatch Queue ä¸­ï¼Œå†™å…¥å¤„ç†åœ¨ä»»ä¸€ä¸ªè¯»å–å¤„ç†æ²¡æœ‰æ‰§è¡Œçš„çŠ¶æ€ä¸‹ï¼Œè¿½åŠ åˆ° Serial Dispatch Queue ä¸­å³å¯ (åœ¨å†™å…¥å¤„ç†ç»“æŸä¹‹å‰ï¼Œè¯»å–å¤„ç†ä¸å¯æ‰§è¡Œ)ã€‚</p><p>åˆ©ç”¨Dispatch Group å’Œ dispatch_set_target_queue å‡½æ•°å¯å®ç°ï¼Œä½†æ˜¯æºä»£ç ä¼šå¾ˆå¤æ‚ã€‚</p><p>æˆ‘ä»¬å¯ä½¿ç”¨ dispatch_barrier_async å‡½æ•°åŒ dispatch_queue_create å‡½æ•°ç”Ÿæˆçš„ Concurrent Dispatch Queue ä¸€èµ·ä½¿ç”¨ã€‚</p><p>æ¯”å¦‚è¯´å¦‚ä¸‹ä»£ç å¯ç­‰å¾…123readå¹¶è¡Œæ‰§è¡Œå®Œä¹‹åï¼Œå†æ‰§è¡Œwriteæ“ä½œï¼Œç„¶åæ­¤æ—¶åªæ‰§è¡Œå”¯ä¸€çš„writeæ“ä½œï¼Œç­‰writeæ“ä½œæ‰§è¡Œå®Œåï¼Œå†æ‰§è¡Œ4567readæ“ä½œã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_queue_create(<span class="string">"Test"</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">    NSLog(@<span class="string">"1read %@"</span>, [NSThread currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">    NSLog(@<span class="string">"2read %@"</span>, [NSThread currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">    NSLog(@<span class="string">"3read %@"</span>, [NSThread currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_barrier_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">    NSLog(@<span class="string">"write %@"</span>, [NSThread currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">   NSLog(@<span class="string">"4read %@"</span>, [NSThread currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">    NSLog(@<span class="string">"5read %@"</span>, [NSThread currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">    NSLog(@<span class="string">"6read %@"</span>, [NSThread currentThread]);</span><br><span class="line">&#125;);</span><br><span class="line">dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">    NSLog(@<span class="string">"7read %@"</span>, [NSThread currentThread]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>æ‰§è¡Œç»“æœï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">21</span>:<span class="number">54</span>:<span class="number">05.186307</span>+<span class="number">0800</span> Test[<span class="number">7809</span>:<span class="number">288931</span>] <span class="number">1</span>read &lt;NSThread: <span class="number">0x600002378180</span>&gt;</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">21</span>:<span class="number">54</span>:<span class="number">05.186309</span>+<span class="number">0800</span> Test[<span class="number">7809</span>:<span class="number">288934</span>] <span class="number">2</span>read &lt;NSThread: <span class="number">0x600002378140</span>&gt;</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">21</span>:<span class="number">54</span>:<span class="number">05.186320</span>+<span class="number">0800</span> Test[<span class="number">7809</span>:<span class="number">288935</span>] <span class="number">3</span>read &lt;NSThread: <span class="number">0x600002374900</span>&gt;</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">21</span>:<span class="number">54</span>:<span class="number">05.186454</span>+<span class="number">0800</span> Test[<span class="number">7809</span>:<span class="number">288935</span>] write &lt;NSThread: <span class="number">0x600002374900</span>&gt;</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">21</span>:<span class="number">54</span>:<span class="number">05.186538</span>+<span class="number">0800</span> Test[<span class="number">7809</span>:<span class="number">288935</span>] <span class="number">4</span>read &lt;NSThread: <span class="number">0x600002374900</span>&gt;</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">21</span>:<span class="number">54</span>:<span class="number">05.186551</span>+<span class="number">0800</span> Test[<span class="number">7809</span>:<span class="number">288934</span>] <span class="number">5</span>read &lt;NSThread: <span class="number">0x600002378140</span>&gt;</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">21</span>:<span class="number">54</span>:<span class="number">05.186553</span>+<span class="number">0800</span> Test[<span class="number">7809</span>:<span class="number">288931</span>] <span class="number">6</span>read &lt;NSThread: <span class="number">0x600002378180</span>&gt;</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">21</span>:<span class="number">54</span>:<span class="number">05.186569</span>+<span class="number">0800</span> Test[<span class="number">7809</span>:<span class="number">288933</span>] <span class="number">7</span>read &lt;NSThread: <span class="number">0x600002374940</span>&gt;</span><br></pre></td></tr></table></figure><h4 id="dispatch-sync"><a href="#dispatch-sync" class="headerlink" title="dispatch_sync"></a>dispatch_sync</h4><p>æ„å‘³ç€åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯å°†æŒ‡å®šçš„BlockåŒæ­¥è¿½åŠ åˆ° Dispatch Queue ä¸­ã€‚åœ¨è¿½åŠ çš„ Block ç»“æŸä¹‹å‰ï¼Œdispatch_sync å‡½æ•°ä¼šä¸€ç›´ç­‰å¾…ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line">dispatch_sync(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * æ‰§è¡Œå¤„ç†</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸€æ—¦è°ƒç”¨ dispatch_sync å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨æŒ‡å®šçš„å¤„ç†æ‰§è¡Œç»“æŸä¹‹å‰ï¼Œè¯¥å‡½æ•°ä¸ä¼šè¿”å›ã€‚dispatch_sync å‡½æ•°å¯ç®€åŒ–ä¸ºæºä»£ç ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ç®€åŒ–ç‰ˆçš„dispatch_group_waitå‡½æ•°ã€‚</p><p>ä½† dispatch_sync å‡½æ•°ä¹Ÿå¾ˆå®¹æ˜“å¼•èµ·æ­»é”ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_get_main_queue();</span><br><span class="line">dispatch_sync(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">    NSLog(@<span class="string">"hahaha"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡ŒæŒ‡å®šçš„Blockå¹¶ç­‰å¾…å…¶æ‰§è¡Œç»“æŸã€‚è€Œå…¶å®åœ¨ä¸»çº¿ç¨‹ä¸­æ­£åœ¨æ‰§è¡Œè¿™äº›æºä»£ç ï¼Œæ‰€ä»¥æ— æ³•è¿½åŠ åˆ°ä¸»çº¿ç¨‹ä¸­åŒæ­¥æ‰§è¡ŒBlockã€‚ä¹Ÿå°±æ˜¯è¯´å‡è®¾ä¸»çº¿ç¨‹æ˜¯TaskAï¼ŒåŠ å…¥çš„çº¿ç¨‹æ˜¯TaskBï¼Œå› ä¸ºæ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥TaskAæ²¡æœ‰æ‰§è¡Œå®Œçš„è¯ï¼ŒTaskBä¸ä¼šæ‰§è¡Œï¼Œè€ŒTaskAæ‰§è¡Œå®Œå¿…ç„¶æ„å‘³ç€TaskBä¹Ÿè¦æ‰§è¡Œå®Œæˆã€‚æ‰€ä»¥å‘ç”Ÿäº†æ­»é”ã€‚</p><p>åŒæ ·åœ¨Serial Dispatch Queue ä¸­ä¹Ÿä¼šå¼•èµ·ç›¸åŒçš„é—®é¢˜</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_queue_create(<span class="string">"hahaha"</span>, <span class="literal">NULL</span>);</span><br><span class="line">dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">    dispatch_sync(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"haha"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="dispatch-apply"><a href="#dispatch-apply" class="headerlink" title="dispatch_apply"></a>dispatch_apply</h4><p>dispatch_apply æ˜¯ dispatch_sync å‡½æ•°å’Œ Dispatch Group çš„å…³è” APIã€‚è¯¥å‡½æ•°æŒ‰æŒ‡å®šçš„æ¬¡æ•°å°†æŒ‡å®šçš„Block è¿½åŠ åˆ°æŒ‡å®šçš„ Dispatch Queue ä¸­ï¼Œå¹¶ç­‰å¾…å…¨éƒ¨å¤„ç†æ‰§è¡Œç»“æŸã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line">dispatch_apply(<span class="number">5</span>, <span class="built_in">queue</span>, ^(<span class="keyword">size_t</span> index) &#123;</span><br><span class="line">    NSLog(@<span class="string">"%zu"</span>, index);</span><br><span class="line">&#125;);</span><br><span class="line">NSLog(@<span class="string">"done"</span>);</span><br></pre></td></tr></table></figure><p><strong>ç»“æœå¦‚ä¸‹ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">23</span>:<span class="number">31</span>:<span class="number">20.492494</span>+<span class="number">0800</span> Test[<span class="number">8500</span>:<span class="number">325942</span>] <span class="number">0</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">23</span>:<span class="number">31</span>:<span class="number">20.492496</span>+<span class="number">0800</span> Test[<span class="number">8500</span>:<span class="number">326017</span>] <span class="number">2</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">23</span>:<span class="number">31</span>:<span class="number">20.492494</span>+<span class="number">0800</span> Test[<span class="number">8500</span>:<span class="number">326018</span>] <span class="number">1</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">23</span>:<span class="number">31</span>:<span class="number">20.492495</span>+<span class="number">0800</span> Test[<span class="number">8500</span>:<span class="number">326019</span>] <span class="number">4</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">23</span>:<span class="number">31</span>:<span class="number">20.492499</span>+<span class="number">0800</span> Test[<span class="number">8500</span>:<span class="number">326023</span>] <span class="number">3</span></span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">23</span>:<span class="number">31</span>:<span class="number">20.492637</span>+<span class="number">0800</span> Test[<span class="number">8500</span>:<span class="number">325942</span>] done</span><br></pre></td></tr></table></figure><p>å› ä¸ºåœ¨Global Dispatch Queue ä¸­æ‰§è¡Œå¤„ç†ï¼Œæ‰€ä»¥å„ä¸ªå¤„ç†çš„æ‰§è¡Œæ—¶é—´ä¸å®šã€‚ä½†æ˜¯è¾“å‡ºç»“æœä¸­çš„doneå¿…å®šåœ¨æœ€åçš„ä½ç½®ä¸Šã€‚è¿™æ˜¯å› ä¸ºdispatch_apply å‡½æ•°ä¼šç­‰å¾…å…¨éƒ¨å¤„ç†æ‰§è¡Œç»“æŸã€‚</p><h4 id="dispatch-suspend-dispatch-resume"><a href="#dispatch-suspend-dispatch-resume" class="headerlink" title="dispatch_suspend / dispatch_resume"></a>dispatch_suspend / dispatch_resume</h4><p>å½“è¿½åŠ å¤§é‡å¤„ç†åˆ° Dispatch Queue æ—¶ï¼Œåœ¨è¿½åŠ å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶å¸Œæœ›ä¸æ‰§è¡Œå·²è¿½åŠ çš„å¤„ç†ã€‚ä¾‹å¦‚æ¼”ç®—ç»“æœè¢«Blockæˆªè·æ—¶ï¼Œä¸€äº›å¤„ç†ä¼šå¯¹è¿™ä¸ªæ¼”ç®—ç»“æœé€ æˆå½±å“ã€‚</p><p>è¿™ç§æƒ…å†µä¸‹ï¼Œåªè¦æŒ‚èµ·æŒ‡å®šçš„ Dispatch Queueã€‚å½“å¯ä»¥æ‰§è¡Œæ—¶å†æ¢å¤ã€‚</p><p>dispatch_suspend æŒ‚èµ·å’Œ dispatch_resume æ¢å¤ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_queue_create(<span class="string">"com.test.gcd"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"><span class="comment">//æäº¤ç¬¬ä¸€ä¸ªblockï¼Œå»¶æ—¶5ç§’æ‰“å°ã€‚</span></span><br><span class="line">dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">    sleep(<span class="number">5</span>);</span><br><span class="line">    NSLog(@<span class="string">"After 5 seconds..."</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//æäº¤ç¬¬äºŒä¸ªblockï¼Œä¹Ÿæ˜¯å»¶æ—¶5ç§’æ‰“å°</span></span><br><span class="line">dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">    sleep(<span class="number">5</span>);</span><br><span class="line">    NSLog(@<span class="string">"After 5 seconds again..."</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//å»¶æ—¶ä¸€ç§’</span></span><br><span class="line">NSLog(@<span class="string">"sleep 1 second..."</span>);</span><br><span class="line">sleep(<span class="number">1</span>);</span><br><span class="line"><span class="comment">//æŒ‚èµ·é˜Ÿåˆ—</span></span><br><span class="line">NSLog(@<span class="string">"suspend..."</span>);</span><br><span class="line">dispatch_suspend(<span class="built_in">queue</span>);</span><br><span class="line"><span class="comment">//å»¶æ—¶10ç§’</span></span><br><span class="line">NSLog(@<span class="string">"sleep 10 second..."</span>);</span><br><span class="line">sleep(<span class="number">10</span>);</span><br><span class="line"><span class="comment">//æ¢å¤é˜Ÿåˆ—</span></span><br><span class="line">NSLog(@<span class="string">"resume..."</span>);</span><br><span class="line">dispatch_resume(<span class="built_in">queue</span>);</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">23</span>:<span class="number">44</span>:<span class="number">01.254454</span>+<span class="number">0800</span> Test[<span class="number">8617</span>:<span class="number">332248</span>] sleep <span class="number">1</span> second...</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">23</span>:<span class="number">44</span>:<span class="number">02.255484</span>+<span class="number">0800</span> Test[<span class="number">8617</span>:<span class="number">332248</span>] suspend...</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">23</span>:<span class="number">44</span>:<span class="number">02.255662</span>+<span class="number">0800</span> Test[<span class="number">8617</span>:<span class="number">332248</span>] sleep <span class="number">10</span> second...</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">23</span>:<span class="number">44</span>:<span class="number">06.257416</span>+<span class="number">0800</span> Test[<span class="number">8617</span>:<span class="number">332298</span>] After <span class="number">5</span> seconds...</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">23</span>:<span class="number">44</span>:<span class="number">12.256036</span>+<span class="number">0800</span> Test[<span class="number">8617</span>:<span class="number">332248</span>] resume...</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-03</span> <span class="number">23</span>:<span class="number">44</span>:<span class="number">17.257411</span>+<span class="number">0800</span> Test[<span class="number">8617</span>:<span class="number">332297</span>] After <span class="number">5</span> seconds again...</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºdispatch_suspendå¹¶ä¸ä¼šç«‹å³æš‚åœæ­£åœ¨è¿è¡Œçš„blockï¼Œè€Œæ˜¯åœ¨å½“å‰blockæ‰§è¡Œå®Œæˆåï¼Œæš‚åœåç»­çš„blockæ‰§è¡Œã€‚</p><h4 id="Dispatch-Semaphore"><a href="#Dispatch-Semaphore" class="headerlink" title="Dispatch Semaphore"></a>Dispatch Semaphore</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">dispatch_semaphore_t</span> semaphore = dispatch_semaphore_create(<span class="number">1</span>);</span><br><span class="line">NSMutableArray *<span class="built_in">array</span> = [[NSMutableArray alloc] init];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">    dispatch_async(<span class="built_in">queue</span>, ^&#123;</span><br><span class="line">        dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class="line">        <span class="comment">// æ‰§è¡Œåˆ°æ­¤å¤„semaphoreçš„å€¼æ’ä¸º0</span></span><br><span class="line">        [<span class="built_in">array</span> addObject: [NSNumber numberWithInt:i]];</span><br><span class="line">    <span class="comment">// æ’ä»–æ§åˆ¶ç»“æŸ</span></span><br><span class="line">        <span class="comment">// é€šè¿‡dispatch_semaphore_signal å‡½æ•°å°†semaphoreè®¡æ•°å€¼åŠ 1</span></span><br><span class="line">        <span class="comment">// ç”±æœ€å…ˆé€šè¿‡waitå‡½æ•°ç­‰å¾…semaphoreè®¡æ•°å€¼åŠ ä¸€çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚</span></span><br><span class="line">        dispatch_semaphore_signal(semaphore);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">NSLog(@<span class="string">"å®Œæˆ"</span>);</span><br></pre></td></tr></table></figure><p>Â·<code>dispatch_semaphore_wait</code>å‡½æ•°ä¼šä¸€ç›´ç­‰å¾…ç›´åˆ°semaphoreä¿¡å·é‡å€¼å˜ä¸º1ï¼Œç”±äºsemaphoreçš„è®¡æ•°å€¼å¤§äºç­‰äº1ï¼Œæ‰€ä»¥å¯ä»¥å°†å…¶è®¡æ•°å€¼å‡å»1ï¼Œwaitå‡½æ•°æ‰§è¡Œè¿”å›ã€‚æ‰€ä»¥æ‰æœ‰ä¸Šé¢æ³¨é‡Šçš„æ’ä¸º0çš„æ„æ€ã€‚</p><h4 id="dispatch-once"><a href="#dispatch-once" class="headerlink" title="dispatch_once"></a>dispatch_once</h4><p>ä¿è¯åœ¨åº”ç”¨ç¨‹åºä¸­åªæ‰§è¡Œä¸€æ¬¡æŒ‡å®šå¤„ç†çš„APIã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">dispatch_once_t</span> pred;</span><br><span class="line">dispatch_once (&amp;pred, ^&#123;</span><br><span class="line">   <span class="comment">/* </span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„å•ä¾‹æ¨¡å¼ã€‚</p><h4 id="Dispatch-I-O"><a href="#Dispatch-I-O" class="headerlink" title="Dispatch I/O"></a>Dispatch I/O</h4><p>è¯»å–å¤§æ–‡ä»¶æ—¶ï¼Œå¦‚æœå°†æ–‡ä»¶åˆ†æˆåˆé€‚å¤§å°å¹¶ä½¿ç”¨ Global Dispatch Queue å¹¶åˆ—è¯»å–çš„è¯ï¼Œä¼šå¢åŠ è¯»å–é€Ÿåº¦ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async(queeu, ^&#123;<span class="comment">/* è¯»å– 0 ï½ 8191 å­—èŠ‚ */</span>&#125;);</span><br><span class="line">dispatch_async(queeu, ^&#123;<span class="comment">/* è¯»å– 8192 ï½ 16383 å­—èŠ‚ */</span>&#125;);</span><br><span class="line">dispatch_async(queeu, ^&#123;<span class="comment">/* è¯»å– 16384 ï½ 24575 å­—èŠ‚ */</span>&#125;);</span><br><span class="line">dispatch_async(queeu, ^&#123;<span class="comment">/* è¯»å– 24576 ï½ 32767 å­—èŠ‚ */</span>&#125;);</span><br><span class="line">dispatch_async(queeu, ^&#123;<span class="comment">/* è¯»å– 32769 ï½ 40959 å­—èŠ‚ */</span>&#125;);</span><br><span class="line">dispatch_async(queeu, ^&#123;<span class="comment">/* è¯»å– 40960 ï½ 49151 å­—èŠ‚ */</span>&#125;);</span><br><span class="line">dispatch_async(queeu, ^&#123;<span class="comment">/* è¯»å– 49152 ï½ 57343 å­—èŠ‚ */</span>&#125;);</span><br><span class="line">dispatch_async(queeu, ^&#123;<span class="comment">/* è¯»å– 57344 ï½ 65535 å­—èŠ‚ */</span>&#125;);</span><br></pre></td></tr></table></figure><p>å¯åƒä¸Šé¢è¿™æ ·ï¼Œå°†æ–‡ä»¶åˆ†å‰²ä¸ºä¸€å—ä¸€å—åœ°è¿›è¡Œè¯»å–å¤„ç†ã€‚åˆ†å‰²è¯»å–çš„æ•°æ®é€šè¿‡ä½¿ç”¨Dispatch Data å¯æ›´ä¸ºç®€å•åœ°è¿›è¡Œç»“åˆå’Œåˆ†å‰²ã€‚</p><p>ä»£ç è§£è¯»å¯å‚è€ƒï¼š<a href="https://www.jianshu.com/p/da4710d76d33" target="_blank" rel="noopener">https://www.jianshu.com/p/da4710d76d33</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;è¿›ç¨‹å’Œçº¿ç¨‹ï¼š&quot;&gt;&lt;a href=&quot;#è¿›ç¨‹å’Œçº¿ç¨‹ï¼š&quot; class=&quot;headerlink&quot; title=&quot;è¿›ç¨‹å’Œçº¿ç¨‹ï¼š&quot;&gt;&lt;/a&gt;è¿›ç¨‹å’Œçº¿ç¨‹ï¼š&lt;/h3&gt;&lt;p&gt;è¿›ç¨‹æ˜¯ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ã€‚åº”ç”¨ç¨‹åºæ˜¯ä¸€ä¸ªæ²¡æœ‰ç”Ÿå‘½çš„å®ä½“ï¼Œåªæœ‰è¿è¡Œä¹‹å
      
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS || Blocks</title>
    <link href="http://yoursite.com/2019/07/11/iOS-Blocks/"/>
    <id>http://yoursite.com/2019/07/11/iOS-Blocks/</id>
    <published>2019-07-10T16:18:24.000Z</published>
    <updated>2019-07-10T16:32:56.636Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æ¦‚è¦"><a href="#æ¦‚è¦" class="headerlink" title="æ¦‚è¦"></a>æ¦‚è¦</h3><p>Blocksæ—¶cè¯­è¨€çš„æ‰©å……åŠŸèƒ½ï¼Œå°±æ˜¯å¸¦æœ‰è‡ªåŠ¨å˜é‡(å±€éƒ¨å˜é‡)çš„åŒ¿åå‡½æ•°</p><h3 id="æ¨¡å¼"><a href="#æ¨¡å¼" class="headerlink" title="æ¨¡å¼"></a>æ¨¡å¼</h3><h4 id="è¯­æ³•ï¼š"><a href="#è¯­æ³•ï¼š" class="headerlink" title="è¯­æ³•ï¼š"></a>è¯­æ³•ï¼š</h4><p><code>^ è¿”å›å€¼ç±»å‹ å‚æ•°åˆ—è¡¨ è¡¨è¾¾å¼</code></p><p>ä¾‹å¦‚ï¼š<code>^int (int count) {return count + 1;}</code></p><p>å¯çœç•¥è¿”å›å€¼ç±»å‹ï¼ŒBlockè¯­æ³•å°†æŒ‰ç…§returnè¯­å¥çš„ç±»å‹è¿”å›intå‹è¿”å›å€¼</p><p><code>^(int count) {return count + 1;}</code></p><p>å¦‚æœä¸ä½¿ç”¨å‚æ•°ï¼Œå‚æ•°åˆ—è¡¨ä¹Ÿå¯çœç•¥</p><p><code>^{printf(&quot;Blocks\n&quot;);}</code></p><a id="more"></a><h4 id="Blockç±»å‹å˜é‡"><a href="#Blockç±»å‹å˜é‡" class="headerlink" title="Blockç±»å‹å˜é‡"></a>Blockç±»å‹å˜é‡</h4><p><code>int (^block) (int) = ^(int count) {return count + 1;}</code></p><p><code>block(10)</code>è¿›è¡Œè°ƒç”¨</p><p>ä¹Ÿå¯ä»¥typedefå®šä¹‰ç±»å‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(^<span class="keyword">block_t</span>)</span> <span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="keyword">block_t</span> block = ^(<span class="keyword">int</span> count) &#123;<span class="keyword">return</span> count + <span class="number">1</span>;&#125;</span><br><span class="line">block(<span class="number">10</span>);</span><br></pre></td></tr></table></figure><h4 id="Blockæˆªè·è‡ªåŠ¨å˜é‡å€¼"><a href="#Blockæˆªè·è‡ªåŠ¨å˜é‡å€¼" class="headerlink" title="Blockæˆªè·è‡ªåŠ¨å˜é‡å€¼"></a>Blockæˆªè·è‡ªåŠ¨å˜é‡å€¼</h4><p>ä¹Ÿå°±æ—¶blockä¸­çš„å¸¦æœ‰è‡ªåŠ¨å˜é‡ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> val = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *fmt = <span class="string">"val = %d\n"</span>;</span><br><span class="line"><span class="keyword">void</span> (^blk)(<span class="keyword">void</span>) = ^&#123;<span class="built_in">printf</span>(fmt, val);&#125;;</span><br><span class="line">fmt = <span class="string">"the value has changed %d"</span>;</span><br><span class="line">val = <span class="number">11</span>;</span><br><span class="line">blk();</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒBlockè¯­æ³•çš„è¡¨è¾¾å¼ä½¿ç”¨çš„æ˜¯å®ƒä¹‹å‰å£°æ˜çš„è‡ªåŠ¨å˜é‡fmtå’Œvalã€‚Blockä¸­ï¼ŒBlockè¡¨è¾¾å¼æˆªè·æ‰€ä½¿ç”¨çš„è‡ªåŠ¨å˜é‡çš„å€¼ï¼Œå³ä¿å­˜è¯¥è‡ªåŠ¨å˜é‡çš„ç¬é—´å€¼ã€‚å› ä¸ºBlockè¡¨è¾¾å¼ä¿å­˜äº†è‡ªåŠ¨å˜é‡çš„å€¼ï¼Œæ‰€ä»¥åœ¨æ‰§è¡ŒBlockè¯­æ³•åï¼Œå³ä½¿æ”¹å†™äº†Blockä¸­ä½¿ç”¨çš„è‡ªåŠ¨å˜é‡çš„å€¼ä¹Ÿä¸ä¼šå½±å“Blockæ‰§è¡Œæ—¶è‡ªåŠ¨å˜é‡çš„å€¼ã€‚</p><p>æ‰“å°å‡ºæ¥åç»“æœä¸º<code>val = 10</code></p><p>è¿™å°±æ˜¯Blockçš„æˆªè·ã€‚</p><h4 id="Blockè¯´æ˜ç¬¦"><a href="#Blockè¯´æ˜ç¬¦" class="headerlink" title="Blockè¯´æ˜ç¬¦"></a>Blockè¯´æ˜ç¬¦</h4><p>æˆ‘ä»¬å°è¯•æ”¹å†™æˆªè·çš„è‡ªåŠ¨å˜é‡çš„å€¼ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> val = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">void</span> (^blk)(<span class="keyword">void</span>) = ^&#123;val = <span class="number">1</span>&#125;;</span><br><span class="line">blk();</span><br><span class="line">NSLog(@<span class="string">"%d"</span>, val);</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ä¼šæŠ¥é”™ï¼Œè¦æƒ³åœ¨blockè¯­æ³•ä¸­å°†å€¼èµ‹ç»™Blockè¯­æ³•å¤–çš„è‡ªåŠ¨å˜é‡ï¼Œéœ€åœ¨è‡ªåŠ¨å˜é‡å‰åŠ ä¸ª__blockè¯´æ˜ç¬¦ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__block <span class="keyword">int</span> val = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">void</span> (^blk)(<span class="keyword">void</span>) = ^&#123;val = <span class="number">1</span>;&#125;;</span><br><span class="line">blk();</span><br><span class="line">NSLog(@<span class="string">"%d"</span>, val);</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š<code>val = 1</code></p><h4 id="æˆªè·çš„è‡ªåŠ¨å˜é‡ï¼š"><a href="#æˆªè·çš„è‡ªåŠ¨å˜é‡ï¼š" class="headerlink" title="æˆªè·çš„è‡ªåŠ¨å˜é‡ï¼š"></a>æˆªè·çš„è‡ªåŠ¨å˜é‡ï¼š</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSMutableArray *a = [@[@<span class="number">1</span>, @<span class="number">2</span>, @<span class="number">3</span>] mutableCopy];</span><br><span class="line"><span class="keyword">void</span> (^blk)(<span class="keyword">void</span>) = ^&#123;[a addObject:@<span class="number">4</span>];&#125;;</span><br><span class="line">blk();</span><br><span class="line">NSLog(@<span class="string">"%@"</span>, a);</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç å¯ä»¥æ­£ç¡®æ‰§è¡Œï¼Œè¯¥ä»£ç ä¸­æˆªè·çš„å˜é‡æ˜¯NSMutableArrayç±»çš„å¯¹è±¡ã€‚å¦‚æœç”¨cè¯­è¨€æè¿°ï¼Œå³æ˜¯æˆªè·NSMutableArrayç±»å¯¹è±¡ç”¨çš„ç»“æ„ä½“å®ä¾‹æŒ‡é’ˆã€‚å¦‚æœä½¿ç”¨æˆªè·çš„å€¼çš„è¯æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¸èƒ½å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œèµ‹å€¼ï¼Œæ¯”å¦‚ä»¥ä¸‹ä»£ç ä¼šæŠ¥é”™ï¼Œè¦æƒ³æˆåŠŸè¿è¡Œçš„è¯è¦ç»™è‡ªåŠ¨å˜é‡aå‰åŠ __blockã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSMutableArray *a = [@[@<span class="number">1</span>, @<span class="number">2</span>, @<span class="number">3</span>] mutableCopy];</span><br><span class="line"><span class="keyword">void</span> (^blk)(<span class="keyword">void</span>) = ^&#123;NSArray *f = @[@<span class="number">1</span>]; a = f;&#125;;</span><br><span class="line">blk();</span><br><span class="line">NSLog(@<span class="string">"%@"</span>, a);</span><br></pre></td></tr></table></figure><h3 id="Blocksçš„å®ç°"><a href="#Blocksçš„å®ç°" class="headerlink" title="Blocksçš„å®ç°"></a>Blocksçš„å®ç°</h3><h4 id="Blocksçš„å®è´¨"><a href="#Blocksçš„å®è´¨" class="headerlink" title="Blocksçš„å®è´¨"></a>Blocksçš„å®è´¨</h4><p>Blocksçš„å®è´¨æ˜¯objcçš„å¯¹è±¡ï¼Œè½¬ä¸ºcçš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªç±»çš„å¯¹è±¡ç»“æ„ä½“å®ä¾‹ï¼Œç»“æ„ä½“å…·æœ‰isaæŒ‡é’ˆå’Œblocksä¸­å¼•ç”¨çš„è‡ªåŠ¨å˜é‡ï¼Œä½œä¸ºç»“æ„ä½“çš„æˆå‘˜å˜é‡ï¼ŒisaæŒ‡é’ˆæŒ‡å‘å­˜å‚¨ç±»ä¿¡æ¯çš„class_tç»“æ„ä½“(å­˜å‚¨ç€ç±»çš„å±æ€§ï¼Œæˆå‘˜å˜é‡ï¼Œæ–¹æ³•åç§°ï¼Œæ–¹æ³•å®ç°(å³å‡½æ•°æŒ‡é’ˆ))ã€‚</p><p>æ‰€ä»¥åœ¨æˆªè·å˜é‡æ—¶æˆªè·çš„è‡ªåŠ¨å˜é‡å­˜åˆ°blockç»“æ„ä½“å®ä¾‹ä¸­å»äº†ï¼Œä¹‹åå†æ”¹å˜è‡ªåŠ¨å˜é‡ç„¶åå†è°ƒç”¨blockså‡½æ•°å¹¶ä¸ä¼šä½¿ç»“æœå‘ç”Ÿæ”¹å˜ã€‚</p><p>è€Œä¹‹æ‰€ä»¥ä¸èƒ½æ”¹å˜è‡ªåŠ¨å˜é‡çš„å€¼æ˜¯å› ä¸ºblocksç»“æ„ä½“ä¸­ä»…ä½¿ç”¨è‡ªåŠ¨å˜é‡çš„å€¼ç„¶åèµ‹ç»™ç»“æ„ä½“å®ä¾‹ä¸­çš„æˆå‘˜å˜é‡ä½†æ˜¯å¹¶ä¸èƒ½æ”¹å˜å®ƒã€‚æ‰€ä»¥æ”¹å˜æ—¶å°±ä¼šæŠ¥é”™ã€‚</p><p><code>__block int val = 0;</code></p><p>é‚£ä¹ˆ__blockçš„å®ç°åˆ™æ¯”è¾ƒå¤æ‚ï¼Œå®ƒç›¸å½“äºä¸ºblockå£°æ˜ç¬¦å£°æ˜çš„å˜é‡å¦åˆ›å»ºä¸€ä¸ªç»“æ„ä½“ï¼Œåœ¨ç»“æ„ä½“ä¸­å°†å«æœ‰isaï¼Œflagsï¼Œç»“æ„ä½“sizeç­‰ä¿¡æ¯å¤–ï¼Œè¿˜å­˜æœ‰ä¸€ä¸ªè‡ªèº«ç±»å‹çš„æŒ‡é’ˆforwardingæˆå‘˜å˜é‡æŒ‡å‘è‡ªèº«ï¼Œå­˜æœ‰ä¸€ä¸ªå£°æ˜çš„valæˆå‘˜å˜é‡ã€‚</p><table><thead><tr><th align="center">åç§°</th><th align="center">å®è´¨</th></tr></thead><tbody><tr><td align="center">Block</td><td align="center">æ ˆä¸ŠBlockçš„ç»“æ„ä½“å®ä¾‹</td></tr><tr><td align="center">__block</td><td align="center">æ ˆä¸Š__blockçš„ç»“æ„ä½“å®ä¾‹</td></tr></tbody></table><h4 id="Blocksçš„å­˜å‚¨åŸŸ"><a href="#Blocksçš„å­˜å‚¨åŸŸ" class="headerlink" title="Blocksçš„å­˜å‚¨åŸŸ"></a>Blocksçš„å­˜å‚¨åŸŸ</h4><h5 id="Blockç»“æ„ä½“å­˜å‚¨ä½ç½®ï¼š"><a href="#Blockç»“æ„ä½“å­˜å‚¨ä½ç½®ï¼š" class="headerlink" title="Blockç»“æ„ä½“å­˜å‚¨ä½ç½®ï¼š"></a>Blockç»“æ„ä½“å­˜å‚¨ä½ç½®ï¼š</h5><ul><li>è®°è¿°å…¨å±€å˜é‡çš„åœ°æ–¹æœ‰Blockè¯­æ³•</li><li>Block è¯­æ³•çš„è¡¨è¾¾å¼ä¸­ä¸ä½¿ç”¨åº”æˆªè·çš„è‡ªåŠ¨å˜é‡</li></ul><p>ä»¥ä¸Šä¸¤ç§æƒ…å†µå°†Blockå­˜äºæ•°æ®åŒºï¼Œå…¶ä»–æƒ…å†µå­˜äºæ ˆåŒºã€‚è€Œä½•æ—¶å°†Blocké…ç½®åœ¨å †ä¸Šå‘¢ï¼Ÿçœ‹å¦‚ä¸‹æƒ…å†µ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(^<span class="keyword">blk_t</span>)</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="keyword">blk_t</span> func(<span class="keyword">int</span> rate)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> ^(<span class="keyword">int</span> count)&#123;<span class="keyword">return</span> rate * count;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åƒä»¥ä¸‹æƒ…å†µä¸‹Blockä¹Ÿæ˜¯ä½œä¸ºè¿”å›å€¼è¿”ç»™bçš„ï¼Œæ‰€ä»¥ä¹Ÿä¼šè¢«å¤åˆ¶åˆ°å †ä¸Šå¹¶è¢«bæ‰€æŒæœ‰ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span>(^b)(<span class="keyword">void</span>) = ^&#123;NSLog(@<span class="string">"hahaha"</span>);&#125;;</span><br></pre></td></tr></table></figure><p>è¯¥æºä»£ç è¿”å›é…ç½®åœ¨æ ˆä¸Šçš„Blockå‡½æ•°ã€‚å³ç¨‹åºæ‰§è¡Œä¸­ä»è¯¥å‡½æ•°è¿”å›å‡½æ•°è°ƒç”¨æ–¹æ—¶å˜é‡ä½œç”¨åŸŸç»“æŸï¼Œå› æ­¤æ ˆä¸Šçš„Blockä¹Ÿè¢«åºŸå¼ƒã€‚ä½†å®é™…å¤„ç†æ—¶ä¼šï¼š(å°†Blockä½œä¸ºå‡½æ•°å€¼è¿”å›æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆå¤åˆ¶åˆ°å †ä¸Šçš„ä»£ç )</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">blk_t</span> tmp = Blockæ ˆä¸Šçš„ç»“æ„ä½“å®ä¾‹</span><br><span class="line">tmp = _Block_copy(tmp);</span><br><span class="line"><span class="comment">// copyå‡½æ•°å°†æ ˆä¸Šçš„Blockå¤åˆ¶åˆ°å †ä¸Šã€‚</span></span><br><span class="line"><span class="comment">// å¤åˆ¶åå°†å †ä¸Šçš„åœ°å€ä½œä¸ºæŒ‡é’ˆèµ‹å€¼ç»™å˜é‡tmp;</span></span><br><span class="line"><span class="keyword">return</span> objc_autoreleaseReturnValue(tmp);</span><br><span class="line"><span class="comment">// å°†å †ä¸Šçš„Blockä½œä¸ºObjective-cå¯¹è±¡</span></span><br><span class="line"><span class="comment">// æ³¨å†Œåˆ°autoreleasepoolä¸­ï¼Œç„¶åè¿”å›è¯¥å¯¹è±¡</span></span><br></pre></td></tr></table></figure><p>å¤§å¤šæ•°æƒ…å†µç¼–è¯‘å™¨ä¼šé€‚å½“è¿›è¡Œåˆ¤æ–­è‡ªåŠ¨ç”Ÿæˆå¤åˆ¶åˆ°å †ä¸Šçš„ä»£ç ï¼Œä½†æœ‰äº›æƒ…å†µéœ€è¦ä½¿ç”¨<strong>copyå®ä¾‹æ–¹æ³•</strong>æ‰‹åŠ¨ç”Ÿæˆä»£ç ã€‚ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</p><ul><li>å‘å‡½æ•°æˆ–è€…æ–¹æ³•çš„å‚æ•°ä¸­ä¼ é€’Blockæ—¶ã€‚</li></ul><p>ä½†æ˜¯å¦‚æœåœ¨æ–¹æ³•æˆ–æ˜¯å‡½æ•°ä¸­é€‚å½“åœ°å¤åˆ¶äº†ä¼ é€’è¿‡æ¥çš„å‚æ•°ï¼Œé‚£ä¹ˆå°±ä¸ç”¨åœ¨è°ƒç”¨è¯¥æ–¹æ³•æˆ–å‡½æ•°å‰æ‰‹åŠ¨å¤åˆ¶äº†ã€‚ä»¥ä¸‹æ–¹æ³•æˆ–å‡½æ•°ä¸ç”¨æ‰‹åŠ¨å¤åˆ¶ï¼š</p><ul><li>Cocoa æ¡†æ¶çš„æ–¹æ³•ä¸”æ–¹æ³•åä¸­å«æœ‰usingBlockç­‰ã€‚ä¾‹å¦‚NSArryç±»çš„enumerateObjectUsingBlockå®ä¾‹æ–¹æ³•</li><li>GCDçš„APIã€‚æ¯”å¦‚dispatch_asyncå‡½æ•°ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    id obj = [self getBlockArray];</span><br><span class="line">    <span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(^<span class="keyword">blk_t</span>)</span> <span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line">    <span class="keyword">blk_t</span> blk = (<span class="keyword">blk_t</span>)[obj objectAtIndex:<span class="number">0</span>];</span><br><span class="line">    blk();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id) getBlockArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> val = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">return</span> [[NSArray alloc] initWithObjects:^&#123;NSLog(@<span class="string">"blk0: %d"</span>, val);&#125;, ^&#123;NSLog(@<span class="string">"blk1: %d"</span>, val);&#125;, nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæƒ…å†µä¸‹ä½¿ç”¨ä¼šæŠ¥é”™ã€‚å› ä¸ºgetBlockArrayå‡½æ•°æ‰§è¡Œç»“æŸåï¼Œæ ˆä¸Šçš„Blockä¼šè¢«åºŸå¼ƒã€‚å¯æƒœæ­¤æ—¶ç¼–è¯‘å™¨æ— æ³•åˆ¤æ–­æ˜¯å¦éœ€è¦å¤åˆ¶ï¼Œæ­¤æ—¶æˆ‘ä»¬åªèƒ½è¿›è¡Œæ‰‹åŠ¨å¤åˆ¶ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    id obj = [self getBlockArray];</span><br><span class="line">    <span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(^<span class="keyword">blk_t</span>)</span> <span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line">    <span class="keyword">blk_t</span> blk = (<span class="keyword">blk_t</span>)[obj objectAtIndex:<span class="number">0</span>];</span><br><span class="line">    blk();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id) getBlockArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> val = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">return</span> [[NSArray alloc] initWithObjects:[^&#123;NSLog(@<span class="string">"blk0: %d"</span>, val);&#125; copy], [^&#123;NSLog(@<span class="string">"blk1: %d"</span>, val);&#125; copy], nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æŒ‰ç…§é¢„æƒ³çš„ç»“æœæˆåŠŸè¿è¡Œå¹¶æ‰“å°å‡ºç»“æœã€‚</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬å¯¹å·²ç»å­˜åœ¨äºå †ä¸Šçš„Blockè¿›è¡Œcopyï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    id obj = [self getBlockArray];</span><br><span class="line">    <span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(^<span class="keyword">blk_t</span>)</span> <span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line">    <span class="keyword">blk_t</span> blk = (<span class="keyword">blk_t</span>)[obj objectAtIndex:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">blk_t</span> c = [blk copy];</span><br><span class="line">    NSLog(@<span class="string">"%p"</span>, blk);</span><br><span class="line">    NSLog(@<span class="string">"%p"</span>, c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id) getBlockArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> val = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">return</span> [[NSArray alloc] initWithObjects:[^&#123;NSLog(@<span class="string">"blk0: %d"</span>, val);&#125; copy], [^&#123;NSLog(@<span class="string">"blk1: %d"</span>, val);&#125; copy], nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯å¹¶ä¸ä¼šåœ¨è¿›è¡Œä¸€æ¬¡æ·±æ‹·è´ï¼Œåªæ˜¯æµ…æ‹·è´ï¼Œå¼•ç”¨è®¡æ•°åŠ ä¸€ã€‚</p><p><strong>æ€»ç»“ä¸€ä¸‹ä½•æ—¶æ ˆä¸Šçš„Blockä¼šå¤åˆ¶åˆ°å †ä¸Šï¼š</strong></p><ul><li>è°ƒç”¨Blockçš„copyå®ä¾‹æ–¹æ³•ã€‚</li><li>Blockä½œä¸ºå‡½æ•°è¿”å›å€¼è¿”å›æ—¶ã€‚</li><li>å°†Blockèµ‹å€¼ç»™é™„æœ‰<code>__strong</code>ä¿®é¥°ç¬¦idç±»å‹çš„ç±»æˆ–è€…Blockç±»å‹çš„æˆå‘˜å˜é‡æ—¶(ç¼–è¯‘å™¨æ›´æ–°åèµ‹å€¼ç»™blockç±»å‹ä¹Ÿä¼šå¤åˆ¶åˆ°æ ˆä¸Š)ã€‚</li><li>æ–¹æ³•åä¸­å«æœ‰usingBlockçš„Cocoaæ¡†æ¶æ–¹æ³•æˆ–GCDçš„APIä¼ é€’Blockæ—¶ã€‚</li></ul><h5 id="blockå˜é‡å­˜å‚¨åŸŸ"><a href="#blockå˜é‡å­˜å‚¨åŸŸ" class="headerlink" title="__blockå˜é‡å­˜å‚¨åŸŸ"></a>__blockå˜é‡å­˜å‚¨åŸŸ</h5><p>ä½¿ç”¨<code>__block</code>å˜é‡çš„Blockä»æ ˆå¤åˆ¶åˆ°å †ä¸Šæ—¶ï¼Œ<code>__block</code>å˜é‡å­˜å‚¨åŸŸä¹Ÿä¼šå—å½±å“ã€‚</p><table><thead><tr><th align="center">__blockå˜é‡çš„é…ç½®å­˜å‚¨åŸŸ</th><th align="center">Blockä»æ ˆå¤åˆ¶åˆ°å †ä¸Šçš„å½±å“</th></tr></thead><tbody><tr><td align="center">æ ˆ</td><td align="center">ä»æ ˆå¤åˆ¶åˆ°å †ä¸Šå¹¶è¢«BlockæŒæœ‰</td></tr><tr><td align="center">å †</td><td align="center">è¢«BlockæŒæœ‰</td></tr></tbody></table><ol><li><p>è‹¥åœ¨ä¸€ä¸ªBlockä¸­ä½¿ç”¨<code>__block</code>å˜é‡ï¼Œåˆ™å½“è¯¥Blockä»æ ˆå¤åˆ¶åˆ°å †æ—¶ï¼Œä½¿ç”¨çš„æ‰€æœ‰<code>__block</code>å˜é‡ä¹Ÿå¿…å®šé…ç½®åœ¨æ ˆä¸Šã€‚è¿™äº›<code>__block</code>å˜é‡ä¹Ÿå…¨è¢«ä»æ ˆä¸Šå¤åˆ¶åˆ°å †ã€‚æ­¤æ—¶ï¼ŒBlockæŒæœ‰<code>__block</code>å˜é‡ã€‚å³ä½¿åœ¨è¯¥Blockå·²å¤åˆ¶åˆ°å †çš„æƒ…å½¢ä¸‹ï¼Œå¤åˆ¶Blockä¹Ÿå¯¹æ‰€ä½¿ç”¨çš„<code>__block</code>å˜é‡æ²¡æœ‰ä»»ä½•å½±å“ã€‚</p></li><li><p>åœ¨å¤šä¸ªBlockä¸­ä½¿ç”¨<code>__block</code>å˜é‡æ—¶ï¼Œå› ä¸ºæœ€å…ˆä¼šå°†æ‰€æœ‰çš„Blocké…ç½®åœ¨æ ˆä¸Šï¼Œæ‰€ä»¥<code>__block</code>å˜é‡ä¹Ÿä¼šé…ç½®åœ¨æ ˆä¸Šã€‚åœ¨ä»»ä½•ä¸€ä¸ªBlockä»æ ˆå¤åˆ¶åˆ°å †æ—¶ï¼Œ<code>__block</code>å˜é‡ä¹Ÿä¼šä¸€å¹¶ä»æ ˆå¤åˆ¶åˆ°å †å¹¶è¢«è¯¥Blockæ‰€æŒæœ‰ã€‚å½“å‰©ä¸‹çš„Blockä»æ ˆå¤åˆ¶åˆ°å †ä¸Šæ—¶ï¼Œè¢«å¤åˆ¶çš„BlockæŒæœ‰<code>__block</code>å˜é‡ï¼Œå¹¶å¢åŠ <code>__block</code>å˜é‡çš„å¼•ç”¨è®¡æ•°ã€‚</p></li></ol><p>ä¸‹é¢å†è°ˆä¸€ä¸‹<code>__block</code>å˜é‡ç”¨ç»“æ„ä½“æˆå‘˜å˜é‡<code>__forwarding</code>çš„åŸå› ã€‚æ­¤æ—¶ï¼Œä¸ç®¡<code>__block</code>å˜é‡é…ç½®åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Šï¼Œéƒ½èƒ½å¤Ÿæ­£ç¡®åœ°è®¿é—®è¯¥å˜é‡ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__block <span class="keyword">int</span> val = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">void</span> (^blk) (<span class="keyword">void</span>) = [^&#123;NSLog(@<span class="string">"val = %d"</span>, val); val++;&#125; copy];</span><br><span class="line">val++;</span><br><span class="line">blk();</span><br><span class="line">NSLog(@<span class="string">"val = %d"</span>,val);</span><br></pre></td></tr></table></figure><p><strong>ç»“æœæ‰“å°å‡ºæ¥åˆ†åˆ«ä¸º2ï¼Œ3ã€‚</strong></p><p>ä»¥ä¸‹ä¸¤ç§val++çš„æºä»£ç éƒ½å¯ä»¥è½¬ä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p><p><code>++(val.__forwarding-&gt;val);</code></p><p>åœ¨Blockä»æ ˆå¤åˆ¶åˆ°å †ä¸Šæ—¶ï¼Œ<code>__forwarding</code>æŒ‡é’ˆåŸæœ¬æŒ‡å‘è‡ªèº«ï¼Œå¤åˆ¶å®ŒåæŒ‡å‘å¤åˆ¶åœ¨å †ä¸Šçš„<code>__block</code>å˜é‡ã€‚</p><p>æ‰€ä»¥é€šè¿‡è¯¥æŒ‡é’ˆåŠŸèƒ½ï¼Œæ— è®ºåœ¨Blockè¯­æ³•ä¸­ã€Blockè¯­æ³•å¤–ä½¿ç”¨<code>__block</code>å˜é‡ï¼Œè¿˜æ˜¯<code>__block</code>å˜é‡é…ç½®åœ¨æ ˆä¸Šæˆ–æ˜¯å †ä¸Šï¼Œéƒ½å¯ä»¥é¡ºåˆ©è®¿é—®åˆ°åŒä¸€ä¸ª<code>__block</code>å˜é‡ã€‚</p><p>åŒæ—¶ä¹Ÿåˆšå¥½éªŒè¯äº†ä¹‹å‰è¯´çš„ä½¿ç”¨<code>__block</code>å˜é‡çš„è¯ä¼šä½¿å¾—BlockæŒæœ‰è¯¥å˜é‡çš„ç»“æ„ä½“ï¼Œæ‰€ä»¥æˆªè·çš„ä¹Ÿå°±ä¸æ˜¯å®šä¹‰Blockå‰çš„å€¼äº†ï¼Œè€Œæ˜¯è°ƒç”¨Blockå‰çš„å€¼ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> [super viewDidLoad];</span><br><span class="line"><span class="keyword">int</span> val = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">void</span> (^blk) (<span class="keyword">void</span>) = ^&#123;NSLog(@<span class="string">"val = %d"</span>, val);&#125;;</span><br><span class="line">val++;</span><br><span class="line">blk();</span><br><span class="line">NSLog(@<span class="string">"val = %d"</span>,val);</span><br></pre></td></tr></table></figure><p><strong>è¿™ä¸ªçš„ç»“æ„å°±æ˜¯1ï¼Œ2ã€‚</strong></p><h4 id="æˆªè·å¯¹è±¡"><a href="#æˆªè·å¯¹è±¡" class="headerlink" title="æˆªè·å¯¹è±¡"></a>æˆªè·å¯¹è±¡</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">block blk;</span><br><span class="line">&#123;</span><br><span class="line">    id <span class="built_in">array</span> = [[NSMutableArray alloc] init];</span><br><span class="line">    blk = ^(id obj) &#123;</span><br><span class="line">        [<span class="built_in">array</span> addObject:obj];</span><br><span class="line">        NSLog(@<span class="string">"array count = %ld"</span>, [<span class="built_in">array</span> count]);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line">blk([[NSObject alloc] init]);</span><br><span class="line">blk([[NSObject alloc] init]);</span><br><span class="line">blk([[NSObject alloc] init]);</span><br></pre></td></tr></table></figure><p>arrayå·²ç»è¶…å‡ºå…¶ä½œç”¨åŸŸï¼Œå˜é‡arrayåº”è¯¥è¢«åºŸå¼ƒï¼Œå…¶å¼ºå¼•ç”¨å¤±æ•ˆï¼Œå› æ­¤èµ‹å€¼ç»™å˜é‡arrayçš„NSMutableArrayç±»çš„å¯¹è±¡å¹¶å®šåº”è¯¥è¢«é‡Šæ”¾å¹¶åºŸå¼ƒã€‚ä½†è¯¥æºä»£ç è¿è¡Œæ­£å¸¸ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">array</span> count = <span class="number">1</span></span><br><span class="line"><span class="built_in">array</span> count = <span class="number">2</span></span><br><span class="line"><span class="built_in">array</span> count = <span class="number">3</span></span><br></pre></td></tr></table></figure><p>è¿™å°±æ„å‘³ç€èµ‹å€¼ç»™å˜é‡arrayçš„NSMutableArrayç±»çš„å¯¹è±¡åœ¨Blockçš„æ‰§è¡Œéƒ¨åˆ†è¶…å‡ºå…¶å˜é‡ä½œç”¨åŸŸè€Œå­˜åœ¨</p><p>åŸå› æ˜¯åœ¨Blockç”¨çš„ç»“æ„ä½“ä¸­èµ‹æœ‰äº†<code>__strong</code>ä¿®é¥°ç¬¦çš„æˆå‘˜å˜é‡arrayã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">main_block_impl_0</span> &#123;</span></span><br><span class="line"> <span class="class"><span class="keyword">struct</span> __<span class="title">block_impl</span> <span class="title">impl</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> __<span class="title">main_block_desc_0</span> *<span class="title">Desc</span>;</span></span><br><span class="line">    id __strong <span class="built_in">array</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è™½ç„¶cè¯­è¨€ç»“æ„ä½“å†…ä¸èƒ½é™„æœ‰<code>__strong</code>ä¿®é¥°ç¬¦çš„å˜é‡ã€‚å› ä¸ºç¼–è¯‘å™¨ä¸çŸ¥é“ä½•æ—¶è¿›è¡Œcè¯­è¨€ç»“æ„ä½“çš„åˆå§‹åŒ–å’ŒåºŸå¼ƒæ“ä½œï¼Œä¸èƒ½å¾ˆå¥½åœ°ç®¡ç†å†…å­˜ã€‚</p><p>ä½†æ˜¯OCè¿è¡Œæ—¶åº“èƒ½å¤Ÿå‡†ç¡®åœ°æŠŠæ¡Blockä»æ ˆå¤åˆ¶åˆ°å †ä»¥åŠå †ä¸Šçš„Blockè¢«åºŸå¼ƒçš„æ—¶æœºï¼Œå› æ­¤Blockç”¨ç»“æ„ä½“ä¸­å³ä½¿å«æœ‰é™„æœ‰<code>__strong</code>ä¿®é¥°ç¬¦æˆ–<code>__weak</code>ä¿®é¥°ç¬¦çš„å˜é‡ï¼Œä¹Ÿå¯ä»¥æ°å½“è¿›è¡Œåˆå§‹åŒ–å’ŒåºŸå¼ƒï¼Œä¸ºæ­¤éœ€è¦å¢åŠ <strong>copy</strong>(retain)å’Œ<strong>dispose</strong>(release)å‡½æ•°æ¥ç»™Blockä¸­çš„æˆå‘˜å˜é‡arrayèµ‹å€¼ã€‚</p><h4 id="é¿å…å¾ªç¯å¼•ç”¨ï¼š"><a href="#é¿å…å¾ªç¯å¼•ç”¨ï¼š" class="headerlink" title="é¿å…å¾ªç¯å¼•ç”¨ï¼š"></a>é¿å…å¾ªç¯å¼•ç”¨ï¼š</h4><p>å³å¯¹è±¡æŒæœ‰Blockï¼ŒBlockåˆæŒæœ‰å¯¹è±¡(self)ã€‚</p><p>é™¤äº†<code>__weak</code>å¤–ï¼Œå¯ä½¿ç”¨<code>__block</code>ä¿®é¥°ç¬¦é¿å…å¾ªç¯å¼•ç”¨ï¼Œå°†<code>__block</code>ä¿®é¥°çš„å˜é‡æŒ‡å‘selfï¼Œç„¶ååœ¨Blockä¸­ç”¨å®Œselfåå°†<code>__block</code>å˜é‡ç½®ä¸ºnilï¼Œä½†æ˜¯å¿…é¡»è¦æ‰§è¡ŒBlockå‡½æ•°ï¼Œä¸ç„¶ä»ä¼šå¼•èµ·å¾ªç¯å¼•ç”¨ã€‚</p><p><strong>PS</strong>ï¼šä¹‹å‰é‡åˆ°çš„ä¸€ä¸ªæ¦‚å¿µæ··æ·†ï¼Œå†æä¸€ç‚¹å±æ€§å’Œæˆå‘˜å˜é‡çš„åŒºåˆ«ï¼š</p><p>å±æ€§ = ivar(æˆå‘˜å˜é‡)+getter+setter(å­˜å–æ–¹æ³•)</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;æ¦‚è¦&quot;&gt;&lt;a href=&quot;#æ¦‚è¦&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¦&quot;&gt;&lt;/a&gt;æ¦‚è¦&lt;/h3&gt;&lt;p&gt;Blocksæ—¶cè¯­è¨€çš„æ‰©å……åŠŸèƒ½ï¼Œå°±æ˜¯å¸¦æœ‰è‡ªåŠ¨å˜é‡(å±€éƒ¨å˜é‡)çš„åŒ¿åå‡½æ•°&lt;/p&gt;
&lt;h3 id=&quot;æ¨¡å¼&quot;&gt;&lt;a href=&quot;#æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;æ¨¡å¼&quot;&gt;&lt;/a&gt;æ¨¡å¼&lt;/h3&gt;&lt;h4 id=&quot;è¯­æ³•ï¼š&quot;&gt;&lt;a href=&quot;#è¯­æ³•ï¼š&quot; class=&quot;headerlink&quot; title=&quot;è¯­æ³•ï¼š&quot;&gt;&lt;/a&gt;è¯­æ³•ï¼š&lt;/h4&gt;&lt;p&gt;&lt;code&gt;^ è¿”å›å€¼ç±»å‹ å‚æ•°åˆ—è¡¨ è¡¨è¾¾å¼&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;code&gt;^int (int count) {return count + 1;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å¯çœç•¥è¿”å›å€¼ç±»å‹ï¼ŒBlockè¯­æ³•å°†æŒ‰ç…§returnè¯­å¥çš„ç±»å‹è¿”å›intå‹è¿”å›å€¼&lt;/p&gt;
&lt;p&gt;&lt;code&gt;^(int count) {return count + 1;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸ä½¿ç”¨å‚æ•°ï¼Œå‚æ•°åˆ—è¡¨ä¹Ÿå¯çœç•¥&lt;/p&gt;
&lt;p&gt;&lt;code&gt;^{printf(&amp;quot;Blocks\n&amp;quot;);}&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOSå¤šçº¿ç¨‹å’Œç½‘ç»œ</title>
    <link href="http://yoursite.com/2019/07/11/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E7%BD%91%E7%BB%9C/"/>
    <id>http://yoursite.com/2019/07/11/iOSå¤šçº¿ç¨‹å’Œç½‘ç»œ/</id>
    <published>2019-07-10T16:15:56.000Z</published>
    <updated>2019-07-10T16:17:29.401Z</updated>
    
    <content type="html"><![CDATA[<h4 id="æä¾›çš„åŠŸèƒ½"><a href="#æä¾›çš„åŠŸèƒ½" class="headerlink" title="æä¾›çš„åŠŸèƒ½"></a>æä¾›çš„åŠŸèƒ½</h4><ul><li>é€šè¿‡URLå°†æ•°æ®ä¸‹è½½åˆ°å†…å­˜</li><li>é€šè¿‡URLå°†æ•°æ®ä¸‹è½½åˆ°æ–‡ä»¶ç³»ç»Ÿ</li><li>å°†æ•°æ®ä¸Šä¼ åˆ°æŒ‡å®šçš„URL</li><li>åœ¨åå°å®Œæˆä¸Šè¿°æ“ä½œ(æ”¯æŒåå°ç½‘ç»œæ“ä½œï¼Œé™¤éç”¨æˆ·å¼ºè¡Œå…³é—­åº”ç”¨ç¨‹åº)</li></ul><a id="more"></a><p><strong>NSURLConnectionå’ŒNSURLSessionçš„å…³ç³»ç¤ºæ„å›¾</strong></p><p><img src="https://img-blog.csdnimg.cn/20190602005847740.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>NSURLSessionä¸­çš„è¯·æ±‚éƒ½çœ‹åšä¸€ä¸ªè¯·æ±‚ä»»åŠ¡(task)ã€‚</p><p><strong>NSURLSessionçš„Taskç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼š</strong><br><img src="https://img-blog.csdnimg.cn/20190602005852734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>NSURLSessionTask æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæä¾›äº†ä¸€äº›åŸºæœ¬çš„æ–¹æ³•</li><li>NSURLSessionDataTask æ˜¯ä¸€ä¸ªå…·ä½“çš„ task ç±»ï¼Œå¯ä»¥è·å–æ•°æ®</li><li>NSURLSessionDownloadTask æ˜¯ä¸€ä¸ªå…·ä½“çš„ task ç±»ï¼Œå¯ä»¥ä¸‹è½½æ•°æ®</li><li>NSURLSessionUploadTask æ˜¯ä¸€ä¸ªå…·ä½“çš„ task ç±»ï¼Œå¯ä»¥ä¸Šä¼ æ•°æ®</li><li>NSURLSessionStreamTasj æ˜¯ä¸€ä¸ªå…·ä½“çš„ task ç±»ï¼Œä»¥æµçš„æ–¹å¼è¯·æ±‚æ•°æ®ï¼Œä½¿ç”¨è¾ƒå°‘</li></ul><p>æ¯ä¸€ä¸ªç±»éƒ½æœ‰å¯¹åº”çš„åè®®ã€‚</p><h3 id="ä»£ç ä½“ç°"><a href="#ä»£ç ä½“ç°" class="headerlink" title="ä»£ç ä½“ç°"></a>ä»£ç ä½“ç°</h3><h4 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)sesssion &#123;    </span><br><span class="line">    <span class="comment">// 1. url    </span></span><br><span class="line">    NSURL *url = [NSURL URLWithString:@<span class="string">"http://127.0.0.1/demo.json"</span>];    </span><br><span class="line">    <span class="comment">// 2. å¦‚æœä½¿ç”¨ GET è¯·æ±‚ï¼Œrequest å¯ä»¥çœç•¥    </span></span><br><span class="line">    <span class="comment">// session - è‹¹æœä¸ºäº†æ–¹ä¾¿ç¨‹åºå‘˜çš„å¼€å‘ï¼Œæä¾›äº†ä¸€ä¸ªå…¨å±€çš„ session å•ä¾‹ ï¼ˆæˆ‘ä»¬æ˜¯ç›´æ¥è·å–çš„ï¼Œä¸éœ€è¦åˆ›å»ºï¼‰    </span></span><br><span class="line">    NSURLSession *session = [NSURLSession sharedSession];    </span><br><span class="line">    <span class="comment">// 3. æ•°æ®ä»»åŠ¡ ï¼ æ‰€æœ‰çš„ä»»åŠ¡ï¼Œéƒ½æ˜¯ç”±session å‘èµ·çš„    </span></span><br><span class="line">    NSURLSessionDataTask *task = [session dataTaskWithURL:url completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) &#123;       </span><br><span class="line">        <span class="comment">// 4.å°†å¾—åˆ°æ•°æ®è¿›è¡Œè¿”åºåˆ—åŒ–        </span></span><br><span class="line">        NSLog(@<span class="string">"%@"</span>, [NSJSONSerialization JSONObjectWithData:data options:<span class="number">0</span> error:<span class="literal">NULL</span>]);    &#125;];    </span><br><span class="line">    <span class="comment">// 5. å¯åŠ¨ä»»åŠ¡ï¼ˆä¸€å®šè¦å¯åŠ¨ä»»åŠ¡ï¼‰    </span></span><br><span class="line">    [task resume];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ä»¥ä¸Šå‘èµ·çš„DataTaskä»»åŠ¡ä¸­ï¼š</strong></p><p><code>- (NSURLSessionDataTask *)dataTaskWithURL:(NSURL *)url completionHandler:(void (^)(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error))completionHandler;</code></p><ul><li>è¯¥æ–¹æ³•ä¸­ä¼šè‡ªåŠ¨å°† url è½¬æ¢ä¸ºä¸€ä¸ªè¯·æ±‚å¯¹è±¡ï¼ˆNSURLRequestï¼‰ï¼Œå¹¶ä¸”è¯¥è¯·æ±‚å¯¹è±¡æ˜¯ GET è¯·æ±‚æ–¹å¼</li><li>å›è°ƒæ–¹æ³•æ˜¯åœ¨å­çº¿ç¨‹ä¸­è¿è¡Œçš„ï¼Œæ‰€ä»¥å¦‚æœåœ¨å›è°ƒæ–¹æ³•ä¸­åˆ·æ–° UI å¿…é¡»å›åˆ°ä¸»çº¿ç¨‹ä¸­</li><li>å›è°ƒæ–¹æ³•ä¸­æœ‰ä¸¤ä¸ªå‚æ•° response / errorï¼Œè¿™ä¸¤ä¸ªå‚æ•°å’Œ è¯¥æ¶ˆæ¯çš„æ¥å—è€…ï¼ˆå³ NSURLSessionDataTask å¯¹è±¡ï¼‰ä¸­çš„ response / error æ˜¯æŒ‡åŒä¸€ä¸ªå†…å®¹ï¼Œå³åœ°å€ç›¸åŒ</li><li>ä½¿ç”¨è¯¥æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ä¸èƒ½ç›‘å¬è·å–æ•°æ®çš„è¿›åº¦ï¼Œå› ä¸ºåªæœ‰å½“å…¨éƒ¨è¯·æ±‚å®Œæ•°æ®åï¼Œæ‰ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œdata ä¸­çš„æ•°æ®æ˜¯è¯·æ±‚çš„å…¨éƒ¨æ•°æ®.</li></ul><p><code>// @param request è¯·æ±‚å¯¹è±¡</code></p><p><code>- (NSURLSessionDataTask *)dataTaskWithRequest:(NSURLRequest *)request completionHandler:(void (^)(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error))completionHandler;</code></p><p><strong>withRequestæ–¹æ³•å¯ä»¥æ‰‹åŠ¨è®¾ç½®è¯·æ±‚å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥æŒ‡å®šGET/POSTä¸­çš„ä»»ä½•ä¸€ç§æ–¹æ³•äº†ã€‚è€ŒwithURLæ–¹æ³•åªèƒ½ä½¿ç”¨GETæ–¹æ³•ã€‚</strong></p><p>åœ¨ç¬¬ä¸‰æ–¹æ¡†æ¶å¯¹äº NSURLSession çš„åŸºæœ¬çš„å°è£…æ€è·¯å°±æ˜¯è¿™æ ·ï¼Œç»™ä¸€ä¸ª url ï¼Œåç›´æ¥å¯åŠ¨å°±å¯ä»¥äº†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)sesssionDemo &#123;    </span><br><span class="line">    <span class="comment">// 1. url    </span></span><br><span class="line">    NSURL *url = [NSURL URLWithString:@<span class="string">"http://127.0.0.1/demo.json"</span>];    </span><br><span class="line">    <span class="comment">// 2. å¯åŠ¨ä¼šè¯    </span></span><br><span class="line">    [self taskWithURL:url];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)taskWithURL:(NSURL *)url &#123;    </span><br><span class="line">    <span class="comment">// 1. å…¨å±€ä¼šè¯å‘èµ·æ•°æ®ä»»åŠ¡ ï¼ æ‰€æœ‰çš„ä»»åŠ¡ï¼Œéƒ½æ˜¯ç”±session å‘èµ·çš„    </span></span><br><span class="line">    [[[NSURLSession sharedSession] dataTaskWithURL:url completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) &#123;        </span><br><span class="line">        NSLog(@<span class="string">"%@"</span>, [NSJSONSerialization JSONObjectWithData:data options:<span class="number">0</span> error:<span class="literal">NULL</span>]);    &#125;] resume];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä½¿ç”¨å•ä¾‹ç±»çš„ç¼ºç‚¹å°±æ˜¯ä¸èƒ½å®æ—¶ç›‘æ§è·å–æ•°æ®çš„æƒ…å†µã€‚å› ä¸ºä»¥ä¸Šä¸¤ç§æ–¹æ³•ä¸­åªæœ‰å½“è¯·æ±‚å®Œå…¨éƒ¨çš„æ•°æ®åæ‰ä¼šè°ƒç”¨å›è°ƒæ–¹æ³•ï¼Œå¦‚æœæƒ³è¦å®æ—¶è·å–å¹¶ç›‘æ§è¯·æ±‚è¿›åº¦ï¼Œå°±è¦è®¾ç½®ä»£ç†æ–¹æ³•ã€‚</p><h4 id="NSURLSessionä¸‹è½½è¿›åº¦è·Ÿè¿›"><a href="#NSURLSessionä¸‹è½½è¿›åº¦è·Ÿè¿›" class="headerlink" title="NSURLSessionä¸‹è½½è¿›åº¦è·Ÿè¿›"></a>NSURLSessionä¸‹è½½è¿›åº¦è·Ÿè¿›</h4><p>ä¸‹è½½è¿›åº¦çš„è·Ÿè¿›æ˜¯é€šè¿‡ä»£ç†å®ç°çš„ã€‚</p><p>éœ€è¦è·Ÿè¸ªè¿›åº¦ï¼Œå°±éœ€è¦ä½¿ç”¨ä»£ç†ï¼Œä»£ç†æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œæˆ‘å°±è¦ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰çš„ä¼šè¯ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property(strong, nonatomic)NSURLSession *session;</span><br></pre></td></tr></table></figure><ul><li><p>æ³¨æ„delegate Queueå¦‚æœæ˜¯ä¼ ä»£ç†æ–¹æ³•åœ¨å­çº¿ç¨‹ä¸­è¿è¡Œæ—¶ï¼Œåˆ™UIçš„åˆ·æ–°è¦æ³¨æ„åœ¨ä¸»çº¿ç¨‹è¿›è¡Œã€‚</p></li><li><p>è€Œä¸»é˜Ÿåˆ—æ˜¯<code>[NSOperationQueue mainQueue]</code></p></li><li><p>å¦‚ä½•é€‰æ‹©é˜Ÿåˆ—: ç½‘ç»œè®¿é—®ç»“æŸåï¼Œå¦‚æœä¸éœ€è¦åšå¤æ‚çš„æ“ä½œï¼Œå¯ä»¥æŒ‡å®šä¸»é˜Ÿåˆ—ï¼Œè¿™æ ·ä¸ç”¨è€ƒè™‘çº¿ç¨‹é—´é€šè®¯ã€‚</p></li><li><p>ç”±äºä¸‹è½½æœ¬èº«æ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹å·¥ä½œã€‚</p></li><li><p>åœ¨ä¸»çº¿ç¨‹ä¸­ä»£ç†çš„è¯ï¼Œæ‰€æœ‰çš„ä»£ç†å›è°ƒï¼Œéƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹å¼‚æ­¥çš„ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹æ‰§è¡Œï¼(ä¸»çº¿ç¨‹å¼‚æ­¥å¹¶ä¸ä¼šå¼€è¾Ÿæ–°çš„çº¿ç¨‹, åªæ˜¯æŠŠé˜Ÿåˆ—ä»»åŠ¡æ”¾åˆ°å¼‚æ­¥æ‰§è¡Œ, ç­‰å¾…ä¸»é˜Ÿåˆ—ä¸­çš„å½“å‰ä»»åŠ¡éƒ½å®Œæˆ, ä¸»çº¿ç¨‹ç©ºé—²çš„æ—¶å€™, å†æ¥æ‰§è¡Œéœ€è¦æ‰§è¡Œçš„ä»»åŠ¡)ã€‚</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @param configuration é…ç½®ä¿¡æ¯å¯¹è±¡</span></span><br><span class="line"><span class="comment">// @param delegate ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">// @param queue ä»£ç†æ–¹æ³•åœ¨å“ªä¸ªçº¿ç¨‹ä¸­è¿è¡Œï¼Œå¦‚æœä¼  nil åˆ™ä¼šåœ¨å­çº¿ç¨‹ä¸­è¿è¡Œä»£ç†æ–¹æ³•</span></span><br><span class="line">+ (NSURLSession *)sessionWithConfiguration:(NSURLSessionConfiguration *)configuration delegate:(nullable id &lt;NSURLSessionDelegate&gt;)delegate delegateQueue:(nullable NSOperationQueue *)<span class="built_in">queue</span>;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)sessionDownload &#123;    </span><br><span class="line"><span class="comment">// 1. url    </span></span><br><span class="line">NSURL *url = [NSURL URLWithString:@<span class="string">"http://127.0.0.1/123.mp4"</span>];    </span><br><span class="line"><span class="comment">// 2. ä¸‹è½½    </span></span><br><span class="line"><span class="comment">// è¿›åº¦è·Ÿè¿›ï¼šä»£ç†ï¼Œè‹¹æœçš„å¤´æ–‡ä»¶ä¸­ï¼Œä»£ç†éƒ½æ˜¯å®šä¹‰åœ¨åé¢çš„    </span></span><br><span class="line"><span class="comment">// æ³¨æ„ï¼šå¦‚æœè¦è·Ÿè¿›ä¸‹è½½è¿›åº¦ï¼Œä¸èƒ½ä½¿ç”¨å…¨å±€ä¼šè¯    </span></span><br><span class="line"><span class="comment">// è¿™ä¸ªæ–¹æ³•æ˜¯å’Œä¸‹é¢é‚£ä¸ªæ–¹æ³•æ˜¯çŸ›ç›¾çš„ï¼Œä½¿ç”¨äº†è¿™ä¸ªæ–¹æ³•ä¸‹é¢é‚£ä¸ªå¿…é¡»å®ç°çš„ä»£ç†æ–¹æ³•æ˜¯ä¸èƒ½ä½¿ç”¨çš„    </span></span><br><span class="line"><span class="comment">//    </span></span><br><span class="line">[[self.session downloadTaskWithURL:url completionHandler:^(NSURL *location, NSURLResponse *response, NSError *error) &#123;    </span><br><span class="line">    <span class="comment">//        </span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ˜¯ä¸€ä¸ªå®Œæˆçš„è¾“å‡º    </span></span><br><span class="line">    <span class="comment">//        </span></span><br><span class="line">    NSLog(@<span class="string">"%@ %@"</span>, location.path, [NSThread currentThread]);    </span><br><span class="line">    <span class="comment">//    </span></span><br><span class="line">&#125;] resume];</span><br></pre></td></tr></table></figure><p>è¦æƒ³ä½¿ç”¨ä¸‹é¢çš„ä»£ç†æ–¹æ³•çš„è¯ï¼šç›´æ¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ä¸‹è½½æ•°æ®ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç›´æ¥å¯åŠ¨ä»»åŠ¡ï¼Œå¯ä»¥é€šè¿‡ä»£ç†è·Ÿè¸ªè¿›åº¦    </span></span><br><span class="line">[[self.session downloadTaskWithURL:url] resume];&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯å¿…é¡»å®ç°çš„åè®®æ–¹æ³•ï¼Œè¡¨ç¤ºä¸‹è½½å®Œæˆäº†</p><ul><li>locationè¡¨ç¤ºæ–‡ä»¶å­˜å‚¨çš„è·¯å¾„</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didFinishDownloadingToURL:(NSURL *)location&#123;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯æ–­ç‚¹ç»­ä¼ ï¼Œå¯ä»¥ä»€ä¹ˆéƒ½ä¸å†™ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥å®ç°ä¸‹è½½è·Ÿè¿›çš„</p><p>åœ¨æ¢å¤ä¸‹è½½çš„æ—¶å€™å¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•ï¼š</p><ul><li>fileOffsetè¡¨ç¤ºä»ä»€ä¹ˆåœ°æ–¹å¼€å§‹ä¸‹è½½</li><li>expectedTotalBytesè¡¨ç¤ºæ–‡ä»¶çš„æ€»å¤§å°ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didResumeAtOffset:(<span class="keyword">int64_t</span>)fileOffset expectedTotalBytes:(<span class="keyword">int64_t</span>)expectedTotalBytes&#123;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ–¹æ³•æ˜¯ç”¨æ¥è¿›è¡Œä¸‹è½½è·Ÿè¿›çš„ ï¼Œä¸‹è½½è¿›åº¦çš„è·Ÿè¿›å­˜åœ¨çš„é—®é¢˜ï¼Œå­˜åœ¨ä¸€ä¸ªå³°å€¼çš„é—®é¢˜ã€‚</p><ul><li><p>downloadTask è¡¨ç¤ºä¸‹è½½ä»»åŠ¡</p></li><li><p>bytesWritten è¡¨ç¤ºæœ¬æ¬¡å†™å…¥çš„æ•°æ®å¤§å°</p></li><li><p>totalBytesWritten ä¸‹è½½çš„æ•°æ®æ€»å¤§å°</p></li><li><p>totalBytesExpectedToWrite æ–‡ä»¶çš„æ€»å¤§å°</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didWriteData:(<span class="keyword">int64_t</span>)bytesWritten totalBytesWritten:(<span class="keyword">int64_t</span>)totalBytesWritten totalBytesExpectedToWrite:(<span class="keyword">int64_t</span>)totalBytesExpectedToWrite&#123;    <span class="comment">// ä¸‹è½½çš„è¿›åº¦    </span></span><br><span class="line">    <span class="keyword">float</span> progress = (<span class="keyword">float</span>)totalBytesWritten / totalBytesExpectedToWrite;    </span><br><span class="line">    <span class="comment">// æ‰“å°ä¸‹è½½çš„è¿›åº¦   </span></span><br><span class="line">    NSLog(@<span class="string">"progress = %f"</span>,progress);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="NSURLSessionçš„æ–­ç‚¹ç»­ä¼ é—®é¢˜"><a href="#NSURLSessionçš„æ–­ç‚¹ç»­ä¼ é—®é¢˜" class="headerlink" title="NSURLSessionçš„æ–­ç‚¹ç»­ä¼ é—®é¢˜"></a>NSURLSessionçš„æ–­ç‚¹ç»­ä¼ é—®é¢˜</h4><p>æ–­ç‚¹ç»­ä¼ ä¸»è¦è€ƒè™‘çš„æ˜¯å°†ä¼šè¯æš‚åœç»§ç»­è¿˜æ˜¯å°†ä»»åŠ¡è¿›è¡Œæš‚åœç»§ç»­ã€‚</p><p>NSURLSession æä¾›çš„æ–­ç‚¹ç»­ä¼ å­˜åœ¨çš„é—®é¢˜ï¼Œä¸èƒ½â€åœâ€ï¼Œåº”ç”¨ç¨‹åºä¸èƒ½ç»ˆæ­¢ï¼Œä¸€æ—¦ç»ˆæ­¢ï¼Œç»­ä¼ æ•°æ®å°±ä¸¢å¤±äº†ï¼Œä¸‹æ¬¡è¿˜éœ€è¦é‡å¤´å†æ¥ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, strong) NSURLSession *session;<span class="comment">/// ä¸‹è½½ä»»åŠ¡</span></span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) NSURLSessionDownloadTask *task;<span class="comment">/// ç»­ä¼ æ•°æ®</span></span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨ä¸‹è½½ä»»åŠ¡</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (IBAction)start &#123;</span><br><span class="line"><span class="comment">// 1. url    </span></span><br><span class="line">    NSURL *url = [NSURL URLWithString:@<span class="string">"http://dldir1.qq.com/qqfile/QQforMac/QQ_V4.0.2.dmg"</span>];</span><br><span class="line">    <span class="comment">// å‘èµ·ä¸‹è½½ä¼šè¯   </span></span><br><span class="line">self.task = [self.session downloadTaskWithURL:url]; </span><br><span class="line"> <span class="comment">// å¯åŠ¨ä»»åŠ¡</span></span><br><span class="line">[self.task resume]; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æš‚åœä¸‹è½½ä»»åŠ¡</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// æš‚åœ ï¼ ä¸‹è½½ä»»åŠ¡</span></span><br><span class="line">- (IBAction)pause &#123;    </span><br><span class="line">    NSLog(@<span class="string">"æš‚åœ"</span>);    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨éœ€è¦ç»­ä¼ çš„æ•°æ®ï¼Œæš‚åœä¸‹è½½ä»»åŠ¡    </span></span><br><span class="line">    <span class="comment">// æš‚åœæ–¹æ³•ï¼Œåªéœ€è¦æ‰§è¡Œä¸€æ¬¡ï¼Œè¢«æš‚åœå°±ä¸ç”¨å†æ¬¡æš‚åœ    </span></span><br><span class="line">    <span class="comment">/**     1. æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ˜¯ç”±ä¼šè¯å‘èµ·çš„     </span></span><br><span class="line"><span class="comment">    2. å½“ä»»åŠ¡å¯åŠ¨åï¼Œä¼šè¯ä¼šå¯¹ä»»åŠ¡è¿›è¡Œå¼ºå¼•ç”¨     </span></span><br><span class="line"><span class="comment">    3. ä¸€æ—¦ä»»åŠ¡è¢«å–æ¶ˆï¼Œæ„å‘³ç€ä¼šè¯ä¸å†å¼•ç”¨ä»»åŠ¡ï¼Œä¸€ä¸ª weak å¯¹è±¡æ²¡æœ‰å…¶ä»–å¯¹è±¡å¼ºå¼•ç”¨ï¼Œä¼šè¢«ç«‹å³é‡Šæ”¾     </span></span><br><span class="line"><span class="comment">    4. å¦‚æœå±æ€§ æ˜¯ strongï¼Œé™¤äº†ä¼šè¯ä¹‹å¤–ï¼ŒvcåŒæ ·å¯¹ä»»åŠ¡å¼ºå¼•ç”¨ï¼ˆsession ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¼ºå¼•ç”¨ï¼‰     </span></span><br><span class="line"><span class="comment">    */</span>     </span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ˜¯å–æ¶ˆä¸‹è½½ä»»åŠ¡ ï¼ˆè¾¾åˆ°æš‚åœçš„ç›®çš„ï¼‰    </span></span><br><span class="line">    [self.task cancelByProducingResumeData:^(NSData *resumeData) &#123;        </span><br><span class="line">        NSLog(@<span class="string">"---&gt; %tu"</span>, resumeData);        </span><br><span class="line">        <span class="comment">// è®°å½•ç»­ä¼ æ•°æ®        </span></span><br><span class="line">        self.resumeData = resumeData; </span><br><span class="line">        <span class="comment">// å°†æš‚åœæ—¶å€™çš„æ•°æ®ä¿å­˜èµ·æ¥ï¼ˆå¦‚æœä¸ä¿å­˜ä¸‹æ¬¡å¯åŠ¨çš„æ—¶å€™æ˜¯æ²¡æœ‰æ•°æ®çš„ï¼‰        </span></span><br><span class="line">        <span class="comment">// é‡Šæ”¾äº†ä¸‹è½½ä»»åŠ¡        </span></span><br><span class="line">        self.task = nil; </span><br><span class="line">        <span class="comment">// å°†ä¸‹è½½ä»»åŠ¡é‡Šæ”¾é¿å…å¤šæ¬¡æš‚åœçš„é—®é¢˜    </span></span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»§ç»­ä¸‹è½½ä»»åŠ¡</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (IBAction)resume &#123;    </span><br><span class="line">    <span class="comment">// éœ€è¦é¿å…ä¸‹è½½ä»»åŠ¡é‡å¤åˆ›å»º    </span></span><br><span class="line">    <span class="keyword">if</span> (self.resumeData == nil) &#123;        </span><br><span class="line">        NSLog(@<span class="string">"æ²¡æœ‰ç»­ä¼ æ•°æ®"</span>);        </span><br><span class="line">        <span class="keyword">return</span>;    </span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨ç»­ä¼ æ•°æ®ï¼Œé‡æ–°å®ä¾‹åŒ–ä¸‹è½½ä»»åŠ¡    </span></span><br><span class="line">    <span class="comment">// ä¸€æ—¦ç»­ä¼ çš„ä¸‹è½½ä»»åŠ¡è¢«å»ºç«‹ä¹‹åï¼Œç»­ä¼ æ•°æ®å°±æ²¡æœ‰ç”¨äº†ï¼    </span></span><br><span class="line">    self.task = [self.session downloadTaskWithResumeData:self.resumeData];    self.resumeData = nil;    </span><br><span class="line">    [self.task resume];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;æä¾›çš„åŠŸèƒ½&quot;&gt;&lt;a href=&quot;#æä¾›çš„åŠŸèƒ½&quot; class=&quot;headerlink&quot; title=&quot;æä¾›çš„åŠŸèƒ½&quot;&gt;&lt;/a&gt;æä¾›çš„åŠŸèƒ½&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;é€šè¿‡URLå°†æ•°æ®ä¸‹è½½åˆ°å†…å­˜&lt;/li&gt;
&lt;li&gt;é€šè¿‡URLå°†æ•°æ®ä¸‹è½½åˆ°æ–‡ä»¶ç³»ç»Ÿ&lt;/li&gt;
&lt;li&gt;å°†æ•°æ®ä¸Šä¼ åˆ°æŒ‡å®šçš„URL&lt;/li&gt;
&lt;li&gt;åœ¨åå°å®Œæˆä¸Šè¿°æ“ä½œ(æ”¯æŒåå°ç½‘ç»œæ“ä½œï¼Œé™¤éç”¨æˆ·å¼ºè¡Œå…³é—­åº”ç”¨ç¨‹åº)&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS-autoreleasePoolçš„å®ç°</title>
    <link href="http://yoursite.com/2019/07/11/iOS-autoreleasePool%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
    <id>http://yoursite.com/2019/07/11/iOS-autoreleasePoolçš„å®ç°/</id>
    <published>2019-07-10T16:14:23.000Z</published>
    <updated>2019-07-10T16:14:58.017Z</updated>
    
    <content type="html"><![CDATA[<ul><li>æ¯ä¸€ä¸ªçº¿ç¨‹çš„autoreleaseå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„å †æ ˆã€‚</li><li>æ¯ä¸€ä¸ªæŒ‡é’ˆä»£è¡¨ä¸€ä¸ªè¦releaseçš„å¯¹è±¡æˆ–è€…æ˜¯POOL_SENTINEL(å“¨å…µå¯¹è±¡ï¼Œä»£è¡¨ä¸€ä¸ªautoreleaseçš„è¾¹ç•Œï¼Œé‡Šæ”¾ä¸€ä¸ªautorelease pooléœ€è¦å°†å“¨å…µå¯¹è±¡åçš„æ‰€æœ‰releaseèŠ‚ç‚¹å¯¹è±¡é‡Šæ”¾)ã€‚</li><li>æ¯ä¸€ä¸ªpool tokenä»£è¡¨çš„å°±æ˜¯è¿™ä¸ªpoolæ‰€å¯¹åº”çš„POOL_SENTINELçš„ç»“ç‚¹çš„å†…å­˜ä½ç½®ï¼Œå½“è¿™ä¸ªpoolè¢«popåï¼Œè¿™ä¸ªtokenåçš„æ‰€æœ‰çš„ç»“ç‚¹å¯¹åº”çš„å¯¹è±¡å†…å­˜éƒ½ä¼šè¢«é‡Šæ”¾ã€‚</li></ul><a id="more"></a><ul><li>autoreleasePoolçš„å®ç°æ˜¯é€šè¿‡AutoreleasePageç»“ç‚¹å®ç°çš„()</li><li>è¿™ä¸ªå †æ ˆè¢«åˆ’åˆ†æˆäº†ä¸€ä¸ªä»¥pageä¸ºç»“ç‚¹çš„åŒå‘é“¾è¡¨ã€‚pagesä¼šåœ¨å¿…è¦çš„æ—¶å€™åŠ¨æ€å¢åŠ æˆ–è€…åˆ é™¤</li><li>Thread_local storageï¼ˆçº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼‰æŒ‡å‘hot pageï¼Œå³æœ€æ–°æ·»åŠ çš„autoreleasedå¯¹è±¡æ‰€åœ¨çš„é‚£ä¸ªpageã€‚</li></ul><p><strong>AutoreleasePoolPageå†…å­˜ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/20190531153033843.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ol><li><p>magic ç”¨æ¥æ ¡éªŒ AutoreleasePoolPage çš„ç»“æ„æ˜¯å¦å®Œæ•´ï¼›</p></li><li><p>next æŒ‡å‘æœ€æ–°æ·»åŠ çš„ autoreleased å¯¹è±¡çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œåˆå§‹åŒ–æ—¶æŒ‡å‘ begin() ï¼›</p></li><li><p>thread æŒ‡å‘å½“å‰çº¿ç¨‹ï¼›</p></li><li><p>parent æŒ‡å‘çˆ¶ç»“ç‚¹ï¼Œç¬¬ä¸€ä¸ªç»“ç‚¹çš„ parent å€¼ä¸º nil ï¼›</p></li><li><p>child æŒ‡å‘å­ç»“ç‚¹ï¼Œæœ€åä¸€ä¸ªç»“ç‚¹çš„ child å€¼ä¸º nil ï¼›</p></li><li><p>depth ä»£è¡¨æ·±åº¦ï¼Œä» 0 å¼€å§‹ï¼Œå¾€åé€’å¢ 1ï¼›</p></li><li><p>hiwat ä»£è¡¨ high water mark ã€‚</p></li><li><p>å½“ next == begin() æ—¶ï¼Œè¡¨ç¤º AutoreleasePoolPage ä¸ºç©ºï¼›å½“ next == end() æ—¶ï¼Œè¡¨ç¤º AutoreleasePoolPage å·²æ»¡ã€‚æ­¤æ—¶å†åˆ›å»ºä¸€ä¸ªAutoreleasePoolPageç»“ç‚¹ã€‚</p></li></ol><p>poolé€šè¿‡ <strong>push</strong> å’Œ <strong>pop</strong> æ“ä½œæ¥æ·»åŠ autoreleasepoolå’Œç§»é™¤autoreleasepoolï¼š</p><ul><li>pushæ“ä½œå®é™…å°±æ˜¯å‰nextæŒ‡é’ˆæ·»åŠ ä¸€ä¸ªå“¨å…µï¼Œç„¶åå†å¾€å“¨å…µçš„nextåæ·»åŠ è¿™ä¸ªpoolè¦releaseçš„å¯¹è±¡ã€‚</li><li>popæ“ä½œä¼šå°†å†…å­˜åœ°å€åœ¨ pool token ä¹‹åçš„æ‰€æœ‰ autoreleased å¯¹è±¡éƒ½ä¼šè¢« release ã€‚ç›´åˆ° pool token æ‰€åœ¨ page çš„ next æŒ‡å‘ pool token ä¸ºæ­¢ã€‚</li></ul><p><img src="https://img-blog.csdnimg.cn/20190531153041580.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ­¤æ—¶ï¼Œå¦‚æœæ‰§è¡Œ pop(token1) æ“ä½œï¼Œé‚£ä¹ˆè¯¥ autoreleasepool å †æ ˆçš„å†…å­˜ç»“æ„å°†ä¼šå˜æˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://img-blog.csdnimg.cn/20190531153049554.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è½¬è½½è‡ªï¼š<a href="http://www.cocoachina.com/ios/20150610/12093.html" target="_blank" rel="noopener">http://www.cocoachina.com/ios/20150610/12093.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;æ¯ä¸€ä¸ªçº¿ç¨‹çš„autoreleaseå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„å †æ ˆã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸€ä¸ªæŒ‡é’ˆä»£è¡¨ä¸€ä¸ªè¦releaseçš„å¯¹è±¡æˆ–è€…æ˜¯POOL_SENTINEL(å“¨å…µå¯¹è±¡ï¼Œä»£è¡¨ä¸€ä¸ªautoreleaseçš„è¾¹ç•Œï¼Œé‡Šæ”¾ä¸€ä¸ªautorelease pooléœ€è¦å°†å“¨å…µå¯¹è±¡åçš„æ‰€æœ‰releaseèŠ‚ç‚¹å¯¹è±¡é‡Šæ”¾)ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸€ä¸ªpool tokenä»£è¡¨çš„å°±æ˜¯è¿™ä¸ªpoolæ‰€å¯¹åº”çš„POOL_SENTINELçš„ç»“ç‚¹çš„å†…å­˜ä½ç½®ï¼Œå½“è¿™ä¸ªpoolè¢«popåï¼Œè¿™ä¸ªtokenåçš„æ‰€æœ‰çš„ç»“ç‚¹å¯¹åº”çš„å¯¹è±¡å†…å­˜éƒ½ä¼šè¢«é‡Šæ”¾ã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS || å†…å­˜ç®¡ç†(MRCå’ŒARCçš„åŒºåˆ«ä»¥åŠå®ç°)</title>
    <link href="http://yoursite.com/2019/07/11/iOS-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86-MRC%E5%92%8CARC%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%A5%E5%8F%8A%E5%AE%9E%E7%8E%B0/"/>
    <id>http://yoursite.com/2019/07/11/iOS-å†…å­˜ç®¡ç†-MRCå’ŒARCçš„åŒºåˆ«ä»¥åŠå®ç°/</id>
    <published>2019-07-10T16:07:14.000Z</published>
    <updated>2019-07-10T16:10:53.375Z</updated>
    
    <content type="html"><![CDATA[<p>è‡ªåŠ¨å¼•ç”¨è®¡æ•°(ARC)æ˜¯æŒ‡å†…å­˜ç®¡ç†ä¸­å¯¹å¼•ç”¨é‡‡å–è‡ªåŠ¨è®¡æ•°çš„æŠ€æœ¯ã€‚</p><p>ä½¿ç”¨ARCï¼Œå°±æ— éœ€å†æ¬¡é”®å…¥retainæˆ–è€…releaseä»£ç ï¼Œè¿™é™ä½äº†ç¨‹åºå´©æºƒï¼Œå†…å­˜æ³„æ¼ç­‰é£é™©çš„åŒæ—¶ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº†å¼€å‘ç¨‹åºçš„å·¥ä½œé‡ã€‚ARCæŠ€æœ¯ä½¿å¾—ç¼–è¯‘å™¨æ¸…æ¥šç›®æ ‡å¯¹è±¡ï¼Œå¹¶èƒ½ç«‹åˆ»é‡Šæ”¾é‚£äº›ä¸å†è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œåº”ç”¨ç¨‹åºå°†å…·æœ‰å¯é¢„æµ‹æ€§ï¼Œä¸”èƒ½æµç•…è¿è¡Œï¼Œé€Ÿåº¦ä¹Ÿå°†å¤§å¹…æå‡ã€‚</p><a id="more"></a><h2 id="MRC"><a href="#MRC" class="headerlink" title="MRC"></a>MRC</h2><p>äººå·¥å¼•ç”¨è®¡æ•°ï¼ˆManual Reference Countingï¼‰</p><h3 id="å†…å­˜ç®¡ç†çš„æ€è€ƒæ–¹å¼ï¼š"><a href="#å†…å­˜ç®¡ç†çš„æ€è€ƒæ–¹å¼ï¼š" class="headerlink" title="å†…å­˜ç®¡ç†çš„æ€è€ƒæ–¹å¼ï¼š"></a>å†…å­˜ç®¡ç†çš„æ€è€ƒæ–¹å¼ï¼š</h3><ul><li>è‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±æŒæœ‰</li><li>éè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰</li><li>ä¸éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾</li><li>æ— æ³•é‡Šæ”¾éè‡ªå·±æŒæœ‰çš„å¯¹è±¡</li></ul><table><thead><tr><th align="center">å¯¹è±¡æ“ä½œ</th><th align="center">ocæ–¹æ³•</th></tr></thead><tbody><tr><td align="center">ç”Ÿæˆå¹¶æŒæœ‰å¯¹è±¡</td><td align="center">alloc/new/copy/mutableCopy ç­‰æ–¹æ³•</td></tr><tr><td align="center">æŒæœ‰å¯¹è±¡</td><td align="center">retain æ–¹æ³•</td></tr><tr><td align="center">é‡Šæ”¾å¯¹è±¡</td><td align="center">release æ–¹æ³•</td></tr><tr><td align="center">åºŸå¼ƒå¯¹è±¡</td><td align="center">dealloc æ–¹æ³•</td></tr></tbody></table><h5 id="è‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±æŒæœ‰"><a href="#è‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±æŒæœ‰" class="headerlink" title="è‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±æŒæœ‰"></a>è‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±æŒæœ‰</h5><ul><li>alloc</li><li>new</li><li>copy</li><li>mutablecopy</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id obj = [[NSObject alloc] init];</span><br><span class="line">id obj = [NSObject <span class="keyword">new</span>];</span><br><span class="line"><span class="comment">// ä¸¤è€…å®Œå…¨ä¸€è‡´ï¼Œç”Ÿæˆå¹¶æŒæœ‰å¯¹è±¡</span></span><br></pre></td></tr></table></figure><p>// NSCopyingå’ŒNSMutableCopying</p><h5 id="éè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰"><a href="#éè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰" class="headerlink" title="éè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰"></a>éè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id obj = [NSMutableArray <span class="built_in">array</span>];</span><br><span class="line"><span class="comment">// å–å¾—çš„å¯¹è±¡å­˜åœ¨ï¼Œä½†è‡ªå·±ä¸æŒæœ‰</span></span><br><span class="line">[obj retain];</span><br><span class="line"><span class="comment">// è‡ªå·±æŒæœ‰å¯¹è±¡</span></span><br></pre></td></tr></table></figure><h5 id="ä¸å†éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾"><a href="#ä¸å†éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾" class="headerlink" title="ä¸å†éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾"></a>ä¸å†éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾</h5><p>è‡ªå·±æŒæœ‰çš„å¯¹è±¡ï¼Œä¸€æ—¦ä¸å†éœ€è¦ï¼ŒæŒæœ‰è€…æœ‰ä¹‰åŠ¡é‡Šæ”¾è¯¥å¯¹è±¡ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">id obj = [NSMutableArray <span class="built_in">array</span>];</span><br><span class="line"><span class="comment">// å–å¾—çš„å¯¹è±¡å­˜åœ¨ï¼Œä½†è‡ªå·±ä¸æŒæœ‰</span></span><br><span class="line">[obj retain];</span><br><span class="line"><span class="comment">// è‡ªå·±æŒæœ‰å¯¹è±¡</span></span><br><span class="line">[obj release];</span><br><span class="line"><span class="comment">// é‡Šæ”¾å¯¹è±¡</span></span><br><span class="line"><span class="comment">// å¯¹è±¡ä¸å¯å†è¢«è®¿é—®</span></span><br></pre></td></tr></table></figure><p>arrayæ–¹æ³•çš„å®ç°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (id) object</span><br><span class="line">&#123;</span><br><span class="line">id obj = [[NSObject alloc] init];</span><br><span class="line"><span class="comment">// è‡ªå·±æŒæœ‰å¯¹è±¡</span></span><br><span class="line">[obj autorelease];</span><br><span class="line"><span class="comment">// é‡Šæ”¾åå–å¾—çš„å¯¹è±¡å­˜åœ¨ï¼Œä½†è‡ªå·±ä¸æŒæœ‰è¯¥å¯¹è±¡</span></span><br><span class="line"><span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>releaseæ–¹æ³•æ—¶è°ƒç”¨åç«‹å³é‡Šæ”¾ï¼Œè€Œautoreleaseæ–¹æ³•åˆ™æ˜¯ä¸ç«‹å³é‡Šæ”¾è€Œæ˜¯æ³¨å†Œåˆ°autoreleasepoolä¸­ï¼Œåœ¨è¶…å‡ºæŒ‡å®šçš„ç”Ÿå­˜èŒƒå›´æ—¶èƒ½å¤Ÿè‡ªåŠ¨å¹¶æ­£ç¡®é‡Šæ”¾(è°ƒç”¨release)ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id obj1 = [obj0 object];</span><br><span class="line"><span class="comment">// å–å¾—å¯¹è±¡å­˜åœ¨ä½†ä¸æŒæœ‰</span></span><br><span class="line">[obj1 retain];</span><br><span class="line"><span class="comment">// è‡ªå·±æŒæœ‰å¯¹è±¡</span></span><br></pre></td></tr></table></figure><h5 id="æ— æ³•é‡Šæ”¾éè‡ªå·±æŒæœ‰çš„å¯¹è±¡"><a href="#æ— æ³•é‡Šæ”¾éè‡ªå·±æŒæœ‰çš„å¯¹è±¡" class="headerlink" title="æ— æ³•é‡Šæ”¾éè‡ªå·±æŒæœ‰çš„å¯¹è±¡"></a>æ— æ³•é‡Šæ”¾éè‡ªå·±æŒæœ‰çš„å¯¹è±¡</h5><ul><li>å·²ç»é‡Šæ”¾è¿‡çš„å¯¹è±¡å†ä¸€æ¬¡é‡Šæ”¾ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id obj = [NSObject alloc] init];</span><br><span class="line">[obj release];</span><br><span class="line">[obj release];</span><br></pre></td></tr></table></figure><ul><li>è‡ªå·±è¿˜æœªæŒæœ‰çš„å¯¹è±¡è¿›è¡Œé‡Šæ”¾</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id obj1 = [obj0 object];</span><br><span class="line">[obj1 release];</span><br></pre></td></tr></table></figure><h3 id="alloc-retain-release-deallocçš„å®ç°"><a href="#alloc-retain-release-deallocçš„å®ç°" class="headerlink" title="alloc/retain/release/deallocçš„å®ç°"></a>alloc/retain/release/deallocçš„å®ç°</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">id obj = [NSObject alloc];</span><br><span class="line">+(id)alloc</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> [self allocWithZone: NSDefaultMallocZone()];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+(id)allocWithZone:(NSZone*)z</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> NSAllocateObject(self, <span class="number">0</span>, z);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">obj_layout</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    NSUInteger retained;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> id <span class="title">NSAllocateObject</span> <span class="params">(Class aClass, NSUInteger extraBytes, NSZone *zone)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> size = è®¡ç®—å®¹çº³å¯¹è±¡æ‰€éœ€å†…å­˜å¤§å°;</span><br><span class="line">    id <span class="keyword">new</span> = NSZoneMalloc(zone, self);</span><br><span class="line">    <span class="built_in">memset</span>(<span class="keyword">new</span>, o, size);</span><br><span class="line">    <span class="keyword">new</span> = (id)&amp;((struct obj_layput *)<span class="keyword">new</span>)[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>NSDefaultMallocZoneå’ŒNSZoneMallocä¸­åŒ…å«çš„NSZoneæ—¶é˜²æ­¢å†…å­˜ç¢ç‰‡åŒ–è€Œå¼•å…¥çš„ç»“æ„ï¼Œå¯¹å†…å­˜åˆ†é…çš„åŒºåŸŸæœ¬èº«è¿›è¡Œå¤šé‡åŒ–ç®¡ç†ï¼Œæ ¹æ®ä½¿ç”¨å¯¹è±¡çš„ç›®çš„ï¼Œå¯¹è±¡çš„å¤§å°åˆ†é…å†…å­˜ï¼Œä»è€Œæé«˜äº†å†…å­˜ç®¡ç†çš„æ•ˆç‡ã€‚</p><p>å»æ‰NSZoneåä»£ç ç®€åŒ–ç‰ˆ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">obj_layout</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    NSUInteger retained;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">+(id) alloc</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> size = <span class="keyword">sizeof</span>(struct obj_layout) + å¯¹è±¡å¤§å°;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">obj_layout</span> *<span class="title">p</span> = (<span class="title">struct</span> <span class="title">obj_layout</span> *)<span class="title">calloc</span>(1, <span class="title">size</span>);</span></span><br><span class="line"><span class="keyword">return</span> (id)(p+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•ä¸­çš„retainæ•´æ•°ç”¨æ¥ä¿æŒå¼•ç”¨è®¡æ•°å¹¶å°†å…¶å†™å…¥å¯¹è±¡å†…å­˜å¤´éƒ¨ã€‚</p><p>å¯¹è±¡çš„å¼•ç”¨è®¡æ•°é€šè¿‡retainCountæ¥å®ç°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">id obj = [[NSObject alloc] init];</span><br><span class="line">[obj retainCount];</span><br><span class="line"></span><br><span class="line">- (NSUInteger)retainCount</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> NSExtraRefCount(self) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> NSUInteger <span class="title">NSExtraRefCount</span><span class="params">(id anObject)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ((struct obj_layout *)anObject)[<span class="number">-1</span>].retained;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é€šè¿‡retainæ–¹æ³•å¯ä½¿retainedå˜é‡åŠ 1ï¼Œé€šè¿‡releaseæ–¹æ³•å¯ä½¿retainedå˜é‡å‡1</strong></p><p>retainæ–¹æ³•çš„å®ç°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-(id)retain</span><br><span class="line">&#123;</span><br><span class="line">NSIncrementExtraRefCount(self);</span><br><span class="line"><span class="keyword">return</span> self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">NSIncrementExtraRefCount</span><span class="params">(id anObject)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (((struct obj_layout *) anObject)[<span class="number">-1</span>].retained == UINT_MAX - <span class="number">1</span>)</span><br><span class="line">        [NSException raise: NSInternalInconsistencyException format: @<span class="string">"....."</span>];</span><br><span class="line">    ((struct obj_layout *) anObject)[<span class="number">-1</span>].retained++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>releaseæ–¹æ³•çš„å®ç°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)release</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (NSDecrementExtraRefCountWasZero(self))</span><br><span class="line">[self dealloc];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">NSDecrementExtraRefCountWasZero</span> <span class="params">(id anObject)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ((struct obj_layout *) anObject)[<span class="number">-1</span>].retained == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> YES;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        ((struct obj_layout *)anObject)[<span class="number">-1</span>].retained--;</span><br><span class="line">        <span class="keyword">return</span> NO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>deallocæ–¹æ³•çš„å®ç°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)dealloc</span><br><span class="line">&#123;</span><br><span class="line">NSDeallocateObject(self);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">NSDeallocateObject</span> <span class="params">(id anObject)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">obj_layout</span> *<span class="title">o</span> = &amp;((<span class="title">struct</span> <span class="title">obj_layout</span> *) <span class="title">anObject</span>)[-1];</span></span><br><span class="line">    <span class="built_in">free</span>(o);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åºŸå¼ƒallocåˆ†é…çš„å†…å­˜å—</span></span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šè‹¹æœæ˜¯é€šè¿‡æ•£åˆ—è¡¨çš„å½¢å¼å®ç°å¼•ç”¨è®¡æ•°çš„ï¼Œæ•£åˆ—è¡¨çš„é”®å€¼ä¸ºå†…å­˜å—åœ°å€çš„æ•£åˆ—å€¼ã€‚</p><p>æ•£åˆ—è¡¨å­˜å‚¨ä¿¡æ¯ä¸ºå¼•ç”¨è®¡æ•°ä»¥åŠå†…å­˜å—åœ°å€ã€‚</p><h3 id="autorelease"><a href="#autorelease" class="headerlink" title="autorelease"></a>autorelease</h3><p>autoreleaseä¼šç±»ä¼¼cè¯­è¨€ä¸­çš„è‡ªåŠ¨å˜é‡æ¥å¯¹å¾…å¯¹è±¡å®ä¾‹ï¼Œè¶…å‡ºä½œç”¨åŸŸæ—¶åˆ™å°†å¯¹è±¡é‡Šæ”¾ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>autoreleaseå°±æ˜¯ç±»ä¼¼ <code>{ }</code> çš„ä½œç”¨ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><ul><li>ç”Ÿæˆå¹¶æŒæœ‰NSAutoreleasePoolå¯¹è±¡</li><li>è°ƒç”¨å·²åˆ†é…å¯¹è±¡çš„autoreleaseå®ä¾‹æ–¹æ³•ã€‚</li><li>åºŸå¼ƒNSAutoreleasePoolå¯¹è±¡ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];</span><br><span class="line">id obj = [[NSObject alloc] init];</span><br><span class="line">[obj autorelease];</span><br><span class="line">[pool drain]; <span class="comment">//ç­‰åŒäº[obj release]</span></span><br></pre></td></tr></table></figure><p>åœ¨Cocoaæ¡†æ¶ä¸­ï¼Œç›¸å½“äºç¨‹åºä¸»å¾ªç¯çš„NSRunLoopæˆ–è€…åœ¨å…¶ä»–ç¨‹åºå¯è¿è¡Œçš„åœ°æ–¹ï¼Œå¯¹NSAutoreleasePool å¯¹è±¡è¿›è¡Œç”Ÿæˆã€æŒæœ‰å’ŒåºŸå¼ƒå¤„ç†ã€‚å› æ­¤å¼€å‘è€…ä¸ä¸€å®šéå¾—ä½¿ç”¨NSAutoreleasePoolå¯¹è±¡æ¥è¿›è¡Œå¼€å‘å·¥ä½œã€‚</p><p>ä½†æ˜¯åœ¨å¤§é‡äº§ç”Ÿautoreleaseå¯¹è±¡æ—¶ï¼Œåªæœ‰ä¸åºŸå¼ƒNSAutoreleasePoolå¯¹è±¡ï¼Œé‚£ä¹ˆç”Ÿæˆçš„å¯¹è±¡å°±ä¸èƒ½è¢«é‡Šæ”¾ï¼Œå› æ­¤å¯èƒ½å‡ºç°å†…å­˜ä¸è¶³çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; å›¾åƒæ•°; ++i)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * è¯»å…¥å›¾åƒ</span></span><br><span class="line"><span class="comment">     * å¤§é‡äº§ç”Ÿautoreleaseå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * æ²¡æœ‰åºŸå¼ƒNSAutoreleasePool å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * å¯¼è‡´æœ€ç»ˆå†…å­˜ä¸è¶³</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    [pool drain];</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * é€šè¿‡drainæ–¹æ³•autoreleaseå¯¹è±¡è¢«release</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Cocoaæ¡†æ¶ä¸­ä¹Ÿæœ‰å¾ˆå¤šç±»æ–¹æ³•è¿”å›autoreleaseå¯¹è±¡ï¼Œæ¯”å¦‚NSMutableArrayç±»çš„arrayWithCapacityç±»æ–¹æ³•ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id <span class="built_in">array</span> = [NSMutableArray arrayWithCapacity:<span class="number">1</span>];</span><br></pre></td></tr></table></figure><p>ç­‰åŒäº</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id <span class="built_in">array</span> = [[[NSMutableArray alloc] initWithCapacity:<span class="number">1</span>] autorelease];</span><br></pre></td></tr></table></figure><h4 id="autoreleaseçš„å®ç°"><a href="#autoreleaseçš„å®ç°" class="headerlink" title="autoreleaseçš„å®ç°"></a>autoreleaseçš„å®ç°</h4><p><code>[obj autorelease]</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-(id)autorelease</span><br><span class="line">&#123;</span><br><span class="line">[NSAutoreleasePool addObject:self];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+(<span class="keyword">void</span>)addObject:(id)anObj</span><br><span class="line">&#123;</span><br><span class="line">NSAutorelease *pool = å–å¾—æ­£åœ¨ä½¿ç”¨çš„NSAutoreleaseå¯¹è±¡;</span><br><span class="line"><span class="keyword">if</span> (pool != nil)</span><br><span class="line">    &#123;</span><br><span class="line">    [pool addObject:anObj];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    NSLog(@<span class="string">"AutoreleasePool å¯¹è±¡éå­˜åœ¨çŠ¶æ€ä¸‹è°ƒç”¨"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœåµŒå¥—ç”Ÿæˆæˆ–æŒæœ‰å¤šä¸ªNSAutoreleasePoolå¯¹è±¡ï¼Œåˆ™ä¼šä½¿ç”¨æœ€å†…ä¾§çš„å¯¹è±¡ã€‚</p><p><code>[pool drain]</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drain</span><br><span class="line">&#123;</span><br><span class="line">[self dealloc];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) dealloc</span><br><span class="line">&#123;</span><br><span class="line">[self emptyPool];</span><br><span class="line">[<span class="built_in">array</span> release];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) emtpyPool</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (id obj in <span class="built_in">array</span>)</span><br><span class="line">    &#123;</span><br><span class="line">    [obj release];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    </p><h2 id="ARC"><a href="#ARC" class="headerlink" title="ARC"></a>ARC</h2><p>ä¸MRCçš„å¼•ç”¨è®¡æ•°å¼å†…å­˜ç®¡ç†åœ¨æœ¬è´¨ä¸Šæ²¡æœ‰å¤ªå¤§å˜åŒ–ï¼Œåªæ˜¯è‡ªåŠ¨å¸®æˆ‘ä»¬å¤„ç†å¼•ç”¨è®¡æ•°çš„éƒ¨åˆ†ã€‚</p><p>é€šè¿‡__strongä¿®é¥°ç¬¦å¯ä»¥ä¸å¿…å†æ¬¡é”®å…¥retainæˆ–è€…releaseï¼Œè‡ªåŠ¨åœ°å®ç°äº†ä¸Šè¿°çš„å››ç§å†…å­˜ç®¡ç†æ€è€ƒæ–¹å¼ã€‚</p><p>ä½†å¼•ç”¨è®¡æ•°å¼å†…å­˜ç®¡ç†ä¼šå‘ç”Ÿâ€å¾ªç¯å¼•ç”¨â€çš„é—®é¢˜ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    id test0 = [[Test alloc] init]; <span class="comment">/* å¯¹è±¡A */</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * test0 æŒæœ‰Testå¯¹è±¡Açš„å¼ºå¼•ç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    </span><br><span class="line">    id test1 = [[Test alloc] init]; <span class="comment">/* å¯¹è±¡B */</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * test1 æŒæœ‰Testå¯¹è±¡Bçš„å¼ºå¼•ç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    [test0 setObject:test1];</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * æ­¤æ—¶æŒæœ‰Testå¯¹è±¡Bçš„å¼ºå¼•ç”¨å˜é‡ä¸ºtest1å’Œå¯¹è±¡Açš„obj_æˆå‘˜å˜é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    [test1 setObject:test0];</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * æ­¤æ—¶æŒæœ‰Testå¯¹è±¡Açš„å¼ºå¼•ç”¨å˜é‡ä¸ºtest0å’Œå¯¹è±¡Bçš„_objå˜é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* å› ä¸ºtest0å˜é‡è¶…å‡ºå…¶ä½œç”¨åŸŸï¼Œå¼ºå¼•ç”¨å¤±æ•ˆï¼Œæ‰€ä»¥è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡A</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* å› ä¸ºtest1å˜é‡è¶…å‡ºå…¶ä½œç”¨åŸŸï¼Œå¼ºå¼•ç”¨å¤±æ•ˆï¼Œæ‰€ä»¥è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡B</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* æ­¤æ—¶æŒæœ‰å¯¹è±¡Açš„å¼ºå¼•ç”¨å˜é‡ä¸ºå¯¹è±¡Bçš„_objï¼ŒæŒæœ‰å¯¹è±¡Bçš„å¼ºå¼•ç”¨å˜é‡ä¸ºå¯¹è±¡Açš„_obj</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* å‘ç”Ÿå†…å­˜æ³„æ¼ï¼(åº”å½“åºŸå¼ƒçš„å¯¹è±¡åœ¨è¶…å‡ºå…¶ç”Ÿå‘½å‘¨æœŸåä¾ç„¶å­˜åœ¨)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>åŒæ—¶åƒä¸‹é¢çš„æƒ…å†µï¼Œè™½ç„¶åªæœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œä½†å¯¹è±¡æŒæœ‰å…¶è‡ªèº«æ—¶ä¹Ÿä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id test = [[Test alloc] init];</span><br><span class="line">[test setObject:test];</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¼±å¼•ç”¨__weakå¯ä»¥å®ç°ï¼Œå¼±å¼•ç”¨ä¸æŒæœ‰å¯¹è±¡ï¼Œåªæ˜¯æŒæœ‰è¯¥å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼Œå¦‚æœè¯¥å¯¹è±¡çš„æ‰€æœ‰å¼ºæŒæœ‰è€…éƒ½é‡Šæ”¾ï¼Œåˆ™å¯¹è±¡åºŸå¼ƒï¼Œå³ä½¿æ­¤æ—¶ä»æœ‰å¼±æŒæœ‰è€…ã€‚</p><p> _unsafe_unretained å’Œweakçš„ä¸åŒä¹‹å¤„åœ¨äºå‰è€…åœ¨èµ‹å€¼ç»™å¸¦æœ‰strongä¿®é¥°ç¬¦çš„å˜é‡å¿…é¡»ç¡®ä¿è¢«èµ‹å€¼å¯¹è±¡ç¡®å®å­˜åœ¨ï¼Œä¸ç„¶å…¶ä¸ä¼šåƒweakä¸€æ ·è¢«è®¾ç½®ä¸ºnilè€Œæ˜¯é€ æˆæ‚¬æµ®æŒ‡é’ˆã€‚(å­˜åœ¨æ˜¯å†å²é—ç•™é—®é¢˜ï¼Œæœ‰äº†weakååŸºæœ¬ä¸ç”¨å®ƒäº†)</p><p>strongä¿®é¥°ç¬¦ç±»ä¼¼äºc++ä¸­çš„std::shared_ptræŒ‡é’ˆï¼Œè€Œweakä¿®é¥°ç¬¦ç±»ä¼¼äºc++ä¸­çš„std::weak_ptrï¼Œåœ¨c++ä¸­æ²¡æœ‰strongï¼Œweakå¼ºçƒˆæ¨èä½¿ç”¨è¿™ä¸¤ä¸ªæŒ‡é’ˆã€‚</p><h4 id="ARCï¼ŒMRCåŒºåˆ«"><a href="#ARCï¼ŒMRCåŒºåˆ«" class="headerlink" title="ARCï¼ŒMRCåŒºåˆ«"></a>ARCï¼ŒMRCåŒºåˆ«</h4><p>è¯´äº†è¿™ä¹ˆå¤šæ€»ç»“ä¸€ä¸‹ARCï¼ŒMRCçš„åŒºåˆ«å§ã€‚MRCç±»ä¼¼äºc++ä¸­çš„æ™®é€šæŒ‡é’ˆï¼Œç¨‹åºçŒ¿è¦æ‰‹åŠ¨çš„è¿›è¡Œç”ŸæˆæŒæœ‰é‡Šæ”¾åºŸå¼ƒæ“ä½œï¼Œä½†æ˜¯å¯ä»¥å°†å…¶æ³¨å†Œåˆ°autoreleasepoolä¸­(ç±»ä¼¼c++çš„ä½œç”¨åŸŸ)ï¼Œåœ¨ä½œç”¨åŸŸæ¶ˆå¤±æ—¶ä¹Ÿå°±æ˜¯autoreleasepoolå¯¹è±¡é‡Šæ”¾æ—¶ä¼šé‡Šæ”¾æ‰€æœ‰æ³¨å†Œåœ¨å®ƒé‡Œé¢çš„å¯¹è±¡ã€‚è€ŒARCåˆ™æ˜¯ç±»ä¼¼äºc++çš„æ™ºèƒ½æŒ‡é’ˆï¼Œä¸éœ€è¦æ˜¾ç¤ºçš„å¯¹å¯¹è±¡å®ä¾‹è¿›è¡Œé‡Šæ”¾ï¼Œå‡ºç°äº†strongï¼Œweakç­‰ä¿®é¥°ç¬¦ï¼Œé‡‡ç”¨è‡ªåŠ¨å¼•ç”¨è®¡æ•°çš„æ–¹æ³•ï¼Œä½¿å¾—å½“ä¸€ä¸ªå¯¹è±¡å®ä¾‹åœ¨å¼ºå¼•ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œåˆ™åºŸå¼ƒè¿™ä¸ªå¯¹è±¡å®ä¾‹ï¼Œé‡Šæ”¾å…¶æ‰€å çš„å†…å­˜å—ã€‚</p><h3 id="ARCçš„è§„åˆ™ï¼š"><a href="#ARCçš„è§„åˆ™ï¼š" class="headerlink" title="ARCçš„è§„åˆ™ï¼š"></a>ARCçš„è§„åˆ™ï¼š</h3><ul><li>åœ¨ARCæœ‰æ•ˆæ—¶ç¼–è¯‘ä»£ç ä¸€å®šè¦éµå®ˆä»¥ä¸‹è§„åˆ™ï¼Œ</li><li>ä¸èƒ½ä½¿ç”¨NSAllocateObject/NSDeallocateObject</li><li>é¡»éµå®ˆå†…å­˜ç®¡ç†çš„å‘½åè§„åˆ™<ul><li>initè¿”å›çš„å¿…é¡»æ˜¯å®ä¾‹å¯¹è±¡</li></ul></li><li>ä¸è¦æ˜¾å¼åœ°è°ƒç”¨dealloc</li><li>ä½¿ç”¨@autoreleaseå—ä»£æ›¿NSAutoreleasePool</li><li>ä¸èƒ½ä½¿ç”¨NSZone</li><li>å¯¹è±¡å‹å˜é‡ä¸èƒ½ä½œä¸ºCè¯­è¨€ç»“æ„ä½“æˆå‘˜</li><li>æ˜¾å¼è½¬æ¢idå’Œvoid*<ul><li>ä¸èƒ½å¼ºåˆ¶è½¬æ¢</li><li>å¦‚æœåªæ˜¯æƒ³å•çº¯åœ°èµ‹å€¼å¯ä»¥é€šè¿‡__bridgeè½¬æ¢ï¼Œä½†å¯èƒ½é€ æˆæ‚¬ç©ºæŒ‡é’ˆé—®é¢˜ï¼Œä¸æ¨èã€‚</li></ul></li></ul><h3 id="ARCä¸­çš„å±æ€§ï¼š"><a href="#ARCä¸­çš„å±æ€§ï¼š" class="headerlink" title="ARCä¸­çš„å±æ€§ï¼š"></a>ARCä¸­çš„å±æ€§ï¼š</h3><table><thead><tr><th align="center">å±æ€§å£°æ˜</th><th align="center">æ‰€æœ‰æƒä¿®é¥°ç¬¦</th></tr></thead><tbody><tr><td align="center">assign</td><td align="center">_unsafe__unretainedä¿®é¥°ç¬¦</td></tr><tr><td align="center">copy</td><td align="center">__strongä¿®é¥°ç¬¦</td></tr><tr><td align="center">retain</td><td align="center">__strongä¿®é¥°ç¬¦</td></tr><tr><td align="center">strong</td><td align="center">__strongä¿®é¥°ç¬¦</td></tr><tr><td align="center">unsafe_unretained</td><td align="center">_unsafe__unretainedä¿®é¥°ç¬¦</td></tr><tr><td align="center">weak</td><td align="center">__weakä¿®é¥°ç¬¦</td></tr></tbody></table><ul><li><p><strong>assignï¼š</strong>å¯¹åº”åˆ°__unsafe_unretained, è¡¨æ˜setterä»…åšèµ‹å€¼ï¼Œä¸å¢åŠ å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œç”¨äºåŸºæœ¬æ•°æ®ç±»å‹</p></li><li><p>__weakä¿®é¥°ç¬¦èµ‹å€¼åä¸ä¼šæ³¨å†Œåˆ°autoreleasepoolä¸­ï¼Œåªä¼šåœ¨ä½¿ç”¨æ—¶æ³¨å†Œï¼Œè€Œä¸”æ¯æ¬¡ä½¿ç”¨éƒ½ä¼šæ³¨å†Œä¸€æ¬¡ï¼Œåœ¨autoreleasepoolç»“æŸåä¼šå…¨éƒ¨é‡Šæ”¾ã€‚</p></li><li><p><strong>copyï¼š</strong>å¯¹åº”åˆ°__strongï¼Œä½†æ˜¯èµ‹å€¼æ“ä½œæ¯”è¾ƒç‰¹æ®Šï¼šèµ‹å€¼æ—¶è¿›è¡Œcopyè€Œéretainæ“ä½œï¼ŒåŸæ¥çš„å€¼å¯å˜åˆ™æ·±æ‹·è´ï¼Œä¸å¯å˜åˆ™æµ…æ‹·è´ã€‚</p></li></ul><h3 id="ARCçš„å®ç°"><a href="#ARCçš„å®ç°" class="headerlink" title="ARCçš„å®ç°"></a>ARCçš„å®ç°</h3><h4 id="strong"><a href="#strong" class="headerlink" title="__strong"></a>__strong</h4><p>å…ˆçœ‹å¦‚ä¸‹ä¸€æ®µä»£ç :</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="comment">// ARCä¸­é»˜è®¤ä¼šåœ¨å¯¹è±¡å‰æ·»åŠ ä¸€ä¸ªä¿®é¥°ç¬¦__strong</span></span><br><span class="line">id obj = [[NSObject alloc] init];</span><br><span class="line"><span class="comment">//&lt;==&gt;ç­‰ä»·äº</span></span><br><span class="line">id __strong obj = [[NSObject alloc] init];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®runtimeç‰¹æ€§,å®ƒçš„å®é™…è°ƒç”¨å¦‚ä¸‹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="comment">// æ¶ˆæ¯è½¬å‘</span></span><br><span class="line">id obj = objc_msgSend(NSObject,@selector(alloc));</span><br><span class="line">objc_msgSend(obj,@selector(init));</span><br><span class="line"><span class="comment">// ç¼–è¯‘å™¨åœ¨objä½œç”¨åŸŸç»“æŸæ—¶è‡ªåŠ¨æ’å…¥release</span></span><br><span class="line">objc_release(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶è¿™é‡Œæ˜¯ä»¥<code>alloc/new/copy/mutableCopy</code>ç”Ÿæˆçš„å¯¹è±¡,è¿™ç§å¯¹è±¡ä¼šè¢«å½“å‰çš„å˜é‡æ‰€æŒæœ‰,å¼•ç”¨è®¡æ•°ä¼šåŠ 1.é‚£å¦‚æœä¸æ˜¯ç”¨è¢«æŒæœ‰çš„æ–¹å¼ç”Ÿæˆå¯¹è±¡å‘¢?<br> çœ‹ä¸‹é¢è¿™æ®µä»£ç :</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">id obj = [NSMutableArray <span class="built_in">array</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼ç”Ÿæˆçš„å¯¹è±¡ä¸ä¼šè¢«objæŒæœ‰,é€šå¸¸æƒ…å†µä¸‹ä¼šè¢«æ³¨å†Œåˆ°<code>autoreleasepool</code>ä¸­.ä½†ä¹Ÿæœ‰ç‰¹æ®Šæƒ…å†µ,ä¸Šé¢çš„ä»£ç å¯ä»¥è½¬æ¢æˆå¦‚ä¸‹ä»£ç :</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="comment">// æ¶ˆæ¯è½¬å‘</span></span><br><span class="line">id obj = objc_msgSend(NSMutableArray,@selector(<span class="built_in">array</span>));</span><br><span class="line"><span class="comment">// è°ƒç”¨objc_retainAutoreleasedReturnValueå‡½æ•°</span></span><br><span class="line">objc_retainAutoreleasedReturnValue(obj);</span><br><span class="line"><span class="comment">// ç¼–è¯‘å™¨åœ¨objä½œç”¨åŸŸç»“æŸæ—¶è‡ªåŠ¨æ’å…¥release</span></span><br><span class="line">objc_release(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä»‹ç»ä¸¤ä¸ªç›¸å…³å‡½æ•°:</p><ul><li>objc_retainAutoreleasedReturnValue():è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯è¿”å›æ³¨å†Œåœ¨<code>autoreleasepool</code>å½“ä¸­çš„å¯¹è±¡.</li><li>objc_retainAutoreleaseReturnValue():è¿™ä¸ªå‡½æ•°ä¸€èˆ¬æ˜¯å’Œ<code>objc_retainAutoreleasedReturnValue()</code>æˆå¯¹å‡ºç°çš„.ç›®çš„æ˜¯æ³¨å†Œå¯¹è±¡åˆ°<code>autoreleasepool</code>ä¸­.ä½†<code>ä¸ä»…é™äºæ­¤</code>.<br>ä¸ºä½•è¯´<code>ä¸ä»…é™äºæ­¤</code>å‘¢?åŸå› åœ¨äº,<code>objc_retainAutoreleaseReturnValue()</code>å‡½æ•°åœ¨å‘ç°å¯¹è±¡è°ƒç”¨äº†æ–¹æ³•æˆ–è€…å‡½æ•°ä¹‹ååˆè°ƒç”¨äº†<code>objc_retainAutoreleasedReturnValue()</code>,é‚£ä¹ˆå°±ä¸ä¼šå†æŠŠè¿”å›çš„å¯¹è±¡æ³¨å†Œåˆ°<code>autoreleasepool</code>ä¸­äº†,è€Œæ˜¯ç›´æ¥æŠŠå¯¹è±¡ä¼ é€’è¿‡å».<br><strong>è¿™æ ·çš„å¥½å¤„æ˜¾è€Œæ˜“è§</strong>:ä¸ç”¨å†å»<code>autoreleasepool</code>ä¸­å–å‡ºå¯¹è±¡,ä¼ é€’å‡ºå»,è€Œæ˜¯è¶Šè¿‡<code>autoreleasepool</code>ç›´æ¥ä¼ é€’,æå‡äº†æ€§èƒ½.</li></ul><h4 id="weak"><a href="#weak" class="headerlink" title="__weak"></a>__weak</h4><p><code>weak</code>ä¿®é¥°ç¬¦æƒ³å¿…å¤§å®¶éƒ½éå¸¸ç†Ÿæ‚‰,å®ƒæœ‰ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„ç‰¹æ€§:<code>ç”¨weakä¿®é¥°çš„å¯¹è±¡åœ¨é”€æ¯åä¼šè¢«è‡ªåŠ¨ç½®ä¸ºnil</code>.å¦å¤–è¿˜è¡¥å……ä¸€ç‚¹:<code>å‡¡æ˜¯ç”¨weakä¿®é¥°è¿‡çš„å¯¹è±¡,å¿…å®šæ˜¯æ³¨å†Œåˆ°autoreleasepoolä¸­çš„å¯¹è±¡</code>.<br> çœ‹ä¸‹é¢çš„ä»£ç :</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="comment">// objé»˜è®¤æœ‰__strongä¿®é¥°</span></span><br><span class="line">id obj = [[NSObject alloc] init];</span><br><span class="line">id __weak obj1 = obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®é™…è¿‡ç¨‹å¦‚ä¸‹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="comment">// çœç•¥objçš„å®ç°</span></span><br><span class="line">id obj1;</span><br><span class="line"><span class="comment">// é€šè¿‡objc_initWeakåˆå§‹åŒ–å˜é‡</span></span><br><span class="line">objc_initWeak(&amp;obj1,obj);</span><br><span class="line"><span class="comment">// é€šè¿‡objc_destroyWeaké‡Šæ”¾å˜é‡</span></span><br><span class="line">objc_destroyWeak(&amp;obj1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>objc_initWeak()</code>å‡½æ•°çš„ä½œç”¨æ˜¯å°†obj1åˆå§‹åŒ–ä¸º0,ç„¶åå°†objä½œä¸ºå‚æ•°ä¼ é€’åˆ°è¿™ä¸ªå‡½æ•°ä¸­<code>objc_storeWeak(&amp;obj1,obj)</code> </li><li><code>objc_destroyWeak()</code>å‡½æ•°åˆ™å°†0ä½œä¸ºå‚æ•°æ¥è°ƒç”¨:<code>objc_storeWeak(&amp;obj1,0)</code> </li><li><code>objc_storeWeak()</code>å‡½æ•°çš„ä½œç”¨æ˜¯ä»¥<code>ç¬¬äºŒä¸ªå‚æ•°(obj || 0)</code>ä½œä¸ºkey,<code>ç¬¬ä¸€ä¸ªå‚æ•°(&amp;obj1)</code>ä½œä¸ºvalue,å°†ç¬¬ä¸€ä¸ªå‚æ•°çš„åœ°å€æ³¨å†Œåˆ°weakè¡¨ä¸­.å½“keyä¸º0,å³ä»weakè¡¨ä¸­åˆ é™¤å˜é‡åœ°å€.</li></ul><p>é‚£ä¹ˆweakè¡¨ä¸­çš„å¯¹è±¡æ˜¯å¦‚ä½•è¢«é‡Šæ”¾çš„å‘¢?</p><ul><li>ä»weakè¡¨ä¸­è·å–åºŸå¼ƒå¯¹è±¡çš„é”®å€¼è®°å½•.</li><li>å°†è®°å½•ä¸­æ‰€æœ‰åŒ…å«__weakçš„å˜é‡åœ°å€,èµ‹å€¼ä¸ºnil.</li><li>ä»weakè¡¨ä¸­åˆ é™¤è¯¥è®°å½•.</li><li>ä»å¼•ç”¨è®¡æ•°è¡¨ä¸­åˆ é™¤å¯¹åº”çš„è®°å½•.</li></ul><p>è¿™å°±æ˜¯<strong>weakä¿®é¥°çš„å˜é‡ä¼šåœ¨é‡Šæ”¾åè‡ªåŠ¨ç½®ä¸ºnilçš„åŸå› .<code>åŒæ—¶,å› ä¸ºweakä¿®é¥°ä¹‹åæ¶‰åŠåˆ°æ³¨å†Œåˆ°weakè¡¨ç­‰ç›¸å…³æ“ä½œ,å¦‚æœå¤§é‡ä½¿ç”¨weakå¯èƒ½ä¼šé€ æˆä¸å¿…è¦çš„CPUèµ„æºæµªè´¹,æ‰€ä»¥ä¹¦é‡ŒæŒ‡å‡ºå°½é‡åœ¨å¾ªç¯å¼•ç”¨ä¸­ä½¿ç”¨weak</code>.<br> è¿™é‡Œä¸å¾—ä¸æåˆ°å¦å¤–ä¸€ä¸ªå’Œ</strong>weakç›¸è¿‘çš„å±æ€§:<code>__unsafe_unretained</code>,å®ƒä¸weakçš„åŒºåˆ«åœ¨äº,é‡Šæ”¾å¯¹è±¡åä¸ä¼šå¯¹å…¶ç½®ä¸ºnil,åœ¨æŸäº›ç‰¹å®šçš„åœºåˆä¸‹,éœ€è¦å»¶è¿Ÿé‡Šæ”¾çš„æ—¶å€™,å¯ä»¥è€ƒè™‘ç”¨è¿™ä¸ªå±æ€§ä¿®é¥°.</p><p>å¥½äº†,ä¸‹ä¸€ä¸ªé—®é¢˜,çœ‹å¦‚ä¸‹ä»£ç :</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">id __weak obj1 = obj;</span><br><span class="line"><span class="comment">// è¿™é‡Œä½¿ç”¨äº†obj1è¿™ä¸ªç”¨weakä¿®é¥°çš„å˜é‡</span></span><br><span class="line">NSLog(@<span class="string">"%@"</span>,obj1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨weakå˜é‡è¢«ä½¿ç”¨çš„æƒ…å†µä¸‹,å®é™…è¿‡ç¨‹å¦‚ä¸‹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">id obj1;</span><br><span class="line">objc_initWeak(&amp;obj1,obj);</span><br><span class="line">id tmp = objc_loadWeakRetained(&amp;obj1);</span><br><span class="line">objc_autorelease(tmp);</span><br><span class="line">NSLog(@<span class="string">"%@"</span>,tmp);</span><br><span class="line">objc_destroyWeak(&amp;obj1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»è¿™æ®µå®ç°ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå¦‚ä¸‹å‡ ç‚¹:</p><ul><li>å½“æˆ‘ä»¬ä½¿ç”¨weakä¿®é¥°çš„å¯¹è±¡æ—¶,å®é™…è¿‡ç¨‹ä¸­äº§ç”Ÿäº†ä¸€ä¸ª<code>tmp</code>å¯¹è±¡,å› ä¸º<code>objc_loadWeakRetained()</code>å‡½æ•°ä¼šä»weakè¡¨ä¸­å–å‡ºweakä¿®é¥°çš„å¯¹è±¡,æ‰€ä»¥tmpä¼šå¯¹è¿™ä¸ªå–å‡ºçš„å¯¹è±¡è¿›è¡Œä¸€æ¬¡å¼ºå¼•ç”¨.</li><li>å› ä¸ºä¸Šè¿°åŸå› ,weakä¿®é¥°çš„å¯¹è±¡åœ¨å½“å‰å˜é‡ä½œç”¨åŸŸç»“æŸå‰éƒ½å¯ä»¥æ”¾å¿ƒä½¿ç”¨.</li><li><code>objc_autorelease()</code>ä¼šå°†tmpå¯¹è±¡ä¹Ÿæ³¨å†Œåˆ°<code>autoreleasepool</code>ä¸­.æ‰€ä»¥å½“å¤§é‡ä½¿ç”¨weakå¯¹è±¡çš„æ—¶å€™,æ³¨å†Œåˆ°<code>autoreleasepool</code>çš„å¯¹è±¡ä¼šå¤§é‡å¢åŠ .è§£å†³æ–¹æ¡ˆå°±æ˜¯ç”¨ä¸€ä¸ª__strongä¿®é¥°çš„ä¸´æ—¶å˜é‡æ¥ä½¿ç”¨.</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">id __weak obj1 = obj;</span><br><span class="line">id tmp = obj1;</span><br><span class="line"><span class="comment">// åé¢ä½¿ç”¨tmpå³å¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å»¶ä¼¸ä¸€ä¸‹:ä¸ºä»€ä¹ˆæœ‰å¾ªç¯å¼•ç”¨blockå†…ç”¨weakObjectçš„æ—¶å€™æœ€å¥½èƒ½åœ¨blockå†…å¥—ä¸€å±‚strongObject?</p><ul><li>åœ¨å¼‚æ­¥çº¿ç¨‹ä¸­weakObjectå¯èƒ½ä¼šè¢«é”€æ¯,æ‰€ä»¥éœ€è¦å¥—ä¸€å±‚strong.</li><li>å¦‚æœå†…éƒ¨æœ‰è€—æ—¶çš„å¾ªç¯è¯­å¥,é¢‘ç¹ä½¿ç”¨weakObjectä¹Ÿä¼šå¢åŠ å†…å­˜æŸè€—.</li></ul><p>!!! <strong>ä¸ºä»€ä¹ˆè®¿é—®weakä¿®é¥°çš„å¯¹è±¡å°±ä¼šè®¿é—®æ³¨å†Œåˆ°è‡ªåŠ¨é‡Šæ”¾æ± çš„å¯¹è±¡å‘¢?</strong></p><p>å› ä¸ºweakä¸ä¼šå¼•èµ·å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨å˜åŒ–ï¼Œå› æ­¤ï¼Œè¯¥å¯¹è±¡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å¾ˆæœ‰å¯èƒ½ä¼šè¢«é‡Šæ”¾ã€‚æ‰€ä»¥ï¼Œéœ€è¦å°†å¯¹è±¡æ³¨å†Œåˆ°è‡ªåŠ¨é‡Šæ”¾æ± ä¸­å¹¶åœ¨autoreleasePoolé”€æ¯æ—¶é‡Šæ”¾å¯¹è±¡å ç”¨çš„å†…å­˜ã€‚</p><h4 id="autoreleasing"><a href="#autoreleasing" class="headerlink" title="__autoreleasing"></a>__autoreleasing</h4><p>å®ƒçš„ä¸»è¦ä½œç”¨å°±æ˜¯å°†å¯¹è±¡æ³¨å†Œåˆ°<code>autoreleasepool</code>ä¸­.æ²¡å•¥å¥½è¯´çš„.</p><p>æœ€åè¡¥å……å‡ ç§åœ¨ARCç¯å¢ƒä¸‹è·å–å¼•ç”¨è®¡æ•°çš„æ–¹æ³•,ä½†å¹¶ä¸ä¸€å®šå‡†ç¡®:<code>ARCçš„ä¸€äº›å¼•ç”¨è®¡æ•°ä¼˜åŒ–,ä»¥åŠå¤šçº¿ç¨‹çš„ä¸­çš„ç«æ€æ¡ä»¶é—®é¢˜,æœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±å»äº†è§£ä¸€ä¸‹</code>.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>) ä½¿ç”¨_objc_rootRetainCount()ç§æœ‰å‡½æ•°</span><br><span class="line">OBJC_EXTERN <span class="keyword">int</span> _objc_rootRetainCount(id);</span><br><span class="line">@<span class="function">interface <span class="title">ViewController</span> <span class="params">()</span></span></span><br><span class="line">@end</span><br><span class="line">@implementation ViewController</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    id obj = [[NSObject alloc] init];</span><br><span class="line">    NSLog(@<span class="string">"%d"</span>,_objc_rootRetainCount(obj));</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>) ä½¿ç”¨KVC</span><br><span class="line">@<span class="function">interface <span class="title">ViewController</span> <span class="params">()</span></span></span><br><span class="line">@end</span><br><span class="line">@implementation ViewController</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    id obj = [[NSObject alloc] init];</span><br><span class="line">    NSLog(@<span class="string">"%d"</span>,[[obj valueForKey:@<span class="string">"retainCount"</span>] integerValue]);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>) ä½¿ç”¨CFGetRetainCount()</span><br><span class="line">@<span class="function">interface <span class="title">ViewController</span> <span class="params">()</span></span></span><br><span class="line">@end</span><br><span class="line">@implementation ViewController</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    id obj = [[NSObject alloc] init];</span><br><span class="line">    NSLog(@<span class="string">"%d"</span>,CFGetRetainCount((__bridge CFTypeRef)(obj)));</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è‡ªåŠ¨å¼•ç”¨è®¡æ•°(ARC)æ˜¯æŒ‡å†…å­˜ç®¡ç†ä¸­å¯¹å¼•ç”¨é‡‡å–è‡ªåŠ¨è®¡æ•°çš„æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ARCï¼Œå°±æ— éœ€å†æ¬¡é”®å…¥retainæˆ–è€…releaseä»£ç ï¼Œè¿™é™ä½äº†ç¨‹åºå´©æºƒï¼Œå†…å­˜æ³„æ¼ç­‰é£é™©çš„åŒæ—¶ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº†å¼€å‘ç¨‹åºçš„å·¥ä½œé‡ã€‚ARCæŠ€æœ¯ä½¿å¾—ç¼–è¯‘å™¨æ¸…æ¥šç›®æ ‡å¯¹è±¡ï¼Œå¹¶èƒ½ç«‹åˆ»é‡Šæ”¾é‚£äº›ä¸å†è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œåº”ç”¨ç¨‹åºå°†å…·æœ‰å¯é¢„æµ‹æ€§ï¼Œä¸”èƒ½æµç•…è¿è¡Œï¼Œé€Ÿåº¦ä¹Ÿå°†å¤§å¹…æå‡ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>assign</title>
    <link href="http://yoursite.com/2019/07/11/iOS-%E6%B7%B1%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B5%85%E6%8B%B7%E8%B4%9D/"/>
    <id>http://yoursite.com/2019/07/11/iOS-æ·±æ‹·è´å’Œæµ…æ‹·è´/</id>
    <published>2019-07-10T16:04:27.000Z</published>
    <updated>2019-07-10T16:06:04.477Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p>æµ…æ‹·è´ï¼šä¸æ‹·è´å¯¹è±¡æœ¬èº«ï¼Œä»…ä»…æ˜¯æ‹·è´æŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆ(copy)</p></li><li><p>æ·±æ‹·è´ï¼šç›´æ¥æ‹·è´æ•´ä¸ªå¯¹è±¡çš„å†…å­˜åˆ°å¦ä¸€å—å†…å­˜ä¸Šå»(mutableCopy)</p></li></ul><p>ä»¥ä¸‹ç‰¹æ®Šæƒ…å†µï¼š</p><ol><li>ä¸å¯å˜æƒ…å†µä¸‹è¢«æ‹·è´æŒ‡é’ˆé‡æ–°èµ‹å€¼ã€‚<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">NSString *str1 = @<span class="string">"str1"</span>;</span><br><span class="line">NSString *str2 = [str1 copy];</span><br><span class="line"></span><br><span class="line">str1 = @<span class="string">"asdf"</span>;</span><br><span class="line"></span><br><span class="line">NSLog(@<span class="string">"\nstr1 = %@ str1P = %p \n str2 = %@ str2P = %p"</span>, str1, str1, str2, str2);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*è¾“å‡ºç»“æœ,ä¿®æ”¹str2 åŒç†</span></span><br><span class="line"><span class="comment">   str1 = asdf str1P = 0x10776b1a0</span></span><br><span class="line"><span class="comment">   str2 = str1 str2P = 0x10776b180</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure></li></ol><a id="more"></a><p>å¼€å§‹æ—¶str1å’Œstr2æŒ‡å‘çš„æ˜¯ç›¸åŒçš„å†…å­˜ç©ºé—´ï¼Œä¸”ä¸¤è€…éƒ½æ˜¯ä¸å¯å˜çš„æ‰€ä»¥ç³»ç»Ÿåªä¼šç”Ÿæˆä¸€ä¸ªæŒ‡å‘åŒä¸€å†…å­˜ç©ºé—´çš„æŒ‡é’ˆï¼Œä½†æ˜¯å¦‚æœé‡æ–°ç»™ç»™str1æˆ–è€…str2èµ‹å€¼ï¼Œä¹‹å‰å†…å®¹ä¸å¯å˜è€Œä¸”åŒæ–¹åº”äº’ä¸å½±å“ï¼Œæ‰€ä»¥åªèƒ½é‡æ–°å¼€å‡ºä¸€å—å†…å­˜ç©ºé—´ã€‚</p><ol start="2"><li>å¯å˜æƒ…å†µä¸‹çš„æµ…æ‹·è´</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">NSMutableArray *mArr1 = [@[@<span class="string">"123"</span>, @<span class="string">"456"</span>, @<span class="string">"asd"</span>] mutableCopy];</span><br><span class="line">NSMutableArray *mArr2 = [mArr1 copy];</span><br><span class="line">   </span><br><span class="line">   NSLog(@<span class="string">"\n mArr1 = %@ mArr1P = %p mArr1 class = %@ \n\n mArr2 = %@ mArr2P = %p mArr2 class = %@"</span>, mArr1, mArr1, [mArr1 class], mArr2, mArr2, [mArr2 class]);</span><br><span class="line"></span><br><span class="line">     <span class="comment">/*è¾“å‡ºç»“æœ</span></span><br><span class="line"><span class="comment">       mArr1 = (</span></span><br><span class="line"><span class="comment">                   123,</span></span><br><span class="line"><span class="comment">                   456,</span></span><br><span class="line"><span class="comment">                   asd</span></span><br><span class="line"><span class="comment">                   )</span></span><br><span class="line"><span class="comment">       mArr1P = 0x60400025db20</span></span><br><span class="line"><span class="comment">       mArr1 class = __NSArrayM</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">       mArr2 = (</span></span><br><span class="line"><span class="comment">                   123,</span></span><br><span class="line"><span class="comment">                   456,</span></span><br><span class="line"><span class="comment">                   asd</span></span><br><span class="line"><span class="comment">                   )</span></span><br><span class="line"><span class="comment">       mArr2P = 0x60400025dd30</span></span><br><span class="line"><span class="comment">       mArr2 class = __NSArrayI</span></span><br><span class="line"><span class="comment">      */</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶mArr1æŒ‡å‘çš„å†…å­˜ç©ºé—´æ˜¯å¯å˜çš„ï¼Œå¦‚æœå¯¹mArr1è¿›è¡Œä¿®æ”¹ï¼ŒåŒä¸€å†…å­˜ç©ºé—´çš„å†…å®¹å°±ä¼šå‘ç”Ÿ<br>å˜åŒ–ã€‚éµå¾ªäº’ä¸å½±å“çš„åŸåˆ™ï¼ŒåŠ ä¸ŠmArr2æ˜¯ä¸å¯å˜çš„(è™½ç„¶æŒ‡é’ˆç±»å‹æ˜¯NSMutableä½†æ˜¯æ˜¯copyæ‹·è´æ‰€ä»¥ä¸å¯å˜ï¼ŒåŒæ—¶å¦‚æœç»™mArr2å¢åˆ å…ƒç´ ç³»ç»Ÿä¼šå´©ï¼Œå› ä¸ºæ˜¯ç”¨copyæ‹·è´åˆ™æ„å‘³ç€å…¶ä¸å¯å˜)ï¼Œæ‰€ä»¥copyä¼šå¼€è¾Ÿæ–°çš„å†…å­˜ç©ºé—´ã€‚</p><ol start="3"><li>ç”¨copyä¿®é¥°ä¸€ä¸ªå±æ€§åå°±é™åˆ¶äº†ä»–æ˜¯ä¸å¯å˜æ•°ç»„(å› ä¸ºcopyå°±æ˜¯å¤åˆ¶ä¸€ä¸ªä¸å¯å˜å†…å­˜çš„æ•°ç»„)ï¼ŒmutableCopyæ˜¯æ·±æ‹·è´é‡æ–°èµ‹å†…å­˜ï¼Œè€Œå¦‚æœè°ƒç”¨copyæˆ–ç›´æ¥æŒ‡å‘arråˆ™ä¸ä¼šã€‚ï¼ˆä½†å¦‚æœarræ˜¯mutableç±»å‹åˆ™ä»æ˜¯ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæ— è®ºå¦‚ä½•éƒ½æ˜¯åœ°å€éƒ½æ˜¯ä¸åŒçš„ï¼Œå› ä¸ºarrå¯å˜ï¼‰</li></ol><p>æ³¨ï¼šcopyå±æ€§ä¿®é¥°ç¬¦æ˜¯æ·±æ‹·è´ï¼Œå³ä¸ºæˆå‘˜å˜é‡å¤åˆ¶ä¸€å—æ–°çš„å¯¹è±¡å®ä¾‹åœ¨åˆ«çš„å†…å­˜å¹¶è®©æˆå‘˜å˜é‡æŒæœ‰å®ƒã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line">@property (nonatomic, copy) NSMutableArray *<span class="built_in">array</span>;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"> NSArray *arr = @[@<span class="string">"123"</span>, @<span class="string">"456"</span>, @<span class="string">"asd"</span>];</span><br><span class="line"> self.mArr = [arr mutableCopy];</span><br><span class="line"> NSLog(@<span class="string">"\n arrP = %p \n self.mArrP = %p, self.mArr class = %@"</span>, arr, self.mArr, [self.mArr class]);</span><br><span class="line"> <span class="comment">/* è¾“å‡ºç»“æœ</span></span><br><span class="line"><span class="comment"> arrP = 0x600000eed530 </span></span><br><span class="line"><span class="comment"> self.mArrP = 0x600000eee520</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p> æ€»ç»“ï¼š</p><ul><li>ç”¨copyä¿®é¥°çš„ æˆ–è€…èµ‹å€¼çš„ å˜é‡è‚¯å®šæ˜¯ä¸å¯å˜çš„ã€‚</li><li>ç”¨copyèµ‹å€¼ï¼Œè¦çœ‹æºå¯¹è±¡æ˜¯å¦æ˜¯å¯å˜çš„ï¼Œæ¥å†³å®šåªæ‹·è´æŒ‡é’ˆï¼Œè¿˜æ˜¯ä¹Ÿæ‹·è´å¯¹è±¡åˆ°å¦ä¸€å—å†…å­˜ç©ºé—´</li><li>å¯¹è±¡ä¹‹é—´mutableCopyèµ‹å€¼ï¼Œè‚¯å®šä¼šæ‹·è´æ•´ä¸ªå¯¹è±¡å†…å­˜åˆ°å¦ä¸€å—å†…å­˜ä¸­</li><li>å¯¹è±¡ä¹‹é—´èµ‹å€¼ä¹‹åï¼Œå†æ”¹å˜ï¼Œéµå¾ªäº’ä¸å½±å“çš„åŸåˆ™</li></ul><p><strong>PS</strong>ï¼šåŒæ—¶åœ¨åŠ ä¸€ç‚¹assignçš„ç”¨æ³•ï¼š<br>assignä¿®é¥°å±æ€§åªèƒ½ä¿®é¥°åŸºæœ¬å˜é‡ç±»å‹ä»¥åŠåŸºæœ¬çš„ocç±»å‹ï¼Œä¸èƒ½ä¿®é¥°å¯¹è±¡ï¼ï¼ï¼</p><p>å¦‚æœç”¨assignä¿®é¥°å¯¹è±¡ï¼Œå½“å¯¹è±¡é‡Šæ”¾åï¼ˆå› ä¸ºä¸å­˜åœ¨å¼ºå¼•ç”¨ï¼Œç¦»å¼€ä½œç”¨åŸŸå¯¹è±¡å†…å­˜å¯èƒ½è¢«å›æ”¶ï¼‰ï¼ŒæŒ‡é’ˆçš„åœ°å€è¿˜æ˜¯å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æŒ‡é’ˆå¹¶æ²¡æœ‰è¢«ç½®ä¸ºnil,ä¸‹æ¬¡å†è®¿é—®è¯¥å¯¹è±¡å°±ä¼šé€ æˆé‡æŒ‡é’ˆå¼‚å¸¸ã€‚å¯¹è±¡æ˜¯åˆ†é…åœ¨å †ä¸Šçš„ï¼Œå †ä¸Šçš„å†…å­˜ç”±ç¨‹åºå‘˜æ‰‹åŠ¨é‡Šæ”¾ã€‚<br>æ‰€ä»¥assignä¿®é¥°çš„æ˜¯å­˜åœ¨æ ˆä¸Šçš„åŸºæœ¬ç±»å‹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›æ”¶ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;&lt;p&gt;æµ…æ‹·è´ï¼šä¸æ‹·è´å¯¹è±¡æœ¬èº«ï¼Œä»…ä»…æ˜¯æ‹·è´æŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆ(copy)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æ·±æ‹·è´ï¼šç›´æ¥æ‹·è´æ•´ä¸ªå¯¹è±¡çš„å†…å­˜åˆ°å¦ä¸€å—å†…å­˜ä¸Šå»(mutableCopy)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸‹ç‰¹æ®Šæƒ…å†µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸å¯å˜æƒ…å†µä¸‹è¢«æ‹·è´æŒ‡é’ˆé‡æ–°èµ‹å€¼ã€‚&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NSString *str1 = @&lt;span class=&quot;string&quot;&gt;&quot;str1&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSString *str2 = [str1 copy];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;str1 = @&lt;span class=&quot;string&quot;&gt;&quot;asdf&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NSLog(@&lt;span class=&quot;string&quot;&gt;&quot;\nstr1 = %@ str1P = %p \n str2 = %@ str2P = %p&quot;&lt;/span&gt;, str1, str1, str2, str2);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*è¾“å‡ºç»“æœ,ä¿®æ”¹str2 åŒç†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;   str1 = asdf str1P = 0x10776b1a0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;   str2 = str1 str2P = 0x10776b180&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOSçš„MVCè®¾è®¡æ¨¡å¼å’ŒMVVMçš„å¼‚åŒç‚¹ä»¥åŠiOSä¸­å¦‚ä½•å®ç°æ•°æ®ç»‘å®š</title>
    <link href="http://yoursite.com/2019/07/11/iOS%E7%9A%84MVC%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%92%8CMVVM%E7%9A%84%E5%BC%82%E5%90%8C%E7%82%B9%E4%BB%A5%E5%8F%8AiOS%E4%B8%AD%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A/"/>
    <id>http://yoursite.com/2019/07/11/iOSçš„MVCè®¾è®¡æ¨¡å¼å’ŒMVVMçš„å¼‚åŒç‚¹ä»¥åŠiOSä¸­å¦‚ä½•å®ç°æ•°æ®ç»‘å®š/</id>
    <published>2019-07-10T16:03:05.000Z</published>
    <updated>2019-07-10T16:04:01.241Z</updated>
    
    <content type="html"><![CDATA[<h3 id="è®¾è®¡æ¨¡å¼ï¼šMVC"><a href="#è®¾è®¡æ¨¡å¼ï¼šMVC" class="headerlink" title="è®¾è®¡æ¨¡å¼ï¼šMVC"></a>è®¾è®¡æ¨¡å¼ï¼šMVC</h3><h5 id="åœ¨æ¨¡å‹å¯¹è±¡-model-ä¸­å°è£…æ•°æ®å’ŒåŸºæœ¬è¡Œä¸º"><a href="#åœ¨æ¨¡å‹å¯¹è±¡-model-ä¸­å°è£…æ•°æ®å’ŒåŸºæœ¬è¡Œä¸º" class="headerlink" title="åœ¨æ¨¡å‹å¯¹è±¡(model)ä¸­å°è£…æ•°æ®å’ŒåŸºæœ¬è¡Œä¸º"></a>åœ¨æ¨¡å‹å¯¹è±¡(model)ä¸­å°è£…æ•°æ®å’ŒåŸºæœ¬è¡Œä¸º</h5><ul><li>æ¨¡å‹å¯¹è±¡ç»´æŠ¤åº”ç”¨ç¨‹åºçš„æ•°æ®ï¼Œå¹¶å®šä¹‰æ“ä½œæ•°æ®çš„ç‰¹å®šé€»è¾‘ã€‚</li><li>åªè¦æ˜¯åŠ è½½çš„æ˜¯åŒ…å«æœ‰åº”ç”¨ç¨‹åºæ°¸ä¹…ä¿¡æ¯çš„æ•°æ®ï¼Œå°±å°†å…¶æ”¾åˆ°modelä¸­ã€‚</li><li>ç†æƒ³çŠ¶å†µä¸‹ï¼Œæ¨¡å‹å¯¹è±¡åŒç”¨äºå¯¹å…¶è¿›è¡Œæ˜¾ç¤ºå’Œç¼–è¾‘çš„ç”¨æˆ·ç•Œé¢ä¹‹é—´ä¸åº”è¯¥æœ‰ä»»ä½•ç›´æ¥çš„å…³è”ã€‚</li></ul><h5 id="ä½¿ç”¨è§†å›¾å¯¹è±¡-view"><a href="#ä½¿ç”¨è§†å›¾å¯¹è±¡-view" class="headerlink" title="ä½¿ç”¨è§†å›¾å¯¹è±¡(view)"></a>ä½¿ç”¨è§†å›¾å¯¹è±¡(view)</h5><ul><li>è§†å›¾å¯¹è±¡å¯ä»¥å“åº”ç”¨æˆ·æ“ä½œï¼Œå¹¶æ‡‚å¾—å¦‚ä½•å°†è‡ªå·±å±•ç°åœ¨å±å¹•ä¸Šã€‚</li><li>è§†å›¾å¯¹è±¡é€šå¸¸ä»åº”ç”¨ç¨‹åºçš„æ¨¡å‹å¯¹è±¡è·å–æ•°æ®ç”¨ä»¥å±•ç¤ºï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è§†å›¾æ¥ä¿®æ”¹æ¨¡å‹å¯¹è±¡çš„æ•°æ®ã€‚</li><li>è§†å›¾å¯¹è±¡å’Œæ¨¡å‹å¯¹è±¡è™½ç„¶ä¹‹é—´å…³ç³»å¯†åˆ‡ä½†ä¸æ²¡æœ‰è€¦åˆï¼Œé™¤éå› ä¸ºæ€§èƒ½åŸå› (æ¯”å¦‚è§†å›¾éœ€è¦å¯¹æ•°æ®è¿›è¡Œç¼“å­˜)ï¼Œå¦åˆ™ä¸åº”è¯¥å°†è§†å›¾ç”¨äºå­˜å‚¨å…¶æ‰€å±•ç¤ºçš„æ•°æ®ã€‚</li></ul><h5 id="æ§åˆ¶å™¨å¯¹è±¡-Controller-è”ç³»èµ·æ¨¡å‹å’Œè§†å›¾"><a href="#æ§åˆ¶å™¨å¯¹è±¡-Controller-è”ç³»èµ·æ¨¡å‹å’Œè§†å›¾" class="headerlink" title="æ§åˆ¶å™¨å¯¹è±¡(Controller)è”ç³»èµ·æ¨¡å‹å’Œè§†å›¾"></a>æ§åˆ¶å™¨å¯¹è±¡(Controller)è”ç³»èµ·æ¨¡å‹å’Œè§†å›¾</h5><ul><li>åè°ƒè§†å›¾å¯¹è±¡å’Œæ¨¡å‹å¯¹è±¡ï¼Œä½¿è§†å›¾å¾—ä»¥çŸ¥æ™“æ¨¡å‹çš„å˜æ›´è€Œç»™äºˆå“åº”ã€‚</li><li>è¿˜å¯ä»¥ä¸ºåº”ç”¨ç¨‹åºæ‰§è¡Œå…¶ä»–æ“ä½œï¼Œæ¯”å¦‚ä¸ºåº”ç”¨ç¨‹åºç®¡ç†å…¶ä»–å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿›è¡Œè®¾ç½®å’Œåè°ƒä»»åŠ¡ã€‚</li></ul><h5 id="ä½œä¸ºå¤åˆè®¾è®¡æ¨¡å¼çš„MVCï¼š"><a href="#ä½œä¸ºå¤åˆè®¾è®¡æ¨¡å¼çš„MVCï¼š" class="headerlink" title="ä½œä¸ºå¤åˆè®¾è®¡æ¨¡å¼çš„MVCï¼š"></a>ä½œä¸ºå¤åˆè®¾è®¡æ¨¡å¼çš„MVCï¼š</h5><p>Cocoaçš„MVCç”¨åˆ°çš„æ¨¡å¼æœ‰ï¼šç»„åˆ(Composite)ã€å‘½ä»¤(Command)ã€ä¸­ä»‹è€…(Mediator)ã€ç­–ç•¥(Strategy)å’Œè§‚å¯Ÿè€…(Observer)</p><ul><li>ç»„åˆï¼šè§†å›¾å¯¹è±¡ä¹‹é—´ä»¥åä½œçš„æ–¹å¼æ„æˆä¸€ä¸ªè§†å›¾å±‚æ¬¡ä½“ç³»ï¼Œå…¶ä¸­æ—¢å¯ä»¥æœ‰å¤åˆè§†å›¾(å¦‚è¡¨æ ¼è§†å›¾)ï¼Œä¹Ÿå¯ä»¥æœ‰ç‹¬ç«‹è§†å›¾(å¦‚æ–‡æœ¬æ¡†)ã€‚æ¯ä¸ªå±‚æ¬¡çš„è§†å›¾èŠ‚ç‚¹éƒ½å¯ä»¥å“åº”ç”¨æˆ·æ“ä½œå¹¶æŠŠè‡ªå·±ç»˜åˆ¶åˆ°å±å¹•ä¸Šã€‚</li><li>å‘½ä»¤ï¼šâ€œç›®æ ‡-åŠ¨ä½œâ€æœºåˆ¶ï¼Œè§†å›¾å¯¹è±¡å¯ä»¥æ¨è¿Ÿå…¶ä»–å¯¹è±¡(æ¯”å¦‚æ§åˆ¶å™¨çš„æ‰§è¡Œ)çš„æ‰§è¡Œï¼Œè®©å…¶ä»–å¯¹è±¡å‘ç”Ÿäº†æŸäº›äº‹ä»¶åæ‰§è¡Œã€‚è¿™æ˜¯å‘½ä»¤æ¨¡å¼ã€‚</li><li>ä¸­ä»‹è€…ï¼šæ§åˆ¶å™¨å¯¹è±¡èµ·ç€ä¸­é—´äººçš„ä½œç”¨ï¼Œè€Œè¿™ä¸ªä¸­é—´äººåˆ™é‡‡ç”¨äº†ä¸­ä»‹è€…æ¨¡å¼ï¼Œæ„æˆäº†è§†å›¾å’Œæ¨¡å‹å¯¹è±¡é—´ä¼ é€’æ•°æ®çš„åŒå‘æ¸ é“ã€‚æ§åˆ¶å™¨å¯¹è±¡å°†æ¨¡å‹çš„å˜æ›´ä¼ é€’ç»™è§†å›¾å¯¹è±¡ã€‚</li><li>ç­–ç•¥ï¼šæ§åˆ¶å™¨å¯ä»¥æ˜¯è§†å›¾å¯¹è±¡çš„ä¸€ä¸ª â€œç­–ç•¥â€ã€‚è§†å›¾å¯¹è±¡å°†è‡ªèº«éš”ç¦»ï¼Œä»¥æœŸç»´æŒå…¶ä½œä¸ºæ•°æ®å±•ç¤ºå™¨çš„å”¯ä¸€èŒè´£ï¼Œè€Œå°†ä¸€åˆ‡åº”ç”¨ç¨‹åºç‰¹æœ‰çš„ç•Œé¢è¡Œä¸ºå†³å®šå§”æ‰˜ç»™å®ƒçš„â€œç­–ç•¥â€å¯¹è±¡ã€‚</li><li>è§‚å¯Ÿè€…ï¼šæ¨¡å‹å¯¹è±¡å‘å®ƒæ‰€å…³æ³¨çš„æ§åˆ¶å™¨ç­‰å¯¹è±¡å‘å‡ºå†…éƒ¨çŠ¶æ€å˜åŒ–çš„é€šçŸ¥ã€‚</li></ul><p><img src="https://img-blog.csdnimg.cn/20190524002728195.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>ä¸‰è€…ä¹‹é—´çš„é€šä¿¡åªèƒ½å®ç°Controllerå’ŒModelä»¥åŠControllerå’ŒViewä¹‹é—´çš„é€šä¿¡ï¼Œä¸¤è€…ä½œä¸ºControllerçš„å±æ€§ã€‚åšå†³ä¸èƒ½æœ‰Modelå’ŒViewä¹‹é—´çš„é€šä¿¡ï¼Œå¦åˆ™å¤±å»äº†åˆ†ç¦»çš„æ„ä¹‰ã€‚</li><li>æ­£å¸¸æƒ…å†µä¸‹æ˜¯Controlleræ§åˆ¶Viewå’ŒModelï¼Œä½†Viewå’ŒModelä¹Ÿå¯ä»¥å®ç°å¯¹Controllerçš„åå‘é€šä¿¡ã€‚</li><li>Viewé€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼å®ç°ä¸Controllerçš„é€šä¿¡<ol><li>action-targetï¼šç”¨æˆ·ä¸UIäº¤äº’è§¦å‘æ§åˆ¶å™¨ã€‚ä¾‹å¦‚ç‚¹å‡»æŒ‰é’®å®ç°é¡µé¢è·³è½¬ï¼Œç½‘ç»œè¯·æ±‚ã€‚</li><li>delegateï¼šViewå‘Controllerè¯¢é—®è‡ªå·±æ— æ³•å†³å®šçš„äº‹æƒ…æˆ–è®©Controllerå¸®åŠ©è‡ªå·±åšä¸€äº›æ— æ³•ç‹¬ç«‹å®Œæˆçš„äº‹æƒ…ã€‚ä¾‹å¦‚è¡¨æ ¼è§†å›¾è¯¢é—®Controllerè‡ªå·±æ˜¯å¦å¯ä»¥æ»šåŠ¨ï¼Œå¦‚æœModelæ•°æ®é‡å¾ˆå°‘ï¼ŒControllerå‘Šè¯‰è¡¨æ ¼ä¸å¯ä»¥æ»šåŠ¨ï¼›è‹¥è¿˜æœ‰æœªæ‹‰å‡ºçš„æ•°æ®ï¼Œåˆ™Controllerå‘ŠçŸ¥å¯ä»¥æ»šåŠ¨ã€‚</li><li>dataSourceï¼šè§†å›¾è®©æ§åˆ¶å™¨ç»™å®ƒå°†è¦æ˜¾ç¤ºçš„æ•°æ®ã€‚ï¼ˆControllerä»Modelä¸­è·å–æ•°æ®ï¼‰</li></ol></li><li>Modelé€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®ç°ä¸Controllerçš„é€šä¿¡ï¼š<ol><li>Notificationï¼šæ§åˆ¶å™¨æ³¨å†Œç›‘å¬æŸæ¨¡å‹æ•°æ®å˜åŒ–çš„å¹¿æ’­é¢‘é“ï¼Œå½“æ­¤æ¨¡å‹æ•°æ®å˜åŒ–åå‘è¯¥æ§åˆ¶å™¨å‘é€å¹¿æ’­ï¼Œå‘ŠçŸ¥æ¨¡å‹å˜åŒ–æƒ…å†µã€‚</li><li>KVOæœºåˆ¶ï¼šæ¨¡å‹ä½œä¸ºæ§åˆ¶å™¨çš„å±æ€§ï¼Œå½“æ¨¡å‹å±æ€§è¢«ä¿®æ”¹åï¼ŒæŒæœ‰æ­¤æ¨¡å‹å±æ€§çš„æ§åˆ¶å™¨å°±ä¼šæ”¶åˆ°é€šçŸ¥ã€‚</li></ol></li><li>å¤šä¸ªMVCçš„ç»“åˆï¼Œä¾‹å¦‚å¯ä»¥åœ¨æ ‡ç­¾æ ä¸­è®¾ç½®å¤šä¸ªæ ‡ç­¾ï¼Œæ¯ä¸ªæ ‡ç­¾æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªMVCã€‚ä¸€ä¸ªå°çš„MVCå¯ä½œä¸ºä¸€ä¸ªå¤§MVCçš„Vã€‚ä¸€ä¸ªå¤§çš„modelå¯ä»¥æœ‰å¤šä¸ªå°çš„MVCã€‚</li></ul><h3 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h3><p>MVVMæ¯”èµ·MVCæœ€å¤§çš„å¥½å¤„å°±æ˜¯å¯ä»¥å®ç°è‡ªåŠ¨ç»‘å®šï¼Œå°†æ•°æ®ç»‘å®šåœ¨UIç»„ä»¶ä¸Šï¼Œå½“UIä¸­çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‚£ä¹ˆå®ƒå¯¹åº”çš„æ¨¡å‹ä¸­ä¹Ÿè·Ÿéšç€å‘ç”Ÿå˜åŒ–ï¼Œè¿™å°±æ˜¯åŒå‘ç»‘å®šæœºåˆ¶ï¼ŒåŸå› åœ¨äºå®ƒåœ¨è§†å›¾å±‚å’Œæ•°æ®æ¨¡å‹å±‚ä¹‹é—´å®ç°äº†ä¸€ä¸ªç»‘å®šå™¨ï¼Œç»‘å®šå™¨å¯ä»¥ç®¡ç†ä¸¤ä¸ªå€¼ï¼Œå®ƒä¸€ç›´ç›‘å¬ç»„ä»¶UIçš„å€¼ï¼Œåªè¦å‘ç”Ÿå˜åŒ–ï¼Œå®ƒå°†ä¼šæŠŠå€¼ä¼ è¾“è¿‡å»æ”¹å˜modelä¸­çš„å€¼ã€‚ç»‘å®šå™¨æ¯”è¾ƒçµæ´»ï¼Œè¿˜å¯ä»¥å®ç°å•å‘ç»‘å®šã€‚</p><ol><li>å®é™…å¼€å‘ä¸­çš„åšæ³•ï¼šè®©Controlleræ‹¥æœ‰Viewå’ŒViewModelå±æ€§ï¼ŒVMæ‹¥æœ‰Modelå±æ€§ï¼›Controlleræˆ–è€…Viewæ¥æ¥æ”¶ViewModelå‘é€çš„Modelæ”¹å˜çš„é€šçŸ¥</li><li>ç”¨æˆ·çš„æ“ä½œç‚¹å‡»æˆ–è€…Controllerçš„è§†å›¾ç”Ÿå‘½å‘¨æœŸé‡Œé¢è®©ViewModelå»æ‰§è¡Œè¯·æ±‚ï¼Œè¯·æ±‚å®ŒæˆåViewModelå°†è¿”å›æ•°æ®æ¨¡å‹åŒ–å¹¶ä¿å­˜ï¼Œä»è€Œæ›´æ–°äº†Modelï¼›Controllerå’ŒViewæ˜¯å±äºVéƒ¨åˆ†ï¼Œå³å®ç°Væ”¹å˜Mï¼ˆVç»‘å®šMï¼‰ã€‚å¦‚æœä¸éœ€è¦è¯·æ±‚ï¼Œè¿™ç›´æ¥ä¿®æ”¹Modelå°±æ˜¯äº†ã€‚</li><li>ç¬¬2æ­¥ä¸­çš„Modelçš„æ”¹å˜ï¼ŒVMæ˜¯çŸ¥é“çš„ï¼ˆå› ä¸ºæŒæœ‰å…³ç³»ï¼‰ï¼Œåªéœ€è¦Modelæ”¹å˜åå‘ä¸€ä¸ªé€šçŸ¥ï¼›Controlleræˆ–Viewæ¥æ”¶åˆ°é€šçŸ¥åï¼ˆä¸€èˆ¬æ˜¯Controllerå…ˆæ¥æ”¶å†èµ‹å€¼ç»™Viewï¼‰ï¼Œæ ¹æ®è¿™ä¸ªæ–°Modelå»æ”¹å˜è§†å›¾å°±å®Œæˆäº†Mæ”¹å˜Vï¼ˆMç»‘å®šVï¼‰<br>ä½¿ç”¨RACï¼ˆRactiveCocoaï¼‰æ¡†æ¶å®ç°ç»‘å®šå¯ä»¥ç®€å•åˆ°ä¸€å¥è¯æ¦‚æ‹¬ï¼šViewModelä¸­åˆ›å»ºå¥½è¯·æ±‚çš„ä¿¡å·RACSignal, Controllerä¸­è®¢é˜…è¿™ä¸ªä¿¡å·ï¼Œåœ¨ViewModelå®Œæˆè¯·æ±‚åè®¢é˜…è€…è°ƒç”¨sendNext:æ–¹æ³•ï¼ŒControlleré‡Œé¢è®¢é˜…æ—¶å†™çš„blockå°±æ”¶åˆ°å›è°ƒäº†ã€‚</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;è®¾è®¡æ¨¡å¼ï¼šMVC&quot;&gt;&lt;a href=&quot;#è®¾è®¡æ¨¡å¼ï¼šMVC&quot; class=&quot;headerlink&quot; title=&quot;è®¾è®¡æ¨¡å¼ï¼šMVC&quot;&gt;&lt;/a&gt;è®¾è®¡æ¨¡å¼ï¼šMVC&lt;/h3&gt;&lt;h5 id=&quot;åœ¨æ¨¡å‹å¯¹è±¡-model-ä¸­å°è£…æ•°æ®å’ŒåŸºæœ¬è¡Œä¸º&quot;&gt;&lt;a href=&quot;#åœ¨æ¨¡å‹å¯¹è±¡-m
      
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>c++ç±»å­˜å‚¨æ–¹å¼</title>
    <link href="http://yoursite.com/2019/07/10/c-%E7%B1%BB%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/"/>
    <id>http://yoursite.com/2019/07/10/c-ç±»å­˜å‚¨æ–¹å¼/</id>
    <published>2019-07-10T15:59:11.000Z</published>
    <updated>2019-07-10T16:02:36.454Z</updated>
    
    <content type="html"><![CDATA[<div id="cnblogs_post_body" class="blogpost-body"><h4>ä¸€ã€<span style="font-family: 'Microsoft YaHei';">C++æˆå‘˜å‡½æ•°åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æ–¹å¼</span></h4><p>ã€€ã€€ç”¨ç±»å»å®šä¹‰å¯¹è±¡æ—¶ï¼Œç³»ç»Ÿä¼šä¸ºæ¯ä¸€ä¸ªå¯¹è±¡åˆ†é…å­˜å‚¨ç©ºé—´ã€‚å¦‚æœä¸€ä¸ªç±»åŒ…æ‹¬äº†æ•°æ®å’Œå‡½æ•°ï¼Œè¦åˆ†åˆ«ä¸ºæ•°æ®å’Œå‡½æ•°çš„ä»£ç åˆ†é…å­˜å‚¨ç©ºé—´ã€‚æŒ‰ç†è¯´ï¼Œå¦‚æœç”¨åŒä¸€ä¸ªç±»å®šä¹‰äº†10ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ†åˆ«ä¸º10ä¸ªå¯¹è±¡çš„æ•°æ®å’Œå‡½æ•°ä»£ç åˆ†é…å­˜å‚¨å•å…ƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p>&nbsp;</p><p><img src="http://img.blog.csdn.net/20170301171347079" alt></p><p>&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;èƒ½å¦åªç”¨ä¸€æ®µç©ºé—´æ¥å­˜æ”¾è¿™ä¸ªå…±åŒçš„å‡½æ•°ä»£ç æ®µï¼Œåœ¨è°ƒç”¨å„å¯¹è±¡çš„å‡½æ•°æ—¶ï¼Œéƒ½å»è°ƒç”¨è¿™ä¸ªå…¬ç”¨çš„å‡½æ•°ä»£ç ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="http://img.blog.csdn.net/20170301171352579" alt></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ˜¾ç„¶ï¼Œè¿™æ ·åšä¼šå¤§å¤§èŠ‚çº¦å­˜å‚¨ç©ºé—´ã€‚C++ç¼–è¯‘ç³»ç»Ÿæ­£æ˜¯è¿™æ ·åšçš„ï¼Œ<strong>å› æ­¤æ¯ä¸ªå¯¹è±¡æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´åªæ˜¯è¯¥å¯¹è±¡çš„æ•°æ®éƒ¨åˆ†ï¼ˆè™šå‡½æ•°æŒ‡é’ˆå’Œè™šåŸºç±»æŒ‡é’ˆä¹Ÿå±äºæ•°æ®éƒ¨åˆ†ï¼‰æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´ï¼Œè€Œä¸åŒ…æ‹¬å‡½æ•°ä»£ç æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´</strong>ã€‚</p><p>ã€€ã€€C++ç¨‹åºçš„å†…å­˜æ ¼å±€é€šå¸¸åˆ†ä¸ºå››ä¸ªåŒºï¼š<strong>å…¨å±€æ•°æ®åŒº(data area)ï¼Œä»£ç åŒº(code area)ï¼Œæ ˆåŒº(stack area)ï¼Œå †åŒº(heap area)(å³è‡ªç”±å­˜å‚¨åŒº)</strong>ã€‚å…¨å±€æ•°æ®åŒºå­˜æ”¾å…¨å±€å˜é‡ï¼Œé™æ€æ•°æ®å’Œå¸¸é‡ï¼›æ‰€æœ‰<strong>ç±»æˆå‘˜å‡½æ•°å’Œéæˆå‘˜å‡½æ•°ä»£ç å­˜æ”¾åœ¨ä»£ç åŒº</strong>ï¼›ä¸ºè¿è¡Œå‡½æ•°è€Œåˆ†é…çš„å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°ã€è¿”å›æ•°æ®ã€è¿”å›åœ°å€ç­‰å­˜æ”¾åœ¨æ ˆåŒºï¼›ä½™ä¸‹çš„ç©ºé—´éƒ½è¢«ç§°ä¸ºå †åŒºã€‚æ ¹æ®è¿™ä¸ªè§£é‡Šï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥åœ¨ç±»çš„å®šä¹‰æ—¶ï¼Œç±»æˆå‘˜å‡½æ•°æ˜¯è¢«æ”¾åœ¨ä»£ç åŒºï¼Œè€Œç±»çš„é™æ€æˆå‘˜å˜é‡åœ¨ç±»å®šä¹‰æ—¶å°±å·²ç»åœ¨å…¨å±€æ•°æ®åŒºåˆ†é…äº†å†…å­˜ï¼Œå› è€Œå®ƒæ˜¯å±äºç±»çš„ã€‚å¯¹äºéé™æ€æˆå‘˜å˜é‡ï¼Œæˆ‘ä»¬æ˜¯åœ¨ç±»çš„å®ä¾‹åŒ–è¿‡ç¨‹ä¸­(æ„é€ å¯¹è±¡)æ‰åœ¨æ ˆåŒºæˆ–è€…å †åŒºä¸ºå…¶åˆ†é…å†…å­˜ï¼Œæ˜¯ä¸ºæ¯ä¸ªå¯¹è±¡ç”Ÿæˆä¸€ä¸ªæ‹·è´ï¼Œæ‰€ä»¥å®ƒæ˜¯å±äºå¯¹è±¡çš„ã€‚</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åº”å½“è¯´æ˜ï¼Œå¸¸è¯´çš„â€œæŸæŸå¯¹è±¡çš„æˆå‘˜å‡½æ•°â€ï¼Œæ˜¯ä»é€»è¾‘çš„è§’åº¦è€Œè¨€çš„ï¼Œè€Œæˆå‘˜å‡½æ•°çš„å­˜å‚¨æ–¹å¼ï¼Œæ˜¯ä»ç‰©ç†çš„è§’åº¦è€Œè¨€çš„ï¼ŒäºŒè€…æ˜¯ä¸çŸ›ç›¾çš„ã€‚</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸‹é¢æˆ‘ä»¬å†æ¥è®¨è®ºä¸‹ç±»çš„é™æ€æˆå‘˜å‡½æ•°å’Œéé™æ€æˆå‘˜å‡½æ•°çš„åŒºåˆ«ï¼š<strong>é™æ€æˆå‘˜å‡½æ•°å’Œéé™æ€æˆå‘˜å‡½æ•°éƒ½æ˜¯åœ¨ç±»çš„å®šä¹‰æ—¶æ”¾åœ¨å†…å­˜çš„ä»£ç åŒº</strong>çš„ï¼Œå› è€Œå¯ä»¥è¯´å®ƒä»¬éƒ½æ˜¯å±äºç±»çš„ï¼Œä½†æ˜¯ç±»ä¸ºä»€ä¹ˆåªèƒ½ç›´æ¥è°ƒç”¨é™æ€ç±»æˆå‘˜å‡½æ•°ï¼Œè€Œéé™æ€ç±»æˆå‘˜å‡½æ•°(å³ä½¿å‡½æ•°æ²¡æœ‰å‚æ•°)åªæœ‰ç±»å¯¹è±¡æ‰èƒ½è°ƒç”¨å‘¢ï¼ŸåŸå› æ˜¯<strong>ç±»çš„éé™æ€ç±»æˆå‘˜å‡½æ•°å…¶å®éƒ½å†…å«äº†ä¸€ä¸ªæŒ‡å‘ç±»å¯¹è±¡çš„æŒ‡é’ˆå‹å‚æ•°(å³thisæŒ‡é’ˆ)ï¼Œå› è€Œåªæœ‰ç±»å¯¹è±¡æ‰èƒ½è°ƒç”¨(æ­¤æ—¶thisæŒ‡é’ˆæœ‰å®å€¼)</strong>ã€‚</p><p>äºŒã€è™šå‡½æ•°è¡¨</p><p>ç¼–è¯‘å™¨å¤„ç†è™šå‡½æ•°çš„æ–¹æ³•æ˜¯ï¼šä¸ºæ¯ä¸ªç±»å¯¹è±¡æ·»åŠ ä¸€ä¸ªéšè—æˆå‘˜ï¼Œéšè—æˆå‘˜ä¸­ä¿å­˜äº†ä¸€ä¸ªæŒ‡å‘å‡½æ•°åœ°å€æ•°ç»„çš„æŒ‡é’ˆï¼Œç§°ä¸ºè™šè¡¨æŒ‡é’ˆï¼ˆvptrï¼‰ï¼Œè¿™ç§æ•°ç»„æˆä¸ºè™šå‡½æ•°è¡¨ï¼ˆvirtual function table, vtblï¼‰ï¼Œå³ï¼Œ<strong>æ¯ä¸ªç±»ä½¿ç”¨ä¸€ä¸ªè™šå‡½æ•°è¡¨ï¼Œæ¯ä¸ªç±»å¯¹è±¡ç”¨ä¸€ä¸ªè™šè¡¨æŒ‡é’ˆ</strong>ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šåŸºç±»å¯¹è±¡åŒ…å«ä¸€ä¸ªè™šè¡¨æŒ‡é’ˆï¼ŒæŒ‡å‘åŸºç±»ä¸­æ‰€æœ‰è™šå‡½æ•°çš„åœ°å€è¡¨ã€‚æ´¾ç”Ÿç±»å¯¹è±¡ä¹Ÿå°†åŒ…å«ä¸€ä¸ªè™šè¡¨æŒ‡é’ˆï¼ŒæŒ‡å‘æ´¾ç”Ÿç±»è™šå‡½æ•°è¡¨ã€‚<em>çœ‹ä¸‹é¢ä¸¤ç§æƒ…å†µï¼š</em></p><ul><li><p>å¦‚æœæ´¾ç”Ÿç±»é‡å†™äº†åŸºç±»çš„è™šæ–¹æ³•ï¼Œè¯¥æ´¾ç”Ÿç±»è™šå‡½æ•°è¡¨å°†ä¿å­˜é‡å†™çš„è™šå‡½æ•°çš„åœ°å€ï¼Œè€Œä¸æ˜¯åŸºç±»çš„è™šå‡½æ•°åœ°å€ã€‚</p></li><li><p>å¦‚æœåŸºç±»ä¸­çš„è™šæ–¹æ³•æ²¡æœ‰åœ¨æ´¾ç”Ÿç±»ä¸­é‡å†™ï¼Œé‚£ä¹ˆæ´¾ç”Ÿç±»å°†ç»§æ‰¿åŸºç±»ä¸­çš„è™šæ–¹æ³•ï¼Œè€Œä¸”æ´¾ç”Ÿç±»ä¸­è™šå‡½æ•°è¡¨å°†ä¿å­˜åŸºç±»ä¸­æœªè¢«é‡å†™çš„è™šå‡½æ•°çš„åœ°å€ã€‚æ³¨æ„ï¼Œå¦‚æœæ´¾ç”Ÿç±»ä¸­å®šä¹‰äº†æ–°çš„è™šæ–¹æ³•ï¼Œåˆ™è¯¥è™šå‡½æ•°çš„åœ°å€ä¹Ÿå°†è¢«æ·»åŠ åˆ°æ´¾ç”Ÿç±»è™šå‡½æ•°è¡¨ä¸­ã€‚</p></li></ul><p>======================================================================================</p><p>è½¬è‡ªï¼šhttp://www.cnblogs.com/malecrab/p/5572730.html</p><p>&nbsp;</p><p><strong>1. æ¦‚è¿°</strong></p><p>ç®€å•åœ°è¯´ï¼Œæ¯ä¸€ä¸ªå«æœ‰è™šå‡½æ•°ï¼ˆæ— è®ºæ˜¯å…¶æœ¬èº«çš„ï¼Œè¿˜æ˜¯ç»§æ‰¿è€Œæ¥çš„ï¼‰çš„ç±»éƒ½è‡³å°‘æœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„è™šå‡½æ•°è¡¨ï¼Œå…¶ä¸­å­˜æ”¾ç€è¯¥ç±»æ‰€æœ‰çš„è™šå‡½æ•°å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆã€‚ä¾‹ï¼š</p><p><img src="https://images2015.cnblogs.com/blog/898333/201606/898333-20160609210402699-1501495771.png" alt></p><p>&nbsp;</p><p>å…¶ä¸­ï¼š</p><p>&nbsp;</p><ul><li>Bçš„è™šå‡½æ•°è¡¨ä¸­å­˜æ”¾ç€B::fooå’ŒB::barä¸¤ä¸ªå‡½æ•°æŒ‡é’ˆã€‚</li><li>Dçš„è™šå‡½æ•°è¡¨ä¸­å­˜æ”¾çš„æ—¢æœ‰ç»§æ‰¿è‡ªBçš„è™šå‡½æ•°B::fooï¼Œåˆæœ‰é‡å†™ï¼ˆoverrideï¼‰äº†åŸºç±»è™šå‡½æ•°B::barçš„D::barï¼Œè¿˜æœ‰æ–°å¢çš„è™šå‡½æ•°D::quzã€‚</li></ul><p>&nbsp;</p><p><em>æç¤ºï¼šä¸ºäº†æè¿°æ–¹ä¾¿ï¼Œæœ¬æ–‡åœ¨æ¢è®¨å¯¹è±¡å†…å­˜å¸ƒå±€æ—¶ï¼Œå°†å¿½ç•¥å†…å­˜å¯¹é½å¯¹å¸ƒå±€çš„å½±å“ã€‚</em></p><p>&nbsp;</p><h3>2. è™šå‡½æ•°è¡¨æ„é€ è¿‡ç¨‹</h3><p>ä»ç¼–è¯‘å™¨çš„è§’åº¦æ¥è¯´ï¼ŒBçš„è™šå‡½æ•°è¡¨å¾ˆå¥½æ„é€ ï¼ŒDçš„è™šå‡½æ•°è¡¨æ„é€ è¿‡ç¨‹ç›¸å¯¹å¤æ‚ã€‚ä¸‹é¢ç»™å‡ºäº†æ„é€ Dçš„è™šå‡½æ•°è¡¨çš„ä¸€ç§æ–¹å¼ï¼ˆä»…ä¾›å‚è€ƒï¼‰ï¼š</p><p><img src="https://images2015.cnblogs.com/blog/898333/201606/898333-20160609210418246-1188626035.png" alt></p><p>&nbsp;</p><p><em>æç¤ºï¼šè¯¥è¿‡ç¨‹æ˜¯ç”±ç¼–è¯‘å™¨å®Œæˆçš„ï¼Œå› æ­¤ä¹Ÿå¯ä»¥è¯´ï¼šè™šå‡½æ•°æ›¿æ¢è¿‡ç¨‹å‘ç”Ÿåœ¨ç¼–è¯‘æ—¶ã€‚</em></p><p>&nbsp;</p><h3>3. è™šå‡½æ•°è°ƒç”¨è¿‡ç¨‹</h3><p>ä»¥ä¸‹é¢çš„ç¨‹åºä¸ºä¾‹ï¼š</p><p><img src="https://images2015.cnblogs.com/blog/898333/201606/898333-20160609210434386-1391536209.png" alt></p><p>&nbsp;</p><p>ç¼–è¯‘å™¨åªçŸ¥é“pbæ˜¯B*ç±»å‹çš„æŒ‡é’ˆï¼Œå¹¶ä¸çŸ¥é“å®ƒæŒ‡å‘çš„å…·ä½“å¯¹è±¡ç±»å‹ ï¼špbå¯èƒ½æŒ‡å‘çš„æ˜¯Bçš„å¯¹è±¡ï¼Œä¹Ÿå¯èƒ½æŒ‡å‘çš„æ˜¯Dçš„å¯¹è±¡ã€‚</p><p>&nbsp;</p><p>ä½†å¯¹äºâ€œpb-&gt;bar()â€ï¼Œç¼–è¯‘æ—¶èƒ½å¤Ÿç¡®å®šçš„æ˜¯ï¼šæ­¤å¤„operator-&gt;çš„å¦ä¸€ä¸ªå‚æ•°æ˜¯B::barï¼ˆå› ä¸ºpbæ˜¯B*ç±»å‹çš„ï¼Œç¼–è¯‘å™¨è®¤ä¸ºbaræ˜¯B::barï¼‰ï¼Œè€ŒB::barå’ŒD::baråœ¨å„è‡ªè™šå‡½æ•°è¡¨ä¸­çš„åç§»ä½ç½®æ˜¯ç›¸ç­‰çš„ã€‚</p><p>&nbsp;</p><p>æ— è®ºpbæŒ‡å‘å“ªç§ç±»å‹çš„å¯¹è±¡ï¼Œåªè¦èƒ½å¤Ÿç¡®å®šè¢«è°ƒå‡½æ•°åœ¨è™šå‡½æ•°ä¸­çš„åç§»å€¼ï¼Œå¾…è¿è¡Œæ—¶ï¼Œèƒ½å¤Ÿç¡®å®šå…·ä½“ç±»å‹ï¼Œå¹¶èƒ½æ‰¾åˆ°ç›¸åº”vpträº†ï¼Œå°±èƒ½æ‰¾å‡ºçœŸæ­£åº”è¯¥è°ƒç”¨çš„å‡½æ•°ã€‚</p><p>&nbsp;</p><p><em>æç¤ºï¼šæœ¬äººæ›¾åœ¨â€œ<a href="http://www.cnblogs.com/malecrab/p/5572119.html" target="_blank" rel="noopener">C/C++æ‚è®°ï¼šæ·±å…¥ç†è§£æ•°æ®æˆå‘˜æŒ‡é’ˆã€å‡½æ•°æˆå‘˜æŒ‡é’ˆ</a>â€ä¸€æ–‡ä¸­æåˆ°ï¼šè™šå‡½æ•°æŒ‡é’ˆä¸­çš„ptréƒ¨åˆ†ä¸ºè™šå‡½æ•°è¡¨ä¸­çš„åç§»å€¼ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰åŠ 1ã€‚</em></p><p>&nbsp;</p><p>B::baræ˜¯ä¸€ä¸ªè™šå‡½æ•°æŒ‡é’ˆï¼Œ å®ƒçš„ptréƒ¨åˆ†å†…å®¹ä¸º9ï¼Œå®ƒåœ¨Bçš„è™šå‡½æ•°è¡¨ä¸­çš„åç§»å€¼ä¸º8ï¼ˆ8+1=9ï¼‰ã€‚</p><p>&nbsp;</p><p>å½“ç¨‹åºæ‰§è¡Œåˆ°â€œpb-&gt;bar()â€æ—¶ï¼Œå·²ç»èƒ½å¤Ÿåˆ¤æ–­pbæŒ‡å‘çš„å…·ä½“ç±»å‹äº†ï¼š</p><p>&nbsp;</p><ul><li>å¦‚æœpbæŒ‡å‘Bçš„å¯¹è±¡ï¼Œå¯ä»¥è·å–åˆ°Bå¯¹è±¡çš„vptrï¼ŒåŠ ä¸Šåç§»å€¼8ï¼ˆ(char*)vptr + 8ï¼‰ï¼Œå¯ä»¥æ‰¾åˆ°B::barã€‚</li><li>å¦‚æœpbæŒ‡å‘Dçš„å¯¹è±¡ï¼Œå¯ä»¥è·å–åˆ°Då¯¹è±¡çš„vptrï¼ŒåŠ ä¸Šåç§»å€¼8ï¼ˆ(char*)vptr + 8ï¼‰ ï¼Œå¯ä»¥æ‰¾åˆ°D::barã€‚</li><li>å¦‚æœpbæŒ‡å‘å…¶å®ƒç±»å‹å¯¹è±¡...åŒç†...</li></ul><p>&nbsp;</p><h3>4. å¤šé‡ç»§æ‰¿</h3><p>å½“ä¸€ä¸ªç±»ç»§æ‰¿å¤šä¸ªç±»ï¼Œä¸”å¤šä¸ªåŸºç±»éƒ½æœ‰è™šå‡½æ•°æ—¶ï¼Œå­ç±»å¯¹è±¡ä¸­å°†åŒ…å«å¤šä¸ªè™šå‡½æ•°è¡¨çš„æŒ‡é’ˆï¼ˆå³å¤šä¸ªvptrï¼‰ï¼Œä¾‹ï¼š</p><p><img src="https://images2015.cnblogs.com/blog/898333/201606/898333-20160609210449511-346261020.png" alt></p><p>&nbsp;</p><p>å…¶ä¸­ï¼šDè‡ªèº«çš„è™šå‡½æ•°ä¸BåŸºç±»å…±ç”¨äº†åŒä¸€ä¸ªè™šå‡½æ•°è¡¨ï¼Œå› æ­¤ä¹Ÿç§°Bä¸ºDçš„ä¸»åŸºç±»ï¼ˆprimary base classï¼‰ã€‚</p><p>&nbsp;</p><p>è™šå‡½æ•°æ›¿æ¢è¿‡ç¨‹ä¸å‰é¢æè¿°ç±»ä¼¼ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªè™šå‡½æ•°è¡¨ï¼Œå¤šäº†ä¸€æ¬¡æ‹·è´å’Œæ›¿æ¢çš„è¿‡ç¨‹ã€‚</p><p>&nbsp;</p><p>è™šå‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ï¼Œä¸å‰é¢æè¿°åŸºæœ¬ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºåŸºç±»æŒ‡é’ˆæŒ‡å‘çš„ä½ç½®å¯èƒ½ä¸æ˜¯æ´¾ç”Ÿç±»å¯¹è±¡çš„èµ·å§‹ä½ç½®ï¼Œä»¥å¦‚ä¸‹é¢çš„ç¨‹åºä¸ºä¾‹ï¼š</p><p><img src="https://images2015.cnblogs.com/blog/898333/201606/898333-20160609210505761-312956336.png" alt></p></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;div id=&quot;cnblogs_post_body&quot; class=&quot;blogpost-body&quot;&gt;&lt;h4&gt;ä¸€ã€&lt;span style=&quot;font-family: &#39;Microsoft YaHei&#39;;&quot;&gt;C++æˆå‘˜å‡½æ•°åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æ–¹å¼&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;ã€€ã€€ç”¨ç±»å»å®š
      
    
    </summary>
    
      <category term="c++" scheme="http://yoursite.com/categories/c/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
  </entry>
  
  <entry>
    <title>c++é™æ€æ–¹æ³•å’Œé™æ€æˆå‘˜</title>
    <link href="http://yoursite.com/2019/07/10/c-%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E5%92%8C%E9%9D%99%E6%80%81%E6%88%90%E5%91%98/"/>
    <id>http://yoursite.com/2019/07/10/c-é™æ€æ–¹æ³•å’Œé™æ€æˆå‘˜/</id>
    <published>2019-07-10T15:35:56.000Z</published>
    <updated>2019-07-10T15:36:41.595Z</updated>
    
    <content type="html"><![CDATA[<h3 id="c-é™æ€æ–¹æ³•å’Œé™æ€æˆå‘˜"><a href="#c-é™æ€æ–¹æ³•å’Œé™æ€æˆå‘˜" class="headerlink" title="c++é™æ€æ–¹æ³•å’Œé™æ€æˆå‘˜"></a>c++é™æ€æ–¹æ³•å’Œé™æ€æˆå‘˜</h3><h4 id="ä¾¿äºå®ç°åŒä¸€ç±»çš„ä¸åŒå¯¹è±¡ä¹‹é—´æ•°æ®å…±äº«"><a href="#ä¾¿äºå®ç°åŒä¸€ç±»çš„ä¸åŒå¯¹è±¡ä¹‹é—´æ•°æ®å…±äº«" class="headerlink" title="ä¾¿äºå®ç°åŒä¸€ç±»çš„ä¸åŒå¯¹è±¡ä¹‹é—´æ•°æ®å…±äº«"></a>ä¾¿äºå®ç°åŒä¸€ç±»çš„ä¸åŒå¯¹è±¡ä¹‹é—´æ•°æ®å…±äº«</h4><p>é™æ€æˆå‘˜çš„æå‡ºæ˜¯ä¸ºäº†è§£å†³æ•°æ®å…±äº«çš„é—®é¢˜ã€‚å®ç°å…±äº«æœ‰è®¸å¤šæ–¹æ³•ï¼Œå¦‚ï¼šè®¾ç½®å…¨å±€æ€§çš„å˜é‡æˆ–å¯¹è±¡æ˜¯ä¸€ç§æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå…¨å±€å˜é‡æˆ–å¯¹è±¡æ˜¯æœ‰å±€é™æ€§çš„ã€‚è¿™ä¸€ç« é‡Œï¼Œæˆ‘ä»¬ä¸»è¦è®²è¿°ç±»çš„é™æ€æˆå‘˜æ¥å®ç°æ•°æ®çš„å…±äº«ã€‚</p><a id="more"></a><p>ã€€ã€€é™æ€æ•°æ®æˆå‘˜</p><p>ã€€ã€€åœ¨ç±»ä¸­ï¼Œé™æ€æˆå‘˜å¯ä»¥å®ç°å¤šä¸ªå¯¹è±¡ä¹‹é—´çš„æ•°æ®å…±äº«ï¼Œå¹¶ä¸”ä½¿ç”¨é™æ€æ•°æ®æˆå‘˜è¿˜ä¸ä¼šç ´åéšè—çš„åŸåˆ™ï¼Œå³ä¿è¯äº†å®‰å…¨æ€§ã€‚å› æ­¤ï¼Œé™æ€æˆå‘˜æ˜¯ç±»çš„æ‰€æœ‰å¯¹è±¡ä¸­å…±äº«çš„æˆå‘˜ï¼Œè€Œä¸æ˜¯æŸä¸ªå¯¹è±¡çš„æˆå‘˜ã€‚</p><p>ã€€ã€€ä½¿ç”¨é™æ€æ•°æ®æˆå‘˜å¯ä»¥èŠ‚çœå†…å­˜ï¼Œå› ä¸ºå®ƒæ˜¯æ‰€æœ‰å¯¹è±¡æ‰€å…¬æœ‰çš„ï¼Œå› æ­¤ï¼Œå¯¹å¤šä¸ªå¯¹è±¡æ¥è¯´ï¼Œé™æ€æ•°æ®æˆå‘˜åªå­˜å‚¨ä¸€å¤„ï¼Œä¾›æ‰€æœ‰å¯¹è±¡å…±ç”¨ã€‚é™æ€æ•°æ®æˆå‘˜çš„å€¼å¯¹æ¯ä¸ªå¯¹è±¡éƒ½æ˜¯ä¸€æ ·ï¼Œä½†å®ƒçš„å€¼æ˜¯å¯ä»¥æ›´æ–°çš„ã€‚åªè¦å¯¹é™æ€æ•°æ®æˆå‘˜çš„å€¼æ›´æ–°ä¸€æ¬¡ï¼Œä¿è¯æ‰€æœ‰å¯¹è±¡å­˜å–æ›´æ–°åçš„ç›¸åŒçš„å€¼ï¼Œè¿™æ ·å¯ä»¥æé«˜æ—¶é—´æ•ˆç‡ã€‚</p><p>ã€€ã€€é™æ€æ•°æ®æˆå‘˜çš„ä½¿ç”¨æ–¹æ³•å’Œæ³¨æ„äº‹é¡¹å¦‚ä¸‹ï¼š</p><p>ã€€ã€€1ã€é™æ€æ•°æ®æˆå‘˜åœ¨å®šä¹‰æˆ–è¯´æ˜æ—¶å‰é¢åŠ å…³é”®å­—staticã€‚//é™æ€å˜é‡çš„å®šä¹‰</p><p>ã€€ã€€2ã€é™æ€æˆå‘˜åˆå§‹åŒ–ä¸ä¸€èˆ¬æ•°æ®æˆå‘˜åˆå§‹åŒ–ä¸åŒã€‚é™æ€æ•°æ®æˆå‘˜åˆå§‹åŒ–çš„æ ¼å¼å¦‚ä¸‹ï¼š</p><p>ã€€ã€€ã€€ã€€&lt;æ•°æ®ç±»å‹&gt;&lt;ç±»å&gt;::&lt;é™æ€æ•°æ®æˆå‘˜å&gt;=&lt;å€¼&gt;  //é™æ€å˜é‡çš„åˆå§‹åŒ–</p><p>ã€€ã€€è¿™è¡¨æ˜ï¼š</p><ul><li>(1) åˆå§‹åŒ–åœ¨ç±»ä½“å¤–è¿›è¡Œï¼Œè€Œå‰é¢ä¸åŠ staticï¼Œï¼ˆè¿™ç‚¹éœ€è¦æ³¨æ„ï¼‰ä»¥å…ä¸ä¸€èˆ¬é™æ€å˜é‡æˆ–å¯¹è±¡ç›¸æ··æ·†ã€‚</li></ul><ul><li><p>(2) åˆå§‹åŒ–æ—¶ä¸åŠ è¯¥æˆå‘˜çš„è®¿é—®æƒé™æ§åˆ¶ç¬¦privateï¼Œpublicç­‰ã€‚</p></li><li><p>(3) åˆå§‹åŒ–æ—¶ä½¿ç”¨ä½œç”¨åŸŸè¿ç®—ç¬¦æ¥æ ‡æ˜å®ƒæ‰€å±ç±»ï¼Œå› æ­¤ï¼Œé™æ€æ•°æ®æˆå‘˜æ˜¯ç±»çš„æˆå‘˜ï¼Œè€Œä¸æ˜¯å¯¹è±¡çš„æˆå‘˜ã€‚</p></li></ul><p>ã€€ã€€3ã€é™æ€æ•°æ®æˆå‘˜æ˜¯é™æ€å­˜å‚¨çš„ï¼Œå®ƒæ˜¯é™æ€ç”Ÿå­˜æœŸï¼Œå¿…é¡»å¯¹å®ƒè¿›è¡Œåˆå§‹åŒ–ã€‚</p><p>ã€€ã€€4ã€å¼•ç”¨é™æ€æ•°æ®æˆå‘˜æ—¶ï¼Œé‡‡ç”¨å¦‚ä¸‹æ ¼å¼ï¼š</p><p>ã€€ã€€ã€€&lt;ç±»å&gt;::&lt;é™æ€æˆå‘˜å&gt;   //é™æ€å˜é‡çš„ä½¿ç”¨æ–¹å¼</p><p>ã€€ã€€å¦‚æœé™æ€æ•°æ®æˆå‘˜çš„è®¿é—®æƒé™å…è®¸çš„è¯(å³publicçš„æˆå‘˜)ï¼Œå¯åœ¨ç¨‹åºä¸­ï¼ŒæŒ‰ä¸Šè¿°æ ¼å¼æ¥å¼•ç”¨é™æ€æ•°æ®æˆå‘˜ã€‚</p><p>ã€€ã€€ä¸‹é¢ä¸¾ä¸€ä¾‹å­ï¼Œè¯´æ˜é™æ€æ•°æ®æˆå‘˜çš„åº”ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StaticTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    StaticTest(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c);</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetNumber</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetSum</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">f1</span><span class="params">(StaticTest &amp;s)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> A, B, C;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> Sum;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#include "StaticTest.h"</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> StaticTest::Sum = <span class="number">0</span>;<span class="comment">//é™æ€æˆå‘˜åœ¨æ­¤åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">StaticTest::StaticTest(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span><br><span class="line">&#123;</span><br><span class="line">    A = a;</span><br><span class="line">    B = b;</span><br><span class="line">    C = c;</span><br><span class="line">    Sum += A + B + C;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> StaticTest::GetNumber()</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">"Number = "</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> StaticTest::GetSum()</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">"Sum = "</span> &lt;&lt; Sum &lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> StaticTest::f1(StaticTest &amp;s)</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; s.A &lt;&lt; endl;<span class="comment">//é™æ€æ–¹æ³•ä¸èƒ½ç›´æ¥è°ƒç”¨ä¸€èˆ¬æˆå‘˜ï¼Œå¯ä»¥é€šè¿‡å¯¹è±¡å¼•ç”¨å®ç°è°ƒç”¨</span></span><br><span class="line">    cout &lt;&lt; Sum &lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#include "StaticTest.h"</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">StaticTest <span class="title">M</span><span class="params">(<span class="number">3</span>, <span class="number">7</span>, <span class="number">10</span>)</span>, <span class="title">N</span><span class="params">(<span class="number">14</span>, <span class="number">9</span>, <span class="number">11</span>)</span></span>;</span><br><span class="line">    M.GetNumber();</span><br><span class="line">    N.GetSum();</span><br><span class="line">    M.GetNumber();</span><br><span class="line">    N.GetSum();</span><br><span class="line">    StaticTest::f1(M);</span><br><span class="line">    system(<span class="string">"pause"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;c-é™æ€æ–¹æ³•å’Œé™æ€æˆå‘˜&quot;&gt;&lt;a href=&quot;#c-é™æ€æ–¹æ³•å’Œé™æ€æˆå‘˜&quot; class=&quot;headerlink&quot; title=&quot;c++é™æ€æ–¹æ³•å’Œé™æ€æˆå‘˜&quot;&gt;&lt;/a&gt;c++é™æ€æ–¹æ³•å’Œé™æ€æˆå‘˜&lt;/h3&gt;&lt;h4 id=&quot;ä¾¿äºå®ç°åŒä¸€ç±»çš„ä¸åŒå¯¹è±¡ä¹‹é—´æ•°æ®å…±äº«&quot;&gt;&lt;a href=&quot;#ä¾¿äºå®ç°åŒä¸€ç±»çš„ä¸åŒå¯¹è±¡ä¹‹é—´æ•°æ®å…±äº«&quot; class=&quot;headerlink&quot; title=&quot;ä¾¿äºå®ç°åŒä¸€ç±»çš„ä¸åŒå¯¹è±¡ä¹‹é—´æ•°æ®å…±äº«&quot;&gt;&lt;/a&gt;ä¾¿äºå®ç°åŒä¸€ç±»çš„ä¸åŒå¯¹è±¡ä¹‹é—´æ•°æ®å…±äº«&lt;/h4&gt;&lt;p&gt;é™æ€æˆå‘˜çš„æå‡ºæ˜¯ä¸ºäº†è§£å†³æ•°æ®å…±äº«çš„é—®é¢˜ã€‚å®ç°å…±äº«æœ‰è®¸å¤šæ–¹æ³•ï¼Œå¦‚ï¼šè®¾ç½®å…¨å±€æ€§çš„å˜é‡æˆ–å¯¹è±¡æ˜¯ä¸€ç§æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå…¨å±€å˜é‡æˆ–å¯¹è±¡æ˜¯æœ‰å±€é™æ€§çš„ã€‚è¿™ä¸€ç« é‡Œï¼Œæˆ‘ä»¬ä¸»è¦è®²è¿°ç±»çš„é™æ€æˆå‘˜æ¥å®ç°æ•°æ®çš„å…±äº«ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="c++" scheme="http://yoursite.com/categories/c/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
  </entry>
  
  <entry>
    <title>è®¡ç®—æœºå›¾å½¢å­¦ || åŸºç¡€å…‰ç…§ä¹‹å†¯æ°å…‰ç…§æ¨¡å‹</title>
    <link href="http://yoursite.com/2019/07/10/%E5%9F%BA%E7%A1%80%E5%85%89%E7%85%A7%E4%B9%8B%E5%86%AF%E6%B0%8F%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B/"/>
    <id>http://yoursite.com/2019/07/10/åŸºç¡€å…‰ç…§ä¹‹å†¯æ°å…‰ç…§æ¨¡å‹/</id>
    <published>2019-07-10T15:34:18.000Z</published>
    <updated>2019-07-10T15:35:28.675Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Basic"><a href="#Basic" class="headerlink" title="Basic:"></a>Basic:</h3><h4 id="1-Phongå…‰ç…§æ¨¡å‹"><a href="#1-Phongå…‰ç…§æ¨¡å‹" class="headerlink" title="1. Phongå…‰ç…§æ¨¡å‹:"></a>1. Phongå…‰ç…§æ¨¡å‹:</h4><p>ç»„æˆåˆ†é‡ï¼š</p><ul><li>ç¯å¢ƒå…‰ç…§(Ambient Lighting)<ul><li>å³ä½¿åœ¨é»‘æš—çš„æƒ…å†µä¸‹ï¼Œä¸–ç•Œä¸Šé€šå¸¸ä¹Ÿä»ç„¶æœ‰ä¸€äº›å…‰äº®ï¼ˆæœˆäº®ã€è¿œå¤„çš„å…‰ï¼‰ï¼Œæ‰€ä»¥ç‰©ä½“å‡ ä¹æ°¸è¿œä¸ä¼šæ˜¯å®Œå…¨é»‘æš—çš„ã€‚ä¸ºäº†æ¨¡æ‹Ÿè¿™ä¸ªï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ä¸€ä¸ªç¯å¢ƒå…‰ç…§å¸¸é‡ï¼Œå®ƒæ°¸è¿œä¼šç»™ç‰©ä½“ä¸€äº›é¢œè‰²ã€‚</li></ul></li></ul><a id="more"></a><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ambient</span></span><br><span class="line"><span class="keyword">float</span> ambientStrength = <span class="number">0.1</span>;</span><br><span class="line">vec3 ambient = ambientStrength * lightColor;</span><br></pre></td></tr></table></figure><p>[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥(img-xFNsmLz4-1562772901265)(<a href="https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/hw6.3.png)]" target="_blank" rel="noopener">https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/hw6.3.png)]</a></p><ul><li>æ¼«åå°„å…‰ç…§(Diffuse Lighting)<ul><li>æ¨¡æ‹Ÿå…‰æºå¯¹ç‰©ä½“çš„æ–¹å‘æ€§å½±å“(Directional Impact)ã€‚å®ƒæ˜¯å†¯æ°å…‰ç…§æ¨¡å‹ä¸­è§†è§‰ä¸Šæœ€æ˜¾è‘—çš„åˆ†é‡ã€‚ç‰©ä½“çš„æŸä¸€éƒ¨åˆ†è¶Šæ˜¯æ­£å¯¹ç€å…‰æºï¼Œå®ƒå°±ä¼šè¶Šäº®ã€‚</li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// diffuse</span></span><br><span class="line">vec3 norm = normalize(Normal);</span><br><span class="line">vec3 lightDir = normalize(lightPos - FragPos);</span><br><span class="line"><span class="keyword">float</span> diff = max(dot(norm, lightDir), <span class="number">0.0</span>);</span><br><span class="line">vec3 diffuse = diff * lightColor;</span><br></pre></td></tr></table></figure><p>[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥(img-hHmO2k6S-1562772901266)(<a href="https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/hw6.4.png)]" target="_blank" rel="noopener">https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/hw6.4.png)]</a></p><ul><li>é•œé¢å…‰ç…§(Specular Lighting)<ul><li>æ¨¡æ‹Ÿæœ‰å…‰æ³½ç‰©ä½“ä¸Šé¢å‡ºç°çš„äº®ç‚¹ã€‚é•œé¢å…‰ç…§çš„é¢œè‰²ç›¸æ¯”äºç‰©ä½“çš„é¢œè‰²ä¼šæ›´å€¾å‘äºå…‰çš„é¢œè‰²ã€‚</li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// specular</span></span><br><span class="line"><span class="keyword">float</span> specularStrength = <span class="number">0.5</span>;</span><br><span class="line">vec3 viewDir = normalize(viewPos - FragPos);</span><br><span class="line">vec3 reflectDir = reflect(-lightDir, norm);</span><br><span class="line"><span class="comment">// é«˜å…‰çš„åå…‰åº¦32</span></span><br><span class="line"><span class="keyword">float</span> spec = <span class="built_in">pow</span>(max(dot(viewDir, reflectDir), <span class="number">0.0</span>), <span class="number">32</span>);</span><br><span class="line">vec3 specular = specularStrength * spec * lightColor;</span><br></pre></td></tr></table></figure><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL1dhbmdQZXJyeVdQWS9QSWNHby9tYXN0ZXIvaHc2LjUucG5n" alt="hw65"></p><h4 id="2-Gouraud-Shadingï¼š"><a href="#2-Gouraud-Shadingï¼š" class="headerlink" title="2. Gouraud Shadingï¼š"></a>2. Gouraud Shadingï¼š</h4><p>Gouraud å…‰ç…§æ¨¡å‹å’Œ Phong å…‰ç…§æ¨¡å‹çš„åŒºåˆ«åœ¨äº: Gouraud æ˜¯åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­å®ç°çš„ï¼Œè€Œ Phong æ˜¯åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­å®ç°ã€‚ ç›¸æ¯”è¾ƒä¹‹ä¸‹ Gouraud å…‰ç…§æ¨¡å‹åšå…‰ç…§å› ä¸ºé¡¶ç‚¹æ•°å°‘äºç‰‡æ®µæ•°ï¼Œæ‰€ä»¥ä¼šæ›´é«˜æ•ˆï¼Œå¼€é”€æ›´ä½ã€‚ä½†é¡¶ç‚¹ç€è‰²å™¨ä¸­çš„æœ€ç»ˆé¢œè‰²å€¼ä»…ä»…æ˜¯è¯¥é¡¶ç‚¹çš„é¢œè‰²å€¼ï¼Œç‰‡æ®µçš„é¢œè‰²å€¼æ˜¯ç”±æ’å€¼å…‰ç…§é¢œè‰²å¾—æ¥çš„ï¼Œå› æ­¤å…‰ç…§æ•ˆæœä¼šæ˜¾å¾—ä¸å¤ŸçœŸå®ã€‚</p><ul><li>gouraud.vs</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 330 core</span></span><br><span class="line">layout (location = <span class="number">0</span>) in vec3 aPos;</span><br><span class="line">layout (location = <span class="number">1</span>) in vec3 aNormal;</span><br><span class="line">out vec3 LightingColor; <span class="comment">// resulting color from lighting calculations</span></span><br><span class="line">uniform vec3 lightPos;</span><br><span class="line">uniform vec3 viewPos;</span><br><span class="line">uniform vec3 lightColor;</span><br><span class="line">uniform mat4 model;</span><br><span class="line">uniform mat4 view;</span><br><span class="line">uniform mat4 projection;</span><br><span class="line">uniform <span class="keyword">float</span> ambientStrength;</span><br><span class="line">uniform <span class="keyword">float</span> diffuseStrength;</span><br><span class="line">uniform <span class="keyword">float</span> specularStrength;</span><br><span class="line">uniform <span class="keyword">int</span> reflectance;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    gl_Position = projection * view * model * vec4(aPos, <span class="number">1.0</span>); </span><br><span class="line">    <span class="comment">// gouraud shading</span></span><br><span class="line">    <span class="comment">// ------------------------</span></span><br><span class="line">    vec3 Position = vec3(model * vec4(aPos, <span class="number">1.0</span>));</span><br><span class="line">    vec3 Normal = mat3(transpose(inverse(model))) * aNormal;</span><br><span class="line">    <span class="comment">// ambient</span></span><br><span class="line">    vec3 ambient = ambientStrength * lightColor;</span><br><span class="line">    <span class="comment">// diffuse</span></span><br><span class="line">    vec3 norm = normalize(Normal);</span><br><span class="line">    vec3 lightDir = normalize(lightPos - Position);</span><br><span class="line">    <span class="keyword">float</span> diff = max(dot(norm, lightDir), <span class="number">0.0</span>);</span><br><span class="line">    vec3 diffuse = diffuseStrength * diff * lightColor;</span><br><span class="line">    <span class="comment">// specular</span></span><br><span class="line">    vec3 viewDir = normalize(viewPos - Position);</span><br><span class="line">    vec3 reflectDir = reflect(-lightDir, norm);</span><br><span class="line">    <span class="keyword">float</span> spec = <span class="built_in">pow</span>(max(dot(viewDir, reflectDir), <span class="number">0.0</span>), reflectance);</span><br><span class="line">    vec3 specular = specularStrength * spec * lightColor;</span><br><span class="line">    </span><br><span class="line">    LightingColor = ambient + diffuse + specular;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>gouraud.fs</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 330 core</span></span><br><span class="line">out vec4 FragColor;</span><br><span class="line">in vec3 LightingColor;</span><br><span class="line">uniform vec3 objectColor;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FragColor = vec4(LightingColor * objectColor, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥(img-Z67sCDhW-1562772901267)(<a href="https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/hw6.6.png)]" target="_blank" rel="noopener">https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/hw6.6.png)]</a></p><p>[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥(img-YPlIlHON-1562772901268)(<a href="https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/hw6.7.png)]" target="_blank" rel="noopener">https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/hw6.7.png)]</a></p><p>é€šè¿‡ä¸¤å¼ å›¾æ¯”è¾ƒå¯ä»¥æ˜æ˜¾çœ‹å‡ºåŒºåˆ«ï¼Œå…¶ä¸­åœ¨ Gouraud å…‰ç…§æ¨¡å‹ä¸­å¯ä»¥çœ‹åˆ°â€œæ¡çº¹â€ã€‚å¯ä»¥çœ‹åˆ°ç«‹æ–¹ä½“æ­£é¢çš„å³ä¸Šè§’è¢«é«˜å…‰ç…§äº®ã€‚ç”±äºå³ä¸‹è§’ä¸‰è§’å½¢çš„å³ä¸Šé¡¶ç‚¹æ˜¯äº®çš„ï¼Œè€Œä¸‰è§’å½¢çš„å…¶ä»–ä¸¤ä¸ªé¡¶ç‚¹ä¸æ˜¯äº®çš„ï¼Œæ‰€ä»¥äº®å€¼å†…æ’åˆ°å…¶ä»–ä¸¤ä¸ªé¡¶ç‚¹ã€‚å·¦ä¸Šè§’çš„ä¸‰è§’å½¢ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ç”±äºä¸­é—´ç¢ç‰‡çš„é¢œè‰²ä¸æ˜¯ç›´æ¥æ¥è‡ªå…‰æºï¼Œè€Œæ˜¯æ’å€¼çš„ç»“æœï¼Œä¸­é—´ç¢ç‰‡çš„å…‰ç…§æ˜¯ä¸æ­£ç¡®çš„ï¼Œå·¦ä¸Šè§’å’Œå³ä¸‹è§’çš„ä¸‰è§’å½¢åœ¨äº®åº¦ä¸Šå‘ç”Ÿç¢°æ’ï¼Œå¯¼è‡´ä¸¤ä¸ªä¸‰è§’å½¢ä¹‹é—´å‡ºç°å¯è§çš„æ¡çº¹ã€‚</p><h4 id="3-ä½¿ç”¨GUIï¼Œä½¿å‚æ•°å¯è°ƒèŠ‚ï¼Œæ•ˆæœå®æ—¶æ›´æ”¹"><a href="#3-ä½¿ç”¨GUIï¼Œä½¿å‚æ•°å¯è°ƒèŠ‚ï¼Œæ•ˆæœå®æ—¶æ›´æ”¹" class="headerlink" title="3. ä½¿ç”¨GUIï¼Œä½¿å‚æ•°å¯è°ƒèŠ‚ï¼Œæ•ˆæœå®æ—¶æ›´æ”¹"></a>3. ä½¿ç”¨GUIï¼Œä½¿å‚æ•°å¯è°ƒèŠ‚ï¼Œæ•ˆæœå®æ—¶æ›´æ”¹</h4><h5 id="a-GUIé‡Œå¯ä»¥åˆ‡æ¢ä¸¤ç§shadingã€‚"><a href="#a-GUIé‡Œå¯ä»¥åˆ‡æ¢ä¸¤ç§shadingã€‚" class="headerlink" title="a. GUIé‡Œå¯ä»¥åˆ‡æ¢ä¸¤ç§shadingã€‚"></a>a. GUIé‡Œå¯ä»¥åˆ‡æ¢ä¸¤ç§shadingã€‚</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ImGui::NewFrame();</span><br><span class="line">&#123;</span><br><span class="line">    ImGui::Begin(<span class="string">"HW6_WPY"</span>, &amp;tool_active, ImGuiWindowFlags_MenuBar);</span><br><span class="line">    <span class="keyword">if</span> (ImGui::BeginMenuBar())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ImGui::BeginMenu(<span class="string">"Menu"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ImGui::MenuItem(<span class="string">"Phong Shading"</span>)) &#123;</span><br><span class="line">                phong = <span class="literal">true</span>;</span><br><span class="line">                gouraud = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ImGui::MenuItem(<span class="string">"Gouraud Shading"</span>)) &#123;</span><br><span class="line">                gouraud = <span class="literal">true</span>;</span><br><span class="line">                phong = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ImGui::MenuItem(<span class="string">"Close"</span>)) &#123;</span><br><span class="line">                tool_active = <span class="literal">false</span>;</span><br><span class="line">                glfwSetWindowShouldClose(window, <span class="literal">true</span>);<span class="comment">//å…³é—­çª—å£</span></span><br><span class="line">            &#125;</span><br><span class="line">            ImGui::EndMenu();</span><br><span class="line">        &#125;</span><br><span class="line">        ImGui::EndMenuBar();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥(img-sXwX5NTE-1562772901268)(<a href="https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/hw6.8.png)]" target="_blank" rel="noopener">https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/hw6.8.png)]</a></p><p>[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥(img-29uGtkWr-1562772901269)(<a href="https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/hw6.9.png)]" target="_blank" rel="noopener">https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/hw6.9.png)]</a></p><h5 id="b-ä½¿ç”¨å¦‚è¿›åº¦æ¡è¿™æ ·çš„æ§ä»¶ï¼Œä½¿ambientå› å­ã€diffuseå› å­ã€specularå› å­ã€åå…‰åº¦ç­‰å‚æ•°å¯è°ƒèŠ‚ï¼Œå…‰ç…§æ•ˆæœå®æ—¶æ›´æ”¹ã€‚"><a href="#b-ä½¿ç”¨å¦‚è¿›åº¦æ¡è¿™æ ·çš„æ§ä»¶ï¼Œä½¿ambientå› å­ã€diffuseå› å­ã€specularå› å­ã€åå…‰åº¦ç­‰å‚æ•°å¯è°ƒèŠ‚ï¼Œå…‰ç…§æ•ˆæœå®æ—¶æ›´æ”¹ã€‚" class="headerlink" title="b. ä½¿ç”¨å¦‚è¿›åº¦æ¡è¿™æ ·çš„æ§ä»¶ï¼Œä½¿ambientå› å­ã€diffuseå› å­ã€specularå› å­ã€åå…‰åº¦ç­‰å‚æ•°å¯è°ƒèŠ‚ï¼Œå…‰ç…§æ•ˆæœå®æ—¶æ›´æ”¹ã€‚"></a>b. ä½¿ç”¨å¦‚è¿›åº¦æ¡è¿™æ ·çš„æ§ä»¶ï¼Œä½¿ambientå› å­ã€diffuseå› å­ã€specularå› å­ã€åå…‰åº¦ç­‰å‚æ•°å¯è°ƒèŠ‚ï¼Œå…‰ç…§æ•ˆæœå®æ—¶æ›´æ”¹ã€‚</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (phong)</span><br><span class="line">&#123;</span><br><span class="line">    ImGui::Text(<span class="string">"1.Phong Shading"</span>);</span><br><span class="line">    ImGui::Text(<span class="string">"change the ambient strength"</span>);</span><br><span class="line">    ImGui::SliderFloat(<span class="string">"ambient strength"</span>, &amp;ambient, <span class="number">0.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line">    ImGui::Text(<span class="string">"change the diffuse strength"</span>);</span><br><span class="line">    ImGui::SliderFloat(<span class="string">"diffuse strength"</span>, &amp;diffuse, <span class="number">0.0f</span>, <span class="number">5.0f</span>);</span><br><span class="line">    ImGui::Text(<span class="string">"change the specular strength"</span>);</span><br><span class="line">    ImGui::SliderFloat(<span class="string">"specular strength"</span>, &amp;specular, <span class="number">0.0f</span>, <span class="number">10.0f</span>);</span><br><span class="line">    ImGui::Text(<span class="string">"change the reflectance"</span>);</span><br><span class="line">    ImGui::SliderInt(<span class="string">"reflectance"</span>, &amp;reflectance, <span class="number">2</span>, <span class="number">256</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">phongObject.setFloat(<span class="string">"ambientStrength"</span>, ambient);</span><br><span class="line">phongObject.setFloat(<span class="string">"diffuseStrength"</span>, diffuse);</span><br><span class="line">phongObject.setFloat(<span class="string">"specularStrength"</span>, specular);</span><br><span class="line">phongObject.setInt(<span class="string">"reflectance"</span>, reflectance);</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uniform <span class="keyword">float</span> ambientStrength;</span><br><span class="line">uniform <span class="keyword">float</span> diffuseStrength;</span><br><span class="line">uniform <span class="keyword">float</span> specularStrength;</span><br><span class="line">uniform <span class="keyword">int</span> reflectance;</span><br></pre></td></tr></table></figure><p><strong>ambientå› å­ï¼š</strong></p><p>[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥(img-6L9x63Ca-1562772901269)(<a href="https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/can11.png)]" target="_blank" rel="noopener">https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/can11.png)]</a></p><p>[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥(img-oJuOBozY-1562772901270)(<a href="https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/can12.png)]" target="_blank" rel="noopener">https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/can12.png)]</a></p><p><strong>diffuseå› å­ï¼š</strong></p><p>[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥(img-Rb8KzeRc-1562772901270)(<a href="https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/can21.png)]" target="_blank" rel="noopener">https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/can21.png)]</a></p><p>[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥(img-cnUpmggP-1562772901270)(<a href="https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/can22.png)]" target="_blank" rel="noopener">https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/can22.png)]</a></p><p><strong>specularå› å­ï¼š</strong></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL1dhbmdQZXJyeVdQWS9QSWNHby9tYXN0ZXIvY2FuMzEucG5n" alt="can31"></p><p>[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥(img-TLYg0rUe-1562772901272)(<a href="https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/can32.png)]" target="_blank" rel="noopener">https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/can32.png)]</a></p><p><strong>åå…‰åº¦ï¼š</strong></p><p>[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥(img-fL9wCWBw-1562772901272)(<a href="https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/can41.png)]" target="_blank" rel="noopener">https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/can41.png)]</a></p><p>[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥(img-wZt6ippZ-1562772901272)(<a href="https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/can42.png)]" target="_blank" rel="noopener">https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/can42.png)]</a></p><h3 id="Bonus"><a href="#Bonus" class="headerlink" title="Bonus:"></a>Bonus:</h3><h4 id="å½“å‰å…‰æºä¸ºé™æ­¢çŠ¶æ€ï¼Œå°è¯•ä½¿å…‰æºåœ¨åœºæ™¯ä¸­æ¥å›ç§»åŠ¨ï¼Œå…‰ç…§æ•ˆæœå®æ—¶æ›´æ”¹ã€‚"><a href="#å½“å‰å…‰æºä¸ºé™æ­¢çŠ¶æ€ï¼Œå°è¯•ä½¿å…‰æºåœ¨åœºæ™¯ä¸­æ¥å›ç§»åŠ¨ï¼Œå…‰ç…§æ•ˆæœå®æ—¶æ›´æ”¹ã€‚" class="headerlink" title="å½“å‰å…‰æºä¸ºé™æ­¢çŠ¶æ€ï¼Œå°è¯•ä½¿å…‰æºåœ¨åœºæ™¯ä¸­æ¥å›ç§»åŠ¨ï¼Œå…‰ç…§æ•ˆæœå®æ—¶æ›´æ”¹ã€‚"></a>å½“å‰å…‰æºä¸ºé™æ­¢çŠ¶æ€ï¼Œå°è¯•ä½¿å…‰æºåœ¨åœºæ™¯ä¸­æ¥å›ç§»åŠ¨ï¼Œå…‰ç…§æ•ˆæœå®æ—¶æ›´æ”¹ã€‚</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> radius = <span class="number">1.0f</span>;</span><br><span class="line"><span class="keyword">float</span> X = <span class="built_in">sin</span>(glfwGetTime()) * radius;</span><br><span class="line"><span class="keyword">float</span> Z = <span class="built_in">cos</span>(glfwGetTime()) * radius;</span><br><span class="line">lightPos = glm::vec3(X, <span class="number">0.0f</span>, Z);</span><br></pre></td></tr></table></figure><p>[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥(img-zPYOHM7L-1562772901273)(<a href="https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/hw6.2.gif)]" target="_blank" rel="noopener">https://raw.githubusercontent.com/WangPerryWPY/PIcGo/master/hw6.2.gif)]</a><br>githubåœ°å€ï¼š<a href="https://github.com/WangPerryWPY/Computer_Graphics/tree/master/HW6" target="_blank" rel="noopener">https://github.com/WangPerryWPY/Computer_Graphics/tree/master/HW6</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Basic&quot;&gt;&lt;a href=&quot;#Basic&quot; class=&quot;headerlink&quot; title=&quot;Basic:&quot;&gt;&lt;/a&gt;Basic:&lt;/h3&gt;&lt;h4 id=&quot;1-Phongå…‰ç…§æ¨¡å‹&quot;&gt;&lt;a href=&quot;#1-Phongå…‰ç…§æ¨¡å‹&quot; class=&quot;headerlink&quot; title=&quot;1. Phongå…‰ç…§æ¨¡å‹:&quot;&gt;&lt;/a&gt;1. Phongå…‰ç…§æ¨¡å‹:&lt;/h4&gt;&lt;p&gt;ç»„æˆåˆ†é‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¯å¢ƒå…‰ç…§(Ambient Lighting)&lt;ul&gt;
&lt;li&gt;å³ä½¿åœ¨é»‘æš—çš„æƒ…å†µä¸‹ï¼Œä¸–ç•Œä¸Šé€šå¸¸ä¹Ÿä»ç„¶æœ‰ä¸€äº›å…‰äº®ï¼ˆæœˆäº®ã€è¿œå¤„çš„å…‰ï¼‰ï¼Œæ‰€ä»¥ç‰©ä½“å‡ ä¹æ°¸è¿œä¸ä¼šæ˜¯å®Œå…¨é»‘æš—çš„ã€‚ä¸ºäº†æ¨¡æ‹Ÿè¿™ä¸ªï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ä¸€ä¸ªç¯å¢ƒå…‰ç…§å¸¸é‡ï¼Œå®ƒæ°¸è¿œä¼šç»™ç‰©ä½“ä¸€äº›é¢œè‰²ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="è®¡ç®—æœºå›¾å½¢å­¦" scheme="http://yoursite.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="è®¡ç®—æœºå›¾å½¢å­¦" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>iOSåº”ç”¨ç”Ÿå‘½å‘¨æœŸ</title>
    <link href="http://yoursite.com/2019/07/10/iOS%E5%BA%94%E7%94%A8%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
    <id>http://yoursite.com/2019/07/10/iOSåº”ç”¨ç”Ÿå‘½å‘¨æœŸ/</id>
    <published>2019-07-10T15:33:10.000Z</published>
    <updated>2019-07-10T15:33:50.391Z</updated>
    
    <content type="html"><![CDATA[<h2 id="IOSåº”ç”¨ç”Ÿå‘½å‘¨æœŸ"><a href="#IOSåº”ç”¨ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="IOSåº”ç”¨ç”Ÿå‘½å‘¨æœŸ"></a>IOSåº”ç”¨ç”Ÿå‘½å‘¨æœŸ</h2><h4 id="åˆ†ä¸ºä»¥ä¸‹5ç§çŠ¶æ€ï¼š"><a href="#åˆ†ä¸ºä»¥ä¸‹5ç§çŠ¶æ€ï¼š" class="headerlink" title="åˆ†ä¸ºä»¥ä¸‹5ç§çŠ¶æ€ï¼š"></a>åˆ†ä¸ºä»¥ä¸‹5ç§çŠ¶æ€ï¼š</h4><ul><li>Not running(éè¿è¡ŒçŠ¶æ€)<ul><li>åº”ç”¨ç¨‹åºæ²¡æœ‰è¿è¡Œæˆ–è¢«ç³»ç»Ÿç»ˆæ­¢</li></ul></li><li>Inactive(å‰å°éæ´»åŠ¨çŠ¶æ€)<ul><li>æ­£åœ¨è¿›å…¥å‰å°çŠ¶æ€ä½†æ˜¯ä¸èƒ½æ¥å—äº‹ä»¶å¤„ç†</li></ul></li><li>Active(å‰å°æ´»åŠ¨çŠ¶æ€)<ul><li>è¿›å…¥å‰å°ï¼Œèƒ½æ¥å—äº‹ä»¶å¤„ç†</li></ul></li><li>Background(åå°çŠ¶æ€)<ul><li>å¦‚æœæœ‰å¯æ‰§è¡Œçš„ä»£ç åˆ™æ‰§è¡Œä»£ç ï¼Œæ²¡æœ‰æˆ–æ‰§è¡Œå®Œæ¯•åˆ™é©¬ä¸Šè¿›å…¥æŒ‚èµ·çŠ¶æ€ã€‚</li></ul></li><li>Suspended(æŒ‚èµ·çŠ¶æ€)<ul><li>å†·å†»çŠ¶æ€ï¼Œä¸èƒ½æ‰§è¡Œä»£ç ã€‚å¦‚æœç³»ç»Ÿå†…å­˜ä¸å¤Ÿï¼Œåº”ç”¨è¢«ç»ˆæ­¢ã€‚</li></ul></li></ul><a id="more"></a><p><img src="https://img-blog.csdnimg.cn/20190426151844410.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="AppDelegateä¸­çŠ¶æ€è·ƒè¿çš„åº”ç”¨å›è°ƒæ–¹æ³•ï¼š"><a href="#AppDelegateä¸­çŠ¶æ€è·ƒè¿çš„åº”ç”¨å›è°ƒæ–¹æ³•ï¼š" class="headerlink" title="AppDelegateä¸­çŠ¶æ€è·ƒè¿çš„åº”ç”¨å›è°ƒæ–¹æ³•ï¼š"></a>AppDelegateä¸­çŠ¶æ€è·ƒè¿çš„åº”ç”¨å›è°ƒæ–¹æ³•ï¼š</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åº”ç”¨ç¨‹åºå¯åŠ¨å¹¶è¿›è¡Œåˆå§‹åŒ–è°ƒç”¨è¯¥æ–¹æ³•å‘å‡ºé€šçŸ¥</span></span><br><span class="line"><span class="comment">// å®ä¾‹åŒ–æ ¹è§†å›¾æ§åˆ¶å™¨</span></span><br><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;</span><br><span class="line">    NSLog(@<span class="string">"%@"</span>, @<span class="string">"application: didFinishLaunchingWithOptions:"</span>);</span><br><span class="line">    <span class="keyword">return</span> YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»æ´»åŠ¨çŠ¶æ€è¿›å…¥éæ´»åŠ¨çŠ¶æ€è°ƒç”¨è¯¥æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">// æ­¤çŠ¶æ€å¯ä»¥ä¿å­˜UIçš„çŠ¶æ€</span></span><br><span class="line">- (<span class="keyword">void</span>)applicationWillResignActive:(UIApplication *)application &#123;</span><br><span class="line">    NSLog(@<span class="string">"%@"</span>, @<span class="string">"applicationWillResignActive"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åº”ç”¨ç¨‹åºè¿›å…¥åå°è°ƒç”¨è¯¥æ–¹æ³•å¹¶å‘å‡ºé€šçŸ¥</span></span><br><span class="line"><span class="comment">// ä¿å­˜ç”¨æˆ·æ•°æ®ï¼Œé‡Šæ”¾ä¸€äº›èµ„æº(ä¾‹å¦‚é‡Šæ”¾æ•°æ®åº“èµ„æº)</span></span><br><span class="line">- (<span class="keyword">void</span>)applicationDidEnterBackground:(UIApplication *)application &#123;</span><br><span class="line">    NSLog(@<span class="string">"%@"</span>, @<span class="string">"applicationDidEnterBackground"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿›å…¥å‰å°ä½†è¿˜æ²¡æœ‰å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶è°ƒç”¨è¯¥æ–¹æ³•å¹¶å‘å‡ºé€šçŸ¥</span></span><br><span class="line"><span class="comment">// æ­¤é˜¶æ®µæ¢å¤ç”¨æˆ·æ•°æ®</span></span><br><span class="line">- (<span class="keyword">void</span>)applicationWillEnterForeground:(UIApplication *)application &#123;</span><br><span class="line">    NSLog(@<span class="string">"%@"</span>, @<span class="string">"applicationWillEnterForeground"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿›å…¥å‰å°å¹¶å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶è°ƒç”¨è¯¥æ–¹æ³•å¹¶å‘å‡ºé€šçŸ¥ã€‚</span></span><br><span class="line"><span class="comment">// æ­¤é˜¶æ®µå¯æ¢å¤UIçš„çŠ¶æ€</span></span><br><span class="line">- (<span class="keyword">void</span>)applicationDidBecomeActive:(UIApplication *)application &#123;</span><br><span class="line">    NSLog(@<span class="string">"%@"</span>, @<span class="string">"applicationDidBecomeActive"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åº”ç”¨ç¨‹åºè¢«ç»ˆæ­¢è°ƒç”¨è¯¥æ–¹æ³•(å†…å­˜æ¸…é™¤æ—¶é™¤å¤–)</span></span><br><span class="line"><span class="comment">// è¯¥é˜¶æ®µé‡Šæ”¾èµ„æºä¿å­˜ç”¨æˆ·æ•°æ®</span></span><br><span class="line">- (<span class="keyword">void</span>)applicationWillTerminate:(UIApplication *)application &#123;</span><br><span class="line">    NSLog(@<span class="string">"%@"</span>, @<span class="string">"applicationWillTerminate"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="çŠ¶æ€åœºæ™¯ï¼š"><a href="#çŠ¶æ€åœºæ™¯ï¼š" class="headerlink" title="çŠ¶æ€åœºæ™¯ï¼š"></a>çŠ¶æ€åœºæ™¯ï¼š</h4><ul><li><p><strong>1. éè¿è¡ŒçŠ¶æ€â€”åº”ç”¨å¯åŠ¨åœºæ™¯</strong><br><img src="https://img-blog.csdnimg.cn/20190426152055882.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li><li><p><strong>2. ç‚¹å‡»Homeé”®â€”åº”ç”¨é€€å‡ºåœºæ™¯</strong></p></li></ul><p>è¯¥åœºæ™¯çŠ¶æ€è·ƒè¿å¯åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œæ ¹æ®Info.plistä¸­çš„å±æ€§è®¾ç½®<code>Application does not run in background</code>æ§åˆ¶ç›¸åº”çš„çŠ¶æ€ï¼š</p><ul><li><p>åº”ç”¨ç¨‹åºåœ¨åå°è¿è¡Œæˆ–æŒ‚èµ·<br><img src="https://img-blog.csdnimg.cn/20190426151953461.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20190426152000668.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li><li><p>åº”ç”¨ç¨‹åºä¸å¯ä»¥åœ¨åå°è¿è¡Œæˆ–æŒ‚èµ·ï¼š</p></li></ul><p><img src="https://img-blog.csdnimg.cn/20190426152013330.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20190426152019492.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li><strong>3. æŒ‚èµ·é‡æ–°è¿è¡Œåœºæ™¯</strong></li></ul><p><img src="https://img-blog.csdnimg.cn/20190426152036288.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li><strong>4. å†…å­˜æ¸…é™¤ï¼šåº”ç”¨ç»ˆæ­¢åœºæ™¯</strong></li></ul><p>å†…å­˜æ¸…é™¤æœ‰ä¸¤ç§æƒ…å†µï¼šå¯èƒ½æ˜¯ç³»ç»Ÿå¼ºåˆ¶æ¸…ç†å†…å­˜ï¼Œä¹Ÿå¯èƒ½æ˜¯ä½¿ç”¨è€…ä»ä»»åŠ¡æ ä¸­æ‰‹åŠ¨æ¸…é™¤ã€‚æ¸…é™¤åå†æ¬¡è¿è¡Œåº”ç”¨ç¨‹åºä¸Šä¸€æ¬¡çŠ¶æ€ä¸ä¼šä¿å­˜ã€‚<br><img src="https://img-blog.csdnimg.cn/2019042615204748.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;IOSåº”ç”¨ç”Ÿå‘½å‘¨æœŸ&quot;&gt;&lt;a href=&quot;#IOSåº”ç”¨ç”Ÿå‘½å‘¨æœŸ&quot; class=&quot;headerlink&quot; title=&quot;IOSåº”ç”¨ç”Ÿå‘½å‘¨æœŸ&quot;&gt;&lt;/a&gt;IOSåº”ç”¨ç”Ÿå‘½å‘¨æœŸ&lt;/h2&gt;&lt;h4 id=&quot;åˆ†ä¸ºä»¥ä¸‹5ç§çŠ¶æ€ï¼š&quot;&gt;&lt;a href=&quot;#åˆ†ä¸ºä»¥ä¸‹5ç§çŠ¶æ€ï¼š&quot; class=&quot;headerlink&quot; title=&quot;åˆ†ä¸ºä»¥ä¸‹5ç§çŠ¶æ€ï¼š&quot;&gt;&lt;/a&gt;åˆ†ä¸ºä»¥ä¸‹5ç§çŠ¶æ€ï¼š&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Not running(éè¿è¡ŒçŠ¶æ€)&lt;ul&gt;
&lt;li&gt;åº”ç”¨ç¨‹åºæ²¡æœ‰è¿è¡Œæˆ–è¢«ç³»ç»Ÿç»ˆæ­¢&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Inactive(å‰å°éæ´»åŠ¨çŠ¶æ€)&lt;ul&gt;
&lt;li&gt;æ­£åœ¨è¿›å…¥å‰å°çŠ¶æ€ä½†æ˜¯ä¸èƒ½æ¥å—äº‹ä»¶å¤„ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Active(å‰å°æ´»åŠ¨çŠ¶æ€)&lt;ul&gt;
&lt;li&gt;è¿›å…¥å‰å°ï¼Œèƒ½æ¥å—äº‹ä»¶å¤„ç†&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Background(åå°çŠ¶æ€)&lt;ul&gt;
&lt;li&gt;å¦‚æœæœ‰å¯æ‰§è¡Œçš„ä»£ç åˆ™æ‰§è¡Œä»£ç ï¼Œæ²¡æœ‰æˆ–æ‰§è¡Œå®Œæ¯•åˆ™é©¬ä¸Šè¿›å…¥æŒ‚èµ·çŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Suspended(æŒ‚èµ·çŠ¶æ€)&lt;ul&gt;
&lt;li&gt;å†·å†»çŠ¶æ€ï¼Œä¸èƒ½æ‰§è¡Œä»£ç ã€‚å¦‚æœç³»ç»Ÿå†…å­˜ä¸å¤Ÿï¼Œåº”ç”¨è¢«ç»ˆæ­¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>CSAPP||Datalab</title>
    <link href="http://yoursite.com/2019/07/10/CSAPP-Datalab/"/>
    <id>http://yoursite.com/2019/07/10/CSAPP-Datalab/</id>
    <published>2019-07-10T15:31:27.000Z</published>
    <updated>2019-07-10T15:32:50.791Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-bitXor"><a href="#1-bitXor" class="headerlink" title="1. bitXor"></a>1. bitXor</h3><ul><li>bitXor - x^y using only ~ and &amp; </li><li>Example: bitXor(4, 5) = 1</li><li>Legal ops: ~ &amp;</li><li>Max ops: 14</li><li>Rating: 1</li></ul><a id="more"></a><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bitXor</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ~(x &amp; y) &amp; ~(~x &amp; ~y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-tmin"><a href="#2-tmin" class="headerlink" title="2. tmin"></a>2. tmin</h3><ul><li>tmin - return minimum twoâ€™s complement integer <ul><li>Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</li><li>Max ops: 4</li><li>Rating: 1<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">int</span> <span class="title">tmin</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span> &lt;&lt; <span class="number">31</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="3-isTmax"><a href="#3-isTmax" class="headerlink" title="3. isTmax"></a>3. isTmax</h3><ul><li>isTmax - returns 1 if x is the maximum, twoâ€™s complement number,<ul><li>and 0 otherwise </li><li>Legal ops: ! ~ &amp; ^ | +</li><li>Max ops: 10</li><li>Rating: 1</li></ul></li></ul><p>è§£é¢˜æ€è·¯ï¼šTmax = ~(Tmax+1), æ’é™¤åŒæ ·æ»¡è¶³æ­¤æ¡ä»¶çš„0xffffffff</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">int</span> <span class="title">isTmax</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; </span><br><span class="line"><span class="keyword">return</span> !(x ^ (~(x + <span class="number">1</span>))) &amp; !!(~x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> åŒç†ï¼Œ Tmin = ~Tim + 1, æ’é™¤åŒæ ·æ»¡è¶³æ­¤æ¡ä»¶çš„0x0<br> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isTmin</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span>  !(x ^ (~x + <span class="number">1</span>)) &amp; !!(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="4-allOddBits"><a href="#4-allOddBits" class="headerlink" title="4. allOddBits"></a>4. allOddBits</h3><ul><li>allOddBits - return 1 if all odd-numbered bits in word set to 1<ul><li>where bits are numbered from 0 (least significant) to 31 (most significant)</li><li>Examples allOddBits(0xFFFFFFFD) = 0, allOddBits(0xAAAAAAAA) = 1</li><li>Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</li><li>Max ops: 12</li><li>Rating: 2</li></ul></li></ul><p>è§£é¢˜æ€è·¯ï¼š</p><ul><li>x &amp; 0xAAAAAAAA = 0xAAAAAAAAã€‚</li><li>æ„é€ 0xAAAAAAAA<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">allOddBits</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> a = <span class="number">0xAA</span> | <span class="number">0xAA</span> &lt;&lt; <span class="number">8</span>;</span><br><span class="line">a = a | <span class="number">0xAA</span> &lt;&lt; <span class="number">16</span>;</span><br><span class="line">a = a | <span class="number">0xAA</span> &lt;&lt; <span class="number">24</span>;</span><br><span class="line"><span class="keyword">return</span> !((a&amp;x)^a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="5-negate"><a href="#5-negate" class="headerlink" title="5. negate"></a>5. negate</h3><ul><li>negate - return -x <ul><li>Example: negate(1) = -1.</li><li>Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</li><li>Max ops: 5</li><li>Rating: 2</li></ul></li></ul><p>è§£é¢˜æ€è·¯ï¼š</p><p>-x = xçš„è¡¥ç ï¼Œè¡¥ç =åç +1</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">negate</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (~x+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-isAsciiDigit"><a href="#6-isAsciiDigit" class="headerlink" title="6. isAsciiDigit"></a>6. isAsciiDigit</h3><ul><li>isAsciiDigit - return 1 if 0x30 &lt;= x &lt;= 0x39 (ASCII codes for characters â€˜0â€™ to â€˜9â€™)</li><li>Example: isAsciiDigit(0x35) = 1.</li><li>isAsciiDigit(0x3a) = 0.</li><li>isAsciiDigit(0x05) = 0.</li><li>Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</li><li>Max ops: 15</li><li>Rating: 3</li></ul><p><strong>è§£é¢˜æ€è·¯ï¼š</strong></p><p>ä¾æ®ä¸¤ä¸ªåŸç†ï¼š</p><ul><li>è®¡ç®—æœºçš„å‡è¿ç®—ç­‰äºåŠ è¡¥ç ï¼Œè¡¥ç =åç +1</li><li>å¯¹äº32ä½intæ¥è¯´ï¼Œè‹¥ä¸€ä¸ªæ•°&gt;=0ï¼Œå³ç§»31ä½ä¸º0ï¼›è‹¥ä¸ºè´Ÿæ•°ï¼Œå³ç§»31ä½ä¸º1ã€‚<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isAsciiDigit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> left = x + (~(<span class="number">0x30</span>)+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">int</span> right = (~x+<span class="number">1</span>) + <span class="number">0x39</span>;</span><br><span class="line"><span class="keyword">return</span> !(left &gt;&gt; <span class="number">31</span>) &amp; !(right &gt;&gt; <span class="number">31</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="7-conditional"><a href="#7-conditional" class="headerlink" title="7. conditional"></a>7. conditional</h3><ul><li>conditional - same as x ? y : z <ul><li>Example: conditional(2,4,5) = 4</li><li>Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</li><li>Max ops: 16</li><li>Rating: 3</li></ul></li></ul><p>è§£é¢˜æ€è·¯ï¼š</p><ul><li>å½“xåªå–0x00000000æˆ–0xFFFFFFFFæ—¶ï¼Œç»“æœä¸º(x &amp; y) | (~x &amp; z)ã€‚</li><li>åªéœ€è¦æ’é™¤å½“x != 0æ—¶ï¼Œx = 0xFFFFFFFFã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">conditional</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span> </span>&#123;</span><br><span class="line">x = (!!x) &lt;&lt; <span class="number">31</span> &gt;&gt; <span class="number">31</span>;</span><br><span class="line"><span class="keyword">return</span> ((x &amp; y) | (~x &amp; z)); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-isLessOrEqual"><a href="#8-isLessOrEqual" class="headerlink" title="8. isLessOrEqual"></a>8. isLessOrEqual</h3><ul><li>isLessOrEqual - if x &lt;= y  then return 1, else return 0 <ul><li>Example: isLessOrEqual(4,5) = 1.</li><li>Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</li><li>Max ops: 24</li><li>Rating: 3</li></ul></li></ul><p>è§£é¢˜æ€è·¯ï¼š</p><ul><li>ç†è®ºä¸Šy-x &gt;= 0å³å¯ã€‚</li><li>ä½†æ˜¯å¦‚æœx, yæ­£è´Ÿä¸åŒï¼Œç›¸å‡å¯èƒ½ä¼šæº¢å‡ºã€‚</li><li>æ‰€ä»¥åˆ†ä¸¤ç§æƒ…å†µè®¨è®ºï¼Œå¦‚æœä¸¤ä¸ªæ•°ç¬¦å·ç›¸ç­‰ï¼Œåˆ¤æ–­ç›¸å‡ï¼›å¦‚æœä¸¤ä¸ªæ•°ç¬¦å·ä¸åŒï¼Œåˆ¤æ–­ç¬¦å·ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isLessOrEqual</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> a = !((x &gt;&gt; <span class="number">31</span>) ^ (y &gt;&gt; <span class="number">31</span>));</span><br><span class="line"><span class="keyword">return</span> (a &amp; !((y + (~x + <span class="number">1</span>)) &gt;&gt; <span class="number">31</span>)) | (~a &amp; !(y &gt;&gt; <span class="number">31</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-logicalNeg"><a href="#9-logicalNeg" class="headerlink" title="9. logicalNeg"></a>9. logicalNeg</h3><ul><li>logicalNeg - implement the ! operator, using all of <ul><li>the legal operators except !</li><li>Examples: logicalNeg(3) = 0, logicalNeg(0) = 1</li><li>Legal ops: ~ &amp; ^ | + &lt;&lt; &gt;&gt;</li><li>Max ops: 12</li><li>Rating: 4 </li></ul></li></ul><p>è§£é¢˜æ€è·¯ï¼š</p><p>0å’Œ-0çš„æœ€é«˜ä½ä¸º0ï¼Œå°†æ­£æ•°è½¬åŒ–ä¸ºè´Ÿæ•°ï¼Œé‚£ä¹ˆåªæœ‰0çš„æœ€é«˜ä½ä¸º0</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">logicalNeg</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ~((x | (~x + <span class="number">1</span>)) &gt;&gt; <span class="number">31</span>) &amp; <span class="number">0x1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-howManyBits"><a href="#10-howManyBits" class="headerlink" title="10. howManyBits"></a>10. howManyBits</h3><ul><li>howManyBits - return the minimum number of bits required to represent x in twoâ€™s complement<ul><li>Examples: howManyBits(12) = 5<ul><li>howManyBits(298) = 10<ul><li>howManyBits(-5) = 4</li><li>howManyBits(0)  = 1</li><li>howManyBits(-1) = 1</li><li>howManyBits(0x80000000) = 32</li></ul></li></ul></li><li>Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</li><li>Max ops: 90</li><li>Rating: 4</li></ul></li></ul><p>è§£é¢˜æ€è·¯ï¼š</p><ul><li>è¡¥ç çš„æœ€é«˜è¡¨ç¤ºä½å‰é¢çš„æ‰€æœ‰æ•°å­—åº”è¯¥éƒ½æ˜¯å…¨0(æ­£æ•°)æˆ–æ˜¯å…¨1(è´Ÿæ•°)ã€‚</li><li>å°†åŸæ•°ä¸å·¦ç§»ä¸€ä½åçš„æ•°å­—å¼‚æˆ–åˆ™æœ€é«˜çš„ä¸åŒçš„é‚£ä¸ªä½ç½®ä¸º1ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°è¿™ä¸ªæœ€é«˜çš„ä¸åŒä½å³å¯ã€‚<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">howManyBits</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> temp = x ^ (x &lt;&lt; <span class="number">1</span>);</span><br><span class="line"><span class="keyword">int</span> bit_16,bit_8,bit_4,bit_2,bit_1;</span><br><span class="line">bit_16 = !!(temp &gt;&gt; <span class="number">16</span>) &lt;&lt; <span class="number">4</span>;</span><br><span class="line">temp = temp &gt;&gt; bit_16;</span><br><span class="line">bit_8 = !!(temp &gt;&gt; <span class="number">8</span>) &lt;&lt; <span class="number">3</span>;</span><br><span class="line">temp = temp &gt;&gt; bit_8;</span><br><span class="line">bit_4 = !!(temp &gt;&gt; <span class="number">4</span>) &lt;&lt; <span class="number">2</span>;</span><br><span class="line">temp = temp &gt;&gt; bit_4;</span><br><span class="line">bit_2 = !!(temp &gt;&gt; <span class="number">2</span>) &lt;&lt; <span class="number">1</span>;</span><br><span class="line">temp = temp &gt;&gt; bit_2;</span><br><span class="line">bit_1 = !!(temp &gt;&gt; <span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span> + bit_1 + bit_2 + bit_4 + bit_8 + bit_16;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="11-floatScale2"><a href="#11-floatScale2" class="headerlink" title="11. floatScale2"></a>11. floatScale2</h3><ul><li>floatScale2 - Return bit-level equivalent of expression 2*f for<ul><li>floating point argument f.</li><li>Both the argument and result are passed as unsigned intâ€™s, but</li><li>they are to be interpreted as the bit-level representation of</li><li>single-precision floating point values.</li><li>When argument is NaN, return argument</li><li>Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</li><li>Max ops: 30</li><li>Rating: 4</li></ul></li></ul><p>è§£é¢˜æ€è·¯ï¼š</p><ul><li>IEEEæµ®ç‚¹æ•°æ ¼å¼ä¸€å…±åˆ†ä¸ºä¸‰ç§å½¢å¼ï¼Œå¼±è§„èŒƒæ•°ï¼ŒNANä»¥åŠä¸€èˆ¬çš„æ•°ã€‚</li><li>NANç›´æ¥è¿”å›</li><li>å¼±è§„èŒƒæ•°ç›´æ¥å·¦ç§»1ä½ä½†è¦ä¿ç•™ç¬¦å·ä½ã€‚</li><li>ä¸€èˆ¬æ•°çš„è¯å°¾æ•°ä¸å˜ï¼Œåªç§»åŠ¨æŒ‡æ•°ä½å¹¶ä¿æŒç¬¦å·ä½ä¸å˜ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">floatScale2</span><span class="params">(<span class="keyword">unsigned</span> uf)</span> </span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> a = (uf &gt;&gt; <span class="number">23</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line"><span class="keyword">unsigned</span> flag = uf &gt;&gt; <span class="number">31</span> &lt;&lt; <span class="number">31</span>;</span><br><span class="line"><span class="keyword">int</span> temp = uf;</span><br><span class="line"><span class="keyword">if</span> (a == <span class="number">0xff</span>) </span><br><span class="line"><span class="keyword">return</span> uf;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (a == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">temp = uf &lt;&lt; <span class="number">1</span>;</span><br><span class="line"><span class="comment">//temp = temp &amp; (~(0xff &lt;&lt; 23));</span></span><br><span class="line">temp = temp | flag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line">temp = temp + (<span class="number">0x1</span>&lt;&lt;<span class="number">23</span>);</span><br><span class="line">temp =  temp | flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> temp;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="12-floatFloat2Int"><a href="#12-floatFloat2Int" class="headerlink" title="12. floatFloat2Int"></a>12. floatFloat2Int</h3><ul><li>floatFloat2Int - Return bit-level equivalent of expression (int) f<ul><li>for floating point argument f.</li><li>Argument is passed as unsigned int, but</li><li>it is to be interpreted as the bit-level representation of a</li><li>single-precision floating point value.</li><li>Anything out of range (including NaN and infinity) should return</li><li>0x80000000u.</li><li>Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</li><li>Max ops: 30</li><li>Rating: 4</li></ul></li></ul><p>è§£é¢˜æ€è·¯ï¼š</p><ul><li>æ­¤é¢˜çš„è§£é¢˜å…³é”®åœ¨äºåˆ†å‡ ç§æƒ…å†µï¼Œå…ˆå°†ç¬¦å·ä½æ‹¿å‡ºå•ç‹¬è®¨è®ºï¼Œå½“æŒ‡æ•°ä½-127&gt;=32ä½æ—¶ï¼Œæº¢å‡ºï¼Œè¿”å›0x80000000uï¼Œå½“æŒ‡æ•°ä½-127 &lt; 0æ—¶ï¼Œæ˜¯å°äº1çš„å°æ•°ï¼Œè¿”å›0å³å¯ã€‚</li><li>å‰©ä¸‹çš„æƒ…å†µä¸€ç§æ˜¯æŒ‡æ•°ä½-127&gt;=23ä½æ—¶ï¼Œå°†å°¾æ•°ä½å·¦ç§»å¤šå‡ºçš„ä½ï¼›å½“&lt;23æ—¶ï¼Œå°¾æ•°ä½å³ç§»ç¼ºå¤±çš„ä½ã€‚</li><li>å†å°†æœ€åçš„ç»“æœæ ¹æ®ç¬¦å·ä½çš„åˆ¤æ–­åŠ ä¸Šæ­£è´Ÿã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">floatFloat2Int</span><span class="params">(<span class="keyword">unsigned</span> uf)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> a = ((uf &gt;&gt; <span class="number">23</span>) &amp; <span class="number">0xff</span>) - <span class="number">127</span>;</span><br><span class="line"><span class="keyword">int</span> flag = uf &gt;&gt; <span class="number">31</span>;</span><br><span class="line"><span class="keyword">if</span> (a &gt;= <span class="number">32</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0x80000000</span>u;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (a &lt; <span class="number">0</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> temp = (uf | <span class="number">0x800000</span>) &amp; <span class="number">0xffffff</span>;</span><br><span class="line"><span class="keyword">if</span> (a &gt;= <span class="number">23</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> e = a - <span class="number">23</span>;</span><br><span class="line">temp = temp &lt;&lt; e;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> e = <span class="number">23</span> - a;</span><br><span class="line">temp = temp &gt;&gt; e;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> flag ? -temp : temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="13-floatPower2"><a href="#13-floatPower2" class="headerlink" title="13.  floatPower2"></a>13.  floatPower2</h3><ul><li>floatPower2 - Return bit-level equivalent of the expression 2.0^x<ul><li>(2.0 raised to the power x) for any 32-bit integer x.</li><li>The unsigned value that is returned should have the identical bit</li><li>representation as the single-precision floating-point number 2.0^x.</li><li>If the result is too small to be represented as a denorm, return</li><li>0.If too large, return +INF.</li><li>Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. Also if, while </li><li>Max ops: 30 </li><li>Rating: 4</li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">floatPower2</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">127</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0x7f800000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (x &lt; <span class="number">-127</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0x0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> (x + <span class="number">127</span>) &lt;&lt; <span class="number">23</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;1-bitXor&quot;&gt;&lt;a href=&quot;#1-bitXor&quot; class=&quot;headerlink&quot; title=&quot;1. bitXor&quot;&gt;&lt;/a&gt;1. bitXor&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;bitXor - x^y using only ~ and &amp;amp; &lt;/li&gt;
&lt;li&gt;Example: bitXor(4, 5) = 1&lt;/li&gt;
&lt;li&gt;Legal ops: ~ &amp;amp;&lt;/li&gt;
&lt;li&gt;Max ops: 14&lt;/li&gt;
&lt;li&gt;Rating: 1&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="c" scheme="http://yoursite.com/categories/c/"/>
    
    
      <category term="CSAPP" scheme="http://yoursite.com/tags/CSAPP/"/>
    
      <category term="c" scheme="http://yoursite.com/tags/c/"/>
    
  </entry>
  
  <entry>
    <title>è®¡ç®—æœºå›¾å½¢å­¦ || Camera</title>
    <link href="http://yoursite.com/2019/07/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6-Camera/"/>
    <id>http://yoursite.com/2019/07/10/è®¡ç®—æœºå›¾å½¢å­¦-Camera/</id>
    <published>2019-07-10T15:22:12.000Z</published>
    <updated>2019-07-10T15:23:19.032Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Basicï¼š"><a href="#Basicï¼š" class="headerlink" title="Basicï¼š"></a>Basicï¼š</h3><h4 id="1-æŠ•å½±-Projection"><a href="#1-æŠ•å½±-Projection" class="headerlink" title="1. æŠ•å½±(Projection):"></a>1. æŠ•å½±(Projection):</h4><ul><li><strong>æŠŠä¸Šæ¬¡ä½œä¸šç»˜åˆ¶çš„cubeæ”¾ç½®åœ¨(-1.5, 0.5, -1.5)ä½ç½®ï¼Œè¦æ±‚6ä¸ªé¢é¢œè‰²ä¸ä¸€è‡´ã€‚</strong></li></ul><a id="more"></a><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> vertices[] = &#123;</span><br><span class="line">        <span class="comment">// é¡¶ç‚¹ä½ç½®           // é¢œè‰²åæ ‡</span></span><br><span class="line">        <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>, <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>,  <span class="number">2.0f</span>, <span class="number">-2.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>,  <span class="number">2.0f</span>, <span class="number">-2.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">-2.0f</span>,  <span class="number">2.0f</span>, <span class="number">-2.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="number">-2.0f</span>, <span class="number">-2.0f</span>,  <span class="number">2.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>, <span class="number">-2.0f</span>,  <span class="number">2.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>,  <span class="number">2.0f</span>,  <span class="number">2.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>,  <span class="number">2.0f</span>,  <span class="number">2.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">-2.0f</span>,  <span class="number">2.0f</span>,  <span class="number">2.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">-2.0f</span>, <span class="number">-2.0f</span>,  <span class="number">2.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="number">-2.0f</span>,  <span class="number">2.0f</span>,  <span class="number">2.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-2.0f</span>,  <span class="number">2.0f</span>, <span class="number">-2.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-2.0f</span>, <span class="number">-2.0f</span>,  <span class="number">2.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-2.0f</span>,  <span class="number">2.0f</span>,  <span class="number">2.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="number">2.0f</span>,  <span class="number">2.0f</span>,  <span class="number">2.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>,  <span class="number">2.0f</span>, <span class="number">-2.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>, <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>, <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>, <span class="number">-2.0f</span>,  <span class="number">2.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>,  <span class="number">2.0f</span>,  <span class="number">2.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>, <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>, <span class="number">-2.0f</span>,  <span class="number">2.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>, <span class="number">-2.0f</span>,  <span class="number">2.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-2.0f</span>, <span class="number">-2.0f</span>,  <span class="number">2.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="number">-2.0f</span>,  <span class="number">2.0f</span>, <span class="number">-2.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>,  <span class="number">2.0f</span>, <span class="number">-2.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>,  <span class="number">2.0f</span>,  <span class="number">2.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">2.0f</span>,  <span class="number">2.0f</span>,  <span class="number">2.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-2.0f</span>,  <span class="number">2.0f</span>,  <span class="number">2.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-2.0f</span>,  <span class="number">2.0f</span>, <span class="number">-2.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span></span><br><span class="line">        </span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><p>å°†6ä¸ªé¢åˆ†åˆ«è®¾ç½®ä¸ºä¸åŒçš„é¢œè‰²ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model = glm::translate(model, glm::vec3(<span class="number">-1.5f</span>, <span class="number">0.5f</span>, <span class="number">-1.5f</span>));</span><br></pre></td></tr></table></figure><p>è®¾ç½®ä¸­å¿ƒåæ ‡ä¸º(-1.5, 0.5, -1.5)ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20190418110034456.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li><strong>æ­£äº¤æŠ•å½±(orthographic projection):å®ç°æ­£äº¤æŠ•å½±ï¼Œä½¿ç”¨å¤šç»„(left, right, bottom, top, near, far)å‚æ•°ï¼Œ æ¯”è¾ƒç»“æœå·®å¼‚ã€‚</strong></li></ul><p>é€‰æ‹©å‚æ•°(-10.0f, 10.0f, -10.0f, 10.0f, 0.1f, 100.0f)</p><p><img src="https://img-blog.csdnimg.cn/20190418110046797.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è°ƒèŠ‚å‰å››ä¸ªå‚æ•°ä¹Ÿå°±æ˜¯å®½é«˜ï¼Œä¼šå‘ç°æŠ•å½±çš„èŒƒå›´å˜å¤§ï¼Œç‰©ä½“åœ¨æ ‡å‡†åŒ–åæ ‡èŒƒå›´å†…çš„è§†è§‰æ•ˆæœä¹Ÿå˜å°ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20190418110059152.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç„¶åè°ƒèŠ‚è¿‘å¹³é¢å’Œè¿œå¹³é¢çš„è·ç¦»ï¼Œå¼€å§‹æ—¶è®¤ä¸ºè¿™ä¸ªè·ç¦»æ˜¯ç›¸å¯¹åˆ°åŸç‚¹çš„è·ç¦»ï¼Œé€šè¿‡è°ƒèŠ‚å‘ç°å…¶å®æ˜¯åˆ°æ‘„åƒæœºä¹Ÿå°±æ˜¯viewçš„è·ç¦»ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">view = glm::translate(view, glm::vec3(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-10.0f</span>));</span><br><span class="line">projection = glm::ortho(<span class="number">-10.0f</span>, <span class="number">10.0f</span>, <span class="number">-10.0f</span>, <span class="number">10.0f</span>, <span class="number">8.0f</span>, <span class="number">50.0f</span>);</span><br></pre></td></tr></table></figure><p>æ•ˆæœä¸ºï¼š</p><p><img src="https://img-blog.csdnimg.cn/20190418110126364.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">view = glm::translate(view, glm::vec3(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-10.0f</span>));</span><br><span class="line">projection = glm::ortho(<span class="number">-10.0f</span>, <span class="number">10.0f</span>, <span class="number">-10.0f</span>, <span class="number">10.0f</span>, <span class="number">9.0f</span>, <span class="number">50.0f</span>);</span><br></pre></td></tr></table></figure><p>æ•ˆæœä¸ºï¼š</p><p><img src="https://img-blog.csdnimg.cn/20190418110137761.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å‡ºç°å¦‚ä¸Šæ•ˆæœæ˜¯å› ä¸ºè®¾ç½®çš„ç«‹æ–¹ä½“è¾¹é•¿ä¸º-2~2ï¼Œ9.0fæ„å‘³ç€-10.0+9.0=-1.0çš„ä½ç½®æ’å…¥è¿‘å¹³é¢ï¼Œæ‰€ä»¥ä¼šæˆªæ‰ä¸€éƒ¨åˆ†ã€‚</p><ul><li><strong>é€è§†æŠ•å½±(perspective projection):å®ç°é€è§†æŠ•å½±ï¼Œä½¿ç”¨å¤šç»„å‚æ•°ï¼Œæ¯”è¾ƒç»“æœå·®å¼‚ ã€‚</strong></li></ul><p>å°†fovè§’è®¾ç½®ä¸º45åº¦ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">view = glm::translate(view, glm::vec3(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-15.0f</span>));</span><br><span class="line">projection = glm::perspective(glm::radians(<span class="number">45.0f</span>), (<span class="keyword">float</span>)SCR_WIDTH / (<span class="keyword">float</span>)SCR_HEIGHT, <span class="number">0.1f</span>, <span class="number">100.0f</span>);</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20190418110154275.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä¿æŒå…¶ä»–å‚æ•°ä¸å˜ï¼Œå°†fovè§’è°ƒä¸º30åº¦ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">view = glm::translate(view, glm::vec3(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-15.0f</span>));</span><br><span class="line">projection = glm::perspective(glm::radians(<span class="number">30.0f</span>), (<span class="keyword">float</span>)SCR_WIDTH / (<span class="keyword">float</span>)SCR_HEIGHT, <span class="number">0.1f</span>, <span class="number">100.0f</span>);</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/201904181102211.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>fovè§’åº¦è¶Šå°ï¼Œé€è§†æŠ•å½±å‡ºçš„ç«‹æ–¹ä½“è¶Šå¤§ã€‚</p><p>æ¥ç€è°ƒæ•´å®½é«˜æ¯”çš„å¤§å°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">view = glm::translate(view, glm::vec3(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-15.0f</span>));</span><br><span class="line">projection = glm::perspective(glm::radians(<span class="number">30.0f</span>), <span class="number">2</span> * (<span class="keyword">float</span>)SCR_WIDTH / (<span class="keyword">float</span>)SCR_HEIGHT, <span class="number">0.1f</span>, <span class="number">100.0f</span>);</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20190418110238431.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä¹Ÿå°±æ˜¯å°†å®½åº¦æ‰€å çš„æ¯”é‡è°ƒé«˜ï¼Œæ˜¾ç„¶å¯ä»¥çœ‹å‡ºç‰©ä½“æ²¿å±å¹•é«˜åº¦æ–¹å‘è¢«æ‹‰ä¼¸ï¼Œæ‰€ä»¥è¦æƒ³ä¿æŒåˆé€‚çš„è§†è§‰æ•ˆæœæœ€å¥½å®½é«˜æ¯”å°±è¿˜æ˜¯è®¾ç½®ä¸ºå±å¹•çš„çœŸæ­£å®½é«˜æ¯”ã€‚</p><h4 id="2-è§†è§’å˜æ¢-View-Changing"><a href="#2-è§†è§’å˜æ¢-View-Changing" class="headerlink" title="2. è§†è§’å˜æ¢(View Changing):"></a>2. è§†è§’å˜æ¢(View Changing):</h4><ul><li><strong>æŠŠcubeæ”¾ç½®åœ¨(0, 0, 0)å¤„ï¼Œåšé€è§†æŠ•å½±ï¼Œä½¿æ‘„åƒæœºå›´ç»•cubeæ—‹è½¬ï¼Œå¹¶ä¸”æ—¶åˆ»çœ‹ç€cubeä¸­å¿ƒã€‚</strong></li></ul><p>ç”¨LookAtçŸ©é˜µåˆ›å»ºæ‘„åƒæœºçš„è§‚å¯Ÿç©ºé—´ã€‚LookAtçŸ©é˜µçš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯æ‘„åƒæœºä½ç½®ï¼Œç›®æ ‡ä½ç½®ï¼Œä¸Šå‘é‡ã€‚<br>$$<br>LookAt = \begin{bmatrix} \color{red}{R_x} &amp; \color{red}{R_y} &amp; \color{red}{R_z} &amp; 0 \ \color{green}{U_x} &amp; \color{green}{U_y} &amp; \color{green}{U_z} &amp; 0 \ \color{blue}{D_x} &amp; \color{blue}{D_y} &amp; \color{blue}{D_z} &amp; 0 \ 0 &amp; 0 &amp; 0  &amp; 1 \end{bmatrix} * \begin{bmatrix} 1 &amp; 0 &amp; 0 &amp; -\color{purple}{P_x} \ 0 &amp; 1 &amp; 0 &amp; -\color{purple}{P_y} \ 0 &amp; 0 &amp; 1 &amp; -\color{purple}{P_z} \ 0 &amp; 0 &amp; 0  &amp; 1 \end{bmatrix}<br>$$<br><strong>Dæ˜¯æ–¹å‘å‘é‡</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">glm::vec3 cameraTarget = glm::vec3(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>); <span class="comment">//ç›®æ ‡ä½ç½®</span></span><br><span class="line">glm::vec3 cameraDirection = glm::normalize(cameraPos - cameraTarget);</span><br></pre></td></tr></table></figure><p><strong>Ræ˜¯å³å‘é‡</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">glm::vec3 up = glm::vec3(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>); <span class="comment">//ä¸Šå‘é‡</span></span><br><span class="line">glm::vec3 cameraRight = glm::normalize(glm::cross(up, cameraDirection));</span><br></pre></td></tr></table></figure><p><strong>Uæ˜¯ä¸Šè½´</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glm::vec3 cameraUp = glm::cross(cameraDirection, cameraRight);</span><br></pre></td></tr></table></figure><p>å½“ç„¶è¿™äº›éƒ½å·²ç»è¢«LookAtå°è£…å¥½ï¼Œæˆ‘ä»¬åªéœ€è¦æä¾›ä¸‰ä¸ªå‚æ•°å³å¯ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">glm::mat4 view;</span><br><span class="line">view = glm::lookAt(glm::vec3(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">3.0f</span>), </span><br><span class="line">           glm::vec3(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>), </span><br><span class="line">           glm::vec3(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br></pre></td></tr></table></figure><p><strong>ç„¶åé€šè¿‡åœ†çš„sinï¼Œcosè®¾ç½®ï¼Œä½¿å¾—æ‘„åƒæœºå›´ä¸­å¿ƒç‚¹ç»•x-zå¹³é¢æ—‹è½¬ã€‚</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> radius = <span class="number">15.0f</span>;</span><br><span class="line"><span class="keyword">float</span> camX = <span class="built_in">sin</span>(glfwGetTime()) * radius;</span><br><span class="line"><span class="keyword">float</span> camZ = <span class="built_in">cos</span>(glfwGetTime()) * radius;</span><br><span class="line">view = glm::lookAt(glm::vec3(camX, <span class="number">0.0</span>, camZ), glm::vec3(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>), glm::vec3(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>));</span><br></pre></td></tr></table></figure><p>æˆªå–å…¶ä¸­ä¸¤å¸§æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20190418110313136.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20190418110321637.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="3-åœ¨GUIé‡Œæ·»åŠ èœå•æ ï¼Œå¯ä»¥é€‰æ‹©å„ç§åŠŸèƒ½ã€‚-Hint-ä½¿æ‘„åƒæœºä¸€ç›´å¤„äºä¸€ä¸ªåœ†çš„ä½ç½®ã€‚"><a href="#3-åœ¨GUIé‡Œæ·»åŠ èœå•æ ï¼Œå¯ä»¥é€‰æ‹©å„ç§åŠŸèƒ½ã€‚-Hint-ä½¿æ‘„åƒæœºä¸€ç›´å¤„äºä¸€ä¸ªåœ†çš„ä½ç½®ã€‚" class="headerlink" title="3.  åœ¨GUIé‡Œæ·»åŠ èœå•æ ï¼Œå¯ä»¥é€‰æ‹©å„ç§åŠŸèƒ½ã€‚ Hint: ä½¿æ‘„åƒæœºä¸€ç›´å¤„äºä¸€ä¸ªåœ†çš„ä½ç½®ã€‚"></a>3.  åœ¨GUIé‡Œæ·»åŠ èœå•æ ï¼Œå¯ä»¥é€‰æ‹©å„ç§åŠŸèƒ½ã€‚ Hint: ä½¿æ‘„åƒæœºä¸€ç›´å¤„äºä¸€ä¸ªåœ†çš„ä½ç½®ã€‚</h4><p>å®ç°GUIåŠŸèƒ½å¦‚ä¸‹ï¼š</p><ul><li>èœå•ç‚¹å‡»startè¿›å…¥é€‰æ‹©ã€‚</li><li>ç•Œé¢åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯projectionï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯Cameraã€‚</li><li>Projectionå¯¹åº”ä¸¤ä¸ªæŒ‰é’®ï¼Œå¯ä»¥é€‰æ‹©æ˜¯æ­£äº¤æŠ•å½±è¿˜æ˜¯é€è§†æŠ•å½±ã€‚</li><li>Cameraå¯¹åº”æ»‘åŠ¨å—ï¼Œå¯ä»¥è°ƒèŠ‚æ‘„åƒæœºè·ç¦»ç‰©ä½“ä¸­å¿ƒçš„æ—‹è½¬åŠå¾„ã€‚</li></ul><p><img src="https://img-blog.csdnimg.cn/20190418110333443.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20190418110341717.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>é…åˆImGuiçš„å®ç°æ•ˆæœï¼š</strong><br><img src="https://img-blog.csdnimg.cn/20190418110401814.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="4-æ€è€ƒé¢˜"><a href="#4-æ€è€ƒé¢˜" class="headerlink" title="4. æ€è€ƒé¢˜"></a>4. æ€è€ƒé¢˜</h4><ul><li><strong>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬å°†æ‘„åƒæœºæ‘†æ”¾çš„ç©ºé—´View matrixå’Œè¢«æ‹æ‘„çš„ç‰©ä½“æ‘†è®¾çš„ç©ºé—´Model matrixåˆ†å¼€ï¼Œä½†æ˜¯åœ¨OpenGLä¸­å´å°†ä¸¤ä¸ªåˆäºŒä¸ºä¸€è®¾ä¸ºModelView matrixï¼Œé€šè¿‡ä¸Šé¢çš„ä½œä¸šå¯å‘ï¼Œä½ è®¤ä¸ºæ˜¯ä¸ºä»€ä¹ˆå‘¢?åœ¨æŠ¥å‘Šä¸­å†™å…¥ã€‚(Hints:ä½ å¯èƒ½æœ‰ä¸æ­¢ä¸€ä¸ªæ‘„åƒæœº)ã€‚</strong></li></ul><p><strong>åæ ‡å˜æ¢çŸ©é˜µæ ˆ(ModelView)</strong></p><p>ç”¨æ¥å­˜å‚¨ä¸€ç³»åˆ—çš„å˜æ¢çŸ©é˜µï¼Œæ ˆé¡¶å°±æ˜¯å½“å‰åæ ‡çš„å˜æ¢çŸ©é˜µï¼Œè¿›å…¥OpenGLç®¡é“çš„æ¯ä¸ªåæ ‡(é½æ¬¡åæ ‡)éƒ½ä¼šå…ˆä¹˜ä¸Šè¿™ä¸ªçŸ©é˜µï¼Œç»“æœæ‰æ˜¯å¯¹åº”ç‚¹åœ¨åœºæ™¯ä¸­çš„ä¸–ç•Œåæ ‡ã€‚</p><blockquote><p>VertexData â€”&gt;(Object Coordinates)â€”&gt;ModelViewMatrix â€”&gt;(Eye Coordinates)â€”&gt; ProjectionMatrix â€”&gt;(Clip Coordinates)â€”&gt;Divide by w â€”&gt;(Normalized Device Coordinates)â€”&gt;ViewportTransformâ€”&gt;WindowCoordinates</p></blockquote><p>å› ä¸ºä¸€ä¸ªåœºæ™¯ä¸­å¯èƒ½å­˜åœ¨å¤šå°æ‘„åƒæœºï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªè§†è§’çš„ç»“åˆï¼Œå¦‚æœä¸ºæ¯ä¸€ä¸ªéƒ½åˆ†é…ä¸€ä¸ªviewå¯èƒ½å®¹æ˜“æ¯”è¾ƒæ··ä¹±ï¼ŒModelViewæ˜¯ä¸€ä¸ªçŸ©é˜µæ ˆï¼Œå¯ä»¥å­˜å‚¨modelçš„å„ç§å˜åŒ–ä»¥åŠä¸åŒçš„viewè§†è§’ï¼Œè¿™æ ·æ—¢ä¸ä¼šé€ æˆè§†è§‰æ··ä¹±åŒæ—¶ä¹Ÿèƒ½å‡å°‘è®¡ç®—é‡ã€‚</p><h3 id="Bonusï¼š"><a href="#Bonusï¼š" class="headerlink" title="Bonusï¼š"></a>Bonusï¼š</h3><h4 id="cameraç±»"><a href="#cameraç±»" class="headerlink" title="cameraç±»:"></a>cameraç±»:</h4><ul><li><strong>å®ç°ä¸€ä¸ªcameraç±»ï¼Œå½“é”®ç›˜è¾“å…¥ w,a,s,d ï¼Œèƒ½å¤Ÿå‰åå·¦å³ç§»åŠ¨;å½“ç§»åŠ¨é¼ æ ‡ï¼Œèƒ½å¤Ÿè§†è§’ç§»åŠ¨(â€œlook aroundâ€)ï¼Œ å³ç±»ä¼¼FPS(First Person Shooting)çš„æ¸¸æˆåœºæ™¯ã€‚</strong> </li></ul><p>å®ç°å†…å®¹ï¼š</p><ul><li><p>é”®ç›˜WASDæŒ‰é”®ç§»åŠ¨ã€‚</p></li><li><p>é¼ æ ‡ç§»åŠ¨å®ç°è§†è§’ç§»åŠ¨</p></li><li><p>æ»šè½®å®ç°ç‰©ä½“ç¼©æ”¾ã€‚</p></li></ul><h5 id="ï¼ˆ1ï¼‰é”®ç›˜WASDæŒ‰é”®å®ç°è‡ªç”±ç§»åŠ¨ã€‚"><a href="#ï¼ˆ1ï¼‰é”®ç›˜WASDæŒ‰é”®å®ç°è‡ªç”±ç§»åŠ¨ã€‚" class="headerlink" title="ï¼ˆ1ï¼‰é”®ç›˜WASDæŒ‰é”®å®ç°è‡ªç”±ç§»åŠ¨ã€‚"></a>ï¼ˆ1ï¼‰é”®ç›˜WASDæŒ‰é”®å®ç°è‡ªç”±ç§»åŠ¨ã€‚</h5><ul><li>è®¡ç®—å‰ä¸€å¸§ä¸å½“å‰å¸§çš„æ—¶é—´å·®ã€‚</li><li>å› ä¸ºå›¾å½¢ç¨‹åºå’Œæ¸¸æˆé€šå¸¸ä¼šè·Ÿè¸ªä¸€ä¸ªæ—¶é—´å·®(Deltatime)å˜é‡ï¼Œå®ƒå‚¨å­˜äº†æ¸²æŸ“ä¸Šä¸€å¸§æ‰€ç”¨çš„æ—¶é—´ã€‚æˆ‘ä»¬æŠŠæ‰€æœ‰é€Ÿåº¦éƒ½å»ä¹˜ä»¥deltaTimeå€¼ã€‚ç»“æœå°±æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„deltaTimeå¾ˆå¤§ï¼Œå°±æ„å‘³ç€ä¸Šä¸€å¸§çš„æ¸²æŸ“èŠ±è´¹äº†æ›´å¤šæ—¶é—´ï¼Œæ‰€ä»¥è¿™ä¸€å¸§çš„é€Ÿåº¦éœ€è¦å˜å¾—æ›´é«˜æ¥å¹³è¡¡æ¸²æŸ“æ‰€èŠ±å»çš„æ—¶é—´ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•æ—¶ï¼Œæ— è®ºä½ çš„ç”µè„‘å¿«è¿˜æ˜¯æ…¢ï¼Œæ‘„åƒæœºçš„é€Ÿåº¦éƒ½ä¼šç›¸åº”å¹³è¡¡ï¼Œè¿™æ ·æ¯ä¸ªç”¨æˆ·çš„ä½“éªŒå°±éƒ½ä¸€æ ·äº†ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> currentFrame = glfwGetTime();</span><br><span class="line">deltaTime = currentFrame - lastFrame;</span><br><span class="line">lastFrame = currentFrame;</span><br></pre></td></tr></table></figure><ul><li>åœ¨cppæ–‡ä»¶ä¸­è°ƒç”¨Cameraç±»æ¥å¯¹é”®ç›˜ç§»åŠ¨è¿›è¡Œæ“ä½œã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">processInput</span><span class="params">(GLFWwindow *window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (glfwGetKey(window, GLFW_KEY_ESCAPE) == GLFW_PRESS)</span><br><span class="line">        glfwSetWindowShouldClose(window, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (glfwGetKey(window, GLFW_KEY_W) == GLFW_PRESS)</span><br><span class="line">        camera.ProcessKeyboard(FORWARD, deltaTime);</span><br><span class="line">    <span class="keyword">if</span> (glfwGetKey(window, GLFW_KEY_S) == GLFW_PRESS)</span><br><span class="line">        camera.ProcessKeyboard(BACKWARD, deltaTime);</span><br><span class="line">    <span class="keyword">if</span> (glfwGetKey(window, GLFW_KEY_A) == GLFW_PRESS)</span><br><span class="line">        camera.ProcessKeyboard(LEFT, deltaTime);</span><br><span class="line">    <span class="keyword">if</span> (glfwGetKey(window, GLFW_KEY_D) == GLFW_PRESS)</span><br><span class="line">        camera.ProcessKeyboard(RIGHT, deltaTime);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Cameraç±»ä¸­é”®ç›˜ç§»åŠ¨çš„å‡½æ•°å®ç°ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ProcessKeyboard</span><span class="params">(Camera_Movement direction, <span class="keyword">float</span> deltaTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> velocity = MovementSpeed * deltaTime;</span><br><span class="line">    <span class="keyword">if</span> (direction == FORWARD)</span><br><span class="line">        Position += Front * velocity;</span><br><span class="line">    <span class="keyword">if</span> (direction == BACKWARD)</span><br><span class="line">        Position -= Front * velocity;</span><br><span class="line">    <span class="keyword">if</span> (direction == LEFT)</span><br><span class="line">        Position -= Right * velocity;</span><br><span class="line">    <span class="keyword">if</span> (direction == RIGHT)</span><br><span class="line">        Position += Right * velocity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•ˆæœï¼š</strong></p><p>é€šè¿‡ç§»åŠ¨ADé”®å®ç°å·¦å³æ–¹å‘çš„ç§»åŠ¨ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20190418110443410.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>é€šè¿‡ç§»åŠ¨WSé”®å®ç°ç‰©ä½“çš„å‰åç§»åŠ¨ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20190418110450354.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h5 id="ï¼ˆ2ï¼‰åˆ©ç”¨é¼ æ ‡å®ç°è§†è§’ç§»åŠ¨"><a href="#ï¼ˆ2ï¼‰åˆ©ç”¨é¼ æ ‡å®ç°è§†è§’ç§»åŠ¨" class="headerlink" title="ï¼ˆ2ï¼‰åˆ©ç”¨é¼ æ ‡å®ç°è§†è§’ç§»åŠ¨"></a>ï¼ˆ2ï¼‰åˆ©ç”¨é¼ æ ‡å®ç°è§†è§’ç§»åŠ¨</h5><p>è§†è§’ç§»åŠ¨ä¹Ÿå°±æ˜¯å®ç°å¯¹cameraFrontå‘é‡çš„æ”¹å˜ã€‚</p><p>é€šè¿‡å¯¹æ¬§æ‹‰è§’çš„æ”¹å˜æ¥å®ç°å¯¹æ–¹å‘å‘é‡çš„æ”¹å˜ã€‚</p><ul><li><p>æ¬§æ‹‰è§’ç”±ä¿¯ä»°è§’å’Œåèˆªè§’è¿˜æœ‰æ»šè½¬è§’(ç”¨ä¸åˆ°)å®ç°</p><ul><li>è®¡ç®—é¼ æ ‡è‡³ä¸Šä¸€å¸§çš„åç§»é‡</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mouse_callback</span><span class="params">(GLFWwindow* window, <span class="keyword">double</span> xpos, <span class="keyword">double</span> ypos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (firstMouse)</span><br><span class="line">    &#123;</span><br><span class="line">        lastX = xpos;</span><br><span class="line">        lastY = ypos;</span><br><span class="line">        firstMouse = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> xoffset = xpos - lastX;</span><br><span class="line">    <span class="keyword">float</span> yoffset = lastY - ypos;</span><br><span class="line">    </span><br><span class="line">    lastX = xpos;</span><br><span class="line">    lastY = ypos;</span><br><span class="line"></span><br><span class="line">    camera.ProcessMouseMovement(xoffset, yoffset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å°†åç§»é‡ä¹˜ä¸Šsensitivity(çµæ•åº¦)åŠ åˆ°pitchå’Œyawä¸Šã€‚</li><li>è®¾ç½®åèˆªè§’é™åˆ¶ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ProcessMouseMovement</span><span class="params">(<span class="keyword">float</span> xoffset, <span class="keyword">float</span> yoffset, GLboolean constrainPitch = <span class="literal">true</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    xoffset *= MouseSensitivity;</span><br><span class="line">    yoffset *= MouseSensitivity;</span><br><span class="line"></span><br><span class="line">    Yaw   += xoffset;</span><br><span class="line">    Pitch += yoffset;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (constrainPitch)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (Pitch &gt; <span class="number">89.0f</span>)</span><br><span class="line">            Pitch = <span class="number">89.0f</span>;</span><br><span class="line">        <span class="keyword">if</span> (Pitch &lt; <span class="number">-89.0f</span>)</span><br><span class="line">            Pitch = <span class="number">-89.0f</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    updateCameraVectors();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æŠŠåç§»é‡åŠ åˆ°å…¨å±€å˜é‡pitchå’Œyawä¸Šï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">glm::vec3 front;</span><br><span class="line">front.x = <span class="built_in">cos</span>(glm::radians(Yaw)) * <span class="built_in">cos</span>(glm::radians(Pitch));</span><br><span class="line">front.y = <span class="built_in">sin</span>(glm::radians(Pitch));</span><br><span class="line">front.z = <span class="built_in">sin</span>(glm::radians(Yaw)) * <span class="built_in">cos</span>(glm::radians(Pitch));</span><br><span class="line">Front = glm::normalize(front);</span><br></pre></td></tr></table></figure></li></ul><p><strong>æ•ˆæœï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/2019041811054195.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h5 id="ï¼ˆ3ï¼‰æ»šè½®å®ç°ç‰©ä½“çš„ç¼©æ”¾"><a href="#ï¼ˆ3ï¼‰æ»šè½®å®ç°ç‰©ä½“çš„ç¼©æ”¾" class="headerlink" title="ï¼ˆ3ï¼‰æ»šè½®å®ç°ç‰©ä½“çš„ç¼©æ”¾"></a>ï¼ˆ3ï¼‰æ»šè½®å®ç°ç‰©ä½“çš„ç¼©æ”¾</h5><p>é€šè¿‡æ”¹å˜è§†é‡æ¥å®ç°ï¼Œåº”ç”¨åˆ°é€è§†çŸ©é˜µä¸Šä¹Ÿå°±æ˜¯fovè§’åº¦çš„å¤§å°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ProcessMouseScroll</span><span class="params">(<span class="keyword">float</span> yoffset)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Zoom &gt;= <span class="number">1.0f</span> &amp;&amp; Zoom &lt;= <span class="number">45.0f</span>)</span><br><span class="line">        Zoom -= yoffset;</span><br><span class="line">    <span class="keyword">if</span> (Zoom &lt;= <span class="number">1.0f</span>)</span><br><span class="line">        Zoom = <span class="number">1.0f</span>;</span><br><span class="line">    <span class="keyword">if</span> (Zoom &gt;= <span class="number">45.0f</span>)</span><br><span class="line">        Zoom = <span class="number">45.0f</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2019041811060459.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æœ€ç»ˆå®ç°æ•ˆæœï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/201904181106164.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>ä»£ç åœ°å€</strong>ï¼š<a href="https://github.com/WangPerryWPY/Computer_Graphics/tree/master/HW5" target="_blank" rel="noopener">https://github.com/WangPerryWPY/Computer_Graphics/tree/master/HW5</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Basicï¼š&quot;&gt;&lt;a href=&quot;#Basicï¼š&quot; class=&quot;headerlink&quot; title=&quot;Basicï¼š&quot;&gt;&lt;/a&gt;Basicï¼š&lt;/h3&gt;&lt;h4 id=&quot;1-æŠ•å½±-Projection&quot;&gt;&lt;a href=&quot;#1-æŠ•å½±-Projection&quot; class=&quot;headerlink&quot; title=&quot;1. æŠ•å½±(Projection):&quot;&gt;&lt;/a&gt;1. æŠ•å½±(Projection):&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æŠŠä¸Šæ¬¡ä½œä¸šç»˜åˆ¶çš„cubeæ”¾ç½®åœ¨(-1.5, 0.5, -1.5)ä½ç½®ï¼Œè¦æ±‚6ä¸ªé¢é¢œè‰²ä¸ä¸€è‡´ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="è®¡ç®—æœºå›¾å½¢å­¦" scheme="http://yoursite.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="è®¡ç®—æœºxå›¾å½¢å­¦" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BAx%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>è®¡ç®—æœºå›¾å½¢å­¦ || Translation</title>
    <link href="http://yoursite.com/2019/07/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6-Translation/"/>
    <id>http://yoursite.com/2019/07/10/è®¡ç®—æœºå›¾å½¢å­¦-Translation/</id>
    <published>2019-07-10T15:20:24.000Z</published>
    <updated>2019-07-10T15:21:44.242Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Basic"><a href="#Basic" class="headerlink" title="Basic:"></a>Basic:</h3><h4 id="1-ç”»ä¸€ä¸ªç«‹æ–¹ä½“-cube-è¾¹é•¿ä¸º4ï¼Œ-ä¸­å¿ƒä½ç½®ä¸º-0-0-0-ã€‚åˆ†åˆ«å¯åŠ¨å’Œå…³é—­æ·±åº¦æµ‹è¯•glEnable-GL-DEPTH-TEST-ã€-glDisable-GL-DEPTH-TEST-ï¼ŒæŸ¥çœ‹åŒºåˆ«ï¼Œå¹¶åˆ†æåŸå› ã€‚"><a href="#1-ç”»ä¸€ä¸ªç«‹æ–¹ä½“-cube-è¾¹é•¿ä¸º4ï¼Œ-ä¸­å¿ƒä½ç½®ä¸º-0-0-0-ã€‚åˆ†åˆ«å¯åŠ¨å’Œå…³é—­æ·±åº¦æµ‹è¯•glEnable-GL-DEPTH-TEST-ã€-glDisable-GL-DEPTH-TEST-ï¼ŒæŸ¥çœ‹åŒºåˆ«ï¼Œå¹¶åˆ†æåŸå› ã€‚" class="headerlink" title="1. ç”»ä¸€ä¸ªç«‹æ–¹ä½“(cube):è¾¹é•¿ä¸º4ï¼Œ ä¸­å¿ƒä½ç½®ä¸º(0, 0, 0)ã€‚åˆ†åˆ«å¯åŠ¨å’Œå…³é—­æ·±åº¦æµ‹è¯•glEnable(GL_DEPTH_TEST) ã€ glDisable(GL_DEPTH_TEST) ï¼ŒæŸ¥çœ‹åŒºåˆ«ï¼Œå¹¶åˆ†æåŸå› ã€‚"></a>1. ç”»ä¸€ä¸ªç«‹æ–¹ä½“(cube):è¾¹é•¿ä¸º4ï¼Œ ä¸­å¿ƒä½ç½®ä¸º(0, 0, 0)ã€‚åˆ†åˆ«å¯åŠ¨å’Œå…³é—­æ·±åº¦æµ‹è¯•glEnable(GL_DEPTH_TEST) ã€ glDisable(GL_DEPTH_TEST) ï¼ŒæŸ¥çœ‹åŒºåˆ«ï¼Œå¹¶åˆ†æåŸå› ã€‚</h4><a id="more"></a><h4 id="ç€è‰²å™¨ï¼š"><a href="#ç€è‰²å™¨ï¼š" class="headerlink" title="ç€è‰²å™¨ï¼š"></a>ç€è‰²å™¨ï¼š</h4><ul><li>é¡¶ç‚¹ç€è‰²å™¨ï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 330 core</span></span><br><span class="line">layout (location = <span class="number">0</span>) in vec3 aPos;</span><br><span class="line"><span class="comment">//layout (location = 1) in vec3 aColor;</span></span><br><span class="line">layout (location = <span class="number">1</span>) in vec2 aTexCoord;</span><br><span class="line"></span><br><span class="line">out vec3 ourColor;</span><br><span class="line"><span class="comment">// å¢åŠ çº¹ç†å±æ€§</span></span><br><span class="line">out vec2 TexCoord;</span><br><span class="line"><span class="comment">//å¢åŠ å˜æ¢å±æ€§</span></span><br><span class="line">uniform mat4 model;</span><br><span class="line">uniform mat4 view;</span><br><span class="line">uniform mat4 projection;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    gl_Position = projection * view * model * vec4(aPos, <span class="number">1.0</span>);</span><br><span class="line">    ourColor = vec3(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line">    TexCoord = aTexCoord;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç‰‡æ®µç€è‰²å™¨ï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 330 core</span></span><br><span class="line">out vec4 FragColor;</span><br><span class="line"></span><br><span class="line">in vec3 ourColor;</span><br><span class="line">in vec2 TexCoord;</span><br><span class="line"></span><br><span class="line">uniform sampler2D texture1;</span><br><span class="line">uniform sampler2D texture2;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å°†ä¸¤ç§çº¹ç†è¿›è¡Œæ··åˆ</span></span><br><span class="line">    FragColor = mix(texture(texture1, TexCoord), texture(texture2, TexCoord), <span class="number">0.2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å»ºæ¨¡ï¼š"><a href="#å»ºæ¨¡ï¼š" class="headerlink" title="å»ºæ¨¡ï¼š"></a>å»ºæ¨¡ï¼š</h4><ul><li>è®¾ç½®ç«‹æ–¹ä½“çš„36ä¸ªé¡¶ç‚¹ï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> vertices[] = &#123;</span><br><span class="line">        <span class="comment">// é¡¶ç‚¹ä½ç½®           // çº¹ç†åæ ‡</span></span><br><span class="line">        <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">         <span class="number">2.0f</span>, <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">         <span class="number">2.0f</span>,  <span class="number">2.0f</span>, <span class="number">-2.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">         <span class="number">2.0f</span>,  <span class="number">2.0f</span>, <span class="number">-2.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-2.0f</span>,  <span class="number">2.0f</span>, <span class="number">-2.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>,</span><br><span class="line">        <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">-2.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">    ......  ............</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="åæ ‡è®¾å®šï¼š"><a href="#åæ ‡è®¾å®šï¼š" class="headerlink" title="åæ ‡è®¾å®šï¼š"></a>åæ ‡è®¾å®šï¼š</h4><ul><li>è®¾ç½®è§‚å¯Ÿ(æ‘„åƒæœº)çŸ©é˜µå’Œé€è§†æŠ•å½±çŸ©é˜µï¼Œå› ä¸ºè®¾ç½®çš„è¾¹é•¿è¾ƒå¤§ï¼Œæ‰€ä»¥è¦å°†è§†è§’æ‹‰å‘å¾ˆè¿œã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®viewå’Œé€è§†çŸ©é˜µï¼Œå› ä¸ºé»˜è®¤æ‘„åƒæœºå’Œé€è§†ä¸å˜åŒ–æ‰€ä»¥å¼€å§‹å°±å¯ä»¥è®¾ç½®å¥½</span></span><br><span class="line">    glm::mat4 view = glm::mat4(<span class="number">1.0f</span>);</span><br><span class="line">    glm::mat4 projection = glm::mat4(<span class="number">1.0f</span>);</span><br><span class="line">    view = glm::translate(view, glm::vec3(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-15.0f</span>));</span><br><span class="line">    projection = glm::perspective(glm::radians(<span class="number">45.0f</span>), (<span class="keyword">float</span>)SCR_WIDTH / (<span class="keyword">float</span>)SCR_HEIGHT, <span class="number">0.1f</span>, <span class="number">100.0f</span>);</span><br><span class="line">    object1.use(); <span class="comment">// don't forget to activate/use the shader before setting uniforms!</span></span><br><span class="line">    object1.setMat4(<span class="string">"view"</span>, view);</span><br><span class="line">    object1.setMat4(<span class="string">"projection"</span>, projection);</span><br></pre></td></tr></table></figure><ul><li>è®¾ç½®æ¨¡å‹çŸ©é˜µï¼š</li></ul><p>å› ä¸ºè®¾è®¡çº¿æ€§ä»£æ•°çš„çŸ©é˜µè¿ç®—ï¼Œæ‰€ä»¥æ¨¡å‹å˜æ¢æ—¶è¦å…ˆç¼©æ”¾ï¼Œåæ—‹è½¬æœ€åä½ç§»ã€‚å˜ä¸ºçŸ©é˜µè¿ç®—åˆ™åˆšå¥½ç›¸åè¿›è¡Œåˆ›å»ºã€‚æœ€åå‘é€ç»™ç€è‰²å™¨ï¼Œå†è¿™ä¹‹å‰è®°å¾—æ¿€æ´»(æ¯æ¬¡ä½¿ç”¨å‰ä¸€å®šè®°å¾—æ¿€æ´»ï¼ï¼ï¼)ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">object1.use();</span><br><span class="line">glm::mat4 model = glm::mat4(<span class="number">1.0f</span>); <span class="comment">// make sure to initialize matrix to identity matrix first</span></span><br><span class="line"><span class="comment">// å…ˆç¼©æ”¾ï¼Œåæ—‹è½¬ï¼Œæœ€åä½ç§»ï¼ŒçŸ©é˜µä¹˜æ³•é¡ºåºç›¸å</span></span><br><span class="line"><span class="comment">// æ²¿æ°´å¹³æ–¹å‘æ¥å›ç§»åŠ¨</span></span><br><span class="line">model = glm::translate(model, glm::vec3(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>));</span><br><span class="line"><span class="comment">// æ²¿ç€x = zè½´æŒç»­æ—‹è½¬</span></span><br><span class="line">model = glm::rotate(model, rad_z , glm::vec3(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line"><span class="comment">// æŒç»­æ”¾å¤§ç¼©å°</span></span><br><span class="line"><span class="comment">//float scale_size = 2 * abs(cos((float)glfwGetTime()));</span></span><br><span class="line">model = glm::scale(model, glm::vec3(_s, _s, _s));</span><br><span class="line">object1.setMat4(<span class="string">"model"</span>, model);</span><br></pre></td></tr></table></figure><h4 id="çº¹ç†ï¼š"><a href="#çº¹ç†ï¼š" class="headerlink" title="çº¹ç†ï¼š"></a>çº¹ç†ï¼š</h4><ul><li>ä¸ºäº†ç¾è§‚åˆä¸ºç«‹æ–¹ä½“æ·»åŠ äº†çº¹ç†æ•ˆæœï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> texture1, texture2;</span><br><span class="line">texture1 = LoadTexture(<span class="string">"timg.jpg"</span>, <span class="number">0</span>);</span><br><span class="line">texture2 = LoadTexture(<span class="string">"rocket.png"</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¿€æ´»å¹¶ç»‘å®šçº¹ç†å•å…ƒ</span></span><br><span class="line">glActiveTexture(GL_TEXTURE0);</span><br><span class="line">glBindTexture(GL_TEXTURE_2D, texture1);</span><br><span class="line">glActiveTexture(GL_TEXTURE1);</span><br><span class="line">glBindTexture(GL_TEXTURE_2D, texture2);</span><br><span class="line"><span class="comment">// å°†çº¹ç†ç»‘å®šåˆ°å¯¹åº”çš„çº¹ç†å•å…ƒ</span></span><br><span class="line">object1.use(); <span class="comment">// don't forget to activate/use the shader before setting uniforms!</span></span><br><span class="line">object1.setInt(<span class="string">"texture1"</span>, <span class="number">0</span>);</span><br><span class="line">object1.setInt(<span class="string">"texture2"</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure><h4 id="æ·±åº¦æµ‹è¯•ï¼š"><a href="#æ·±åº¦æµ‹è¯•ï¼š" class="headerlink" title="æ·±åº¦æµ‹è¯•ï¼š"></a>æ·±åº¦æµ‹è¯•ï¼š</h4><ul><li>å¼€å¯æ·±åº¦æµ‹è¯•</li></ul><p><img src="https://img-blog.csdnimg.cn/20190410144514309.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">- æœªå¼€å¯æ·±åº¦æµ‹è¯•</p><p><img src="https://img-blog.csdnimg.cn/20190410144536453.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç°è±¡è§£é‡Šï¼š"><a href="#ç°è±¡è§£é‡Šï¼š" class="headerlink" title="ç°è±¡è§£é‡Šï¼š"></a>ç°è±¡è§£é‡Šï¼š</h4><p>OpenGLæ˜¯ä¸€ä¸ªä¸‰è§’å½¢ä¸€ä¸ªä¸‰è§’å½¢åœ°æ¥ç»˜åˆ¶ä½ çš„ç«‹æ–¹ä½“çš„ï¼Œæ‰€ä»¥å³ä¾¿ä¹‹å‰é‚£é‡Œæœ‰ä¸œè¥¿å®ƒä¹Ÿä¼šè¦†ç›–ä¹‹å‰çš„åƒç´ ã€‚å› ä¸ºè¿™ä¸ªåŸå› ï¼Œæœ‰äº›ä¸‰è§’å½¢ä¼šè¢«ç»˜åˆ¶åœ¨å…¶å®ƒä¸‰è§’å½¢ä¸Šé¢ï¼Œè™½ç„¶å®ƒä»¬æœ¬ä¸åº”è¯¥æ˜¯è¢«è¦†ç›–çš„ã€‚</p><ul><li><strong>æ·±åº¦ç¼“å†²ï¼š</strong></li></ul><p>OpenGLå­˜å‚¨å®ƒçš„æ‰€æœ‰æ·±åº¦ä¿¡æ¯äºä¸€ä¸ªZç¼“å†²(Z-buffer)ä¸­ï¼Œä¹Ÿè¢«ç§°ä¸ºæ·±åº¦ç¼“å†²(Depth Buffer)ã€‚GLFWä¼šè‡ªåŠ¨ç”Ÿæˆè¿™æ ·ä¸€ä¸ªç¼“å†²ï¼ˆå°±åƒå®ƒä¹Ÿæœ‰ä¸€ä¸ªé¢œè‰²ç¼“å†²æ¥å­˜å‚¨è¾“å‡ºå›¾åƒçš„é¢œè‰²ï¼‰ã€‚æ·±åº¦å€¼å­˜å‚¨åœ¨æ¯ä¸ªç‰‡æ®µé‡Œé¢ï¼ˆä½œä¸ºç‰‡æ®µçš„<strong>z</strong>å€¼ï¼‰ï¼Œå½“ç‰‡æ®µæƒ³è¦è¾“å‡ºå®ƒçš„é¢œè‰²æ—¶ï¼ŒOpenGLä¼šå°†å®ƒçš„æ·±åº¦å€¼å’Œzç¼“å†²è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå½“å‰çš„ç‰‡æ®µåœ¨å…¶å®ƒç‰‡æ®µä¹‹åï¼Œå®ƒå°†ä¼šè¢«ä¸¢å¼ƒï¼Œå¦åˆ™å°†ä¼šè¦†ç›–ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºæ·±åº¦æµ‹è¯•(Depth Testing)ï¼Œå®ƒæ˜¯ç”±OpenGLè‡ªåŠ¨å®Œæˆçš„ã€‚</p><p>é€šè¿‡glEnableå‡½æ•°æ¥å¼€å¯æ·±åº¦æµ‹è¯•ã€‚glEnableå’ŒglDisableå‡½æ•°å¯ç”¨æˆ–ç¦ç”¨æŸä¸ªOpenGLåŠŸèƒ½ã€‚è¿™ä¸ªåŠŸèƒ½ä¼šä¸€ç›´ä¿æŒå¯ç”¨/ç¦ç”¨çŠ¶æ€ï¼Œç›´åˆ°å¦ä¸€ä¸ªè°ƒç”¨æ¥ç¦ç”¨/å¯ç”¨å®ƒã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glEnable(GL_DEPTH_TEST);</span><br></pre></td></tr></table></figure><p>å› ä¸ºä½¿ç”¨äº†æ·±åº¦æµ‹è¯•ï¼Œæˆ‘ä»¬ä¹Ÿæƒ³è¦åœ¨æ¯æ¬¡æ¸²æŸ“è¿­ä»£ä¹‹å‰æ¸…é™¤æ·±åº¦ç¼“å†²ï¼ˆå¦åˆ™å‰ä¸€å¸§çš„æ·±åº¦ä¿¡æ¯ä»ç„¶ä¿å­˜åœ¨ç¼“å†²ä¸­ï¼‰ã€‚å°±åƒæ¸…é™¤é¢œè‰²ç¼“å†²ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡åœ¨glClearå‡½æ•°ä¸­æŒ‡å®šDEPTH_BUFFER_BITä½æ¥æ¸…é™¤æ·±åº¦ç¼“å†²ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br></pre></td></tr></table></figure><h4 id="2-å¹³ç§»-Translation-ä½¿ç”»å¥½çš„cubeæ²¿ç€æ°´å¹³æˆ–å‚ç›´æ–¹å‘æ¥å›ç§»åŠ¨ã€‚"><a href="#2-å¹³ç§»-Translation-ä½¿ç”»å¥½çš„cubeæ²¿ç€æ°´å¹³æˆ–å‚ç›´æ–¹å‘æ¥å›ç§»åŠ¨ã€‚" class="headerlink" title="2. å¹³ç§»(Translation):ä½¿ç”»å¥½çš„cubeæ²¿ç€æ°´å¹³æˆ–å‚ç›´æ–¹å‘æ¥å›ç§»åŠ¨ã€‚"></a>2. å¹³ç§»(Translation):ä½¿ç”»å¥½çš„cubeæ²¿ç€æ°´å¹³æˆ–å‚ç›´æ–¹å‘æ¥å›ç§»åŠ¨ã€‚</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model = glm::translate(model, glm::vec3(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br></pre></td></tr></table></figure><h4 id="3-æ—‹è½¬-Rotation-ä½¿ç”»å¥½çš„cubeæ²¿ç€XoZå¹³é¢çš„x-zè½´æŒç»­æ—‹è½¬ã€‚"><a href="#3-æ—‹è½¬-Rotation-ä½¿ç”»å¥½çš„cubeæ²¿ç€XoZå¹³é¢çš„x-zè½´æŒç»­æ—‹è½¬ã€‚" class="headerlink" title="3. æ—‹è½¬(Rotation):ä½¿ç”»å¥½çš„cubeæ²¿ç€XoZå¹³é¢çš„x=zè½´æŒç»­æ—‹è½¬ã€‚"></a>3. æ—‹è½¬(Rotation):ä½¿ç”»å¥½çš„cubeæ²¿ç€XoZå¹³é¢çš„x=zè½´æŒç»­æ—‹è½¬ã€‚</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model = glm::rotate(model, (<span class="keyword">float</span>)glfwGetTime() * glm::radians(<span class="number">30.0f</span>),  glm::vec3(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));![img](pic/<span class="number">2.</span>gif)</span><br></pre></td></tr></table></figure><h4 id="4-æ”¾ç¼©-Scaling-ä½¿ç”»å¥½çš„cubeæŒç»­æ”¾å¤§ç¼©å°ã€‚"><a href="#4-æ”¾ç¼©-Scaling-ä½¿ç”»å¥½çš„cubeæŒç»­æ”¾å¤§ç¼©å°ã€‚" class="headerlink" title="4.æ”¾ç¼©(Scaling):ä½¿ç”»å¥½çš„cubeæŒç»­æ”¾å¤§ç¼©å°ã€‚"></a>4.æ”¾ç¼©(Scaling):ä½¿ç”»å¥½çš„cubeæŒç»­æ”¾å¤§ç¼©å°ã€‚</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> scale_size = <span class="number">2</span> * <span class="built_in">abs</span>(<span class="built_in">cos</span>((<span class="keyword">float</span>)glfwGetTime()));</span><br><span class="line">model = glm::scale(model, glm::vec3(scale_size, scale_size, scale_size));</span><br></pre></td></tr></table></figure><h4 id="5-åœ¨GUIé‡Œæ·»åŠ èœå•æ ï¼Œå¯ä»¥é€‰æ‹©å„ç§å˜æ¢ã€‚"><a href="#5-åœ¨GUIé‡Œæ·»åŠ èœå•æ ï¼Œå¯ä»¥é€‰æ‹©å„ç§å˜æ¢ã€‚" class="headerlink" title="5. åœ¨GUIé‡Œæ·»åŠ èœå•æ ï¼Œå¯ä»¥é€‰æ‹©å„ç§å˜æ¢ã€‚"></a>5. åœ¨GUIé‡Œæ·»åŠ èœå•æ ï¼Œå¯ä»¥é€‰æ‹©å„ç§å˜æ¢ã€‚</h4><h5 id="åŠŸèƒ½ï¼š"><a href="#åŠŸèƒ½ï¼š" class="headerlink" title="åŠŸèƒ½ï¼š"></a>åŠŸèƒ½ï¼š</h5><ul><li><strong>Translatinï¼š</strong><ul><li>åˆ†åˆ«æœ‰xè½´å’Œyè½´ä¸¤ä¸ªSliderï¼Œæ‹–åŠ¨è¿›åº¦æ¡å¯ä»¥ä½¿ç‰©ä½“æ²¿ä¸¤ä¸ªè½´ç§»åŠ¨ã€‚</li><li>å› ä¸ºzè½´çš„ç§»åŠ¨è§†è§‰æ•ˆæœç±»ä¼¼æ”¾ç¼©ï¼Œæ‰€ä»¥ä¸åšè®¾è®¡ã€‚</li></ul></li><li><strong>Rotationï¼š</strong><ul><li>åˆ†åˆ«æœ‰ä¸‰ä¸ªæŒ‰é’®ï¼Œå¯¹åº”x, y, zè½´ï¼Œç‚¹å‡»å¯ä»¥ä½¿å¾—ç«‹æ–¹ä½“æ²¿ç€å¯¹åº”è½´æ—‹è½¬å“åº”å•ä½è§’åº¦(è®¾ç½®ä¸º30åº¦)ã€‚</li></ul></li><li><strong>Scale:</strong><ul><li>æ‹–åŠ¨Sliderå®ç°ç«‹æ–¹ä½“çš„æ”¾ç¼©ï¼Œä¸Šé™ä¸º2å€ã€‚</li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// imguiçš„Sliderå˜åŒ–é‡</span></span><br><span class="line"><span class="keyword">float</span> _t_x = <span class="number">0</span>, _t_y = <span class="number">0</span>, _s = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">float</span> rad_x = <span class="number">0.0f</span>, rad_y = <span class="number">0.0f</span>, rad_z = <span class="number">0.0f</span>;</span><br><span class="line"><span class="keyword">bool</span> r_x = <span class="literal">false</span>, r_y = <span class="literal">false</span>, r_z = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">// imguiçš„menu</span></span><br><span class="line"><span class="keyword">bool</span> tool_active = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">bool</span> basic = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">bool</span> bonus = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ImGui::Text(<span class="string">"(1).Translation"</span>);</span><br><span class="line">ImGui::SliderFloat(<span class="string">"translation_X"</span>, &amp;_t_x, <span class="number">-1</span>, <span class="number">1</span>);</span><br><span class="line">ImGui::SliderFloat(<span class="string">"translation_Y"</span>, &amp;_t_y, <span class="number">-1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">//ImGui::SliderFloat("translation_Z", &amp;_t_z, -1, 1);</span></span><br><span class="line">ImGui::Text(<span class="string">"(2).Rotation"</span>);</span><br><span class="line"><span class="comment">//ImGui::SliderFloat("Rotation", &amp;_r, -1, 1);</span></span><br><span class="line"><span class="keyword">if</span> (ImGui::Button(<span class="string">"rotate by x"</span>))</span><br><span class="line">&#123;</span><br><span class="line">    r_x = <span class="literal">true</span>;</span><br><span class="line">    rad_x += glm::radians(<span class="number">30.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (ImGui::Button(<span class="string">"rotata by y"</span>))</span><br><span class="line">&#123;</span><br><span class="line">    r_y = <span class="literal">true</span>;</span><br><span class="line">    rad_y += glm::radians(<span class="number">30.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (ImGui::Button(<span class="string">"rotate by z"</span>))</span><br><span class="line">&#123;</span><br><span class="line">    r_z = <span class="literal">true</span>;</span><br><span class="line">    rad_z += glm::radians(<span class="number">30.0f</span>);</span><br><span class="line">&#125;</span><br><span class="line">ImGui::Text(<span class="string">"(3).Scale"</span>);</span><br><span class="line">ImGui::SliderFloat(<span class="string">"Scale"</span>, &amp;_s, <span class="number">0</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">object1.use();</span><br><span class="line"><span class="comment">// å˜æ¢ç»„åˆ</span></span><br><span class="line">glm::mat4 model = glm::mat4(<span class="number">1.0f</span>); <span class="comment">// make sure to initialize matrix to identity matrix first</span></span><br><span class="line"><span class="comment">// å…ˆç¼©æ”¾ï¼Œåæ—‹è½¬ï¼Œæœ€åä½ç§»ï¼ŒçŸ©é˜µä¹˜æ³•é¡ºåºç›¸å</span></span><br><span class="line"><span class="comment">// æ²¿æ°´å¹³æ–¹å‘æ¥å›ç§»åŠ¨</span></span><br><span class="line">model = glm::translate(model, glm::vec3(_t_x, _t_y, <span class="number">0.0</span>));</span><br><span class="line"><span class="comment">// æ²¿ç€x = zè½´æŒç»­æ—‹è½¬</span></span><br><span class="line"><span class="keyword">if</span> (r_x)</span><br><span class="line">&#123;</span><br><span class="line">    model = glm::rotate(model, rad_x , glm::vec3(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (r_y)</span><br><span class="line">&#123;</span><br><span class="line">    model = glm::rotate(model, rad_y,  glm::vec3(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (r_z)</span><br><span class="line">&#123;</span><br><span class="line">    model = glm::rotate(model, rad_z, glm::vec3(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æŒç»­æ”¾å¤§ç¼©å°</span></span><br><span class="line"><span class="comment">//float scale_size = 2 * abs(cos((float)glfwGetTime()));</span></span><br><span class="line">model = glm::scale(model, glm::vec3(_s, _s, _s));</span><br><span class="line">object1.setMat4(<span class="string">"model"</span>, model);</span><br></pre></td></tr></table></figure><h5 id="å®ç°æ•ˆæœï¼š"><a href="#å®ç°æ•ˆæœï¼š" class="headerlink" title="å®ç°æ•ˆæœï¼š"></a>å®ç°æ•ˆæœï¼š</h5><p><img src="https://img-blog.csdnimg.cn/20190410144710319.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20190410144718564.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20190410144735332.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="6-ç»“åˆShaderè°ˆè°ˆå¯¹æ¸²æŸ“ç®¡çº¿çš„ç†è§£"><a href="#6-ç»“åˆShaderè°ˆè°ˆå¯¹æ¸²æŸ“ç®¡çº¿çš„ç†è§£" class="headerlink" title="6. ç»“åˆShaderè°ˆè°ˆå¯¹æ¸²æŸ“ç®¡çº¿çš„ç†è§£"></a>6. ç»“åˆShaderè°ˆè°ˆå¯¹æ¸²æŸ“ç®¡çº¿çš„ç†è§£</h4><p><strong>shaderçš„ç®¡çº¿æ­¥éª¤å¦‚ä¸‹ï¼š</strong></p><ul><li>vertex processor(vs)</li><li>Primitive assembly(å›¾å…ƒè£…é…)</li><li>Geometry processor(å‡ ä½•å­¦å¤„ç†)(åŒ…æ‹¬å°†ç‰©ä½“ä»ä¸‰ç»´é€å½±åˆ°äºŒç»´)</li><li>clipper</li><li>å…‰æ …åŒ–</li><li>fragment processor</li></ul><p><strong>åœ¨openGLä¸­ç¼–å†™shaderç¨‹åºåˆ™ä¸»è¦åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š</strong></p><ul><li>åˆ›å»ºshaderå¯¹è±¡<ul><li>é¡¶ç‚¹shader</li><li>ç‰‡å…ƒshader</li></ul></li><li>æŒ‡å®šshaderæºä»£ç </li><li>ç¼–è¯‘shader<ul><li>è°ƒè¯•</li></ul></li><li>å°†shaderå¯¹è±¡ä¸ç¨‹åºå¯¹è±¡ç»‘å®š</li><li>é“¾æ¥<ul><li>è°ƒè¯•</li></ul></li><li>é‡Šæ”¾ä¸­é—´shaderå¯¹è±¡</li><li>é€šè¿‡glUseProgramå°†é“¾æ¥å¥½çš„ç¨‹åºå¯¹è±¡é€åˆ°shaderç®¡çº¿ï¼Œè¿™ä¸ªshaderå°†å¯¹ä¹‹åçš„drawæœ‰æ•ˆ</li></ul><p><strong>shaderå¯¹è±¡è°ƒç”¨é¡¶ç‚¹å’Œç‰‡å…ƒçš„shaderä»£ç ï¼š</strong></p><ul><li>é¡¶ç‚¹shaderä»£ç ä¸­åŒ…å«é¡¶ç‚¹bufferä¸­çš„å€¼è¢«è§£é‡Šä¸ºå…¶åœ¨bufferä¸­ä½ç½®(å¯èƒ½åŒ…å«ä½ç½®ï¼Œæ³•å‘ï¼Œçº¹ç†ç­‰å¤šä¸ªå±æ€§)ã€‚</li><li>mainä¸­æŠŠå¤šä¸ªshaderå¯¹è±¡é“¾æ¥åˆ°ä¸€èµ·å½¢æˆæœ€ç»ˆçš„shaderã€‚</li><li>é¡¶ç‚¹shaderè¿è¡ŒæˆåŠŸåå°†ä¼šæŠŠç‰©ä½“ä»ä¸‰ç»´æŠ•å°„åˆ°äºŒç»´(é€å°„é™¤æ³•)</li><li>å…‰æ …åŒ–åæ¯ä¸ªç‰‡å…ƒæ‰§è¡Œç‰‡å…ƒshaderçš„æ“ä½œï¼Œè¾“å‡ºçš„æœ€ç»ˆé¢œè‰²ç”±outçš„FragColorå†³å®šã€‚</li></ul><h3 id="Bonus"><a href="#Bonus" class="headerlink" title="Bonus:"></a>Bonus:</h3><ul><li>åŠŸèƒ½ï¼š<ul><li>å°†basicå’Œbonusåˆ†åˆ«ä»¥ä¸åŒçš„menuåœ¨guiä¸­åŒºåˆ«å‡ºæ¥ã€‚</li><li>bonusä¸­å®ç°äº†ä¸€ä¸ªæ¨¡æ‹Ÿçš„åœ°çƒç»•å¤ªé˜³æ—‹è½¬(ç”¨ç«‹æ–¹ä½“è¡¨ç¤ºçš„)ï¼Œåœ°çƒå…·å¤‡è‡ªè½¬å’Œå…¬è½¬èƒ½åŠ›ï¼Œå¤ªé˜³è‡ªè½¬ã€‚</li><li>åœ°çƒå’Œå¤ªé˜³åˆ†åˆ«éš¶å±ä¸åŒçš„ç€è‰²å™¨ï¼Œå› ä¸ºè®¾ç½®ä¸åŒçš„çº¹ç†ï¼Œå¤ªé˜³æ˜¯å¤ªç©ºå’Œå¤ªé˜³ç»“åˆçš„çº¹ç†å±æ€§ï¼Œåœ°çƒæ˜¯åœ°çƒè¡¨é¢è´´å›¾çš„çº¹ç†å±æ€§ã€‚</li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Shader <span class="title">object1</span><span class="params">(<span class="string">"shader.vs"</span>, <span class="string">"shader.fs"</span>)</span></span>;</span><br><span class="line"><span class="function">Shader <span class="title">object2</span><span class="params">(<span class="string">"shader1.vs"</span>, <span class="string">"shader1.fs"</span>)</span></span>;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">texture3 = LoadTexture(<span class="string">"åœ°çƒ.jpg"</span>, <span class="number">0</span>);</span><br><span class="line">texture4 = LoadTexture(<span class="string">"å¤ªé˜³.png"</span>, <span class="number">1</span>);</span><br><span class="line">glActiveTexture(GL_TEXTURE2);</span><br><span class="line">glBindTexture(GL_TEXTURE_2D, texture3);</span><br><span class="line">glActiveTexture(GL_TEXTURE3);</span><br><span class="line">glBindTexture(GL_TEXTURE_2D, texture4);</span><br><span class="line">object1.use(); <span class="comment">// don't forget to activate/use the shader before setting uniforms!</span></span><br><span class="line">object1.setInt(<span class="string">"texture1"</span>, <span class="number">0</span>);</span><br><span class="line">object1.setInt(<span class="string">"texture2"</span>, <span class="number">3</span>);</span><br><span class="line">object2.use();</span><br><span class="line">object2.setInt(<span class="string">"Texture"</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">object1.use();</span><br><span class="line"><span class="comment">// å˜æ¢ç»„åˆ</span></span><br><span class="line"><span class="comment">// å¤ªé˜³</span></span><br><span class="line">glm::mat4 model = glm::mat4(<span class="number">1.0f</span>);</span><br><span class="line">model = glm::rotate(model, (<span class="keyword">float</span>)glfwGetTime() * glm::radians(<span class="number">30.0f</span>), glm::vec3(<span class="number">0.5f</span>, <span class="number">0.8f</span>, <span class="number">0.0f</span>));</span><br><span class="line">object1.setMat4(<span class="string">"model"</span>, model);</span><br><span class="line">glDrawArrays(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">object2.use();</span><br><span class="line">glm::mat4 model1 = glm::mat4(<span class="number">1.0f</span>); <span class="comment">// make sure to initialize matrix to identity matrix first</span></span><br><span class="line"><span class="comment">// å…¬è½¬</span></span><br><span class="line"><span class="keyword">float</span> X = <span class="built_in">sin</span>(glfwGetTime()) * <span class="number">5</span>;</span><br><span class="line"><span class="keyword">float</span> Z = <span class="built_in">cos</span>(glfwGetTime()) * <span class="number">5</span>;</span><br><span class="line">model1 = glm::translate(model1, glm::vec3(X, <span class="number">0.0f</span>, Z));</span><br><span class="line"><span class="comment">// è‡ªè½¬</span></span><br><span class="line">model1 = glm::rotate(model1, (<span class="keyword">float</span>)glfwGetTime() * glm::radians(<span class="number">45.0f</span>), glm::vec3(<span class="number">0.5f</span>, <span class="number">1.0f</span>, <span class="number">0.3f</span>));</span><br><span class="line"><span class="comment">// åœ°çƒæ¯”å¤ªé˜³å°</span></span><br><span class="line">model1 = glm::scale(model1, glm::vec3(<span class="number">0.5f</span>, <span class="number">0.5f</span>, <span class="number">0.5f</span>));</span><br><span class="line">object2.setMat4(<span class="string">"model"</span>, model1);</span><br><span class="line">glDrawArrays(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br></pre></td></tr></table></figure><h5 id="å®ç°æ•ˆæœï¼š-1"><a href="#å®ç°æ•ˆæœï¼š-1" class="headerlink" title="å®ç°æ•ˆæœï¼š"></a>å®ç°æ•ˆæœï¼š</h5><ul><li>ç•¥ä¸‘(æ‚è„¸)</li></ul><p><img src="https://img-blog.csdnimg.cn/20190410144756905.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20190410144810441.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20190410144819530.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¯¦ç»†ä»£ç å‚è€ƒï¼š<br><a href="https://github.com/WangPerryWPY/Computer_Graphics/tree/master/HW4" target="_blank" rel="noopener">https://github.com/WangPerryWPY/Computer_Graphics/tree/master/HW4</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Basic&quot;&gt;&lt;a href=&quot;#Basic&quot; class=&quot;headerlink&quot; title=&quot;Basic:&quot;&gt;&lt;/a&gt;Basic:&lt;/h3&gt;&lt;h4 id=&quot;1-ç”»ä¸€ä¸ªç«‹æ–¹ä½“-cube-è¾¹é•¿ä¸º4ï¼Œ-ä¸­å¿ƒä½ç½®ä¸º-0-0-0-ã€‚åˆ†åˆ«å¯åŠ¨å’Œå…³é—­æ·±åº¦æµ‹è¯•glEnable-GL-DEPTH-TEST-ã€-glDisable-GL-DEPTH-TEST-ï¼ŒæŸ¥çœ‹åŒºåˆ«ï¼Œå¹¶åˆ†æåŸå› ã€‚&quot;&gt;&lt;a href=&quot;#1-ç”»ä¸€ä¸ªç«‹æ–¹ä½“-cube-è¾¹é•¿ä¸º4ï¼Œ-ä¸­å¿ƒä½ç½®ä¸º-0-0-0-ã€‚åˆ†åˆ«å¯åŠ¨å’Œå…³é—­æ·±åº¦æµ‹è¯•glEnable-GL-DEPTH-TEST-ã€-glDisable-GL-DEPTH-TEST-ï¼ŒæŸ¥çœ‹åŒºåˆ«ï¼Œå¹¶åˆ†æåŸå› ã€‚&quot; class=&quot;headerlink&quot; title=&quot;1. ç”»ä¸€ä¸ªç«‹æ–¹ä½“(cube):è¾¹é•¿ä¸º4ï¼Œ ä¸­å¿ƒä½ç½®ä¸º(0, 0, 0)ã€‚åˆ†åˆ«å¯åŠ¨å’Œå…³é—­æ·±åº¦æµ‹è¯•glEnable(GL_DEPTH_TEST) ã€ glDisable(GL_DEPTH_TEST) ï¼ŒæŸ¥çœ‹åŒºåˆ«ï¼Œå¹¶åˆ†æåŸå› ã€‚&quot;&gt;&lt;/a&gt;1. ç”»ä¸€ä¸ªç«‹æ–¹ä½“(cube):è¾¹é•¿ä¸º4ï¼Œ ä¸­å¿ƒä½ç½®ä¸º(0, 0, 0)ã€‚åˆ†åˆ«å¯åŠ¨å’Œå…³é—­æ·±åº¦æµ‹è¯•glEnable(GL_DEPTH_TEST) ã€ glDisable(GL_DEPTH_TEST) ï¼ŒæŸ¥çœ‹åŒºåˆ«ï¼Œå¹¶åˆ†æåŸå› ã€‚&lt;/h4&gt;
    
    </summary>
    
      <category term="è®¡ç®—æœºå›¾å½¢å­¦" scheme="http://yoursite.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="è®¡ç®—æœºå›¾å½¢å­¦" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>å¤–éƒ¨æ’åº || c++å®ç°å¤šè·¯å½’å¹¶çš„è´¥è€…æ ‘ç®—æ³•</title>
    <link href="http://yoursite.com/2019/07/10/c-%E5%AE%9E%E7%8E%B0%E5%A4%9A%E8%B7%AF%E5%BD%92%E5%B9%B6%E7%9A%84%E8%B4%A5%E8%80%85%E6%A0%91%E7%AE%97%E6%B3%95/"/>
    <id>http://yoursite.com/2019/07/10/c-å®ç°å¤šè·¯å½’å¹¶çš„è´¥è€…æ ‘ç®—æ³•/</id>
    <published>2019-07-10T15:18:58.000Z</published>
    <updated>2019-07-10T15:20:01.810Z</updated>
    
    <content type="html"><![CDATA[<h4 id="ç®—æ³•æ¦‚å¿µï¼š"><a href="#ç®—æ³•æ¦‚å¿µï¼š" class="headerlink" title="ç®—æ³•æ¦‚å¿µï¼š"></a>ç®—æ³•æ¦‚å¿µï¼š</h4><ul><li>å¦‚æœæˆ‘ä»¬è¦å¯¹å¤§è§„æ¨¡æ–‡ä»¶è¿›è¡Œæ’åºï¼Œä¸èƒ½ä¸€æ¬¡è£…å…¥å†…å­˜ä¸­ï¼Œåªèƒ½ä»å¤–å­˜ä¸€æ¬¡æ¬¡è¯»å–åˆ†åˆ«æ’åºï¼Œè€Œå¤–å­˜çš„IOæ—¶é—´å¤æ‚åº¦å¾ˆé«˜ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å°½é‡å‡å°‘é’ˆå¯¹å¤–å­˜è¯»å†™çš„æ¬¡æ•°ã€‚å¦‚æœæˆ‘ä»¬åªæ˜¯ç®€å•åœ°è¿›è¡ŒäºŒè·¯å½’å¹¶çš„è¯ï¼Œå½’å¹¶è·¯æ•°è¶Šå°‘å½’å¹¶çš„æ¬¡æ•°å°±è¶Šå¤šï¼Œæ¯æ¬¡å½’å¹¶éƒ½è¦è¿›è¡Œä¸€æ¬¡IOæ“ä½œã€‚æ‰€ä»¥æˆ‘ä»¬è€ƒè™‘å°½é‡è¿›è¡Œå¤šè·¯å½’å¹¶ï¼Œè€Œå¤šè·¯å½’å¹¶ä¸åŒäºç®€å•åœ°äºŒæ¬¡å½’å¹¶åªéœ€å¯¹ä¸¤ç»„æ•°è¿›è¡ŒæŒ‡é’ˆç§»åŠ¨å½’å¹¶ï¼Œä¸ºäº†é™ä½å¤šè·¯å½’å¹¶ä¸­å½’å¹¶çš„æ—¶é—´å¤æ‚åº¦ã€‚æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨è´¥è€…æ ‘ã€‚</li></ul><a id="more"></a><ul><li>è´¥è€…æ ‘å’Œèƒœè€…æ ‘ç›¸å¯¹ï¼Œå°±æ˜¯æ ‘çš„æ¯ä¸ªç»“ç‚¹å­˜å‚¨çš„æ˜¯æ¯”è¾ƒå¤±è´¥çš„ç»“ç‚¹ï¼Œèƒœåˆ©çš„ç»“ç‚¹æ¥ç€å»ä¸æ›´é«˜å±‚æ¬¡çš„ç»“ç‚¹è¿›è¡Œæ¯”è¾ƒã€‚</li><li>æƒ³æ³•åº”ç”¨äºç«æŠ€æ¯”èµ›å°±æ˜¯å½“é€‰å‡ºå† å†›åï¼Œå†é€‰æ‹©äºšå†›åªéœ€è¦è®©æ›¾ç»è´¥ç»™å† å†›çš„ç»“ç‚¹è¿›è¡Œæ¯”è¾ƒå³å¯ï¼Œç±»æ¨å­£å†›â€¦ï¼Œä»è€Œå¾—åˆ°å…¨éƒ¨æ‰€æœ‰çš„åæ¬¡ã€‚</li></ul><h4 id="ä»£ç å®ç°ï¼š"><a href="#ä»£ç å®ç°ï¼š" class="headerlink" title="ä»£ç å®ç°ï¼š"></a>ä»£ç å®ç°ï¼š</h4><ul><li><p>LoserTree.hpp</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  LoserTree.hpp</span></span><br><span class="line"><span class="comment">//  LoserTree</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by peiyu wang on 2019/4/1.</span></span><br><span class="line"><span class="comment">//  Copyright Â© 2019 peiyu wang. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> LoserTree_hpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LoserTree_hpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å®å®šä¹‰ */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MAXSIZE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXSIZE 2000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX 2500</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> K 5 <span class="comment">// kè·¯å½’å¹¶</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXKEY INT_MAX</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MINKEY INT_MIN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* k-è·¯å½’å¹¶è´¥è€…æ ‘ç±»å‹å®šä¹‰ */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> KeyType;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> LoserTree[K];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ExNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    KeyType key;</span><br><span class="line">&#125;; <span class="comment">// å¤–ç»“ç‚¹ï¼Œåªå­˜æ”¾å¾…å½’å¹¶è®°å½•çš„å…³é”®å­—</span></span><br><span class="line"><span class="keyword">typedef</span> ExNode External[K+<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è´¥è€…æ ‘å‡½æ•°åˆ—è¡¨ */</span></span><br><span class="line"><span class="comment">// åˆ©ç”¨è´¥è€…æ ‘lså°†keä¸ªè¾“å…¥å½’å¹¶æ®µä¸­çš„è®°å½•å½’å¹¶åˆ°è¾“å‡ºå½’å¹¶æ®µ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">K_Merge</span><span class="params">(FILE *fp, LoserTree ls, External b)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»b[s]å‡ºå‘è°ƒæ•´è´¥è€…æ ‘</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Adjust</span><span class="params">(LoserTree ls, External b, <span class="keyword">int</span> s)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¾æ¬¡ä»b[k-1...0]å‡ºå‘ï¼Œè°ƒæ•´lsä¸ºè´¥è€…æ ‘</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CreateLoserTree</span><span class="params">(LoserTree ls, External b)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">freadNum</span><span class="params">(FILE *fp, <span class="keyword">int</span> *i)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»æ–‡ä»¶fp[i]ä¸­è¯»å–å…³é”®å­—åˆ°x</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">(FILE *fp[K], <span class="keyword">int</span> *x, <span class="keyword">int</span> i)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†xè¾“å‡ºåˆ°æœ‰åºè¡¨fp</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(FILE *fp, <span class="keyword">int</span> x)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”ŸæˆMAXä¸ªéšæœºæ•°åˆ°fpç”¨ä½œæµ‹è¯•</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RandomNum</span><span class="params">(FILE *fp)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†éšæœºæ•°è¡¨fpåˆ†æ®µæ’åºååˆ†åˆ«å†™å…¥æ–‡ä»¶[0...k-1].txtä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cut_Sort</span><span class="params">(FILE *fp)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* LoserTree_hpp */</span></span></span><br></pre></td></tr></table></figure><ul><li>LoserTree.cpp:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  LoserTree.cpp</span></span><br><span class="line"><span class="comment">//  LoserTree</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by peiyu wang on 2019/4/1.</span></span><br><span class="line"><span class="comment">//  Copyright Â© 2019 peiyu wang. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"LoserTree.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ©ç”¨è´¥è€…æ ‘lså°†kä¸ªè¾“å…¥å½’å¹¶æ®µä¸­çš„è®°å½•å½’å¹¶åˆ°è¾“å‡ºå½’å¹¶æ®µ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">K_Merge</span><span class="params">(FILE *fp_out, LoserTree ls, External b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, q;</span><br><span class="line">    FILE *fp_in[K] = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; K; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        input(fp_in, &amp;(b[i].key), i);</span><br><span class="line">    &#125;</span><br><span class="line">    CreateLoserTree(ls, b);</span><br><span class="line">    <span class="keyword">while</span> (b[ls[<span class="number">0</span>]].key != MAXKEY)</span><br><span class="line">    &#123;</span><br><span class="line">        q = ls[<span class="number">0</span>];</span><br><span class="line">        output(fp_out, b[q].key);</span><br><span class="line">        input(fp_in, &amp;(b[q].key), q);</span><br><span class="line">        Adjust(ls, b, q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//output(fp_out, b[ls[0]].key);</span></span><br><span class="line">    fclose(fp_out);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»b[s]å‡ºå‘è°ƒæ•´è´¥è€…æ ‘</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Adjust</span><span class="params">(LoserTree ls, External b, <span class="keyword">int</span> s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t, tmp;</span><br><span class="line">    t = (s + K) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">while</span> (t &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (b[s].key &gt; b[ls[t]].key)</span><br><span class="line">        &#123;</span><br><span class="line">            tmp = s;</span><br><span class="line">            s = ls[t];</span><br><span class="line">            ls[t] = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        t /= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ls[<span class="number">0</span>] = s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¾æ¬¡ä»b[k-1...0]å‡ºå‘ï¼Œè°ƒæ•´lsä¸ºè´¥è€…æ ‘</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CreateLoserTree</span><span class="params">(LoserTree ls, External b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    b[K].key = MINKEY;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; K; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ls[i] = K;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = K - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        Adjust(ls, b, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">freadNum</span><span class="params">(FILE *fp, <span class="keyword">int</span> *i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tmp;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ((tmp = getc(fp)) != EOF)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((tmp &gt;= <span class="string">'0'</span>&amp;&amp; tmp &lt;= <span class="string">'9'</span>) || (tmp == <span class="string">'+'</span>) || (tmp == <span class="string">'-'</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            ungetc(tmp, fp);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (tmp != EOF)</span><br><span class="line">    &#123;</span><br><span class="line">        count = <span class="built_in">fscanf</span>(fp, <span class="string">"%d"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»æ–‡ä»¶fp[i]ä¸­è¯»å–å…³é”®å­—åˆ°x</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">(FILE *fp[K], <span class="keyword">int</span> *x, <span class="keyword">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tmp;</span><br><span class="line">    <span class="keyword">char</span> str1[<span class="number">100</span>], str2[<span class="number">100</span>], str3[<span class="number">100</span>] = <span class="string">".txt"</span>;</span><br><span class="line">    <span class="keyword">if</span> (!fp[i])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">strcpy</span>(str1, <span class="string">"tmpfile/"</span>);</span><br><span class="line">        <span class="built_in">sprintf</span>(str2, <span class="string">"%d"</span>, i);</span><br><span class="line">        <span class="built_in">strcat</span>(str1, <span class="built_in">strcat</span>(str2, str3));</span><br><span class="line">        fp[i] = fopen(str1, <span class="string">"r"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(freadNum(fp[i], &amp;tmp))</span><br><span class="line">    &#123;</span><br><span class="line">        *x = tmp;</span><br><span class="line">        <span class="keyword">if</span> (tmp == MAXKEY)</span><br><span class="line">            fclose(fp[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†xè¾“å‡ºåˆ°æœ‰åºè¡¨fp</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(FILE *fp, <span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(fp, <span class="string">"%d, "</span>, x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”ŸæˆMAXä¸ªéšæœºæ•°åˆ°fpç”¨ä½œæµ‹è¯•</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RandomNum</span><span class="params">(FILE *fp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j, number, tag;</span><br><span class="line">    <span class="keyword">int</span> x[MAX + <span class="number">1</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    srand((<span class="keyword">unsigned</span> <span class="keyword">int</span>)time(<span class="number">0</span>));</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i&lt;= MAX; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            number = rand() % (<span class="number">4</span>*MAX - <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">            tag = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt;= x[<span class="number">0</span>]; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (number == x[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    tag = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (tag == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                x[<span class="number">0</span>]++;</span><br><span class="line">                x[x[<span class="number">0</span>]] = number;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">while</span>(tag == <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fprintf</span>(fp, <span class="string">"(%d), "</span>, MAX);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= x[<span class="number">0</span>]; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(fp, <span class="string">"%d, "</span>, x[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(fp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†éšæœºæ•°è¡¨fpåˆ†æ®µæ’åºååˆ†åˆ«å†™å…¥æ–‡ä»¶[0...k-1].txtä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cut_Sort</span><span class="params">(FILE *fp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FILE *fptr;</span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">    KeyType tmp;</span><br><span class="line">    <span class="keyword">int</span> len, m, n;</span><br><span class="line">    <span class="keyword">char</span> str1[<span class="number">100</span>], str2[<span class="number">100</span>], str3[<span class="number">100</span>] = <span class="string">".txt"</span>;</span><br><span class="line">    freadNum(fp, &amp;len);</span><br><span class="line">    m = len / K; <span class="comment">// mä¸ºä¸€æ¬¡å¯ä»¥å¤„ç†çš„æœ€å¤§æ•°å­—çš„ä¸ªæ•°</span></span><br><span class="line">    n = K + (len % m != <span class="number">0</span>); <span class="comment">// nä¸ºå½’å¹¶æ®µä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;KeyType&gt; v;</span><br><span class="line">        <span class="built_in">strcpy</span>(str1, <span class="string">"./tmpfile/"</span>);</span><br><span class="line">        <span class="built_in">sprintf</span>(str2, <span class="string">"%d"</span>, i);</span><br><span class="line">        <span class="built_in">strcat</span>(str1, <span class="built_in">strcat</span>(str2, str3));</span><br><span class="line">        fptr = fopen(str1, <span class="string">"w+"</span>);</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt;= m; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (freadNum(fp, &amp;tmp) == <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                v.push_back(tmp);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        sort(v.begin(), v.end());</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; v.size(); j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(fptr, <span class="string">"%d, "</span>, v[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">fprintf</span>(fptr, <span class="string">"%d"</span>, MAXKEY);</span><br><span class="line">        fclose(fptr);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(fp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>main.cpp</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  main.cpp</span></span><br><span class="line"><span class="comment">//  LoserTree</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by peiyu wang on 2019/4/1.</span></span><br><span class="line"><span class="comment">//  Copyright Â© 2019 peiyu wang. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"LoserTree.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    LoserTree ls;</span><br><span class="line">    External b;</span><br><span class="line">    fp = fopen(<span class="string">"test.txt"</span>, <span class="string">"w+"</span>);</span><br><span class="line">    RandomNum(fp);</span><br><span class="line">    fp = fopen(<span class="string">"test.txt"</span>, <span class="string">"r"</span>);</span><br><span class="line">    Cut_Sort(fp);</span><br><span class="line">    fp = fopen(<span class="string">"Order.txt"</span>, <span class="string">"w+"</span>);</span><br><span class="line">    K_Merge(fp, ls, b);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"END\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="å®ç°æ•ˆæœï¼š"><a href="#å®ç°æ•ˆæœï¼š" class="headerlink" title="å®ç°æ•ˆæœï¼š"></a>å®ç°æ•ˆæœï¼š</h4><p>ï¼ˆåˆå§‹åŒ–çš„æ–‡ä»¶ä»¥åŠæ’åºåçš„æ–‡ä»¶ï¼‰<img src="https://img-blog.csdnimg.cn/20190401173256112.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;ç®—æ³•æ¦‚å¿µï¼š&quot;&gt;&lt;a href=&quot;#ç®—æ³•æ¦‚å¿µï¼š&quot; class=&quot;headerlink&quot; title=&quot;ç®—æ³•æ¦‚å¿µï¼š&quot;&gt;&lt;/a&gt;ç®—æ³•æ¦‚å¿µï¼š&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;å¦‚æœæˆ‘ä»¬è¦å¯¹å¤§è§„æ¨¡æ–‡ä»¶è¿›è¡Œæ’åºï¼Œä¸èƒ½ä¸€æ¬¡è£…å…¥å†…å­˜ä¸­ï¼Œåªèƒ½ä»å¤–å­˜ä¸€æ¬¡æ¬¡è¯»å–åˆ†åˆ«æ’åºï¼Œè€Œå¤–å­˜çš„IOæ—¶é—´å¤æ‚åº¦å¾ˆé«˜ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å°½é‡å‡å°‘é’ˆå¯¹å¤–å­˜è¯»å†™çš„æ¬¡æ•°ã€‚å¦‚æœæˆ‘ä»¬åªæ˜¯ç®€å•åœ°è¿›è¡ŒäºŒè·¯å½’å¹¶çš„è¯ï¼Œå½’å¹¶è·¯æ•°è¶Šå°‘å½’å¹¶çš„æ¬¡æ•°å°±è¶Šå¤šï¼Œæ¯æ¬¡å½’å¹¶éƒ½è¦è¿›è¡Œä¸€æ¬¡IOæ“ä½œã€‚æ‰€ä»¥æˆ‘ä»¬è€ƒè™‘å°½é‡è¿›è¡Œå¤šè·¯å½’å¹¶ï¼Œè€Œå¤šè·¯å½’å¹¶ä¸åŒäºç®€å•åœ°äºŒæ¬¡å½’å¹¶åªéœ€å¯¹ä¸¤ç»„æ•°è¿›è¡ŒæŒ‡é’ˆç§»åŠ¨å½’å¹¶ï¼Œä¸ºäº†é™ä½å¤šè·¯å½’å¹¶ä¸­å½’å¹¶çš„æ—¶é—´å¤æ‚åº¦ã€‚æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨è´¥è€…æ ‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="ç®—æ³•" scheme="http://yoursite.com/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="ç®—æ³•" scheme="http://yoursite.com/tags/%E7%AE%97%E6%B3%95/"/>
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="æ•°æ®ç»“æ„" scheme="http://yoursite.com/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
</feed>
