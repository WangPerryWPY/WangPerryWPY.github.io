<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>PerryWangğŸåšå®¢</title>
  
  <subtitle>åˆ†äº«è½¯ä»¶å¼€å‘ä¸­å­¦åˆ°çš„ç‚¹æ»´çŸ¥è¯†</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-07-07T11:56:31.917Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>PerryWang</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å›¾åƒåˆ†å‰²è¿›è¡ŒA4çº¸çŸ«æ­£</title>
    <link href="http://yoursite.com/2019/07/07/%E5%9B%BE%E5%83%8F%E5%88%86%E5%89%B2%E8%BF%9B%E8%A1%8CA4%E7%BA%B8%E7%9F%AB%E6%AD%A3/"/>
    <id>http://yoursite.com/2019/07/07/å›¾åƒåˆ†å‰²è¿›è¡ŒA4çº¸çŸ«æ­£/</id>
    <published>2019-07-07T11:55:54.000Z</published>
    <updated>2019-07-07T11:56:31.917Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å›¾åƒåˆ†å‰²è¿›è¡ŒA4çº¸çŸ«æ­£"><a href="#å›¾åƒåˆ†å‰²è¿›è¡ŒA4çº¸çŸ«æ­£" class="headerlink" title="å›¾åƒåˆ†å‰²è¿›è¡ŒA4çº¸çŸ«æ­£"></a>å›¾åƒåˆ†å‰²è¿›è¡ŒA4çº¸çŸ«æ­£</h2><h3 id="1-å°†å›¾åƒä»rgbç©ºé—´è½¬ä¸ºç°åº¦ç©ºé—´"><a href="#1-å°†å›¾åƒä»rgbç©ºé—´è½¬ä¸ºç°åº¦ç©ºé—´" class="headerlink" title="(1) å°†å›¾åƒä»rgbç©ºé—´è½¬ä¸ºç°åº¦ç©ºé—´"></a>(1) å°†å›¾åƒä»rgbç©ºé—´è½¬ä¸ºç°åº¦ç©ºé—´</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ImageSegmentation::rgb2gray() &#123;</span><br><span class="line">grayImg.resize(Img._width, Img._height, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">cimg_forXY(grayImg, x, y) &#123;</span><br><span class="line"><span class="keyword">double</span> R = Img(x,y,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">double</span> G = Img(x,y,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">double</span> B = Img(x,y,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">double</span> Gray = (R * <span class="number">299</span> + G * <span class="number">587</span> + B * <span class="number">114</span> + <span class="number">500</span>) / <span class="number">1000</span>;</span><br><span class="line">grayImg(x,y) = Gray;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-é«˜æ–¯æ»¤æ³¢"><a href="#2-é«˜æ–¯æ»¤æ³¢" class="headerlink" title="(2) é«˜æ–¯æ»¤æ³¢"></a>(2) é«˜æ–¯æ»¤æ³¢</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ImageSegmentation::Gauss_blur() &#123;</span><br><span class="line">blurImg = grayImg.get_blur(guassian_blur);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-æ±‚é˜ˆå€¼"><a href="#3-æ±‚é˜ˆå€¼" class="headerlink" title="(3) æ±‚é˜ˆå€¼"></a>(3) æ±‚é˜ˆå€¼</h3><h4 id="1-è¿­ä»£æ³•æ±‚é˜ˆå€¼"><a href="#1-è¿­ä»£æ³•æ±‚é˜ˆå€¼" class="headerlink" title="1. è¿­ä»£æ³•æ±‚é˜ˆå€¼"></a>1. è¿­ä»£æ³•æ±‚é˜ˆå€¼</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¿­ä»£æ³•æ±‚é˜ˆå€¼</span></span><br><span class="line"><span class="keyword">void</span> ImageSegmentation::get_thres_iteration() &#123;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; image = blurImg;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; hist = image.histogram(<span class="number">256</span>, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line"><span class="keyword">int</span> size = blurImg.size();</span><br><span class="line">cimg_forX(hist, i) &#123;</span><br><span class="line">threshold += i*hist(i);</span><br><span class="line">&#125;</span><br><span class="line">threshold /= size;</span><br><span class="line"><span class="keyword">int</span> threshold_new;</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">int</span> t1 = <span class="number">0</span>, t2 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> num1 = <span class="number">0</span>, num2 = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// è®¡ç®—å°äºç­‰äºé˜ˆå€¼thresholdçš„ç°åº¦å¹³å‡å€¼t1ä»¥åŠå¤§äºé˜ˆå€¼çš„t2</span></span><br><span class="line">cimg_forX(hist, i) &#123;</span><br><span class="line"><span class="keyword">if</span> (i &lt;= threshold) &#123;</span><br><span class="line">t1 += i * hist(i);</span><br><span class="line">num1 += hist(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">t2 += i * hist(i);</span><br><span class="line">num2 += hist(i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (num1 == <span class="number">0</span> || num2 == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">t1 /= num1;</span><br><span class="line">t2 /= num2;</span><br><span class="line">threshold_new = (t1 + t2) / <span class="number">2</span>;</span><br><span class="line"><span class="comment">// è‹¥ä¸¤ä¸ªé˜ˆå€¼ç›¸ç­‰ï¼Œåˆ™è¿”å›é˜ˆå€¼thresholdï¼Œå¦åˆ™æ›´æ–°é˜ˆå€¼ç»§ç»­å¾ªç¯</span></span><br><span class="line"><span class="keyword">if</span> (threshold == threshold_new) <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">else</span> threshold = threshold_new;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"threshold = "</span> &lt;&lt; threshold &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-OSTUæ³•æ±‚é˜ˆå€¼"><a href="#2-OSTUæ³•æ±‚é˜ˆå€¼" class="headerlink" title="2.OSTUæ³•æ±‚é˜ˆå€¼"></a>2.OSTUæ³•æ±‚é˜ˆå€¼</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//OSTUæ³•æ±‚é˜ˆå€¼</span></span><br><span class="line"><span class="keyword">void</span> ImageSegmentation::get_thres_ostu() &#123;</span><br><span class="line"><span class="comment">//å®šä¹‰ç±»é—´æ–¹å·®</span></span><br><span class="line"><span class="keyword">double</span> variance = <span class="number">0.0</span>;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; image = blurImg;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; hist = image.histogram(<span class="number">256</span>, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line"><span class="keyword">int</span> size = blurImg.size();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line"><span class="comment">//å®šä¹‰å‰æ™¯å›¾ï¼ŒèƒŒæ™¯å›¾çš„åƒç´ ç‚¹æ‰€å æ¯”ä¾‹ä»¥åŠå¹³å‡ç°åº¦</span></span><br><span class="line"><span class="keyword">double</span> p1 = <span class="number">0.0</span>, p2 = <span class="number">0.0</span>, g1 = <span class="number">0.0</span>, g2 = <span class="number">0.0</span>;</span><br><span class="line">cimg_forX(hist, j) &#123;</span><br><span class="line"><span class="keyword">if</span> (j &lt;= i) &#123;</span><br><span class="line">p1 += hist(j);</span><br><span class="line">g1 += j*hist(j);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">p2 += hist(j);</span><br><span class="line">g2 += j*hist(j);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (p1 == <span class="number">0</span> || p2 == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">g1 /= p1;</span><br><span class="line">p1 /= size;</span><br><span class="line">g2 /= p2;</span><br><span class="line">p2 /= size;</span><br><span class="line"><span class="keyword">double</span> temp_variance = p1 * p2 * (g1 - g2) * (g1 - g2);</span><br><span class="line"><span class="keyword">if</span> (variance &lt; temp_variance) &#123;</span><br><span class="line">variance = temp_variance;</span><br><span class="line">threshold = i;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"threshold = "</span> &lt;&lt; threshold &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-æŒ‰é˜ˆå€¼è¿›è¡Œå›¾åƒåˆ†å‰²"><a href="#4-æŒ‰é˜ˆå€¼è¿›è¡Œå›¾åƒåˆ†å‰²" class="headerlink" title="(4)æŒ‰é˜ˆå€¼è¿›è¡Œå›¾åƒåˆ†å‰²"></a>(4)æŒ‰é˜ˆå€¼è¿›è¡Œå›¾åƒåˆ†å‰²</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ImageSegmentation::Segmentation() &#123;</span><br><span class="line">segImg.resize(Img._width, Img._height, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">cimg_forXY(blurImg, x, y) &#123;</span><br><span class="line"><span class="keyword">if</span> (blurImg(x,y) &gt; threshold) &#123;</span><br><span class="line">segImg(x,y) = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">segImg(x,y) = <span class="number">255</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//segImg.display();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-å¯¹åˆ†å‰²åçš„å›¾åƒè¿›è¡Œæ¢¯åº¦æ£€æµ‹"><a href="#5-å¯¹åˆ†å‰²åçš„å›¾åƒè¿›è¡Œæ¢¯åº¦æ£€æµ‹" class="headerlink" title="(5) å¯¹åˆ†å‰²åçš„å›¾åƒè¿›è¡Œæ¢¯åº¦æ£€æµ‹"></a>(5) å¯¹åˆ†å‰²åçš„å›¾åƒè¿›è¡Œæ¢¯åº¦æ£€æµ‹</h3><p><strong>PS:å¦‚æœæ­¤æ—¶ç›´æ¥è¿›è¡ŒçŸ«æ­£æˆ–è€…è†¨èƒ€åè†¨èƒ€æ•ˆæœä¸å¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬æ£€æµ‹ä¸€æ­¥æ¢¯åº¦ï¼ˆé‡‡ç”¨sobelç®—å­ï¼‰</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ImageSegmentation::gradDection() &#123;</span><br><span class="line">gradImg.resize(segImg._width, segImg._height, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">CImg_3x3(I, <span class="keyword">double</span>);</span><br><span class="line">cimg_for3x3(segImg, x, y, <span class="number">0</span>, <span class="number">0</span>, I, <span class="keyword">double</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> ix = (Inn + <span class="number">2</span> * Icn + Ipn) - (Ipp + <span class="number">2</span> * Icp + Inp);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> iy = (Inp + <span class="number">2</span> * Inc + Inn) - (Ipp + <span class="number">2</span> * Ipc + Ipn);</span><br><span class="line"><span class="keyword">double</span> grad = <span class="built_in">sqrt</span>(ix * ix + iy * iy);</span><br><span class="line"><span class="keyword">if</span> (grad &gt; <span class="number">255</span>) grad = <span class="number">255</span>;</span><br><span class="line"><span class="keyword">if</span> (grad &lt; <span class="number">0</span> ) grad = <span class="number">0</span>;</span><br><span class="line">gradImg(x, y) = grad;</span><br><span class="line">&#125;</span><br><span class="line">gradImg.display();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-éœå¤«å˜æ¢"><a href="#6-éœå¤«å˜æ¢" class="headerlink" title="(6) éœå¤«å˜æ¢"></a>(6) éœå¤«å˜æ¢</h3><h4 id="1-ç»Ÿè®¡éœå¤«ç©ºé—´ç‚¹"><a href="#1-ç»Ÿè®¡éœå¤«ç©ºé—´ç‚¹" class="headerlink" title="1. ç»Ÿè®¡éœå¤«ç©ºé—´ç‚¹"></a>1. ç»Ÿè®¡éœå¤«ç©ºé—´ç‚¹</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ImageSegmentation::Hough_Statistics() &#123;</span><br><span class="line"><span class="comment">//double maxDistance = sqrt(Img._width*Img._width + Img._height*Img._height);</span></span><br><span class="line"><span class="keyword">double</span> w = Img._width;</span><br><span class="line"><span class="keyword">double</span> h = Img._height;</span><br><span class="line"><span class="keyword">double</span> center_x = w/<span class="number">2</span>;</span><br><span class="line"><span class="keyword">double</span> center_y = h/<span class="number">2</span>;</span><br><span class="line"><span class="keyword">double</span> hough_h = ((<span class="built_in">sqrt</span>(<span class="number">2.0</span>) * (<span class="keyword">double</span>)(h&gt;w?h:w)) / <span class="number">2.0</span>);</span><br><span class="line">houghImg.resize(<span class="number">180</span>, hough_h * <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">cimg_forXY(gradImg, x, y) &#123;</span><br><span class="line"><span class="keyword">if</span> (gradImg(x,y) != <span class="number">0</span>) &#123;</span><br><span class="line">cimg_forX(houghImg, angle) &#123;</span><br><span class="line"><span class="keyword">double</span> _angle = (<span class="keyword">double</span>)PI*angle / <span class="number">180.0f</span>;</span><br><span class="line"><span class="keyword">int</span> polar = (<span class="keyword">int</span>)((((<span class="keyword">double</span>)x - center_x)*<span class="built_in">cos</span>(_angle) + ((<span class="keyword">double</span>)y - center_y)*<span class="built_in">sin</span>(_angle)) + hough_h);</span><br><span class="line"><span class="comment">//cout &lt;&lt; polar &lt;&lt; endl;</span></span><br><span class="line">houghImg(angle, polar) += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//houghImg.display();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-è·å–å¯¹åº”æ£€æµ‹å‡ºçš„ç›´çº¿"><a href="#2-è·å–å¯¹åº”æ£€æµ‹å‡ºçš„ç›´çº¿" class="headerlink" title="2. è·å–å¯¹åº”æ£€æµ‹å‡ºçš„ç›´çº¿"></a>2. è·å–å¯¹åº”æ£€æµ‹å‡ºçš„ç›´çº¿</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ImageSegmentation::GetLine() &#123;</span><br><span class="line">resultImg = Img;</span><br><span class="line"><span class="comment">//å‰”é™¤æ‰å¯èƒ½å‡ºç°çš„é‡åˆçº¿ï¼Œæ–¹æ³•æ˜¯å–9x9ç©ºé—´å†…çš„éœå¤«æœ€å¤§å€¼</span></span><br><span class="line"><span class="keyword">int</span> hough_h = houghImg._height;</span><br><span class="line"><span class="comment">//int hough_w = houghImg._width;</span></span><br><span class="line"><span class="keyword">int</span> img_h = Img._height;</span><br><span class="line"><span class="keyword">int</span> img_w = Img._width;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> y_min = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> y_max = Img._height - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> x_min = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> x_max = Img._width - <span class="number">1</span>;</span><br><span class="line">cimg_forXY(houghImg, angle, polar) &#123;</span><br><span class="line"><span class="keyword">if</span> (houghImg(angle, polar) &gt;= Min_thres) &#123;</span><br><span class="line"><span class="keyword">int</span> max = houghImg(angle, polar);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> ly=-DIFF;ly&lt;=DIFF;ly++) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> lx=-DIFF;lx&lt;=DIFF;lx++) &#123;</span><br><span class="line"><span class="keyword">if</span>( (ly+polar&gt;=<span class="number">0</span> &amp;&amp; ly+polar&lt;houghImg._height) &amp;&amp; (lx+angle&gt;=<span class="number">0</span> &amp;&amp; lx+angle&lt;houghImg._width) ) &#123;</span><br><span class="line"><span class="keyword">if</span>( (<span class="keyword">int</span>)houghImg(angle + lx, polar + ly ) &gt; max ) &#123;</span><br><span class="line">max = houghImg(angle + lx, polar + ly );</span><br><span class="line">ly = lx = DIFF + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (max &gt; (<span class="keyword">int</span>)houghImg(angle, polar) )</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">peaks.push_back(pair&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;, <span class="keyword">int</span> &gt;(pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;(angle, polar), houghImg(angle, polar)));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">sort(peaks.begin(), peaks.end(), [](<span class="keyword">const</span> pair&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;, <span class="keyword">int</span> &gt; &amp;a, <span class="keyword">const</span> pair&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;, <span class="keyword">int</span> &gt; &amp;b) -&gt; <span class="keyword">int</span> &#123;<span class="keyword">return</span> a.second &gt; b.second ;&#125;);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; lines.size() != <span class="number">4</span>; i++) &#123;</span><br><span class="line"><span class="keyword">int</span> angle = peaks[i].first.first;</span><br><span class="line"><span class="keyword">int</span> polar = peaks[i].first.second;</span><br><span class="line"><span class="comment">//cout &lt;&lt; angle &lt;&lt; endl &lt;&lt; polar &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">int</span> x1, y1, x2, y2;</span><br><span class="line">x1 = y1 = x2 = y2 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">double</span> _angle = (<span class="keyword">double</span>)PI*angle / <span class="number">180.0f</span>;</span><br><span class="line"><span class="keyword">if</span>(angle &gt;= <span class="number">45</span> &amp;&amp; angle &lt;= <span class="number">135</span>) &#123;</span><br><span class="line">x1 = <span class="number">0</span>;</span><br><span class="line">y1 = ((<span class="keyword">double</span>)(polar-(hough_h/<span class="number">2</span>)) - ((x1 - (img_w/<span class="number">2</span>) ) * <span class="built_in">cos</span>(_angle))) / <span class="built_in">sin</span>(_angle) + (img_h / <span class="number">2</span>);</span><br><span class="line">x2 = img_w;</span><br><span class="line">y2 = ((<span class="keyword">double</span>)(polar-(hough_h/<span class="number">2</span>)) - ((x2 - (img_w/<span class="number">2</span>) ) * <span class="built_in">cos</span>(_angle))) / <span class="built_in">sin</span>(_angle) + (img_h / <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">y1 = <span class="number">0</span>;</span><br><span class="line">x1 = ((<span class="keyword">double</span>)(polar-(hough_h/<span class="number">2</span>)) - ((y1 - (img_h/<span class="number">2</span>) ) * <span class="built_in">sin</span>(_angle))) / <span class="built_in">cos</span>(_angle) + (img_w / <span class="number">2</span>);</span><br><span class="line">y2 = img_h;</span><br><span class="line">x2 = ((<span class="keyword">double</span>)(polar-(hough_h/<span class="number">2</span>)) - ((y2 - (img_h/<span class="number">2</span>) ) * <span class="built_in">sin</span>(_angle))) / <span class="built_in">cos</span>(_angle) + (img_w / <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//if</span></span><br><span class="line"><span class="keyword">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; lines.size(); k++) &#123;</span><br><span class="line"><span class="keyword">if</span> (distance(lines[k].first.first - x1, lines[k].first.second - y1) &lt; <span class="number">100</span> &amp;&amp; distance(lines[k].second.first - x2, lines[k].second.second - y2) &lt; <span class="number">100</span>) &#123;</span><br><span class="line">flag = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (flag == <span class="literal">true</span>) &#123;</span><br><span class="line">lines.push_back(pair&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;, pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt;(pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;(x1, y1), pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;(x2, y2)));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lines.size(); i++) &#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; lines[i].first.first &lt;&lt; <span class="string">", "</span> &lt;&lt; lines[i].first.second &lt;&lt; <span class="string">"  ..  "</span> &lt;&lt; lines[i].second.first &lt;&lt; <span class="string">", "</span> &lt;&lt; lines[i].second.second &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">resultImg.draw_line(lines[i].first.first, lines[i].first.second, lines[i].second.first, lines[i].second.second, Red);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//resultImg.draw_line(200, 3458, 2500, 3459, Red);</span></span><br><span class="line"><span class="comment">//resultImg.display();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-è·å¾—å››ä¸ªè§’ç‚¹"><a href="#3-è·å¾—å››ä¸ªè§’ç‚¹" class="headerlink" title="3.  è·å¾—å››ä¸ªè§’ç‚¹"></a>3.  è·å¾—å››ä¸ªè§’ç‚¹</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ImageSegmentation::GetVertexs() &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lines.size(); i++) &#123;</span><br><span class="line"><span class="keyword">double</span> k0, b0;</span><br><span class="line"><span class="keyword">if</span> (lines[i].first.first == lines[i].second.first) &#123;</span><br><span class="line">k0 = DBL_MAX;</span><br><span class="line">b0 = lines[i].first.first;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">k0 = (<span class="keyword">double</span>) (lines[i].first.second - lines[i].second.second) / (lines[i].first.first - lines[i].second.first);</span><br><span class="line">b0 = (<span class="keyword">double</span>) (lines[i].first.second * lines[i].second.first - lines[i].second.second * lines[i].first.first) / (lines[i].second.first - lines[i].first.first);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; lines.size(); j++) &#123;</span><br><span class="line"><span class="keyword">double</span> k1, b1;</span><br><span class="line"><span class="keyword">if</span> (lines[j].first.first == lines[j].second.first) &#123;</span><br><span class="line">k1 = DBL_MAX;</span><br><span class="line">b1 = lines[j].first.first;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">k1 = (<span class="keyword">double</span>) (lines[j].first.second - lines[j].second.second) / (lines[j].first.first - lines[j].second.first);</span><br><span class="line">b1 = (<span class="keyword">double</span>) (lines[j].first.second * lines[j].second.first - lines[j].second.second * lines[j].first.first) / (lines[j].second.first - lines[j].first.first);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (k0 == k1)</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span> (k0 == DBL_MAX) &#123;</span><br><span class="line"><span class="keyword">int</span> _x = b0, _y = k1 * b0 + b1;</span><br><span class="line"><span class="keyword">if</span> (_x &gt;= <span class="number">0</span> &amp;&amp; _x &lt; Img._width &amp;&amp; _y &gt;= <span class="number">0</span> &amp;&amp; _y &lt; Img._height)</span><br><span class="line">vertex.push_back(make_pair(_x, _y));</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (k1 == DBL_MAX) &#123;</span><br><span class="line"><span class="keyword">int</span> _x = b1, _y = k0 * b1 + b0;</span><br><span class="line"><span class="keyword">if</span> (_x &gt;= <span class="number">0</span> &amp;&amp; _x &lt; Img._width &amp;&amp; _y &gt;= <span class="number">0</span> &amp;&amp; _y &lt; Img._height)</span><br><span class="line">vertex.push_back(make_pair(_x, _y));</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> _x = (b0 - b1) / (k1 - k0);</span><br><span class="line"><span class="keyword">int</span> _y = (k0 * b1 - k1 * b0) / (k0 - k1);</span><br><span class="line"><span class="keyword">if</span> (_x &gt;= <span class="number">0</span> &amp;&amp; _x &lt; Img._width &amp;&amp; _y &gt;= <span class="number">0</span> &amp;&amp; _y &lt; Img._height)</span><br><span class="line">vertex.push_back(make_pair(_x, _y));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vertex.size(); i++) &#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; vertex[i].first &lt;&lt; <span class="string">"  ...  "</span> &lt;&lt; vertex[i].second &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">resultImg.draw_circle(vertex[i].first, vertex[i].second, <span class="number">50</span>, Red);</span><br><span class="line">&#125;</span><br><span class="line">resultImg.display();</span><br><span class="line">resultImg.save(<span class="string">"result_a.bmp"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-å¯¹è·å¾—çš„è§’ç‚¹è¿›è¡Œæ’åºï¼š"><a href="#7-å¯¹è·å¾—çš„è§’ç‚¹è¿›è¡Œæ’åºï¼š" class="headerlink" title="(7) å¯¹è·å¾—çš„è§’ç‚¹è¿›è¡Œæ’åºï¼š"></a>(7) å¯¹è·å¾—çš„è§’ç‚¹è¿›è¡Œæ’åºï¼š</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ImageSegmentation::orderVertexs() &#123;</span><br><span class="line">sort(vertex.begin(), vertex.end(), [](<span class="keyword">const</span> pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &amp;a, <span class="keyword">const</span> pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &amp;b)-&gt; <span class="keyword">int</span> &#123;<span class="keyword">return</span> distance(a.first, a.second) &lt; distance(b.first, b.second);&#125;);</span><br><span class="line"><span class="keyword">double</span> w = distance(vertex[<span class="number">0</span>].first - vertex[<span class="number">1</span>].first, vertex[<span class="number">0</span>].second - vertex[<span class="number">1</span>].second);</span><br><span class="line"><span class="keyword">double</span> h = distance(vertex[<span class="number">0</span>].first - vertex[<span class="number">2</span>].first, vertex[<span class="number">0</span>].second - vertex[<span class="number">2</span>].second);</span><br><span class="line"><span class="comment">//çº¸å¼ æ˜¯æ¨ªå‘çš„</span></span><br><span class="line"><span class="keyword">if</span> (vertex[<span class="number">1</span>].first &lt; vertex[<span class="number">2</span>].first &amp;&amp; h &gt; w) &#123;</span><br><span class="line">swap(vertex[<span class="number">1</span>], vertex[<span class="number">2</span>]);</span><br><span class="line">swap(vertex[<span class="number">2</span>], vertex[<span class="number">3</span>]);</span><br><span class="line">vertex.push_back(vertex[<span class="number">0</span>]);</span><br><span class="line">vertex.erase(vertex.begin());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//çº¸å¼ æ˜¯ç«–å‘çš„</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">swap(vertex[<span class="number">2</span>], vertex[<span class="number">3</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-å¾—åˆ°ç”¨äºçŸ«æ­£A4çº¸çš„ç‰¹å¾çŸ©é˜µ"><a href="#8-å¾—åˆ°ç”¨äºçŸ«æ­£A4çº¸çš„ç‰¹å¾çŸ©é˜µ" class="headerlink" title="(8) å¾—åˆ°ç”¨äºçŸ«æ­£A4çº¸çš„ç‰¹å¾çŸ©é˜µ"></a>(8) å¾—åˆ°ç”¨äºçŸ«æ­£A4çº¸çš„ç‰¹å¾çŸ©é˜µ</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ImageSegmentation::calcMatrix() &#123;</span><br><span class="line">  <span class="keyword">double</span> x0 = vertex[<span class="number">0</span>].first, x1 = vertex[<span class="number">1</span>].first, x2 = vertex[<span class="number">2</span>].first, x3 = vertex[<span class="number">3</span>].first;</span><br><span class="line">  <span class="keyword">double</span> y0 = vertex[<span class="number">0</span>].second, y1 = vertex[<span class="number">1</span>].second, y2 = vertex[<span class="number">2</span>].second, y3 = vertex[<span class="number">3</span>].second;</span><br><span class="line">  <span class="keyword">double</span> dx3 = x0 - x1 + x2 - x3;</span><br><span class="line">  <span class="keyword">double</span> dy3 = y0 - y1 + y2 - y3;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">fabs</span>(dx3) &lt; <span class="number">10e-5</span> &amp;&amp; <span class="built_in">fabs</span>(dy3) &lt; <span class="number">10e-5</span>) &#123;</span><br><span class="line">    M[<span class="number">0</span>] = x1 - x0, M[<span class="number">1</span>] = y1 - y0, M[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">    M[<span class="number">3</span>] = x2 - x1, M[<span class="number">4</span>] = y2 - y1, M[<span class="number">5</span>] = <span class="number">0</span>;</span><br><span class="line">    M[<span class="number">6</span>] = x0, M[<span class="number">7</span>] = y0, M[<span class="number">8</span>] = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">double</span> dx1 = x1 - x2, dx2 = x3 - x2, dy1 = y1 - y2, dy2 = y3 - y2;</span><br><span class="line">    <span class="keyword">double</span> det = dx1 * dy2 - dx2 * dy1;</span><br><span class="line">    <span class="keyword">double</span> a13 = (dx3 * dy2 - dx2 * dy3) / det;</span><br><span class="line">    <span class="keyword">double</span> a23 = (dx1 * dy3 - dx3 * dy1) / det;</span><br><span class="line">    M[<span class="number">0</span>] = x1 - x0 + a13 * x1, M[<span class="number">1</span>] = y1 - y0 + a13 * y1, M[<span class="number">2</span>] = a13;</span><br><span class="line">    M[<span class="number">3</span>] = x3 - x0 + a23 * x3, M[<span class="number">4</span>] = y3 - y0 + a23 * y3, M[<span class="number">5</span>] = a23;</span><br><span class="line">    M[<span class="number">6</span>] = x0, M[<span class="number">7</span>] = y0, M[<span class="number">8</span>] = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-è¿›è¡ŒA4çº¸çŸ«æ­£"><a href="#9-è¿›è¡ŒA4çº¸çŸ«æ­£" class="headerlink" title="(9) è¿›è¡ŒA4çº¸çŸ«æ­£"></a>(9) è¿›è¡ŒA4çº¸çŸ«æ­£</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ImageSegmentation::warping() &#123;</span><br><span class="line">resultImg = Img;</span><br><span class="line"><span class="keyword">double</span> P[<span class="number">3</span>];</span><br><span class="line">  resultImg.resize(<span class="number">1050</span>, <span class="number">1485</span>);  <span class="comment">// æ ‡å‡†A4çº¸æ¯”ä¾‹</span></span><br><span class="line">  <span class="keyword">double</span> width = resultImg.width(), height = resultImg.height();</span><br><span class="line">cimg_forXY(resultImg, x, y) &#123;</span><br><span class="line"><span class="keyword">double</span> _x = x / width, _y = y / height;</span><br><span class="line"><span class="keyword">double</span> denominator = M[<span class="number">2</span>] * _x + M[<span class="number">5</span>] * _y + M[<span class="number">8</span>];</span><br><span class="line"><span class="keyword">double</span> tx = (M[<span class="number">0</span>] * _x + M[<span class="number">3</span>] * _y + M[<span class="number">6</span>]) / denominator;</span><br><span class="line"><span class="keyword">double</span> ty = (M[<span class="number">1</span>] * _x + M[<span class="number">4</span>] * _y + M[<span class="number">7</span>]) / denominator;</span><br><span class="line"><span class="comment">/*Interpolation(Img, tx, ty, P);</span></span><br><span class="line"><span class="comment">resultImg(x,y,0) = P[0];</span></span><br><span class="line"><span class="comment">resultImg(x,y,1) = P[1];</span></span><br><span class="line"><span class="comment">resultImg(x,y,2) = P[2];</span></span><br><span class="line"><span class="comment">//cout &lt;&lt; P[0] &lt;&lt; endl;*/</span></span><br><span class="line">cimg_forC(resultImg, c) &#123;</span><br><span class="line">resultImg(x,y,c) = Img((<span class="keyword">int</span>)tx, (<span class="keyword">int</span>)ty, c);</span><br><span class="line">&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  resultImg.display();</span><br><span class="line">  resultImg.save(<span class="string">"result_b.bmp"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-å°è£…æˆç±»"><a href="#10-å°è£…æˆç±»" class="headerlink" title="(10) å°è£…æˆç±»"></a>(10) å°è£…æˆç±»</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageSegmentation</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="comment">//æºå›¾</span></span><br><span class="line">CImg&lt;<span class="keyword">double</span>&gt; Img;</span><br><span class="line"><span class="comment">//ç°åº¦å›¾</span></span><br><span class="line">CImg&lt;<span class="keyword">double</span>&gt; grayImg;</span><br><span class="line"><span class="comment">//é«˜æ–¯å¹³æ»‘åçš„å›¾åƒ</span></span><br><span class="line">CImg&lt;<span class="keyword">double</span>&gt; blurImg;</span><br><span class="line"><span class="comment">//ç”¨äºå›¾åƒåˆ†å‰²çš„é˜ˆå€¼</span></span><br><span class="line"><span class="keyword">int</span> threshold;</span><br><span class="line"><span class="comment">//å›¾åƒåˆ†å‰²åçš„å›¾ç‰‡</span></span><br><span class="line">CImg&lt;<span class="keyword">double</span>&gt; segImg;</span><br><span class="line"><span class="comment">//æ¢¯åº¦å›¾åƒ</span></span><br><span class="line">CImg&lt;<span class="keyword">double</span>&gt; gradImg;</span><br><span class="line"><span class="comment">//éœå¤«ç©ºé—´å›¾åƒ</span></span><br><span class="line">CImg&lt;<span class="keyword">double</span>&gt; houghImg;</span><br><span class="line">CImg&lt;<span class="keyword">double</span>&gt; resultImg;</span><br><span class="line"><span class="built_in">vector</span>&lt; pair&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;, <span class="keyword">int</span> &gt; &gt; peaks;</span><br><span class="line"><span class="comment">//ç›´çº¿ç‚¹é›†</span></span><br><span class="line"><span class="built_in">vector</span>&lt; pair&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;, pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; &gt; lines;</span><br><span class="line"><span class="comment">//å››ä¸ªè§’ç‚¹</span></span><br><span class="line"><span class="built_in">vector</span>&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span> &gt; &gt; vertex;</span><br><span class="line"><span class="keyword">double</span> M[<span class="number">9</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rgb2gray</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Gauss_blur</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//è¿­ä»£æ³•æ±‚é˜ˆå€¼</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_thres_iteration</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//OSTUæ³•æ±‚é˜ˆå€¼</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_thres_ostu</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_thres</span><span class="params">(<span class="built_in">string</span> type_c)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Segmentation</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gradDection</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Hough_Statistics</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetLine</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetVertexs</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">orderVertexs</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">calcMatrix</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">warping</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">ImageSegmentation();</span><br><span class="line">ImageSegmentation(<span class="keyword">const</span> <span class="keyword">char</span>* filename);</span><br><span class="line">~ImageSegmentation();</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">correct_process</span><span class="params">(<span class="built_in">string</span> type_c)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="11-æ•ˆæœå±•ç¤ºï¼š"><a href="#11-æ•ˆæœå±•ç¤ºï¼š" class="headerlink" title="(11) æ•ˆæœå±•ç¤ºï¼š"></a>(11) æ•ˆæœå±•ç¤ºï¼š</h3><h4 id="1-jpg"><a href="#1-jpg" class="headerlink" title="1.jpg"></a>1.jpg</h4><p><img src="https://img-blog.csdnimg.cn/20181221004328407.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181221004347445.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="2-jpg"><a href="#2-jpg" class="headerlink" title="2.jpg"></a>2.jpg</h4><p><img src="https://img-blog.csdnimg.cn/20181221004406485.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181221004419687.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="3-jpg"><a href="#3-jpg" class="headerlink" title="3.jpg"></a>3.jpg</h4><p><img src="https://img-blog.csdnimg.cn/2018122100443531.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181221004510343.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="4-jpg"><a href="#4-jpg" class="headerlink" title="4.jpg"></a>4.jpg</h4><p><img src="https://img-blog.csdnimg.cn/20181221004523755.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181221004537784.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="5-jpg"><a href="#5-jpg" class="headerlink" title="5.jpg"></a>5.jpg</h4><p><img src="https://img-blog.csdnimg.cn/20181221004553481.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181221004602800.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="6-jpg"><a href="#6-jpg" class="headerlink" title="6.jpg"></a>6.jpg</h4><p><img src="https://img-blog.csdnimg.cn/20181221004614514.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181221004634542.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>å®Œæ•´ä»£ç å‚è§ï¼š</strong><br><a href="https://github.com/WangPerryWPY/Computer-Version/tree/master/Exp7/code/work1" target="_blank" rel="noopener">https://github.com/WangPerryWPY/Computer-Version/tree/master/Exp7/code/work1</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å›¾åƒåˆ†å‰²è¿›è¡ŒA4çº¸çŸ«æ­£&quot;&gt;&lt;a href=&quot;#å›¾åƒåˆ†å‰²è¿›è¡ŒA4çº¸çŸ«æ­£&quot; class=&quot;headerlink&quot; title=&quot;å›¾åƒåˆ†å‰²è¿›è¡ŒA4çº¸çŸ«æ­£&quot;&gt;&lt;/a&gt;å›¾åƒåˆ†å‰²è¿›è¡ŒA4çº¸çŸ«æ­£&lt;/h2&gt;&lt;h3 id=&quot;1-å°†å›¾åƒä»rgbç©ºé—´è½¬ä¸ºç°åº¦ç©ºé—´&quot;&gt;&lt;a href=&quot;#
      
    
    </summary>
    
      <category term="è®¡ç®—æœºè§†è§‰" scheme="http://yoursite.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="è®¡ç®—æœºè§†è§‰" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/"/>
    
  </entry>
  
  <entry>
    <title>mnistæ‰‹å†™å­—ä½“è¯†åˆ«</title>
    <link href="http://yoursite.com/2019/07/07/mnist%E6%89%8B%E5%86%99%E5%AD%97%E4%BD%93%E8%AF%86%E5%88%AB/"/>
    <id>http://yoursite.com/2019/07/07/mnistæ‰‹å†™å­—ä½“è¯†åˆ«/</id>
    <published>2019-07-07T11:53:24.000Z</published>
    <updated>2019-07-07T11:55:27.873Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‰‹å†™å­—ä½“çš„æ£€æµ‹"><a href="#æ‰‹å†™å­—ä½“çš„æ£€æµ‹" class="headerlink" title="æ‰‹å†™å­—ä½“çš„æ£€æµ‹"></a>æ‰‹å†™å­—ä½“çš„æ£€æµ‹</h2><h3 id="1-Adaboostè¿›è¡Œæ‰‹å†™å­—ä½“çš„æ£€æµ‹"><a href="#1-Adaboostè¿›è¡Œæ‰‹å†™å­—ä½“çš„æ£€æµ‹" class="headerlink" title="(1) Adaboostè¿›è¡Œæ‰‹å†™å­—ä½“çš„æ£€æµ‹"></a>(1) Adaboostè¿›è¡Œæ‰‹å†™å­—ä½“çš„æ£€æµ‹</h3><h4 id="å¯¼å…¥mnistæ•°æ®é›†"><a href="#å¯¼å…¥mnistæ•°æ®é›†" class="headerlink" title="å¯¼å…¥mnistæ•°æ®é›†"></a>å¯¼å…¥mnistæ•°æ®é›†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow.examples.tutorials.mnist.input_data <span class="keyword">as</span> input_data</span><br><span class="line">data_dir = <span class="string">'../MNIST_data/'</span></span><br><span class="line">mnist = input_data.read_data_sets(data_dir,one_hot=<span class="literal">False</span>)</span><br><span class="line">batch_size = <span class="number">50000</span></span><br><span class="line">test_x = mnist.test.images[:<span class="number">10000</span>]</span><br><span class="line">test_y = mnist.test.labels[:<span class="number">10000</span>]</span><br></pre></td></tr></table></figure><p>ä¸€å…±60000ä¸ªæ•°æ®é›†ï¼Œå–50000ç”¨äºè®­ç»ƒï¼Œ10000ç”¨äºæµ‹è¯•è®­ç»ƒå‡ºçš„æ¨¡å‹ã€‚</p><h4 id="è°ƒç”¨Adabooståˆ†ç±»å™¨è¿›è¡Œè®­ç»ƒï¼š"><a href="#è°ƒç”¨Adabooståˆ†ç±»å™¨è¿›è¡Œè®­ç»ƒï¼š" class="headerlink" title="è°ƒç”¨Adabooståˆ†ç±»å™¨è¿›è¡Œè®­ç»ƒï¼š"></a>è°ƒç”¨Adabooståˆ†ç±»å™¨è¿›è¡Œè®­ç»ƒï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">batch_x,batch_y = mnist.train.next_batch(batch_size)</span><br><span class="line">clf_rf = AdaBoostClassifier(n_estimators = <span class="number">60</span>)</span><br><span class="line">clf_rf.fit(batch_x,batch_y)</span><br></pre></td></tr></table></figure><h4 id="è¯„ä¼°é¢„æµ‹çš„æ•ˆæœï¼š"><a href="#è¯„ä¼°é¢„æµ‹çš„æ•ˆæœï¼š" class="headerlink" title="è¯„ä¼°é¢„æµ‹çš„æ•ˆæœï¼š"></a>è¯„ä¼°é¢„æµ‹çš„æ•ˆæœï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">y_pred_rf = clf_rf.predict(test_x)</span><br><span class="line">acc_rf = accuracy_score(test_y,y_pred_rf)</span><br><span class="line">print(<span class="string">"%s n_estimators = 60, accuracy:%f"</span> % (datetime.now(), acc_rf))</span><br></pre></td></tr></table></figure><h4 id="é€‰å–è¾ƒå¥½çš„å‚æ•°-å¼±åˆ†ç±»å™¨æ•°é‡-ï¼š"><a href="#é€‰å–è¾ƒå¥½çš„å‚æ•°-å¼±åˆ†ç±»å™¨æ•°é‡-ï¼š" class="headerlink" title="é€‰å–è¾ƒå¥½çš„å‚æ•°(å¼±åˆ†ç±»å™¨æ•°é‡)ï¼š"></a>é€‰å–è¾ƒå¥½çš„å‚æ•°(å¼±åˆ†ç±»å™¨æ•°é‡)ï¼š</h4><p>å…ˆé€šè¿‡è°ƒèŠ‚å¼±åˆ†ç±»å™¨æ•°é‡æ¥è·å¾—ä¸€ä¸ªè®­ç»ƒæ•ˆæœæ¯”è¾ƒä¸é”™çš„æ•°é‡å‚æ•°(<strong>è™½ç„¶ä¹‹åå‘ç°é¢„æµ‹ç‡å¥½åƒæ˜¯æ”¹å˜çš„</strong>)</p><p><img src="https://img-blog.csdnimg.cn/20181221003558443.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>ä¹‹åé€‰å–å¼±åˆ†ç±»å™¨å‚æ•°ä¸º60è¿›è¡Œè®­ç»ƒ</strong></p><h5 id="åœ¨å¯¹è‡ªå·±çš„æ‰‹å†™å›¾ç‰‡è¯»å…¥å‰å…ˆè¿›è¡Œå‡ æ­¥å¤„ç†ï¼š"><a href="#åœ¨å¯¹è‡ªå·±çš„æ‰‹å†™å›¾ç‰‡è¯»å…¥å‰å…ˆè¿›è¡Œå‡ æ­¥å¤„ç†ï¼š" class="headerlink" title="åœ¨å¯¹è‡ªå·±çš„æ‰‹å†™å›¾ç‰‡è¯»å…¥å‰å…ˆè¿›è¡Œå‡ æ­¥å¤„ç†ï¼š"></a>åœ¨å¯¹è‡ªå·±çš„æ‰‹å†™å›¾ç‰‡è¯»å…¥å‰å…ˆè¿›è¡Œå‡ æ­¥å¤„ç†ï¼š</h5><ul><li>å°†å›¾ç‰‡è½¬ä¸ºäºŒå€¼å›¾</li><li>resizeä¸ºmnistè®­ç»ƒé›†è¦æ±‚çš„(28*28)å°ºå¯¸</li><li>å°†å›¾åƒè¿›è¡Œè†¨èƒ€å¤„ç†</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">img = cv2.resize(img, (<span class="number">28</span>, <span class="number">28</span>), interpolation=cv2.INTER_CUBIC)</span><br><span class="line">GrayImage = cv2.cvtColor(img,cv2.COLOR_BGR2GRAY)</span><br><span class="line">ret,thresh2=cv2.threshold(GrayImage,<span class="number">127</span>,<span class="number">255</span>,cv2.THRESH_BINARY_INV)</span><br><span class="line">kernel = cv2.getStructuringElement(cv2.MORPH_RECT,(<span class="number">3</span>, <span class="number">3</span>))</span><br><span class="line">img = cv2.dilate(thresh2,kernel)</span><br></pre></td></tr></table></figure><p><strong>å¤„ç†å¥½çš„å›¾ç‰‡æ•ˆæœå¦‚ä¸‹ï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/20181221003609115.JPG" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>åŒæ—¶æœ‰ä¸€ç‚¹å¾ˆå‘çš„è¦æ³¨æ„å°±æ˜¯mnistè¦è¯†åˆ«çš„æ˜¯è¥¿æ–¹çš„æ‰‹å†™å­—ä½“ï¼Œå’Œæˆ‘ä»¬å¸¸å†™çš„æœ‰ä¸€ç‚¹åŒºåˆ«ã€‚</strong></p><h5 id="ä¸‹é¢æ˜¯ç”¨äºè¯»å…¥çš„æ‰‹å†™æ•°å­—"><a href="#ä¸‹é¢æ˜¯ç”¨äºè¯»å…¥çš„æ‰‹å†™æ•°å­—" class="headerlink" title="ä¸‹é¢æ˜¯ç”¨äºè¯»å…¥çš„æ‰‹å†™æ•°å­—"></a>ä¸‹é¢æ˜¯ç”¨äºè¯»å…¥çš„æ‰‹å†™æ•°å­—</h5><p><img src="https://img-blog.csdnimg.cn/2018122100362140.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h5 id="è¿›è¡Œä¸€æ­¥è£å‰ªå¤„ç†ï¼š"><a href="#è¿›è¡Œä¸€æ­¥è£å‰ªå¤„ç†ï¼š" class="headerlink" title="è¿›è¡Œä¸€æ­¥è£å‰ªå¤„ç†ï¼š"></a>è¿›è¡Œä¸€æ­¥è£å‰ªå¤„ç†ï¼š</h5><p><img src="https://img-blog.csdnimg.cn/20181221003631478.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä¸‹é¢æ˜¯é¢„æµ‹æ•ˆæœï¼š"><a href="#ä¸‹é¢æ˜¯é¢„æµ‹æ•ˆæœï¼š" class="headerlink" title="ä¸‹é¢æ˜¯é¢„æµ‹æ•ˆæœï¼š"></a>ä¸‹é¢æ˜¯é¢„æµ‹æ•ˆæœï¼š</h4><p><img src="https://img-blog.csdnimg.cn/20181221003648945.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>testé›†çš„å‡†ç¡®ç‡ä¸º75%å·¦å³ï¼Œè‡ªå·±æ‰‹å†™æ•°å­—çš„å‡†ç¡®ç‡ä¸º60%ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒä¸æœŸæœ›çš„ç»“æœï¼Œäºæ˜¯è€ƒè™‘ç”¨ä¸€ä¸ªè‡ªå·±æ­å»ºçš„CNNç½‘ç»œå¯¹æ¨¡å‹è¿›è¡Œæµ‹è¯•(å‚è€ƒtensorflowä¸­æ–‡ç¤¾åŒº)</strong></p><h3 id="2-å·ç§¯ç¥ç»ç½‘ç»œ-CNN-è¿›è¡Œæ‰‹å†™å­—ä½“çš„æ£€æµ‹"><a href="#2-å·ç§¯ç¥ç»ç½‘ç»œ-CNN-è¿›è¡Œæ‰‹å†™å­—ä½“çš„æ£€æµ‹" class="headerlink" title="(2) å·ç§¯ç¥ç»ç½‘ç»œ(CNN)è¿›è¡Œæ‰‹å†™å­—ä½“çš„æ£€æµ‹"></a>(2) å·ç§¯ç¥ç»ç½‘ç»œ(CNN)è¿›è¡Œæ‰‹å†™å­—ä½“çš„æ£€æµ‹</h3><h4 id="1-æƒé‡åˆå§‹åŒ–"><a href="#1-æƒé‡åˆå§‹åŒ–" class="headerlink" title="1. æƒé‡åˆå§‹åŒ–"></a>1. æƒé‡åˆå§‹åŒ–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">weight_variable</span><span class="params">(shape)</span>:</span></span><br><span class="line">  initial = tf.truncated_normal(shape, stddev=<span class="number">0.1</span>)</span><br><span class="line">  <span class="keyword">return</span> tf.Variable(initial)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bias_variable</span><span class="params">(shape)</span>:</span></span><br><span class="line">  initial = tf.constant(<span class="number">0.1</span>, shape=shape)</span><br><span class="line">  <span class="keyword">return</span> tf.Variable(initial)</span><br></pre></td></tr></table></figure><h4 id="2-å·ç§¯å’Œæ± åŒ–"><a href="#2-å·ç§¯å’Œæ± åŒ–" class="headerlink" title="2. å·ç§¯å’Œæ± åŒ–"></a>2. å·ç§¯å’Œæ± åŒ–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conv2d</span><span class="params">(x, W)</span>:</span></span><br><span class="line">  <span class="keyword">return</span> tf.nn.conv2d(x, W, strides=[<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>], padding=<span class="string">'SAME'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">max_pool_2x2</span><span class="params">(x)</span>:</span></span><br><span class="line">  <span class="keyword">return</span> tf.nn.max_pool(x, ksize=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>], strides=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>], padding=<span class="string">'SAME'</span>)</span><br></pre></td></tr></table></figure><h4 id="3-ç¬¬ä¸€å±‚å·ç§¯"><a href="#3-ç¬¬ä¸€å±‚å·ç§¯" class="headerlink" title="3. ç¬¬ä¸€å±‚å·ç§¯"></a>3. ç¬¬ä¸€å±‚å·ç§¯</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">W_conv1 = weight_variable([<span class="number">5</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">32</span>])</span><br><span class="line">b_conv1 = bias_variable([<span class="number">32</span>])</span><br><span class="line"></span><br><span class="line">x_image = tf.reshape(x, [<span class="number">-1</span>,<span class="number">28</span>,<span class="number">28</span>,<span class="number">1</span>])</span><br><span class="line">h_conv1 = tf.nn.relu(conv2d(x_image, W_conv1) + b_conv1)</span><br><span class="line">h_pool1 = max_pool_2x2(h_conv1)</span><br></pre></td></tr></table></figure><h4 id="4-ç¬¬äºŒå±‚å·ç§¯"><a href="#4-ç¬¬äºŒå±‚å·ç§¯" class="headerlink" title="4.ç¬¬äºŒå±‚å·ç§¯"></a>4.ç¬¬äºŒå±‚å·ç§¯</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">W_conv2 = weight_variable([<span class="number">5</span>, <span class="number">5</span>, <span class="number">32</span>, <span class="number">64</span>])</span><br><span class="line">b_conv2 = bias_variable([<span class="number">64</span>])</span><br><span class="line"></span><br><span class="line">h_conv2 = tf.nn.relu(conv2d(h_pool1, W_conv2) + b_conv2)</span><br><span class="line">h_pool2 = max_pool_2x2(h_conv2)</span><br></pre></td></tr></table></figure><h4 id="5-å¯†é›†è¿æ¥å±‚"><a href="#5-å¯†é›†è¿æ¥å±‚" class="headerlink" title="5. å¯†é›†è¿æ¥å±‚"></a>5. å¯†é›†è¿æ¥å±‚</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">W_fc1 = weight_variable([<span class="number">7</span> * <span class="number">7</span> * <span class="number">64</span>, <span class="number">1024</span>])</span><br><span class="line">b_fc1 = bias_variable([<span class="number">1024</span>])</span><br><span class="line"></span><br><span class="line">h_pool2_flat = tf.reshape(h_pool2, [<span class="number">-1</span>, <span class="number">7</span>*<span class="number">7</span>*<span class="number">64</span>])</span><br><span class="line">h_fc1 = tf.nn.relu(tf.matmul(h_pool2_flat, W_fc1) + b_fc1)</span><br></pre></td></tr></table></figure><h4 id="6-Dropout"><a href="#6-Dropout" class="headerlink" title="6. Dropout"></a>6. Dropout</h4><p><strong>(å±è”½ç¥ç»å…ƒçš„è¾“å‡ºä»¥åŠè‡ªåŠ¨å¤„ç†ç¥ç»å…ƒè¾“å‡ºå€¼çš„scale )</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keep_prob = tf.placeholder(tf.float32)</span><br><span class="line">h_fc1_drop = tf.nn.dropout(h_fc1, keep_prob)</span><br></pre></td></tr></table></figure><h4 id="7-è¾“å‡ºå±‚"><a href="#7-è¾“å‡ºå±‚" class="headerlink" title="7. è¾“å‡ºå±‚"></a>7. è¾“å‡ºå±‚</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">W_fc2 = weight_variable([<span class="number">1024</span>, <span class="number">10</span>])</span><br><span class="line">b_fc2 = bias_variable([<span class="number">10</span>])</span><br><span class="line"></span><br><span class="line">y_conv=tf.nn.softmax(tf.matmul(h_fc1_drop, W_fc2) + b_fc2)</span><br></pre></td></tr></table></figure><h4 id="8-è®­ç»ƒå’Œè¯„ä¼°æ¨¡å‹"><a href="#8-è®­ç»ƒå’Œè¯„ä¼°æ¨¡å‹" class="headerlink" title="8. è®­ç»ƒå’Œè¯„ä¼°æ¨¡å‹"></a>8. è®­ç»ƒå’Œè¯„ä¼°æ¨¡å‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cross_entropy = tf.reduce_mean(</span><br><span class="line">    tf.nn.softmax_cross_entropy_with_logits(labels=y_, logits=y_conv))</span><br><span class="line">train_step = tf.train.AdamOptimizer(<span class="number">1e-4</span>).minimize(cross_entropy)</span><br><span class="line">correct_prediction = tf.equal(tf.argmax(y_conv,<span class="number">1</span>), tf.argmax(y_,<span class="number">1</span>))</span><br><span class="line">accuracy = tf.reduce_mean(tf.cast(correct_prediction, tf.float32))</span><br><span class="line"></span><br><span class="line">saver = tf.train.Saver()  <span class="comment"># defaults to saving all variables</span></span><br><span class="line"></span><br><span class="line">sess.run(tf.global_variables_initializer())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20000</span>):</span><br><span class="line">  batch = mnist.train.next_batch(<span class="number">50</span>)</span><br><span class="line">  <span class="keyword">if</span> i%<span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">    train_accuracy = accuracy.eval(feed_dict=&#123;</span><br><span class="line">        x:batch[<span class="number">0</span>], y_: batch[<span class="number">1</span>], keep_prob: <span class="number">1.0</span>&#125;)</span><br><span class="line">    print(<span class="string">"step %d, training accuracy %g"</span>%(i, train_accuracy))</span><br><span class="line"></span><br><span class="line">  train_step.run(feed_dict=&#123;x: batch[<span class="number">0</span>], y_: batch[<span class="number">1</span>], keep_prob: <span class="number">0.5</span>&#125;)</span><br><span class="line">saver.save(sess, <span class="string">'./model/model.ckpt'</span>)  <span class="comment">#ä¿å­˜æ¨¡å‹å‚æ•°ï¼Œæ³¨æ„æŠŠè¿™é‡Œæ”¹ä¸ºè‡ªå·±çš„è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"test accuracy %g"</span>%accuracy.eval(feed_dict=&#123;</span><br><span class="line">    x: mnist.test.images, y_: mnist.test.labels, keep_prob: <span class="number">1.0</span>&#125;))</span><br></pre></td></tr></table></figure><p><strong>æœ€ç»ˆè·‘å‡ºçš„æ¨¡å‹å‡†ç¡®åº¦æ¥è¿‘99.3%</strong></p><h5 id="è®­ç»ƒå‡ºçš„æ¨¡å‹ï¼š"><a href="#è®­ç»ƒå‡ºçš„æ¨¡å‹ï¼š" class="headerlink" title="è®­ç»ƒå‡ºçš„æ¨¡å‹ï¼š"></a>è®­ç»ƒå‡ºçš„æ¨¡å‹ï¼š</h5><p><img src="https://img-blog.csdnimg.cn/20181221003700538.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="9-ç”¨å­˜å‚¨çš„modelå¯¹è‡ªå·±çš„æ‰‹å†™å­—ä½“è¿›è¡Œæµ‹è¯•ï¼š"><a href="#9-ç”¨å­˜å‚¨çš„modelå¯¹è‡ªå·±çš„æ‰‹å†™å­—ä½“è¿›è¡Œæµ‹è¯•ï¼š" class="headerlink" title="9. ç”¨å­˜å‚¨çš„modelå¯¹è‡ªå·±çš„æ‰‹å†™å­—ä½“è¿›è¡Œæµ‹è¯•ï¼š"></a>9. ç”¨å­˜å‚¨çš„modelå¯¹è‡ªå·±çš„æ‰‹å†™å­—ä½“è¿›è¡Œæµ‹è¯•ï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">init_op = tf.initialize_all_variables()</span><br><span class="line"></span><br><span class="line">saver = tf.train.Saver()</span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    sess.run(init_op)</span><br><span class="line">    saver.restore(sess, <span class="string">"./model/model.ckpt"</span>)<span class="comment">#è¿™é‡Œä½¿ç”¨äº†ä¹‹å‰ä¿å­˜çš„æ¨¡å‹å‚æ•°</span></span><br><span class="line"></span><br><span class="line">    prediction=tf.argmax(y_conv,<span class="number">1</span>)</span><br><span class="line">    predint=prediction.eval(feed_dict=&#123;x: [result],keep_prob: <span class="number">1.0</span>&#125;, session=sess)</span><br><span class="line">    print(<span class="string">'the digit is 9: '</span>)</span><br><span class="line">    print(<span class="string">'recognize result:'</span>)</span><br><span class="line">    print(predint[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><h4 id="10-æ•ˆæœï¼š"><a href="#10-æ•ˆæœï¼š" class="headerlink" title="10. æ•ˆæœï¼š"></a>10. æ•ˆæœï¼š</h4><p><strong>(æœ€ç»ˆæ•ˆæœ10å¼ å›¾å…¨éƒ¨éƒ½é¢„æµ‹å‡†ç¡®ï¼Œå†æµ‹äº†å‡ å¼ å†™å¾—ä¸æ˜¯ç‰¹åˆ«è§„èŒƒçš„æ•°å­—ä¹ŸåŸºæœ¬éƒ½è¯†åˆ«æ­£ç¡®)</strong><br><img src="https://img-blog.csdnimg.cn/20181221003803598.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>å®Œæ•´ä»£ç å‚è§ï¼š</strong><br><a href="https://github.com/WangPerryWPY/Computer-Version/tree/master/Exp7/code/work2" target="_blank" rel="noopener">https://github.com/WangPerryWPY/Computer-Version/tree/master/Exp7/code/work2</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;æ‰‹å†™å­—ä½“çš„æ£€æµ‹&quot;&gt;&lt;a href=&quot;#æ‰‹å†™å­—ä½“çš„æ£€æµ‹&quot; class=&quot;headerlink&quot; title=&quot;æ‰‹å†™å­—ä½“çš„æ£€æµ‹&quot;&gt;&lt;/a&gt;æ‰‹å†™å­—ä½“çš„æ£€æµ‹&lt;/h2&gt;&lt;h3 id=&quot;1-Adaboostè¿›è¡Œæ‰‹å†™å­—ä½“çš„æ£€æµ‹&quot;&gt;&lt;a href=&quot;#1-Adaboostè¿›è¡Œæ‰‹å†™
      
    
    </summary>
    
      <category term="è®¡ç®—æœºè§†è§‰" scheme="http://yoursite.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/"/>
    
    
      <category term="è®¡ç®—æœºè§†è§‰" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/"/>
    
      <category term="ç¥ç»ç½‘ç»œ" scheme="http://yoursite.com/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>c++å®ç°DESåŠ å¯†ç®—æ³•</title>
    <link href="http://yoursite.com/2019/07/06/c-%E5%AE%9E%E7%8E%B0DES%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/"/>
    <id>http://yoursite.com/2019/07/06/c-å®ç°DESåŠ å¯†ç®—æ³•/</id>
    <published>2019-07-06T13:12:25.000Z</published>
    <updated>2019-07-06T13:13:07.439Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç®—æ³•åŸç†ï¼š"><a href="#ç®—æ³•åŸç†ï¼š" class="headerlink" title="ç®—æ³•åŸç†ï¼š"></a>ç®—æ³•åŸç†ï¼š</h2><p>DESç®—æ³•æ˜¯ä¸€ç§å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä»¥64ä½ä¸ºåˆ†ç»„å¯¹æ•°æ®åŠ å¯†ï¼ŒåŠ å¯†å’Œè§£å¯†ç”¨çš„æ˜¯åŒä¸€ä¸ªç®—æ³•ã€‚å®ƒçš„å¯†é’¥é•¿åº¦æ˜¯56ä½ï¼ˆå› ä¸ºæ¯ä¸ªç¬¬8 ä½éƒ½ç”¨ä½œå¥‡å¶æ ¡éªŒï¼‰ï¼Œå¯†é’¥å¯ä»¥æ˜¯ä»»æ„çš„56ä½çš„æ•°ï¼Œè€Œä¸”å¯ä»¥ä»»æ„æ—¶å€™æ”¹å˜ã€‚å…¶ä¸­æœ‰æå°‘æ•°è¢«è®¤ä¸ºæ˜¯æ˜“ç ´è§£çš„å¼±å¯†é’¥ï¼Œä½†æ˜¯å¾ˆå®¹æ˜“é¿å¼€å®ƒä»¬ä¸ç”¨ã€‚æ‰€ä»¥ä¿å¯†æ€§ä¾èµ–äºå¯†é’¥ã€‚ </p><p><strong>å…¶åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š</strong></p><p>é¦–å…ˆè¦ç”Ÿæˆä¸€å¥—åŠ å¯†å¯†é’¥ï¼Œä»ç”¨æˆ·å¤„å–å¾—ä¸€ä¸ª64ä½é•¿çš„å¯†ç å£ä»¤ï¼Œç„¶åé€šè¿‡ç­‰åˆ†ã€ç§»ä½ã€é€‰å–å’Œè¿­ä»£å½¢æˆä¸€å¥—16ä¸ªåŠ å¯†å¯†é’¥ï¼Œåˆ†åˆ«ä¾›æ¯ä¸€è½®è¿ç®—ä¸­ä½¿ç”¨ã€‚</p><p>DESå¯¹64ä½(bit)çš„æ˜æ–‡åˆ†ç»„Mè¿›è¡Œæ“ä½œï¼ŒMç»è¿‡ä¸€ä¸ªåˆå§‹ç½®æ¢IPï¼Œç½®æ¢æˆm0ã€‚å°†m0æ˜æ–‡åˆ†æˆå·¦åŠéƒ¨åˆ†å’Œå³åŠéƒ¨åˆ†m0 = (L0ï¼ŒR0)ï¼Œå„32ä½é•¿ã€‚ç„¶åè¿›è¡Œ16è½®å®Œå…¨ç›¸åŒçš„è¿ç®—ï¼ˆè¿­ä»£ï¼‰ï¼Œè¿™äº›è¿ç®—è¢«ç§°ä¸ºå‡½æ•°fï¼Œåœ¨æ¯ä¸€è½®è¿ç®—è¿‡ç¨‹ä¸­æ•°æ®ä¸ç›¸åº”çš„å¯†é’¥ç»“åˆã€‚</p><p>åœ¨æ¯ä¸€è½®ä¸­ï¼Œå¯†é’¥ä½ç§»ä½ï¼Œç„¶åå†ä»å¯†é’¥çš„56ä½ä¸­é€‰å‡º48ä½ã€‚é€šè¿‡ä¸€ä¸ªæ‰©å±•ç½®æ¢å°†æ•°æ®çš„å³åŠéƒ¨åˆ†æ‰©å±•æˆ48ä½ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªå¼‚æˆ–æ“ä½œæ›¿ä»£æˆæ–°çš„48ä½æ•°æ®ï¼Œå†å°†å…¶å‹ç¼©ç½®æ¢æˆ32ä½ã€‚è¿™å››æ­¥è¿ç®—æ„æˆäº†å‡½æ•°fã€‚ç„¶åï¼Œé€šè¿‡å¦ä¸€ä¸ªå¼‚æˆ–è¿ç®—ï¼Œå‡½æ•°fçš„è¾“å‡ºä¸å·¦åŠéƒ¨åˆ†ç»“åˆï¼Œå…¶ç»“æœæˆä¸ºæ–°çš„å³åŠéƒ¨åˆ†ï¼ŒåŸæ¥çš„å³åŠéƒ¨åˆ†æˆä¸ºæ–°çš„å·¦åŠéƒ¨åˆ†ã€‚å°†è¯¥æ“ä½œé‡å¤16æ¬¡ã€‚</p><p>ç»è¿‡16è½®è¿­ä»£åï¼Œå·¦ï¼Œå³åŠéƒ¨åˆ†åˆåœ¨ä¸€èµ·ç»è¿‡ä¸€ä¸ªæœ«ç½®æ¢ï¼ˆæ•°æ®æ•´ç†ï¼‰ï¼Œè¿™æ ·å°±å®Œæˆäº†åŠ å¯†è¿‡ç¨‹ã€‚</p><p>DESçš„è§£å¯†å’ŒåŠ å¯†å”¯ä¸€çš„ä¸åŒæ˜¯å¯†é’¥çš„æ¬¡åºç›¸åã€‚å¦‚æœå„è½®åŠ å¯†å¯†é’¥åˆ†åˆ«æ˜¯K1ï¼ŒK2ï¼ŒK3â€¦K16ï¼Œé‚£ä¹ˆè§£å¯†å¯†é’¥å°±æ˜¯K16ï¼ŒK15ï¼ŒK14â€¦K1ã€‚</p><h2 id="æ€»ä½“ç»“æ„ï¼š"><a href="#æ€»ä½“ç»“æ„ï¼š" class="headerlink" title="æ€»ä½“ç»“æ„ï¼š"></a>æ€»ä½“ç»“æ„ï¼š</h2><p><strong>Feistelç»“æ„ï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/20181209200251183.PNG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="æ¨¡å—åˆ†è§£ï¼š"><a href="#æ¨¡å—åˆ†è§£ï¼š" class="headerlink" title="æ¨¡å—åˆ†è§£ï¼š"></a>æ¨¡å—åˆ†è§£ï¼š</h2><h4 id="ç”±ç»™å®šçš„å¯†é’¥è·å–16ä¸ªå­å¯†é’¥ï¼š"><a href="#ç”±ç»™å®šçš„å¯†é’¥è·å–16ä¸ªå­å¯†é’¥ï¼š" class="headerlink" title="ç”±ç»™å®šçš„å¯†é’¥è·å–16ä¸ªå­å¯†é’¥ï¼š"></a>ç”±ç»™å®šçš„å¯†é’¥è·å–16ä¸ªå­å¯†é’¥ï¼š</h4><ul><li>å¯¹K çš„56ä¸ªéæ ¡éªŒä½å®è¡Œç½®æ¢PC-1ï¼Œå¾—åˆ°C0D0ï¼Œå…¶ä¸­C0 å’ŒD0 åˆ†åˆ«ç”±PC-1 ç½®æ¢åçš„å‰28ä½å’Œå28ä½ç»„æˆã€‚ </li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯†é’¥ç½®æ¢è¡¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> PC_1[<span class="number">56</span>] = &#123;</span><br><span class="line"><span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>,</span><br><span class="line"> <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>,</span><br><span class="line"><span class="number">10</span>,  <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>,</span><br><span class="line"><span class="number">19</span>, <span class="number">11</span>,  <span class="number">3</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>,</span><br><span class="line"><span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>,</span><br><span class="line"> <span class="number">7</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>,</span><br><span class="line"><span class="number">14</span>,  <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>,</span><br><span class="line"><span class="number">21</span>, <span class="number">13</span>,  <span class="number">5</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>,  <span class="number">4</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>è®¡ç®—Ci = LSi(Ci-1) å’ŒDi = LSi(Di-1) </li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯†é’¥ç½®æ¢æ—¶æ¯è½®ç§»åŠ¨çš„ä½æ•°</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> shift[<span class="number">16</span>] = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†å¯†é’¥çš„å‰åéƒ¨åˆ†åˆ†åˆ«å·¦ç§»</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">leftShift</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> K[<span class="number">28</span>], <span class="keyword">int</span> shift)</span> </span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> ar[<span class="number">28</span>];</span><br><span class="line"><span class="built_in">memcpy</span>(ar, K, <span class="number">28</span>);</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">27</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(i-shift &lt; <span class="number">0</span>)</span><br><span class="line">K[i] = ar[i-shift+<span class="number">28</span>];</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">K[i] = ar[i-shift];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯¹56ä½çš„CiDi å®è¡ŒPC-2 å‹ç¼©ç½®æ¢ï¼Œå¾—åˆ°48ä½çš„Ki ã€‚i= i+1ã€‚ </li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‹ç¼©ç½®æ¢è¡¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> PC_2[<span class="number">48</span>] = &#123;</span><br><span class="line"><span class="number">14</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">24</span>,  <span class="number">1</span>,  <span class="number">5</span>,</span><br><span class="line"> <span class="number">3</span>, <span class="number">28</span>, <span class="number">15</span>,  <span class="number">6</span>, <span class="number">21</span>, <span class="number">10</span>,</span><br><span class="line"><span class="number">23</span>, <span class="number">19</span>, <span class="number">12</span>,  <span class="number">4</span>, <span class="number">26</span>,  <span class="number">8</span>,</span><br><span class="line"><span class="number">16</span>,  <span class="number">7</span>, <span class="number">27</span>, <span class="number">20</span>, <span class="number">13</span>,  <span class="number">2</span>,</span><br><span class="line"><span class="number">41</span>, <span class="number">52</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">47</span>, <span class="number">55</span>,</span><br><span class="line"><span class="number">30</span>, <span class="number">40</span>, <span class="number">51</span>, <span class="number">45</span>, <span class="number">33</span>, <span class="number">48</span>,</span><br><span class="line"><span class="number">44</span>, <span class="number">49</span>, <span class="number">39</span>, <span class="number">56</span>, <span class="number">34</span>, <span class="number">53</span>,</span><br><span class="line"><span class="number">46</span>, <span class="number">42</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">32</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>ä¹‹åçš„16è½®æŒ‰ç…§ä»¥ä¸Šæ­¥éª¤é‡å¤å¾—åˆ°16ä¸ªå­å¯†é’¥</li></ul><p>[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥(img-Dov3dif3-1562418750620)(C:\Users\ADMINI~1\AppData\Local\Temp\1540735921928.png)]</p><ul><li><strong>æ€»çš„ç®—æ³•å®ç°ï¼š</strong></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getMyKey</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> key[<span class="number">64</span>], <span class="keyword">unsigned</span> <span class="keyword">char</span> subKey[<span class="number">16</span>][<span class="number">48</span>])</span> </span>&#123;</span><br><span class="line"><span class="comment">//å»æ‰å¥‡å¶æ£€éªŒä½çš„key</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> key_f[<span class="number">56</span>];</span><br><span class="line"><span class="comment">//å·¦åŠéƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> L[<span class="number">28</span>];</span><br><span class="line"><span class="comment">//å³åŠéƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> R[<span class="number">28</span>];</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> C_key[<span class="number">48</span>];</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">56</span>; i++) &#123;</span><br><span class="line">key_f[<span class="number">55</span>-i] = key[<span class="number">64</span>-PC_1[i]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç”Ÿæˆå·¦å³å­å¯†é’¥</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">28</span>; j++) &#123;</span><br><span class="line">L[j] = key_f[j+<span class="number">28</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">28</span>; j++) &#123;</span><br><span class="line">R[j] = key_f[j];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å·¦ç§»</span></span><br><span class="line">leftShift(L, shift[i]);</span><br><span class="line">leftShift(R, shift[i]);</span><br><span class="line"><span class="comment">//å‹ç¼©ç½®æ¢</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">28</span>; j++) &#123;</span><br><span class="line">key_f[j+<span class="number">28</span>] = L[j];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">28</span>; j++) &#123;</span><br><span class="line">key_f[j] = R[j];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">48</span>; j++) &#123;</span><br><span class="line">C_key[<span class="number">47</span>-j] = key_f[<span class="number">56</span>-PC_2[j]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">memcpy</span>(subKey[i], C_key, <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆå§‹IPç½®æ¢ï¼š"><a href="#åˆå§‹IPç½®æ¢ï¼š" class="headerlink" title="åˆå§‹IPç½®æ¢ï¼š"></a>åˆå§‹IPç½®æ¢ï¼š</h4><p> ç»™å®š64ä½æ˜æ–‡å—Mï¼Œé€šè¿‡ä¸€ä¸ªå›ºå®šçš„åˆå§‹ç½®æ¢IPæ¥é‡æ’Mä¸­çš„äºŒè¿›åˆ¶ä½ï¼Œå¾—åˆ°äºŒè¿›åˆ¶ä¸²M0 = IP(M) = L0 R0ï¼Œè¿™é‡ŒL0 å’ŒR0åˆ†åˆ«æ˜¯M0 çš„å‰32ä½å’Œå32ä½ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//IPç½®æ¢è¡¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> IP[<span class="number">64</span>] = &#123;</span><br><span class="line"><span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>,</span><br><span class="line"><span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>,</span><br><span class="line"><span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>,</span><br><span class="line"><span class="number">64</span>, <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>,</span><br><span class="line"><span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>,  <span class="number">1</span>,</span><br><span class="line"><span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>,</span><br><span class="line"><span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>,</span><br><span class="line"><span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆå§‹ç½®æ¢IP</span></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> FirstKey[<span class="number">64</span>];</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">FirstKey[<span class="number">63</span>-i] = word[<span class="number">64</span>-IP[i]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¿­ä»£T"><a href="#è¿­ä»£T" class="headerlink" title="è¿­ä»£T"></a>è¿­ä»£T</h4><ul><li>æ ¹æ®L0R0 æŒ‰ä¸‹è¿°è§„åˆ™è¿›è¡Œ16æ¬¡è¿­ä»£ï¼Œå³ </li></ul><p>$$<br>Li= Ri-1,  Ri= Li-1 (XOR) f(Ri-1, Ki), i= 1 .. 16<br>$$</p><ul><li>è¿™é‡Œ (XOR) æ˜¯32ä½äºŒè¿›åˆ¶ä¸²æŒ‰ä½å¼‚æˆ–è¿ç®—ï¼Œf æ˜¯è¾“å‡º32ä½çš„Feistel è½®å‡½æ•°ï¼›</li><li>16ä¸ªé•¿åº¦ä¸º48ä½çš„å­å¯†é’¥Ki(i= 1 .. 16) ç”±å¯†é’¥Kç”Ÿæˆï¼›</li><li>16æ¬¡è¿­ä»£åå¾—åˆ°L16R16 ;</li><li>å·¦å³äº¤æ¢è¾“å‡ºR16L16 ã€‚</li></ul><p><img src="https://img-blog.csdnimg.cn/20181209200339257.PNG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//16è½®è¿­ä»£</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> L[<span class="number">32</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> R[<span class="number">32</span>];</span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">L[i] = FirstKey[i+<span class="number">32</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">R[i] = FirstKey[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> tmp_R[<span class="number">32</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> R1[<span class="number">32</span>];</span><br><span class="line"><span class="built_in">memcpy</span>(tmp_R, R, <span class="number">32</span>);</span><br><span class="line">f(R, subKey[i], R1);</span><br><span class="line">XOR_32(L, R1);</span><br><span class="line"><span class="built_in">memcpy</span>(R, L, <span class="number">32</span>);</span><br><span class="line"><span class="built_in">memcpy</span>(L, tmp_R, <span class="number">32</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è½®è¯¢å‡½æ•°Feistelï¼š</strong></p><ul><li>å°†é•¿åº¦ä¸º32ä½çš„ä¸²Ri-1ä½œE-æ‰©å±•,æˆä¸º48ä½çš„ä¸²E(Ri-1)ï¼› </li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‰©å±•ç½®æ¢è¡¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> E[<span class="number">48</span>] = &#123;</span><br><span class="line"><span class="number">32</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>,</span><br><span class="line"> <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>,</span><br><span class="line"> <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>,</span><br><span class="line"><span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>,</span><br><span class="line"><span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>,</span><br><span class="line"><span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>,</span><br><span class="line"><span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>,</span><br><span class="line"><span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>,  <span class="number">1</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>å°†E(Ri-1) å’Œé•¿åº¦ä¸º48ä½çš„å­å¯†é’¥Kiä½œ48ä½äºŒè¿›åˆ¶ä¸²æŒ‰ä½å¼‚æˆ–è¿ç®—ï¼ŒKi ç”±å¯†é’¥Kç”Ÿæˆï¼› </li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">XOR_48</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> ER[<span class="number">48</span>], <span class="keyword">unsigned</span> <span class="keyword">char</span> K[<span class="number">48</span>])</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++) &#123;</span><br><span class="line">ER[i] ^= K[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å°†ä¸Šé¢å¾—åˆ°çš„ç»“æœå¹³å‡åˆ†æˆ8ä¸ªåˆ†ç»„(æ¯ä¸ªåˆ†ç»„é•¿åº¦6ä½)ï¼Œå„ä¸ªåˆ† ç»„åˆ†åˆ«ç»è¿‡8ä¸ªä¸åŒçš„S-ç›’è¿›è¡Œ6-4 è½¬æ¢ï¼Œå¾—åˆ°8ä¸ªé•¿åº¦åˆ†åˆ«ä¸º4 ä½çš„åˆ†ç»„ï¼› </li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sç›’ç½®æ¢è¡¨ï¼Œæ¯ä¸ªSç›’æ˜¯4x16çš„ç½®æ¢è¡¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> S_BOX[<span class="number">8</span>][<span class="number">4</span>][<span class="number">16</span>] = &#123;</span><br><span class="line">&#123;  </span><br><span class="line">&#123;<span class="number">14</span>,<span class="number">4</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">15</span>,<span class="number">11</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">7</span>&#125;,  </span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">15</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">12</span>,<span class="number">11</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">8</span>&#125;,  </span><br><span class="line">&#123;<span class="number">4</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="number">15</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">10</span>,<span class="number">5</span>,<span class="number">0</span>&#125;, </span><br><span class="line">&#123;<span class="number">15</span>,<span class="number">12</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">13</span>&#125; </span><br><span class="line">&#125;,</span><br><span class="line">&#123;  </span><br><span class="line">&#123;<span class="number">15</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">14</span>,<span class="number">6</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">10</span>&#125;,  </span><br><span class="line">&#123;<span class="number">3</span>,<span class="number">13</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">15</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">14</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">11</span>,<span class="number">5</span>&#125;, </span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">15</span>&#125;,  </span><br><span class="line">&#123;<span class="number">13</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">9</span>&#125;  </span><br><span class="line">&#125;, </span><br><span class="line">&#123;  </span><br><span class="line">&#123;<span class="number">10</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">14</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">8</span>&#125;,  </span><br><span class="line">&#123;<span class="number">13</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">12</span>,<span class="number">11</span>,<span class="number">15</span>,<span class="number">1</span>&#125;,  </span><br><span class="line">&#123;<span class="number">13</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">15</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">7</span>&#125;,  </span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">15</span>,<span class="number">14</span>,<span class="number">3</span>,<span class="number">11</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">12</span>&#125;  </span><br><span class="line">&#125;, </span><br><span class="line">&#123;  </span><br><span class="line">&#123;<span class="number">7</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">15</span>&#125;,  </span><br><span class="line">&#123;<span class="number">13</span>,<span class="number">8</span>,<span class="number">11</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">9</span>&#125;,  </span><br><span class="line">&#123;<span class="number">10</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">11</span>,<span class="number">7</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>&#125;,  </span><br><span class="line">&#123;<span class="number">3</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">14</span>&#125;  </span><br><span class="line">&#125;,</span><br><span class="line">&#123;  </span><br><span class="line">&#123;<span class="number">2</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">14</span>,<span class="number">9</span>&#125;,  </span><br><span class="line">&#123;<span class="number">14</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">6</span>&#125;,  </span><br><span class="line">&#123;<span class="number">4</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">11</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">15</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">14</span>&#125;,  </span><br><span class="line">&#123;<span class="number">11</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>&#125;  </span><br><span class="line">&#125;,</span><br><span class="line">&#123;  </span><br><span class="line">&#123;<span class="number">12</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">15</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">11</span>&#125;,  </span><br><span class="line">&#123;<span class="number">10</span>,<span class="number">15</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">8</span>&#125;,  </span><br><span class="line">&#123;<span class="number">9</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">11</span>,<span class="number">6</span>&#125;,  </span><br><span class="line">&#123;<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">14</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">13</span>&#125;  </span><br><span class="line">&#125;, </span><br><span class="line">&#123;  </span><br><span class="line">&#123;<span class="number">4</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">1</span>&#125;,  </span><br><span class="line">&#123;<span class="number">13</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">12</span>,<span class="number">2</span>,<span class="number">15</span>,<span class="number">8</span>,<span class="number">6</span>&#125;,  </span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">14</span>,<span class="number">10</span>,<span class="number">15</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">2</span>&#125;,  </span><br><span class="line">&#123;<span class="number">6</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">15</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">12</span>&#125;  </span><br><span class="line">&#125;, </span><br><span class="line">&#123;  </span><br><span class="line">&#123;<span class="number">13</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">7</span>&#125;,  </span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">15</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">11</span>,<span class="number">0</span>,<span class="number">14</span>,<span class="number">9</span>,<span class="number">2</span>&#125;,  </span><br><span class="line">&#123;<span class="number">7</span>,<span class="number">11</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>&#125;,  </span><br><span class="line">&#123;<span class="number">2</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">11</span>&#125;  </span><br><span class="line">&#125; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>å°†ä¸Šé¢å¾—åˆ°çš„åˆ†ç»„ç»“æœé¡ºåºè¿æ¥å¾—åˆ°é•¿åº¦ä¸º32ä½çš„ä¸²ï¼›</li><li>å†å°†ä¸Šé¢çš„32ä½ä¸²ç»è¿‡P-ç½®æ¢ï¼Œå¾—åˆ°çš„ç»“æœä½œä¸ºè½®å‡½æ•°f(Ri-1, Ki) çš„æœ€ç»ˆ32ä½è¾“å‡ºã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Pç›’ç½®æ¢è¡¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P[<span class="number">32</span>] = &#123;</span><br><span class="line"><span class="number">16</span>,  <span class="number">7</span>, <span class="number">20</span>, <span class="number">21</span>,</span><br><span class="line"><span class="number">29</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">17</span>,</span><br><span class="line"> <span class="number">1</span>, <span class="number">15</span>, <span class="number">23</span>, <span class="number">26</span>,</span><br><span class="line"> <span class="number">5</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">10</span>,</span><br><span class="line"> <span class="number">2</span>,  <span class="number">8</span>, <span class="number">24</span>, <span class="number">14</span>,</span><br><span class="line"><span class="number">32</span>, <span class="number">27</span>,  <span class="number">3</span>,  <span class="number">9</span>,</span><br><span class="line"><span class="number">19</span>, <span class="number">13</span>, <span class="number">30</span>,  <span class="number">6</span>,</span><br><span class="line"><span class="number">22</span>, <span class="number">11</span>,  <span class="number">4</span>, <span class="number">25</span> </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><strong>æ•´ä¸ªå‡½æ•°çš„å®ç°è¿‡ç¨‹ï¼š</strong></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è½®è¯¢å‡½æ•°Feistel</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> R[<span class="number">32</span>], <span class="keyword">unsigned</span> <span class="keyword">char</span> K[<span class="number">48</span>], <span class="keyword">unsigned</span> <span class="keyword">char</span> R1[<span class="number">32</span>])</span> </span>&#123;</span><br><span class="line"><span class="comment">//å°†32ä½è¿›è¡Œæ‰©å±•æˆ48ä½</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> ER[<span class="number">48</span>];</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i++) &#123;</span><br><span class="line">ER[<span class="number">47</span>-i] = R[<span class="number">32</span>-E[i]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ‰©å±•åçš„Rå’ŒKå¼‚æˆ–</span></span><br><span class="line">XOR_48(ER, K);</span><br><span class="line"><span class="comment">//è½®è¯¢S_Boxï¼Œå°†6-&gt;4</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i+=<span class="number">6</span>, j+=<span class="number">4</span>) &#123;</span><br><span class="line"><span class="keyword">int</span> m = (ER[<span class="number">47</span>-i]&lt;&lt;<span class="number">1</span>) +ER[<span class="number">47</span>-i<span class="number">-5</span>];</span><br><span class="line"><span class="keyword">int</span> n = (ER[<span class="number">47</span>-i<span class="number">-1</span>]&lt;&lt;<span class="number">3</span>) + (ER[<span class="number">47</span>-i<span class="number">-2</span>]&lt;&lt;<span class="number">2</span>) + (ER[<span class="number">47</span>-i<span class="number">-3</span>]&lt;&lt;<span class="number">1</span>) + ER[<span class="number">47</span>-i<span class="number">-4</span>];</span><br><span class="line"><span class="keyword">int</span> num = S_BOX[i/<span class="number">6</span>][m][n];</span><br><span class="line"><span class="comment">//printf("%d  %d", m, n);</span></span><br><span class="line">R1[<span class="number">31</span>-j] = (num&amp;<span class="number">0x08</span>) &gt;&gt; <span class="number">3</span>;</span><br><span class="line">R1[<span class="number">31</span>-j<span class="number">-1</span>] = (num&amp;<span class="number">0x04</span>) &gt;&gt; <span class="number">2</span>;</span><br><span class="line">R1[<span class="number">31</span>-j<span class="number">-2</span>] = (num&amp;<span class="number">0x02</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">R1[<span class="number">31</span>-j<span class="number">-3</span>] = num&amp;<span class="number">0x01</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Pç½®æ¢ï¼Œ 32-&gt;32</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> ar[<span class="number">32</span>];</span><br><span class="line"><span class="built_in">memcpy</span>(ar, R1, <span class="number">32</span>);</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">R1[<span class="number">31</span>-i] = ar[<span class="number">32</span>-P[i]];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠ å¯†ï¼š"><a href="#åŠ å¯†ï¼š" class="headerlink" title="åŠ å¯†ï¼š"></a>åŠ å¯†ï¼š</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">EnCode</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> word[<span class="number">64</span>], <span class="keyword">unsigned</span> <span class="keyword">char</span> cipher[<span class="number">64</span>], <span class="keyword">unsigned</span> <span class="keyword">char</span> subKey[<span class="number">16</span>][<span class="number">48</span>])</span> </span>&#123;</span><br><span class="line"><span class="comment">//åˆå§‹ç½®æ¢IP</span></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> FirstKey[<span class="number">64</span>];</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">FirstKey[<span class="number">63</span>-i] = word[<span class="number">64</span>-IP[i]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//16è½®è¿­ä»£</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> L[<span class="number">32</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> R[<span class="number">32</span>];</span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">L[i] = FirstKey[i+<span class="number">32</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">R[i] = FirstKey[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> tmp_R[<span class="number">32</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> R1[<span class="number">32</span>];</span><br><span class="line"><span class="built_in">memcpy</span>(tmp_R, R, <span class="number">32</span>);</span><br><span class="line">f(R, subKey[i], R1);</span><br><span class="line">XOR_32(L, R1);</span><br><span class="line"><span class="built_in">memcpy</span>(R, L, <span class="number">32</span>);</span><br><span class="line"><span class="built_in">memcpy</span>(L, tmp_R, <span class="number">32</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆå¹¶è¿­ä»£åçš„Lå’ŒR,å¹¶è¿›è¡ŒIP-1çš„ç½®æ¢</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> LR[<span class="number">64</span>];</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">LR[i] = L[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">LR[i+<span class="number">32</span>] = R[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> tmp_LR[<span class="number">64</span>];</span><br><span class="line"><span class="built_in">memcpy</span>(tmp_LR, LR, <span class="number">64</span>);</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">cipher[<span class="number">63</span>-i] = tmp_LR[<span class="number">64</span>-IP_1[i]];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è§£å¯†ï¼š"><a href="#è§£å¯†ï¼š" class="headerlink" title="è§£å¯†ï¼š"></a>è§£å¯†ï¼š</h4><ul><li>åˆ†ææ‰€æœ‰çš„ä»£æ›¿ã€ç½®æ¢ã€å¼‚æˆ–å’Œå¾ªç¯ç§»åŠ¨è¿‡ç¨‹ï¼Œè·å¾—ä¸€ä¸ªéå¸¸ æœ‰ç”¨çš„æ€§è´¨ï¼šDES çš„åŠ å¯†å’Œè§£å¯†å¯ä½¿ç”¨ç›¸åŒçš„ç®—æ³•å’Œå¯†é’¥ã€‚ </li><li>DES çš„è¿‡ç¨‹è®¾è®¡ä½¿å¾—ç”¨ç›¸åŒçš„å‡½æ•°æ¥åŠ å¯†æˆ–è§£å¯†æ¯ä¸ªåˆ†ç»„æˆä¸º å¯èƒ½ã€‚åŠ è§£å¯†è¿‡ç¨‹ä¸­ä½¿ç”¨ç”±åŒä¸€ä¸ªå¯†é’¥K ç»è¿‡ç›¸åŒçš„å­å¯†é’¥ç”Ÿ æˆç®—æ³•å¾—åˆ°çš„å­å¯†é’¥åºåˆ—ï¼Œå”¯ä¸€ä¸åŒä¹‹å¤„æ˜¯åŠ è§£å¯†è¿‡ç¨‹ä¸­å­å¯† é’¥çš„è°ƒåº¦æ¬¡åºæ°å¥½ç›¸åã€‚<ul><li>åŠ å¯†è¿‡ç¨‹çš„å­å¯†é’¥æŒ‰(K1 K2 â€¦ K15 K16) æ¬¡åºè°ƒåº¦</li><li>è§£å¯†è¿‡ç¨‹çš„å­å¯†é’¥æŒ‰(K16 K15 â€¦ K2 K1) æ¬¡åºè°ƒåº¦</li></ul></li></ul><p><strong>ä»£ç å®ç°ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DeCode</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> cipher[<span class="number">64</span>], <span class="keyword">unsigned</span> <span class="keyword">char</span> word[<span class="number">64</span>], <span class="keyword">unsigned</span> <span class="keyword">char</span> subKey[<span class="number">16</span>][<span class="number">48</span>])</span> </span>&#123;</span><br><span class="line"><span class="comment">//åˆå§‹ç½®æ¢IP</span></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> FirstKey[<span class="number">64</span>];</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">FirstKey[<span class="number">63</span>-i] = cipher[<span class="number">64</span>-IP[i]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//16è½®è¿­ä»£</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> L[<span class="number">32</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> R[<span class="number">32</span>];</span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">L[i] = FirstKey[i+<span class="number">32</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">R[i] = FirstKey[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> tmp_R[<span class="number">32</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> R1[<span class="number">32</span>];</span><br><span class="line"><span class="built_in">memcpy</span>(tmp_R, R, <span class="number">32</span>);</span><br><span class="line">f(R, subKey[<span class="number">15</span>-i], R1);</span><br><span class="line">XOR_32(L, R1);</span><br><span class="line"><span class="built_in">memcpy</span>(R, L, <span class="number">32</span>);</span><br><span class="line"><span class="built_in">memcpy</span>(L, tmp_R, <span class="number">32</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆå¹¶è¿­ä»£åçš„Lå’ŒR,å¹¶è¿›è¡ŒIP-1çš„ç½®æ¢</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> LR[<span class="number">64</span>];</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">LR[i] = L[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">LR[i+<span class="number">32</span>] = R[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> tmp_LR[<span class="number">64</span>];</span><br><span class="line"><span class="built_in">memcpy</span>(tmp_LR, LR, <span class="number">64</span>);</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">word[<span class="number">63</span>-i] = tmp_LR[<span class="number">64</span>-IP_1[i]];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®ç»“æ„ï¼š"><a href="#æ•°æ®ç»“æ„ï¼š" class="headerlink" title="æ•°æ®ç»“æ„ï¼š"></a>æ•°æ®ç»“æ„ï¼š</h2><p>ä½¿ç”¨<strong>unsigned charæ•°ç»„</strong>æ¥å­˜å‚¨äºŒè¿›åˆ¶ä½ä¸²</p><p>é€šè¿‡cè¯­è¨€çš„ç§»ä½æ“ä½œç¬¦å®ç°äºŒè¿›åˆ¶ä½ä¸²çš„é€»è¾‘è¿ç®—ã€‚</p><p><strong>é€šè¿‡ä»¥ä¸‹ä»£ç å®ç°å­—ç¬¦ä¸²ä¸äºŒè¿›åˆ¶ä½ä¸²çš„è½¬æ¢ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å­—ç¬¦è½¬æ¢æˆäºŒè¿›åˆ¶ç¬¦å· </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CharToBit</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> c, <span class="keyword">unsigned</span> <span class="keyword">char</span> bit[<span class="number">8</span>])</span></span>&#123;  </span><br><span class="line">    <span class="keyword">int</span> i;  </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)&#123;  </span><br><span class="line">        *(bit+i) = (c&gt;&gt;i) &amp; <span class="number">1</span>;  </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;  </span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line"><span class="comment">//å°†é•¿åº¦ä¸º8çš„å­—ç¬¦ä¸²è½¬ä¸º64ä½äºŒè¿›åˆ¶  </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">StringToBits</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> c[<span class="number">8</span>], <span class="keyword">unsigned</span> <span class="keyword">char</span> bit[<span class="number">64</span>])</span></span>&#123;  </span><br><span class="line">    <span class="keyword">int</span> i;  </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)&#123;          </span><br><span class="line">        CharToBit(*(c + i), bit + (i&lt;&lt;<span class="number">3</span>));  </span><br><span class="line">    &#125; </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//äºŒè¿›åˆ¶è½¬æ¢æˆå­—èŠ‚  </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BitToChar</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> bit[<span class="number">8</span>], <span class="keyword">unsigned</span> <span class="keyword">char</span> *c)</span></span>&#123;  </span><br><span class="line">    <span class="keyword">int</span> i;  </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)&#123;  </span><br><span class="line">        *c |= *(bit + i) &lt;&lt; i;  </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†äºŒè¿›åˆ¶å­—èŠ‚è½¬ä¸ºé•¿åº¦ä¸º8çš„å­—ç¬¦ä¸²  </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BitsToString</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> bit[<span class="number">64</span>], <span class="keyword">unsigned</span> <span class="keyword">char</span> c[<span class="number">8</span>])</span></span>&#123;  </span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="built_in">memset</span>(c,<span class="number">0</span>,<span class="number">8</span>);  </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)&#123;  </span><br><span class="line">        BitToChar(bit + (i&lt;&lt;<span class="number">3</span>), c + i);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>äºŒè¿›åˆ¶ä½ä¸²çš„ä¸€äº›é€»è¾‘è¿ç®—å¦‚ä¸‹ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">XOR_32</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> ER[<span class="number">32</span>], <span class="keyword">unsigned</span> <span class="keyword">char</span> K[<span class="number">32</span>])</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">ER[i] ^= K[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> m = (ER[<span class="number">47</span>-i]&lt;&lt;<span class="number">1</span>) +ER[<span class="number">47</span>-i<span class="number">-5</span>];</span><br><span class="line"><span class="keyword">int</span> n = (ER[<span class="number">47</span>-i<span class="number">-1</span>]&lt;&lt;<span class="number">3</span>) + (ER[<span class="number">47</span>-i<span class="number">-2</span>]&lt;&lt;<span class="number">2</span>) + (ER[<span class="number">47</span>-i<span class="number">-3</span>]&lt;&lt;<span class="number">1</span>) + ER[<span class="number">47</span>-i<span class="number">-4</span>];</span><br><span class="line"><span class="keyword">int</span> num = S_BOX[i/<span class="number">6</span>][m][n];</span><br><span class="line"><span class="comment">//printf("%d  %d", m, n);</span></span><br><span class="line">R1[<span class="number">31</span>-j] = (num&amp;<span class="number">0x08</span>) &gt;&gt; <span class="number">3</span>;</span><br><span class="line">R1[<span class="number">31</span>-j<span class="number">-1</span>] = (num&amp;<span class="number">0x04</span>) &gt;&gt; <span class="number">2</span>;</span><br><span class="line">R1[<span class="number">31</span>-j<span class="number">-2</span>] = (num&amp;<span class="number">0x02</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">R1[<span class="number">31</span>-j<span class="number">-3</span>] = num&amp;<span class="number">0x01</span>;</span><br></pre></td></tr></table></figure><h2 id="ç¼–è¯‘è¿è¡Œç»“æœï¼š"><a href="#ç¼–è¯‘è¿è¡Œç»“æœï¼š" class="headerlink" title="ç¼–è¯‘è¿è¡Œç»“æœï¼š"></a>ç¼–è¯‘è¿è¡Œç»“æœï¼š</h2><p><strong>ç”¨äºæµ‹è¯•çš„mainæ–‡ä»¶ï¼š</strong></p><ul><li>å°†åŠ å¯†çš„æ–‡å­—å­˜åˆ°ä¸€ä¸ªè®°äº‹æœ¬é‡Œï¼Œè§£å¯†è¿‡ç¨‹è¯»å–è®°äº‹æœ¬ä¸­çš„ä½ä¸²è¿›è¡Œè§£ç ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"desCode.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"please input the words you want to encode: \n\n"</span>);</span><br><span class="line"><span class="comment">//åŠ å¯†çš„æ–‡å­—</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> word[<span class="number">8</span>];</span><br><span class="line"><span class="built_in">memset</span>(word, <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> *s_word = (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="number">8</span>*<span class="keyword">sizeof</span>(<span class="keyword">unsigned</span> <span class="keyword">char</span>));</span><br><span class="line">gets(s_word);</span><br><span class="line"><span class="built_in">strcpy</span>(word, s_word);</span><br><span class="line"><span class="built_in">free</span>(s_word);</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> words[<span class="number">64</span>];</span><br><span class="line">StringToBits(word, words);</span><br><span class="line"><span class="comment">//å¯†é’¥</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> c_key[<span class="number">8</span>];</span><br><span class="line"><span class="comment">//å–1~9çš„éšæœºæ•°ä½œä¸ºå¯†é’¥</span></span><br><span class="line">srand(time(<span class="number">0</span>));</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line"><span class="keyword">int</span> key_1 = rand() % <span class="number">10</span>;</span><br><span class="line">c_key[i] = key_1 + <span class="string">'0'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\nthe key help us to encode is: \n"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%c"</span>, c_key[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n\n"</span>);</span><br><span class="line"><span class="comment">//unsigned char *c_key = "12342a78";</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> key[<span class="number">64</span>];</span><br><span class="line">StringToBits(c_key, key);</span><br><span class="line"><span class="comment">//æ ¹æ®æä¾›çš„å¯†é’¥ç”Ÿæˆ16ä¸ªå­å¯†é’¥</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> subKey[<span class="number">16</span>][<span class="number">48</span>];</span><br><span class="line">getMyKey(key, subKey);</span><br><span class="line"><span class="comment">//åŠ å¯†è¿‡ç¨‹</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> cipher[<span class="number">64</span>];</span><br><span class="line">EnCode(words, cipher, subKey);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"After encode, your cipher is: \n"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%c"</span>, cipher[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n\n"</span>);</span><br><span class="line"><span class="comment">//å°†å¯†ç å†™åˆ°å¯†ç æœ¬é‡Œé¢</span></span><br><span class="line">FILE *fp;</span><br><span class="line">fp = fopen(<span class="string">"code.txt"</span>,<span class="string">"w+t"</span>);</span><br><span class="line">fwrite(cipher, <span class="keyword">sizeof</span>(<span class="keyword">char</span>), <span class="number">64</span>, fp);</span><br><span class="line">fclose(fp);</span><br><span class="line"><span class="comment">//å°†å¯†ç æœ¬çš„å¯†ç è¯»å–å‡º</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> cipher_read[<span class="number">64</span>];</span><br><span class="line">fp = fopen(<span class="string">"code.txt"</span>,<span class="string">"r+t"</span>);</span><br><span class="line">fread(cipher_read, <span class="keyword">sizeof</span>(<span class="keyword">char</span>), <span class="number">64</span>, fp);</span><br><span class="line"><span class="comment">//fscanf(fp, "%s", cipher_read);</span></span><br><span class="line">fclose(fp);</span><br><span class="line"><span class="comment">//è§£å¯†è¿‡ç¨‹</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> decode[<span class="number">64</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> answer[<span class="number">8</span>];</span><br><span class="line">DeCode(cipher_read, decode, subKey);</span><br><span class="line">BitsToString(decode, answer);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"After decode, your answer is: \n"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%c"</span>, answer[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿è¡Œç»“æœï¼š</strong><br><img src="https://img-blog.csdnimg.cn/20181209200433922.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç®—æ³•åŸç†ï¼š&quot;&gt;&lt;a href=&quot;#ç®—æ³•åŸç†ï¼š&quot; class=&quot;headerlink&quot; title=&quot;ç®—æ³•åŸç†ï¼š&quot;&gt;&lt;/a&gt;ç®—æ³•åŸç†ï¼š&lt;/h2&gt;&lt;p&gt;DESç®—æ³•æ˜¯ä¸€ç§å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä»¥64ä½ä¸ºåˆ†ç»„å¯¹æ•°æ®åŠ å¯†ï¼ŒåŠ å¯†å’Œè§£å¯†ç”¨çš„æ˜¯åŒä¸€ä¸ªç®—æ³•ã€‚å®ƒçš„å¯†é’¥é•¿åº¦æ˜¯56ä½ï¼ˆå› ä¸ºæ¯ä¸ªç¬¬
      
    
    </summary>
    
      <category term="ä¿¡æ¯å®‰å…¨æŠ€æœ¯" scheme="http://yoursite.com/categories/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="ä¿¡æ¯å®‰å…¨æŠ€æœ¯" scheme="http://yoursite.com/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>c++å®ç°MD5</title>
    <link href="http://yoursite.com/2019/07/06/c-%E5%AE%9E%E7%8E%B0MD5/"/>
    <id>http://yoursite.com/2019/07/06/c-å®ç°MD5/</id>
    <published>2019-07-06T13:10:58.000Z</published>
    <updated>2019-07-06T13:11:57.393Z</updated>
    
    <content type="html"><![CDATA[<h4 id="MD5ç®—æ³•ç®€ä»‹ï¼š"><a href="#MD5ç®—æ³•ç®€ä»‹ï¼š" class="headerlink" title="MD5ç®—æ³•ç®€ä»‹ï¼š"></a>MD5ç®—æ³•ç®€ä»‹ï¼š</h4><p>æ¶ˆæ¯æ‘˜è¦ç®—æ³•ç¬¬äº”ç‰ˆï¼ˆè‹±è¯­ï¼šMessage-Digest Algorithm 5ï¼Œç¼©å†™ä¸ºMD5ï¼‰ï¼Œæ˜¯å½“å‰è®¡ç®—æœºé¢†åŸŸç”¨äºç¡®ä¿ä¿¡æ¯ä¼ è¾“å®Œæ•´ä¸€è‡´è€Œå¹¿æ³›ä½¿ç”¨çš„æ•£åˆ—ç®—æ³•ä¹‹ä¸€ï¼ˆåˆè¯‘å“ˆå¸Œç®—æ³•ã€æ‘˜è¦ç®—æ³•ç­‰ï¼‰ï¼Œä¸»æµç¼–ç¨‹è¯­è¨€æ™®éå·²æœ‰MD5çš„å®ç°ã€‚å°†æ•°æ® ï¼ˆå¦‚ä¸€æ®µæ–‡å­—ï¼‰è¿ç®—å˜ä¸ºå¦ä¸€å›ºå®šé•¿åº¦å€¼ï¼Œæ˜¯æ•£åˆ—ç®—æ³•çš„åŸºç¡€åŸç†ï¼ŒMD5çš„å‰èº«æœ‰MD2ã€MD3å’ŒMD4ã€‚MD5ç”±MD4ã€MD3ã€MD2æ”¹è¿›è€Œæ¥ï¼Œä¸»è¦å¢å¼ºç®—æ³•å¤æ‚åº¦å’Œä¸å¯é€†æ€§ã€‚ç›®å‰ï¼ŒMD5ç®—æ³•å› å…¶æ™®éã€ç¨³å®šã€å¿«é€Ÿçš„ç‰¹ç‚¹ï¼Œä»å¹¿æ³›åº”ç”¨äºæ™®é€š æ•°æ®çš„é”™è¯¯æ£€æŸ¥é¢†åŸŸã€‚ä¾‹å¦‚åœ¨ä¸€äº›BitTorrentä¸‹è½½ä¸­ï¼Œè½¯ä»¶å°†é€šè¿‡è®¡ç®—MD5æ£€éªŒä¸‹è½½åˆ°çš„æ–‡ä»¶ç‰‡æ®µçš„å®Œæ•´æ€§ã€‚MD5å·²ç»å¹¿æ³›ä½¿ç”¨åœ¨ä¸ºæ–‡ä»¶ä¼ è¾“æä¾›ä¸€å®šçš„å¯é æ€§æ–¹é¢ã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡å™¨é¢„å…ˆæä¾›ä¸€ä¸ªMD5æ ¡éªŒå’Œï¼Œç”¨æˆ·ä¸‹è½½å®Œæ–‡ä»¶ä»¥åï¼Œ ç”¨MD5ç®—æ³•è®¡ç®—ä¸‹è½½æ–‡ä»¶çš„MD5æ ¡éªŒå’Œï¼Œç„¶åé€šè¿‡æ£€æŸ¥è¿™ä¸¤ä¸ªæ ¡éªŒå’Œæ˜¯å¦ä¸€è‡´ï¼Œå°±èƒ½åˆ¤æ–­ä¸‹è½½çš„æ–‡ä»¶æ˜¯å¦å‡ºé”™ã€‚MD5æ˜¯è¾“å…¥ä¸å®šé•¿åº¦ä¿¡æ¯ï¼Œè¾“å‡ºå›ºå®šé•¿åº¦128-bitsçš„ç®—æ³•ã€‚ç»è¿‡ç¨‹åºæµç¨‹ï¼Œç”Ÿæˆå››ä¸ª32ä½æ•°æ®ï¼Œæœ€åè”åˆèµ·æ¥æˆä¸ºä¸€ä¸ª 128-bitsæ•£åˆ—ã€‚åŸºæœ¬æ–¹å¼ä¸ºï¼Œæ±‚ä½™ã€å–ä½™ã€è°ƒæ•´é•¿åº¦ã€ä¸é“¾æ¥å˜é‡è¿›è¡Œå¾ªç¯è¿ç®—ã€‚å¾—å‡ºç»“æœã€‚</p><h4 id="MD5è¿ç®—æ­¥éª¤ï¼š"><a href="#MD5è¿ç®—æ­¥éª¤ï¼š" class="headerlink" title="MD5è¿ç®—æ­¥éª¤ï¼š"></a>MD5è¿ç®—æ­¥éª¤ï¼š</h4><p>å‡è®¾è¾“å…¥ä¿¡æ¯(input message)çš„é•¿åº¦ä¸ºb(bit)ï¼Œæˆ‘ä»¬æƒ³è¦äº§ç”Ÿå®ƒçš„æŠ¥æ–‡æ‘˜è¦ï¼Œåœ¨æ­¤å¤„bä¸ºä»»æ„çš„éè´Ÿæ•´æ•°ï¼šbä¹Ÿå¯èƒ½ä¸º0ï¼Œä¹Ÿä¸ä¸€å®šä¸º8çš„æ•´æ•°å€ï¼Œä¸”å¯èƒ½æ˜¯ä»»æ„å¤§çš„é•¿åº¦ã€‚è®¾è¯¥ä¿¡æ¯çš„æ¯”ç‰¹æµè¡¨ç¤ºå¦‚ä¸‹ï¼š M[0] M[1] M[2] â€¦ M[b-1] è®¡ç®—æ­¤ä¿¡æ¯çš„æŠ¥æ–‡æ‘˜è¦éœ€è¦å¦‚ä¸‹5æ­¥ï¼š</p><p><strong>1.è¡¥ä½</strong></p><p>ä¿¡æ¯è®¡ç®—å‰å…ˆè¦è¿›è¡Œä½è¡¥ä½ï¼Œè®¾è¡¥ä½åä¿¡æ¯çš„é•¿åº¦ä¸ºLEN(bit)ï¼Œåˆ™LEN%512 = 448(bit)ï¼Œå³æ•°æ®æ‰©å±•è‡³ K * 512 + 448(bit)ã€‚å³K * 64+56(byte)ï¼ŒKä¸ºæ•´æ•°ã€‚è¡¥ä½æ“ä½œå§‹ç»ˆè¦æ‰§è¡Œï¼Œå³ä½¿è¡¥ä½å‰ä¿¡æ¯çš„é•¿åº¦å¯¹512æ±‚ä½™çš„ç»“æœæ˜¯448ã€‚å…·ä½“è¡¥ä½æ“ä½œï¼šè¡¥ä¸€ä¸ª1ï¼Œç„¶åè¡¥0è‡³æ»¡è¶³ä¸Šè¿°è¦æ±‚ã€‚æ€»å…±æœ€å°‘è¦è¡¥1bitï¼Œæœ€å¤šè¡¥512bitã€‚</p><p><strong>2.å°¾éƒ¨åŠ ä¸Šä¿¡æ¯é•¿åº¦</strong></p><p>å°†è¾“å…¥ä¿¡æ¯çš„åŸå§‹é•¿åº¦b(bit)è¡¨ç¤ºæˆä¸€ä¸ª64-bitçš„æ•°å­—ï¼ŒæŠŠå®ƒæ·»åŠ åˆ°ä¸Šä¸€æ­¥çš„ç»“æœåé¢(åœ¨32ä½çš„æœºå™¨ä¸Šï¼Œè¿™64ä½å°†ç”¨2ä¸ªå­—æ¥è¡¨ç¤ºå¹¶ä¸”ä½ä½åœ¨å‰)ã€‚å½“é‡åˆ°bå¤§äº2^64è¿™ç§æå°‘çš„æƒ…å†µæ—¶ï¼Œbçš„é«˜ä½è¢«æˆªå»ï¼Œä»…ä½¿ç”¨bçš„ä½64ä½ã€‚ç»è¿‡ä¸Šé¢ä¸¤æ­¥ï¼Œæ•°æ®å°±è¢«å¡«è¡¥æˆé•¿åº¦ä¸º512(bit)çš„å€æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤æ—¶çš„æ•°æ®é•¿åº¦æ˜¯16ä¸ªå­—(32byte)çš„æ•´æ•°å€ã€‚æ­¤æ—¶çš„æ•°æ®è¡¨ç¤ºä¸ºï¼š M[0 â€¦ N-1] å…¶ä¸­çš„Næ˜¯16çš„å€æ•°ã€‚</p><p><strong>3.åˆå§‹åŒ–ç¼“å­˜åŒº</strong></p><p>ç”¨ä¸€ä¸ªå››ä¸ªå­—çš„ç¼“å†²å™¨(Aï¼ŒBï¼ŒCï¼ŒD)æ¥è®¡ç®—æŠ¥æ–‡æ‘˜è¦ï¼ŒA,B,C,Dåˆ†åˆ«æ˜¯32ä½çš„å¯„å­˜å™¨ï¼Œåˆå§‹åŒ–ä½¿ç”¨çš„æ˜¯åå…­è¿›åˆ¶è¡¨ç¤ºçš„æ•°å­—ï¼Œæ³¨æ„ä½å­—èŠ‚åœ¨å‰ï¼š word A: 01 23 45 67 word B: 89 ab cd ef word C: fe dc ba 98 word D: 76 54 32 10</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A = <span class="number">0x67452301</span>;</span><br><span class="line">B = <span class="number">0xEFCDAB89</span>;</span><br><span class="line">C = <span class="number">0x98BADCFE</span>;</span><br><span class="line">D = <span class="number">0x10325476</span>;</span><br></pre></td></tr></table></figure><p><strong>4.è½¬æ¢</strong></p><p>å››è½®å¾ªç¯è¿ç®—ï¼šå¾ªç¯çš„æ¬¡æ•°æ˜¯åˆ†ç»„çš„ä¸ªæ•°ï¼ˆN+1ï¼‰ï¼š</p><p>1ï¼‰å°†æ¯ä¸€512å­—èŠ‚ç»†åˆ†æˆ16ä¸ªå°ç»„ï¼Œæ¯ä¸ªå°ç»„64ä½ï¼ˆ8ä¸ªå­—èŠ‚ï¼‰ </p><p>2ï¼‰ç”¨åˆ°çš„ä½œä¸ºè¾…åŠ©çš„å››ä¸ªçº¿æ€§å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">F</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> x, <span class="keyword">unsigned</span> <span class="keyword">int</span> y, <span class="keyword">unsigned</span> <span class="keyword">int</span> z)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> (x &amp; y) | ((~x) &amp; z);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">G</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> x, <span class="keyword">unsigned</span> <span class="keyword">int</span> y, <span class="keyword">unsigned</span> <span class="keyword">int</span> z)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> (x &amp; z) | (y &amp; (~z));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">H</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> x, <span class="keyword">unsigned</span> <span class="keyword">int</span> y, <span class="keyword">unsigned</span> <span class="keyword">int</span> z)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> x ^ y ^ z;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">I</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> x, <span class="keyword">unsigned</span> <span class="keyword">int</span> y, <span class="keyword">unsigned</span> <span class="keyword">int</span> z)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> y ^ (x | (~z));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰xè¡¨ç¤ºæ¶ˆæ¯çš„æŸä¸ªå­åˆ†ç»„ï¼ˆä»0åˆ°15ï¼‰ï¼Œ&lt;&lt; </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">FF</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> a, <span class="keyword">unsigned</span> <span class="keyword">int</span> b, <span class="keyword">unsigned</span> <span class="keyword">int</span> c, <span class="keyword">unsigned</span> <span class="keyword">int</span> d, <span class="keyword">unsigned</span> <span class="keyword">int</span> x, <span class="keyword">int</span> s, <span class="keyword">unsigned</span> <span class="keyword">int</span> ac)</span> </span>&#123;</span><br><span class="line">a += F(b, c, d) + x + ac;</span><br><span class="line">a = (a &lt;&lt; s) | (a &gt;&gt; (<span class="number">32</span> - s));</span><br><span class="line">a += b;</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">GG</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> a, <span class="keyword">unsigned</span> <span class="keyword">int</span> b, <span class="keyword">unsigned</span> <span class="keyword">int</span> c, <span class="keyword">unsigned</span> <span class="keyword">int</span> d, <span class="keyword">unsigned</span> <span class="keyword">int</span> x, <span class="keyword">int</span> s, <span class="keyword">unsigned</span> <span class="keyword">int</span> ac)</span> </span>&#123;</span><br><span class="line">a += G(b, c, d) + x + ac;</span><br><span class="line">a = (a &lt;&lt; s) | (a &gt;&gt; (<span class="number">32</span> - s));</span><br><span class="line">a += b;</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">HH</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> a, <span class="keyword">unsigned</span> <span class="keyword">int</span> b, <span class="keyword">unsigned</span> <span class="keyword">int</span> c, <span class="keyword">unsigned</span> <span class="keyword">int</span> d, <span class="keyword">unsigned</span> <span class="keyword">int</span> x, <span class="keyword">int</span> s, <span class="keyword">unsigned</span> <span class="keyword">int</span> ac)</span> </span>&#123;</span><br><span class="line">a += H(b, c, d) + x + ac;</span><br><span class="line">a = (a &lt;&lt; s) | (a &gt;&gt; (<span class="number">32</span> - s));</span><br><span class="line">a += b;</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">II</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> a, <span class="keyword">unsigned</span> <span class="keyword">int</span> b, <span class="keyword">unsigned</span> <span class="keyword">int</span> c, <span class="keyword">unsigned</span> <span class="keyword">int</span> d, <span class="keyword">unsigned</span> <span class="keyword">int</span> x, <span class="keyword">int</span> s, <span class="keyword">unsigned</span> <span class="keyword">int</span> ac)</span> </span>&#123;</span><br><span class="line">a += I(b, c, d) + x + ac;</span><br><span class="line">a = (a &lt;&lt; s) | (a &gt;&gt; (<span class="number">32</span> - s));</span><br><span class="line">a += b;</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ï¼‰å››è½®è¿ç®— </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> MD5::transform(<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *block) &#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> a = A, b = B, c = C, d = D;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> groups[<span class="number">16</span>];</span><br><span class="line">decode(groups, block, <span class="number">64</span>);</span><br><span class="line"><span class="comment">//groups[15] = 0;</span></span><br><span class="line">a = FF(a, b, c, d, groups[<span class="number">0</span>], S11, <span class="number">0xd76aa478</span>L); <span class="comment">/* 1 */</span></span><br><span class="line">    d = FF(d, a, b, c, groups[<span class="number">1</span>], S12, <span class="number">0xe8c7b756</span>L); <span class="comment">/* 2 */</span></span><br><span class="line">    c = FF(c, d, a, b, groups[<span class="number">2</span>], S13, <span class="number">0x242070db</span>L); <span class="comment">/* 3 */</span></span><br><span class="line">    b = FF(b, c, d, a, groups[<span class="number">3</span>], S14, <span class="number">0xc1bdceee</span>L); <span class="comment">/* 4 */</span></span><br><span class="line">    a = FF(a, b, c, d, groups[<span class="number">4</span>], S11, <span class="number">0xf57c0faf</span>L); <span class="comment">/* 5 */</span></span><br><span class="line">    d = FF(d, a, b, c, groups[<span class="number">5</span>], S12, <span class="number">0x4787c62a</span>L); <span class="comment">/* 6 */</span></span><br><span class="line">    c = FF(c, d, a, b, groups[<span class="number">6</span>], S13, <span class="number">0xa8304613</span>L); <span class="comment">/* 7 */</span></span><br><span class="line">    b = FF(b, c, d, a, groups[<span class="number">7</span>], S14, <span class="number">0xfd469501</span>L); <span class="comment">/* 8 */</span></span><br><span class="line">    a = FF(a, b, c, d, groups[<span class="number">8</span>], S11, <span class="number">0x698098d8</span>L); <span class="comment">/* 9 */</span></span><br><span class="line">    d = FF(d, a, b, c, groups[<span class="number">9</span>], S12, <span class="number">0x8b44f7af</span>L); <span class="comment">/* 10 */</span></span><br><span class="line">    c = FF(c, d, a, b, groups[<span class="number">10</span>], S13, <span class="number">0xffff5bb1</span>L); <span class="comment">/* 11 */</span></span><br><span class="line">    b = FF(b, c, d, a, groups[<span class="number">11</span>], S14, <span class="number">0x895cd7be</span>L); <span class="comment">/* 12 */</span></span><br><span class="line">    a = FF(a, b, c, d, groups[<span class="number">12</span>], S11, <span class="number">0x6b901122</span>L); <span class="comment">/* 13 */</span></span><br><span class="line">    d = FF(d, a, b, c, groups[<span class="number">13</span>], S12, <span class="number">0xfd987193</span>L); <span class="comment">/* 14 */</span></span><br><span class="line">    c = FF(c, d, a, b, groups[<span class="number">14</span>], S13, <span class="number">0xa679438e</span>L); <span class="comment">/* 15 */</span></span><br><span class="line">    b = FF(b, c, d, a, groups[<span class="number">15</span>], S14, <span class="number">0x49b40821</span>L); <span class="comment">/* 16 */</span></span><br><span class="line">    <span class="comment">/*ç¬¬äºŒè½®*/</span></span><br><span class="line">    a = GG(a, b, c, d, groups[<span class="number">1</span>], S21, <span class="number">0xf61e2562</span>L); <span class="comment">/* 17 */</span></span><br><span class="line">    d = GG(d, a, b, c, groups[<span class="number">6</span>], S22, <span class="number">0xc040b340</span>L); <span class="comment">/* 18 */</span></span><br><span class="line">    c = GG(c, d, a, b, groups[<span class="number">11</span>], S23, <span class="number">0x265e5a51</span>L); <span class="comment">/* 19 */</span></span><br><span class="line">    b = GG(b, c, d, a, groups[<span class="number">0</span>], S24, <span class="number">0xe9b6c7aa</span>L); <span class="comment">/* 20 */</span></span><br><span class="line">    a = GG(a, b, c, d, groups[<span class="number">5</span>], S21, <span class="number">0xd62f105d</span>L); <span class="comment">/* 21 */</span></span><br><span class="line">    d = GG(d, a, b, c, groups[<span class="number">10</span>], S22, <span class="number">0x2441453</span>L); <span class="comment">/* 22 */</span></span><br><span class="line">    c = GG(c, d, a, b, groups[<span class="number">15</span>], S23, <span class="number">0xd8a1e681</span>L); <span class="comment">/* 23 */</span></span><br><span class="line">    b = GG(b, c, d, a, groups[<span class="number">4</span>], S24, <span class="number">0xe7d3fbc8</span>L); <span class="comment">/* 24 */</span></span><br><span class="line">    a = GG(a, b, c, d, groups[<span class="number">9</span>], S21, <span class="number">0x21e1cde6</span>L); <span class="comment">/* 25 */</span></span><br><span class="line">    d = GG(d, a, b, c, groups[<span class="number">14</span>], S22, <span class="number">0xc33707d6</span>L); <span class="comment">/* 26 */</span></span><br><span class="line">    c = GG(c, d, a, b, groups[<span class="number">3</span>], S23, <span class="number">0xf4d50d87</span>L); <span class="comment">/* 27 */</span></span><br><span class="line">    b = GG(b, c, d, a, groups[<span class="number">8</span>], S24, <span class="number">0x455a14ed</span>L); <span class="comment">/* 28 */</span></span><br><span class="line">    a = GG(a, b, c, d, groups[<span class="number">13</span>], S21, <span class="number">0xa9e3e905</span>L); <span class="comment">/* 29 */</span></span><br><span class="line">    d = GG(d, a, b, c, groups[<span class="number">2</span>], S22, <span class="number">0xfcefa3f8</span>L); <span class="comment">/* 30 */</span></span><br><span class="line">    c = GG(c, d, a, b, groups[<span class="number">7</span>], S23, <span class="number">0x676f02d9</span>L); <span class="comment">/* 31 */</span></span><br><span class="line">    b = GG(b, c, d, a, groups[<span class="number">12</span>], S24, <span class="number">0x8d2a4c8a</span>L); <span class="comment">/* 32 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*ç¬¬ä¸‰è½®*/</span></span><br><span class="line">    a = HH(a, b, c, d, groups[<span class="number">5</span>], S31, <span class="number">0xfffa3942</span>L); <span class="comment">/* 33 */</span></span><br><span class="line">    d = HH(d, a, b, c, groups[<span class="number">8</span>], S32, <span class="number">0x8771f681</span>L); <span class="comment">/* 34 */</span></span><br><span class="line">    c = HH(c, d, a, b, groups[<span class="number">11</span>], S33, <span class="number">0x6d9d6122</span>L); <span class="comment">/* 35 */</span></span><br><span class="line">    b = HH(b, c, d, a, groups[<span class="number">14</span>], S34, <span class="number">0xfde5380c</span>L); <span class="comment">/* 36 */</span></span><br><span class="line">    a = HH(a, b, c, d, groups[<span class="number">1</span>], S31, <span class="number">0xa4beea44</span>L); <span class="comment">/* 37 */</span></span><br><span class="line">    d = HH(d, a, b, c, groups[<span class="number">4</span>], S32, <span class="number">0x4bdecfa9</span>L); <span class="comment">/* 38 */</span></span><br><span class="line">    c = HH(c, d, a, b, groups[<span class="number">7</span>], S33, <span class="number">0xf6bb4b60</span>L); <span class="comment">/* 39 */</span></span><br><span class="line">    b = HH(b, c, d, a, groups[<span class="number">10</span>], S34, <span class="number">0xbebfbc70</span>L); <span class="comment">/* 40 */</span></span><br><span class="line">    a = HH(a, b, c, d, groups[<span class="number">13</span>], S31, <span class="number">0x289b7ec6</span>L); <span class="comment">/* 41 */</span></span><br><span class="line">    d = HH(d, a, b, c, groups[<span class="number">0</span>], S32, <span class="number">0xeaa127fa</span>L); <span class="comment">/* 42 */</span></span><br><span class="line">    c = HH(c, d, a, b, groups[<span class="number">3</span>], S33, <span class="number">0xd4ef3085</span>L); <span class="comment">/* 43 */</span></span><br><span class="line">    b = HH(b, c, d, a, groups[<span class="number">6</span>], S34, <span class="number">0x4881d05</span>L); <span class="comment">/* 44 */</span></span><br><span class="line">    a = HH(a, b, c, d, groups[<span class="number">9</span>], S31, <span class="number">0xd9d4d039</span>L); <span class="comment">/* 45 */</span></span><br><span class="line">    d = HH(d, a, b, c, groups[<span class="number">12</span>], S32, <span class="number">0xe6db99e5</span>L); <span class="comment">/* 46 */</span></span><br><span class="line">    c = HH(c, d, a, b, groups[<span class="number">15</span>], S33, <span class="number">0x1fa27cf8</span>L); <span class="comment">/* 47 */</span></span><br><span class="line">    b = HH(b, c, d, a, groups[<span class="number">2</span>], S34, <span class="number">0xc4ac5665</span>L); <span class="comment">/* 48 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*ç¬¬å››è½®*/</span></span><br><span class="line">    a = II(a, b, c, d, groups[<span class="number">0</span>], S41, <span class="number">0xf4292244</span>L); <span class="comment">/* 49 */</span></span><br><span class="line">    d = II(d, a, b, c, groups[<span class="number">7</span>], S42, <span class="number">0x432aff97</span>L); <span class="comment">/* 50 */</span></span><br><span class="line">    c = II(c, d, a, b, groups[<span class="number">14</span>], S43, <span class="number">0xab9423a7</span>L); <span class="comment">/* 51 */</span></span><br><span class="line">    b = II(b, c, d, a, groups[<span class="number">5</span>], S44, <span class="number">0xfc93a039</span>L); <span class="comment">/* 52 */</span></span><br><span class="line">    a = II(a, b, c, d, groups[<span class="number">12</span>], S41, <span class="number">0x655b59c3</span>L); <span class="comment">/* 53 */</span></span><br><span class="line">    d = II(d, a, b, c, groups[<span class="number">3</span>], S42, <span class="number">0x8f0ccc92</span>L); <span class="comment">/* 54 */</span></span><br><span class="line">    c = II(c, d, a, b, groups[<span class="number">10</span>], S43, <span class="number">0xffeff47d</span>L); <span class="comment">/* 55 */</span></span><br><span class="line">    b = II(b, c, d, a, groups[<span class="number">1</span>], S44, <span class="number">0x85845dd1</span>L); <span class="comment">/* 56 */</span></span><br><span class="line">    a = II(a, b, c, d, groups[<span class="number">8</span>], S41, <span class="number">0x6fa87e4f</span>L); <span class="comment">/* 57 */</span></span><br><span class="line">    d = II(d, a, b, c, groups[<span class="number">15</span>], S42, <span class="number">0xfe2ce6e0</span>L); <span class="comment">/* 58 */</span></span><br><span class="line">    c = II(c, d, a, b, groups[<span class="number">6</span>], S43, <span class="number">0xa3014314</span>L); <span class="comment">/* 59 */</span></span><br><span class="line">    b = II(b, c, d, a, groups[<span class="number">13</span>], S44, <span class="number">0x4e0811a1</span>L); <span class="comment">/* 60 */</span></span><br><span class="line">    a = II(a, b, c, d, groups[<span class="number">4</span>], S41, <span class="number">0xf7537e82</span>L); <span class="comment">/* 61 */</span></span><br><span class="line">    d = II(d, a, b, c, groups[<span class="number">11</span>], S42, <span class="number">0xbd3af235</span>L); <span class="comment">/* 62 */</span></span><br><span class="line">    c = II(c, d, a, b, groups[<span class="number">2</span>], S43, <span class="number">0x2ad7d2bb</span>L); <span class="comment">/* 63 */</span></span><br><span class="line">    b = II(b, c, d, a, groups[<span class="number">9</span>], S44, <span class="number">0xeb86d391</span>L); <span class="comment">/* 64 */</span></span><br><span class="line"></span><br><span class="line">A += a;</span><br><span class="line">    B += b;</span><br><span class="line">    C += c;</span><br><span class="line">    D += d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å‡½æ•°ä¸­ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„æ¨¡å—</strong>ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯updateå‡½æ•°ï¼Œä¹Ÿæ˜¯å¤§éƒ¨åˆ†æ‘˜è¦ç®—æ³•éƒ½å…·æœ‰çš„æ“ä½œï¼š</p><p>ä½œç”¨ä¸»è¦æ˜¯æ›´æ–°MD5å—ã€‚ç„¶åç»§ç»­MD5æ¶ˆæ¯æ‘˜è¦æ“ä½œï¼Œå¤„ç†å¦ä¸€ä¸ªæ¶ˆæ¯å—ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> MD5::update(<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *input, <span class="keyword">int</span> length) &#123;</span><br><span class="line">inputNum += (length &lt;&lt; <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">int</span> start = <span class="number">64</span> - bufferNum;</span><br><span class="line">    <span class="comment">////å°†è¾“å…¥çš„ä¸€éƒ¨åˆ†å¤åˆ¶åˆ°bufferæ‰€ä»¥å®ƒå¯ä»¥å½¢æˆä¸€ä¸ªå—ï¼ˆsize = 64ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span>(start &lt;= length)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//å¯ä»¥å½¢æˆä¸€ä¸ªå—ï¼Œç„¶åå¯¹è¿™ä¸ªå—åšå››è½®å¾ªç¯</span></span><br><span class="line">            <span class="built_in">memcpy</span>(&amp;buffer[bufferNum], input, start);</span><br><span class="line">            transform(buffer);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">int</span> i;</span><br><span class="line">            <span class="keyword">for</span>(i = start; i &lt;= length - <span class="number">64</span>; i += <span class="number">64</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                transform(&amp;input[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            bufferNum = length - i;  </span><br><span class="line">            <span class="built_in">memcpy</span>(buffer, &amp;input[i], bufferNum);  </span><br><span class="line">    &#125;     </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//ä¸èƒ½å½¢æˆå—</span></span><br><span class="line">        <span class="built_in">memcpy</span>(&amp;buffer[bufferNum], input, length);</span><br><span class="line">        bufferNum += length;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå†æ˜¯Finalå‡½æ•°ï¼Œä½œç”¨æ˜¯ä½¿ç”¨100000å¡«å……buffer, å¹¶æ·»åŠ 64ä½åŸå§‹å¤§å°çš„è¾“å…¥</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> MD5::Final()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = <span class="number">56</span> - bufferNum;  <span class="comment">//56 = 448/8</span></span><br><span class="line">    <span class="comment">//å¡«å……</span></span><br><span class="line">    <span class="keyword">if</span>(temp &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        update(padding, temp);</span><br><span class="line"></span><br><span class="line">        inputNum -= (temp &lt;&lt; <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(temp &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        update(padding, <span class="number">64</span> + temp);</span><br><span class="line">        inputNum -= ((<span class="number">64</span> + temp) &lt;&lt; <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//trans inputNum(è¾“å…¥çš„ä½æ•°) to unsigned char (64bits)</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Bits[<span class="number">8</span>];</span><br><span class="line">    <span class="comment">//cout &lt;&lt; inputNum &lt;&lt; endl;</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//cout &lt;&lt; inputNum &lt;&lt; endl;</span></span><br><span class="line">        Bits[i] = (inputNum &gt;&gt; <span class="number">8</span>*i) &amp; <span class="number">0xff</span>;</span><br><span class="line">        <span class="comment">//cout &lt;&lt; i &lt;&lt; endl;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//cout &lt;&lt; (int)Bits[4] &lt;&lt; endl;</span></span><br><span class="line">    <span class="comment">//æ·»åŠ æœ€åˆè¾“å…¥çš„num(å64ä½)</span></span><br><span class="line">    update(Bits, <span class="number">8</span>); </span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> input[<span class="number">4</span>];</span><br><span class="line">    input[<span class="number">0</span>] = A;</span><br><span class="line">   input[<span class="number">1</span>] = B;</span><br><span class="line">   input[<span class="number">2</span>] = C;</span><br><span class="line">   input[<span class="number">3</span>] = D;</span><br><span class="line">   <span class="comment">//å°†inputå­˜å…¥result</span></span><br><span class="line">    encode(result, input, <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æœ€åå°†æ•´ä¸ªæ¨¡å—æ•´åˆä¸ºç±»ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MD5</span> &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="built_in">string</span> cipher;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> A;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> B;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> C;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> D;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> buffer[<span class="number">64</span>];</span><br><span class="line"><span class="keyword">int</span> bufferNum;  <span class="comment">//</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> inputNum;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> result[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">MD5();</span><br><span class="line">~MD5();</span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">encrypt</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* fiename)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">readCipher</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *filename)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *input, <span class="keyword">int</span> length)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encode</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *output, <span class="keyword">unsigned</span> <span class="keyword">int</span> *input, <span class="keyword">int</span> length)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decode</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> *output, <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span>* input, <span class="keyword">const</span> <span class="keyword">int</span> length)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transform</span><span class="params">(<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *block)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Final</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="è¿è¡Œç»“æœï¼š"><a href="#è¿è¡Œç»“æœï¼š" class="headerlink" title="è¿è¡Œç»“æœï¼š"></a>è¿è¡Œç»“æœï¼š</h4><p><strong>å°†è¦åŠ å¯†çš„æ–‡æœ¬å†™å…¥åˆ°å¯†ç æœ¬ä¸­ï¼š</strong><br><img src="https://img-blog.csdnimg.cn/20181209195553162.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>è¿è¡Œç»“æœï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/20181209195631415.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>ç„¶åä¸åŠ å¯†ç½‘ç«™çš„ç»“æœè¿›è¡Œå¯¹æ¯”ï¼š</strong></p><p>ç½‘ç«™ä¸ºï¼š<a href="http://tool.chinaz.com/tools/md5.aspx" target="_blank" rel="noopener">http://tool.chinaz.com/tools/md5.aspx</a><br><img src="https://img-blog.csdnimg.cn/20181209195712744.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç»“æœä¸€è‡´ï¼Œè¯´æ˜åŠ å¯†æˆåŠŸã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;MD5ç®—æ³•ç®€ä»‹ï¼š&quot;&gt;&lt;a href=&quot;#MD5ç®—æ³•ç®€ä»‹ï¼š&quot; class=&quot;headerlink&quot; title=&quot;MD5ç®—æ³•ç®€ä»‹ï¼š&quot;&gt;&lt;/a&gt;MD5ç®—æ³•ç®€ä»‹ï¼š&lt;/h4&gt;&lt;p&gt;æ¶ˆæ¯æ‘˜è¦ç®—æ³•ç¬¬äº”ç‰ˆï¼ˆè‹±è¯­ï¼šMessage-Digest Algorithm 5ï¼Œç¼©å†™ä¸ºMD5
      
    
    </summary>
    
      <category term="ä¿¡æ¯å®‰å…¨æŠ€æœ¯" scheme="http://yoursite.com/categories/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="ä¿¡æ¯å®‰å…¨æŠ€æœ¯" scheme="http://yoursite.com/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>å›¾åƒæ‹¼æ¥(Image Stitch)</title>
    <link href="http://yoursite.com/2019/07/06/Stitch/"/>
    <id>http://yoursite.com/2019/07/06/Stitch/</id>
    <published>2019-07-06T13:09:16.000Z</published>
    <updated>2019-07-06T13:10:19.048Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç¼–è¯‘è¿è¡Œï¼š"><a href="#ç¼–è¯‘è¿è¡Œï¼š" class="headerlink" title="ç¼–è¯‘è¿è¡Œï¼š"></a>ç¼–è¯‘è¿è¡Œï¼š</h3><p><strong>è¿è¡Œç¯å¢ƒ</strong>ï¼š</p><p><code>Ubuntu 18</code></p><p><strong>é“¾æ¥åº“ï¼š</strong></p><p><code>VLFeat</code>&amp;&amp;<code>CImg</code></p><p><strong>ç¼–è¯‘å‘½ä»¤ï¼š</strong></p><p><code>g++ -o test main.cpp ImageStitching.cpp ImageStitching.h -lpthread -l X11 -Lglnxa64/ -lvl -O3 -std=c++11</code></p><p>(linuxä¸‹ç¼–è¯‘æ¯”è¾ƒç®€å•ï¼Œåªéœ€å°†CImg.hæ–‡ä»¶å’Œç”¨åˆ°çš„vlåº“æ”¾åœ¨åŒç›®å½•ä¸‹ï¼Œä½†æ˜¯è¦å°†libvl.soæ·»åŠ åˆ°usrä¸‹çš„åŠ¨æ€é“¾æ¥åº“å†…)</p><h3 id="è¯»å…¥å›¾åƒï¼š"><a href="#è¯»å…¥å›¾åƒï¼š" class="headerlink" title="è¯»å…¥å›¾åƒï¼š"></a>è¯»å…¥å›¾åƒï¼š</h3><p>å°†ç›®å½•ä¸‹çš„å¤šå¼ å›¾ç‰‡è¯»å…¥ï¼Œè¿ç”¨äº†linuxç¯å¢ƒä¸‹æå–ç›®å½•æ–‡ä»¶çš„ä¸€ä¸ªç›®å½•æŒ‡é’ˆï¼Œç„¶åå›¾ç‰‡å­˜åœ¨äº†CImgListä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> *<span class="title">ptr</span>;</span></span><br><span class="line">DIR *dir;</span><br><span class="line">dir = opendir(<span class="string">"TEST-ImageData1"</span>);</span><br><span class="line"><span class="keyword">while</span> ((ptr = readdir(dir)) != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(ptr-&gt;d_name[<span class="number">0</span>] == <span class="string">'.'</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line"><span class="built_in">string</span> file = <span class="built_in">string</span>(<span class="string">"TEST-ImageData1/"</span>) + <span class="built_in">string</span>(ptr-&gt;d_name);</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; file &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *Ff = file.c_str();</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; picture;</span><br><span class="line">picture.load(Ff);</span><br><span class="line">imgs.push_back(picture);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŸ±é¢æŠ•å½±ï¼š"><a href="#æŸ±é¢æŠ•å½±ï¼š" class="headerlink" title="æŸ±é¢æŠ•å½±ï¼š"></a>æŸ±é¢æŠ•å½±ï¼š</h3><p>åœ¨å…¨æ™¯å›¾åƒä¸­ï¼Œç”±äºæ‘„åƒå¤´çš„æœå‘ä¸åŒï¼Œé‡åˆéƒ¨åˆ†éƒ¨åˆ†å›¾åƒä¸ä¸€å®šæ»¡è¶³è§†è§‰ä¸€è‡´æ€§çš„è¦æ±‚ï¼Œå› æ­¤å…ˆå¯¹å›¾åƒè¿›è¡ŒæŠ•å½±ï¼Œä½¿å…¶æ»¡è¶³è¦æ±‚ï¼Œä»¥ä¸ºåé¢çš„æ‹¼æ¥åšå‡†å¤‡ã€‚åœ¨ç¯å½¢å…¨æ™¯ä¸­ï¼Œä¸€èˆ¬é€‰æ‹©æŸ±é¢æŠ•å½±ç®—æ³•ï¼Œå°†å›¾åƒåˆ†åˆ«æŠ•å½±åˆ°ä»¥ åƒç´ ç„¦è·+æ‘„åƒå¤´ä¸åœ†å¿ƒè·ç¦» ä¸ºåŠå¾„çš„åœ†æŸ±ä¸Šã€‚æŠ•å½±åçš„å›¾åƒä¸ºä¸Šå›¾æ‘„åƒå¤´å‰æ–¹çš„åœ†å¼§ã€‚ä»åœ†å¼§ä¸Šçœ‹ï¼Œå›¾åƒçš„é‡åˆéƒ¨åˆ†å·²ç»æ»¡è¶³è§†è§‰ä¸€è‡´æ€§çš„è¦æ±‚ ã€‚</p><p><img src="https://img-blog.csdn.net/20160201195938321" alt="img"></p><p><strong>åœ†æŸ±é¢åæ ‡è½¬æ¢çš„å…¬å¼ä¸ºï¼š</strong><br>$$<br>x = \frac{xâ€™-\frac{W}{2}}{k}+\frac{W}{2}=\frac{(xâ€™-\frac{W}{2})\sqrt{R^2+(x-\frac{W}{2})^2}}{R}+\frac{W}{2}<br>$$</p><p>$$<br>y = \frac{yâ€™-\frac{H}{2}}{k}+\frac{H}{2}=\frac{(yâ€™-\frac{H}{2})\sqrt{R^2+(x-\frac{W}{2})^2}}{R}+\frac{H}{2}<br>$$</p><p>å¯ä»¥æ³¨æ„åˆ°æŠŠxå’Œyå†™åœ¨äº†ç­‰å¼çš„å·¦è¾¹è€Œxâ€™,yâ€™å†™åœ¨äº†å³è¾¹ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†æ–¹ä¾¿è¿›è¡Œæ’å€¼è®¡ç®— ã€‚æŠ•å½±åçš„å›¾åƒç‚¹åæ ‡æœªå¿…ä¸ºæ•´æ•°ï¼Œè€Œå›¾åƒçš„åæ ‡éœ€è¦ä¸ºæ•´æ•°ï¼Œæ‰€ä»¥å¿…å°†é€ æˆè¯¯å·® ã€‚ä¸ºäº†å‡å°‘è¿™ç§è¯¯å·®ï¼Œæˆ‘ä»¬å¯¹åæ ‡ç‚¹è¿›è¡ŒåŒçº¿æ€§æ’å€¼ã€‚</p><p>å…¶ä¸­åŠå¾„Rçš„å€¼: <strong>R = W / (2*tan(Î±/2))</strong>ï¼ŒÎ±çš„å–å€¼ä¸€èˆ¬ä¸ºç›¸æœºè§†åœºè§’åº¦ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CImg&lt;<span class="keyword">float</span>&gt; ImageStitching::CylindricalProjection(CImg&lt;<span class="keyword">float</span>&gt; pic) &#123;</span><br><span class="line">    <span class="keyword">int</span> width = pic._width;</span><br><span class="line">    <span class="keyword">int</span> height = pic._height;</span><br><span class="line">    <span class="keyword">int</span> channel = pic._spectrum;</span><br><span class="line">    CImg&lt;<span class="keyword">float</span>&gt; result(width, height, <span class="number">1</span>, channel, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">float</span>  R = width / (<span class="number">2</span>*<span class="built_in">tan</span>(<span class="number">28.0f</span>/<span class="number">2.0f</span>*PI/<span class="number">180.0f</span>));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; width; x++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; height; y++) &#123;</span><br><span class="line">            <span class="keyword">float</span> x0 = x - (<span class="keyword">float</span>)(width / <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">float</span> y0 = y - (<span class="keyword">float</span>) (height/<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">float</span> _x = x0*<span class="built_in">sqrt</span>(R*R + x0*x0) / R + (<span class="keyword">float</span>) width / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">float</span> _y = y0*<span class="built_in">sqrt</span>(R*R + x0*x0) / R + (<span class="keyword">float</span>) height / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (_x &gt;= <span class="number">0</span> &amp;&amp; _x &lt; width &amp;&amp; _y &gt;=<span class="number">0</span> &amp;&amp; _y &lt;= height) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">0</span>;  c &lt; channel; c++) &#123;</span><br><span class="line">                    result(x,y,c) = Interpolation(pic,_x,_y,c);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å°†å›¾åƒç”±RGBç©ºé—´è½¬ä¸ºç°åº¦ç©ºé—´ï¼š"><a href="#å°†å›¾åƒç”±RGBç©ºé—´è½¬ä¸ºç°åº¦ç©ºé—´ï¼š" class="headerlink" title="å°†å›¾åƒç”±RGBç©ºé—´è½¬ä¸ºç°åº¦ç©ºé—´ï¼š"></a>å°†å›¾åƒç”±RGBç©ºé—´è½¬ä¸ºç°åº¦ç©ºé—´ï¼š</h3><p>è¿™ä¸€æ­¥æ˜¯ä¸ºäº†ä¸‹é¢çš„siftç®—æ³•åšé“ºå«ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CImg&lt;<span class="keyword">float</span>&gt; ImageStitching::convertTogray(CImg&lt;<span class="keyword">float</span>&gt; pic) &#123;</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; picture(pic._width, pic._height, <span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">cimg_forXY(pic,x,y) &#123;</span><br><span class="line"><span class="keyword">float</span> R = pic(x,y,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">float</span> G = pic(x,y,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">float</span> B = pic(x,y,<span class="number">2</span>);</span><br><span class="line">picture(x,y) =  R*<span class="number">0.299</span> + G*<span class="number">0.587</span> + B*<span class="number">0.114</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> picture;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SIFTç®—æ³•æŸ¥æ‰¾ç‰¹å¾ç‚¹"><a href="#SIFTç®—æ³•æŸ¥æ‰¾ç‰¹å¾ç‚¹" class="headerlink" title="SIFTç®—æ³•æŸ¥æ‰¾ç‰¹å¾ç‚¹"></a>SIFTç®—æ³•æŸ¥æ‰¾ç‰¹å¾ç‚¹</h3><p>SIFTç®—æ³•çš„å®è´¨æ˜¯åœ¨ä¸åŒå°ºåº¦ç©ºé—´ä¸ŠæŸ¥æ‰¾å…³é”®ç‚¹(ç‰¹å¾ç‚¹)ï¼Œå¹¶è®¡ç®—å…³é”®ç‚¹æ–¹å‘ã€‚SIFTæ‰€æŸ¥æ‰¾çš„å…³é”®ç‚¹æ˜¯ä¸€äº›ååˆ†çªå‡ºï¼Œä¸ä¼šå› å…‰ç…§ï¼Œä»¿å°„å˜æ¢å’Œå™ªéŸ³ç­‰å› ç´ è€Œå˜åŒ–çš„ç‚¹ï¼Œä¾‹å¦‚è§’ç‚¹ã€è¾¹ç¼˜ç‚¹ã€æš—åŒºçš„äº®ç‚¹ä»¥åŠäº®åŒºçš„æš—ç‚¹ã€‚</p><p>ç®—æ³•ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å››æ­¥ï¼š</p><ol><li><strong>å°ºåº¦ç©ºé—´æå€¼æ£€æµ‹</strong>ï¼šæœç´¢æ‰€æœ‰å°ºåº¦ä¸Šçš„å›¾åƒä½ç½®ã€‚é€šè¿‡é«˜æ–¯å¾®åˆ†å‡½æ•°æ¥è¯†åˆ«æ½œåœ¨çš„å¯¹äºå°ºåº¦å’Œæ—‹è½¬ä¸å˜çš„å…´è¶£ç‚¹ã€‚</li><li><strong>å…³é”®ç‚¹å®šä½ï¼š</strong>åœ¨æ¯ä¸ªå€™é€‰ä½ç½®ä¸Šï¼Œé€šè¿‡ä¸€ä¸ªæ‹Ÿåˆç²¾ç»†çš„æ¨¡å‹æ¥ç¡®å®šä½ç½®å’Œå°ºåº¦ã€‚å…³é”®ç‚¹çš„é€‰æ‹©ä¾æ®å®ƒä»¬çš„ç¨³å®šç¨‹åº¦ã€‚</li><li><strong>æ–¹å‘ç¡®å®šï¼š</strong>åŸºäºå›¾åƒå±€éƒ¨æ¢¯åº¦æ–¹å‘ï¼Œåˆ†é…ç»™æ¯ä¸ªå…³é”®ç‚¹ä½ç½®ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹å‘ã€‚æ‰€æœ‰åé¢çš„å¯¹å›¾åƒæ•°æ®çš„æ“ä½œéƒ½ç›¸å¯¹äºå…³é”®ç‚¹çš„æ–¹å‘ï¼Œå°ºåº¦å’Œä½ç½®è¿›è¡Œå˜æ¢ã€‚</li><li><strong>å…³é”®ç‚¹æè¿°ï¼š</strong>åœ¨æ¯ä¸ªå…³é”®ç‚¹å‘¨å›´çš„é‚»åŸŸå†…ï¼Œåœ¨é€‰å®šçš„å°ºåº¦ä¸Šæµ‹é‡å›¾åƒå±€éƒ¨çš„æ¢¯åº¦ã€‚è¿™äº›æ¢¯åº¦è¢«å˜æ¢æˆä¸€ç§è¡¨ç¤ºï¼Œè¿™ç§è¡¨ç¤ºå…è®¸æ¯”è¾ƒå¤§çš„å±€éƒ¨å½¢çŠ¶çš„å˜å½¢å’Œå…‰ç…§å˜åŒ–ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">map</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt;, VlSiftKeypoint&gt; ImageStitching::SIFTFeatures(CImg&lt;<span class="keyword">float</span>&gt; pic) &#123;</span><br><span class="line">    <span class="keyword">int</span> noctaves = <span class="number">4</span>, nlevels = <span class="number">2</span>, o_min = <span class="number">0</span>;</span><br><span class="line">    vl_sift_pix *ImageData = <span class="keyword">new</span> vl_sift_pix[pic._width*pic._height];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pic._width; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; pic._height; j++) &#123;</span><br><span class="line">            ImageData[j*pic._width + i] = pic(i,j,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å®šä¹‰VlSiftFiltç»“æ„ä½“æŒ‡é’ˆ</span></span><br><span class="line">VlSiftFilt *SiftFilt = <span class="literal">NULL</span>;</span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„siftæ»¤æ³¢å™¨</span></span><br><span class="line">SiftFilt = vl_sift_new(pic._width, pic._height, noctaves, nlevels, o_min);</span><br><span class="line">    <span class="comment">//int KeyPoint = 0;</span></span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt;, VlSiftKeypoint&gt; Feature;</span><br><span class="line">    <span class="keyword">if</span> (vl_sift_process_first_octave(SiftFilt, ImageData) != VL_ERR_EOF) &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">//è®¡ç®—æ¯ç»„ä¸­çš„å…³é”®ç‚¹</span></span><br><span class="line">            vl_sift_detect(SiftFilt);</span><br><span class="line"><span class="comment">//éå†å¹¶ç»˜åˆ¶æ¯ä¸ªç‚¹  </span></span><br><span class="line"><span class="comment">//KeyPoint += SiftFilt-&gt;nkeys;//æ£€æµ‹åˆ°çš„å…³é”®ç‚¹çš„æ•°ç›®</span></span><br><span class="line">            VlSiftKeypoint *pKeyPoint = SiftFilt-&gt;keys;<span class="comment">//æ£€æµ‹åˆ°çš„å…³é”®ç‚¹</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;SiftFilt-&gt;nkeys; i++) &#123;</span><br><span class="line">                VlSiftKeypoint tempKeyPoint = *pKeyPoint;</span><br><span class="line">                pKeyPoint++;</span><br><span class="line">                <span class="keyword">double</span> angles[<span class="number">4</span>];</span><br><span class="line"><span class="keyword">int</span> angleCount = vl_sift_calc_keypoint_orientations(SiftFilt, angles, &amp;tempKeyPoint);<span class="comment">//è®¡ç®—å…³é”®ç‚¹çš„æ–¹å‘</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;angleCount; j++) &#123;</span><br><span class="line">                    <span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt; Descriptor;</span><br><span class="line">                    <span class="keyword">double</span> tempAngle = angles[j];</span><br><span class="line">vl_sift_pix descriptors[<span class="number">128</span>];</span><br><span class="line"><span class="comment">// è®¡ç®—æ¯ä¸ªæ–¹å‘çš„æè¿°</span></span><br><span class="line">vl_sift_calc_keypoint_descriptor(SiftFilt, descriptors, &amp;tempKeyPoint, tempAngle);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">128</span> ;k++) &#123;</span><br><span class="line">                        Descriptor.push_back(descriptors[k]);</span><br><span class="line">                    &#125;</span><br><span class="line">                    Feature.insert(pair&lt;<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt;, VlSiftKeypoint&gt;(Descriptor, tempKeyPoint));</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//ä¸‹ä¸€é˜¶  </span></span><br><span class="line"><span class="keyword">if</span> (vl_sift_process_next_octave(SiftFilt) == VL_ERR_EOF)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//free(pKeyPoint);  </span></span><br><span class="line"><span class="comment">//KeyPoint = NULL;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    vl_sift_delete(SiftFilt);</span><br><span class="line"><span class="keyword">delete</span>[]ImageData;</span><br><span class="line">ImageData = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> Feature;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="K-d-Treeæœ€è¿‘é‚»æœç´¢è¿›è¡Œç‰¹å¾ç‚¹åŒ¹é…ï¼š"><a href="#K-d-Treeæœ€è¿‘é‚»æœç´¢è¿›è¡Œç‰¹å¾ç‚¹åŒ¹é…ï¼š" class="headerlink" title="K-d Treeæœ€è¿‘é‚»æœç´¢è¿›è¡Œç‰¹å¾ç‚¹åŒ¹é…ï¼š"></a>K-d Treeæœ€è¿‘é‚»æœç´¢è¿›è¡Œç‰¹å¾ç‚¹åŒ¹é…ï¼š</h3><h4 id="k-dæ ‘ç®—æ³•å¯ä»¥åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯æœ‰å…³k-dæ ‘æœ¬èº«è¿™ç§æ•°æ®ç»“æ„å»ºç«‹çš„ç®—æ³•ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯åœ¨å»ºç«‹çš„k-dæ ‘ä¸Šå¦‚ä½•è¿›è¡Œæœ€é‚»è¿‘æŸ¥æ‰¾çš„ç®—æ³•ã€‚"><a href="#k-dæ ‘ç®—æ³•å¯ä»¥åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯æœ‰å…³k-dæ ‘æœ¬èº«è¿™ç§æ•°æ®ç»“æ„å»ºç«‹çš„ç®—æ³•ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯åœ¨å»ºç«‹çš„k-dæ ‘ä¸Šå¦‚ä½•è¿›è¡Œæœ€é‚»è¿‘æŸ¥æ‰¾çš„ç®—æ³•ã€‚" class="headerlink" title="k-dæ ‘ç®—æ³•å¯ä»¥åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯æœ‰å…³k-dæ ‘æœ¬èº«è¿™ç§æ•°æ®ç»“æ„å»ºç«‹çš„ç®—æ³•ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯åœ¨å»ºç«‹çš„k-dæ ‘ä¸Šå¦‚ä½•è¿›è¡Œæœ€é‚»è¿‘æŸ¥æ‰¾çš„ç®—æ³•ã€‚"></a>k-dæ ‘ç®—æ³•å¯ä»¥åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯æœ‰å…³k-dæ ‘æœ¬èº«è¿™ç§æ•°æ®ç»“æ„å»ºç«‹çš„ç®—æ³•ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯åœ¨å»ºç«‹çš„k-dæ ‘ä¸Šå¦‚ä½•è¿›è¡Œæœ€é‚»è¿‘æŸ¥æ‰¾çš„ç®—æ³•ã€‚</h4><p><strong>æ„å»ºk-dæ ‘ï¼š</strong></p><p>æ„é€ kdæ ‘çš„æ–¹æ³•ï¼šé¦–å…ˆæ„é€ æ ¹èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹å¯¹åº”äºæ•´ä¸ªkç»´ç©ºé—´ï¼ŒåŒ…å«æ‰€æœ‰çš„å®ä¾‹ç‚¹ï¼Œï¼ˆè‡³äºå¦‚ä½•é€‰å–åˆ’åˆ†ç‚¹ï¼Œæœ‰ä¸åŒçš„ç­–ç•¥ã€‚æœ€å¸¸ç”¨çš„æ˜¯ä¸€ç§æ–¹æ³•æ˜¯ï¼šå¯¹äºæ‰€æœ‰çš„æ ·æœ¬ç‚¹ï¼Œç»Ÿè®¡å®ƒä»¬åœ¨æ¯ä¸ªç»´ä¸Šçš„æ–¹å·®ï¼ŒæŒ‘é€‰å‡ºæ–¹å·®ä¸­çš„æœ€å¤§å€¼ï¼Œå¯¹åº”çš„ç»´å°±æ˜¯è¦è¿›è¡Œæ•°æ®åˆ‡åˆ†çš„ç»´åº¦ã€‚æ•°æ®æ–¹å·®æœ€å¤§è¡¨æ˜æ²¿è¯¥ç»´åº¦æ•°æ®ç‚¹åˆ†æ•£å¾—æ¯”è¾ƒå¼€ï¼Œè¿™ä¸ªæ–¹å‘ä¸Šè¿›è¡Œæ•°æ®åˆ†å‰²å¯ä»¥è·å¾—æœ€å¥½çš„åˆ†è¾¨ç‡ï¼›ç„¶åå†å°†æ‰€æœ‰æ ·æœ¬ç‚¹æŒ‰åˆ‡åˆ†ç»´åº¦çš„å€¼è¿›è¡Œæ’åºï¼Œä½äºæ­£ä¸­é—´çš„é‚£ä¸ªæ•°æ®ç‚¹é€‰ä¸ºåˆ†è£‚ç»“ç‚¹ã€‚ï¼‰ã€‚ç„¶ååˆ©ç”¨é€’å½’çš„æ–¹æ³•ï¼Œåˆ†åˆ«æ„é€ k-dæ ‘æ ¹èŠ‚ç‚¹çš„å·¦å³å­æ ‘ã€‚åœ¨è¶…çŸ©å½¢åŒºåŸŸä¸Šé€‰æ‹©ä¸€ä¸ªåæ ‡è½´ï¼ˆåˆ‡åˆ†ç»´åº¦ï¼‰å’Œä¸€ä¸ªåˆ†è£‚ç»“ç‚¹ï¼Œä»¥é€šè¿‡æ­¤åˆ†è£‚ç»“ç‚¹ä¸”å‚ç›´äºåˆ‡åˆ†æ–¹å‘åæ ‡è½´çš„ç›´çº¿ä½œä¸ºåˆ†éš”çº¿ï¼Œå°†å½“å‰è¶…çŸ©å½¢åŒºåŸŸåˆ†éš”æˆå·¦å³æˆ–è€…ä¸Šä¸‹ä¸¤ä¸ªå­è¶…çŸ©å½¢åŒºåŸŸï¼Œå¯¹åº”äºåˆ†è£‚ç»“ç‚¹çš„å·¦å³å­æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚å®ä¾‹ä¹Ÿå°±è¢«åˆ†åˆ°ä¸¤ä¸ªä¸ç›¸äº¤çš„åŒºåŸŸä¸­ã€‚é‡å¤æ­¤è¿‡ç¨‹ç›´åˆ°å­åŒºåŸŸå†…æ²¡æœ‰å®ä¾‹ç‚¹æ—¶ç»ˆæ­¢ã€‚ç»ˆæ­¢æ—¶çš„ç»“ç‚¹ä¸ºå¶ç»“ç‚¹ã€‚</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ç®—æ³•ï¼šcreateKDTree æ„å»ºä¸€æ£µk-d tree </span><br><span class="line"> </span><br><span class="line">è¾“å…¥ï¼šexm_<span class="keyword">set</span> æ ·æœ¬é›† </span><br><span class="line"> </span><br><span class="line">è¾“å‡º : Kd, ç±»å‹ä¸ºkd-tree </span><br><span class="line"> </span><br><span class="line">1. å¦‚æœexm_<span class="keyword">set</span>æ˜¯ç©ºçš„ï¼Œåˆ™è¿”å›ç©ºçš„kd-tree </span><br><span class="line"> </span><br><span class="line">2.è°ƒç”¨åˆ†è£‚ç»“ç‚¹é€‰æ‹©ç¨‹åºï¼ˆè¾“å…¥æ˜¯exm_<span class="keyword">set</span>ï¼‰ï¼Œè¿”å›ä¸¤ä¸ªå€¼ </span><br><span class="line"> </span><br><span class="line">       dom_elt:= exm_<span class="keyword">set</span>ä¸­çš„ä¸€ä¸ªæ ·æœ¬ç‚¹ </span><br><span class="line"> </span><br><span class="line">       split := åˆ†è£‚ç»´çš„åºå· </span><br><span class="line"> </span><br><span class="line">3.exm_<span class="keyword">set</span>_left = &#123;exmâˆˆexm_<span class="keyword">set</span> â€“ dom_elt &amp;&amp; exm[split] &lt;= dom_elt[split]&#125; </span><br><span class="line"> </span><br><span class="line">   exm_<span class="keyword">set</span>_right = &#123;exmâˆˆexm_<span class="keyword">set</span> â€“ dom_elt &amp;&amp; exm[split] &gt; dom_elt[split]&#125; </span><br><span class="line"> </span><br><span class="line">4.left = createKDTree<span class="params">(exm_set_left)</span> </span><br><span class="line"> </span><br><span class="line">right = createKDTree<span class="params">(exm_set_right)</span></span><br></pre></td></tr></table></figure><p><strong>k-d treeæœ€è¿‘é‚»æœç´¢ç®—æ³•</strong></p><p>åœ¨k-d treeæ ‘ä¸­è¿›è¡Œæ•°æ®çš„kè¿‘é‚»æœç´¢æ˜¯ç‰¹å¾åŒ¹é…çš„é‡è¦ç¯èŠ‚ï¼Œå…¶ç›®çš„æ˜¯æ£€ç´¢åœ¨k-d treeä¸­ä¸å¾…æŸ¥è¯¢ç‚¹è·ç¦»æœ€è¿‘çš„kä¸ªæ•°æ®ç‚¹ã€‚</p><p> æœ€è¿‘é‚»æœç´¢æ˜¯kè¿‘é‚»çš„ç‰¹ä¾‹ï¼Œä¹Ÿå°±æ˜¯1è¿‘é‚»ã€‚å°†1è¿‘é‚»æ”¹æ‰©å±•åˆ°kè¿‘é‚»éå¸¸å®¹æ˜“ã€‚ä¸‹é¢ä»‹ç»æœ€ç®€å•çš„k-d treeæœ€è¿‘é‚»æœç´¢ç®—æ³•ã€‚</p><p>åŸºæœ¬çš„æ€è·¯å¾ˆç®€å•ï¼šé¦–å…ˆé€šè¿‡äºŒå‰æ ‘æœç´¢ï¼ˆæ¯”è¾ƒå¾…æŸ¥è¯¢èŠ‚ç‚¹å’Œåˆ†è£‚èŠ‚ç‚¹çš„åˆ†è£‚ç»´çš„å€¼ï¼Œå°äºç­‰äºå°±è¿›å…¥å·¦å­æ ‘åˆ†æ”¯ï¼Œç­‰äºå°±è¿›å…¥å³å­æ ‘åˆ†æ”¯ç›´åˆ°å¶å­ç»“ç‚¹ï¼‰ï¼Œé¡ºç€â€œæœç´¢è·¯å¾„â€å¾ˆå¿«èƒ½æ‰¾åˆ°æœ€è¿‘é‚»çš„è¿‘ä¼¼ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä¸å¾…æŸ¥è¯¢ç‚¹å¤„äºåŒä¸€ä¸ªå­ç©ºé—´çš„å¶å­ç»“ç‚¹ï¼›ç„¶åå†å›æº¯æœç´¢è·¯å¾„ï¼Œå¹¶åˆ¤æ–­æœç´¢è·¯å¾„ä¸Šçš„ç»“ç‚¹çš„å…¶ä»–å­ç»“ç‚¹ç©ºé—´ä¸­æ˜¯å¦å¯èƒ½æœ‰è·ç¦»æŸ¥è¯¢ç‚¹æ›´è¿‘çš„æ•°æ®ç‚¹ï¼Œå¦‚æœæœ‰å¯èƒ½ï¼Œåˆ™éœ€è¦è·³åˆ°å…¶ä»–å­ç»“ç‚¹ç©ºé—´ä¸­å»æœç´¢ï¼ˆå°†å…¶ä»–å­ç»“ç‚¹åŠ å…¥åˆ°æœç´¢è·¯å¾„ï¼‰ã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°æœç´¢è·¯å¾„ä¸ºç©ºã€‚ä¸‹é¢æ˜¯k-d treeæœ€è¿‘é‚»æœç´¢çš„ä¼ªä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">ç®—æ³•ï¼škdtreeFindNearest <span class="comment">/* k-d treeçš„æœ€è¿‘é‚»æœç´¢ */</span> </span><br><span class="line"> </span><br><span class="line">è¾“å…¥ï¼šKd <span class="comment">/* k-d treeç±»å‹*/</span>  </span><br><span class="line">target <span class="comment">/* å¾…æŸ¥è¯¢æ•°æ®ç‚¹ */</span> </span><br><span class="line"> </span><br><span class="line">è¾“å‡º : nearest <span class="comment">/* æœ€è¿‘é‚»æ•°æ®ç»“ç‚¹ */</span> </span><br><span class="line">dist <span class="comment">/* æœ€è¿‘é‚»å’ŒæŸ¥è¯¢ç‚¹çš„è·ç¦» */</span> </span><br><span class="line"> </span><br><span class="line"><span class="number">1.</span> å¦‚æœKdæ˜¯ç©ºçš„ï¼Œåˆ™è®¾distä¸ºæ— ç©·å¤§è¿”å› </span><br><span class="line"><span class="number">2.</span> å‘ä¸‹æœç´¢ç›´åˆ°å¶å­ç»“ç‚¹ </span><br><span class="line">pSearch = &amp;Kd </span><br><span class="line"><span class="keyword">while</span>(pSearch != <span class="literal">NULL</span>)  </span><br><span class="line">&#123;  </span><br><span class="line">pSearchåŠ å…¥åˆ°search_pathä¸­;  </span><br><span class="line"><span class="keyword">if</span>(target[pSearch-&gt;split] &lt;= pSearch-&gt;dom_elt[pSearch-&gt;split]) <span class="comment">/* å¦‚æœå°äºå°±è¿›å…¥å·¦å­æ ‘ */</span>  </span><br><span class="line">&#123;  </span><br><span class="line">pSearch = pSearch-&gt;left;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">else</span>  </span><br><span class="line">&#123;  </span><br><span class="line">pSearch = pSearch-&gt;right;  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;  </span><br><span class="line">å–å‡ºsearch_pathæœ€åä¸€ä¸ªèµ‹ç»™nearest  </span><br><span class="line">dist = Distance(nearest, target);  </span><br><span class="line"><span class="number">3.</span> å›æº¯æœç´¢è·¯å¾„ </span><br><span class="line"><span class="keyword">while</span>(search_pathä¸ä¸ºç©º)  </span><br><span class="line">&#123;  </span><br><span class="line">å–å‡ºsearch_pathæœ€åä¸€ä¸ªç»“ç‚¹èµ‹ç»™pBack  </span><br><span class="line"><span class="keyword">if</span>(pBack-&gt;leftä¸ºç©º &amp;&amp; pBack-&gt;rightä¸ºç©º) <span class="comment">/* å¦‚æœpBackä¸ºå¶å­ç»“ç‚¹ */</span> </span><br><span class="line">&#123; </span><br><span class="line"><span class="keyword">if</span>( Distance(nearest, target) &gt; Distance(pBack-&gt;dom_elt, target) )  </span><br><span class="line">&#123;  </span><br><span class="line">nearest = pBack-&gt;dom_elt;  </span><br><span class="line">dist = Distance(pBack-&gt;dom_elt, target);  </span><br><span class="line">&#125; </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123; </span><br><span class="line">s = pBack-&gt;split;  </span><br><span class="line"><span class="keyword">if</span>( <span class="built_in">abs</span>(pBack-&gt;dom_elt[s] - target[s]) &lt; dist) <span class="comment">/* å¦‚æœä»¥targetä¸ºä¸­å¿ƒçš„åœ†ï¼ˆçƒæˆ–è¶…çƒï¼‰ï¼ŒåŠå¾„ä¸ºdistçš„åœ†ä¸åˆ†å‰²è¶…å¹³é¢ç›¸äº¤ï¼Œ é‚£ä¹ˆå°±è¦è·³åˆ°å¦ä¸€è¾¹çš„å­ç©ºé—´å»æœç´¢ */</span>  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="keyword">if</span>( Distance(nearest, target) &gt; Distance(pBack-&gt;dom_elt, target) )  </span><br><span class="line">&#123;  </span><br><span class="line">nearest = pBack-&gt;dom_elt;  </span><br><span class="line">dist = Distance(pBack-&gt;dom_elt, target);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">if</span>(target[s] &lt;= pBack-&gt;dom_elt[s]) <span class="comment">/* å¦‚æœtargetä½äºpBackçš„å·¦å­ç©ºé—´ï¼Œé‚£ä¹ˆå°±è¦è·³åˆ°å³å­ç©ºé—´å»æœç´¢ */</span>  </span><br><span class="line">pSearch = pBack-&gt;right;  </span><br><span class="line"><span class="keyword">else</span>  </span><br><span class="line">pSearch = pBack-&gt;left; <span class="comment">/* å¦‚æœtargetä½äºpBackçš„å³å­ç©ºé—´ï¼Œé‚£ä¹ˆå°±è¦è·³åˆ°å·¦å­ç©ºé—´å»æœç´¢ */</span>  </span><br><span class="line"><span class="keyword">if</span>(pSearch != <span class="literal">NULL</span>)  </span><br><span class="line">pSearchåŠ å…¥åˆ°search_pathä¸­  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ©ç”¨VLFeatå®ç°k-d treeç®—æ³•çš„ä»£ç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;point_pair&gt; ImageStitching::KDtreeMatch(<span class="built_in">map</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt;, VlSiftKeypoint&gt; feature_a, <span class="built_in">map</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt;, VlSiftKeypoint&gt; feature_b) &#123;</span><br><span class="line"><span class="built_in">vector</span>&lt;point_pair&gt; result;</span><br><span class="line"></span><br><span class="line">    VlKDForest* forest = vl_kdforest_new(VL_TYPE_FLOAT, <span class="number">128</span>, <span class="number">1</span>, VlDistanceL1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">float</span> *data = <span class="keyword">new</span> <span class="keyword">float</span>[<span class="number">128</span> * feature_a.size()];</span><br><span class="line"><span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> it = feature_a.begin(); it != feature_a.end(); it++) &#123;</span><br><span class="line"><span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt; &amp;descriptors = it-&gt;first;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">128</span>; i++) &#123;</span><br><span class="line">data[i + <span class="number">128</span> * k] = descriptors[i];</span><br><span class="line">&#125;</span><br><span class="line">k++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vl_kdforest_build(forest, feature_a.size(), data);</span><br><span class="line">VlKDForestSearcher* searcher = vl_kdforest_new_searcher(forest);</span><br><span class="line">VlKDForestNeighbor neighbours[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> it = feature_b.begin(); it != feature_b.end(); it++)&#123;</span><br><span class="line"><span class="keyword">float</span> *temp_data = <span class="keyword">new</span> <span class="keyword">float</span>[<span class="number">128</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">128</span>; i++) &#123;</span><br><span class="line">temp_data[i] = (it-&gt;first)[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> nvisited = vl_kdforestsearcher_query(searcher, neighbours, <span class="number">2</span>, temp_data);</span><br><span class="line"></span><br><span class="line"><span class="keyword">float</span> ratio = neighbours[<span class="number">0</span>].distance / neighbours[<span class="number">1</span>].distance;</span><br><span class="line"><span class="keyword">if</span> (ratio &lt; <span class="number">0.5</span>) &#123;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt; des(<span class="number">128</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">128</span>; j++) &#123;</span><br><span class="line">des[j] = data[j + neighbours[<span class="number">0</span>].index * <span class="number">128</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">VlSiftKeypoint left = feature_a.find(des)-&gt;second;</span><br><span class="line">VlSiftKeypoint right = it-&gt;second;</span><br><span class="line">result.push_back(point_pair(left, right));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span>[] temp_data;</span><br><span class="line">temp_data = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vl_kdforestsearcher_delete(searcher);</span><br><span class="line">vl_kdforest_delete(forest);</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span>[] data;</span><br><span class="line">data = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="RANSACç­›é€‰å‡ºç‰¹å¾åŒ¹é…ç‚¹ï¼š"><a href="#RANSACç­›é€‰å‡ºç‰¹å¾åŒ¹é…ç‚¹ï¼š" class="headerlink" title="RANSACç­›é€‰å‡ºç‰¹å¾åŒ¹é…ç‚¹ï¼š"></a>RANSACç­›é€‰å‡ºç‰¹å¾åŒ¹é…ç‚¹ï¼š</h3><p><strong>RANSACç®—æ³•åœ¨SIFTç‰¹å¾ç­›é€‰ä¸­çš„ä¸»è¦æµç¨‹æ˜¯ï¼š</strong></p><p>(1) ä»æ ·æœ¬é›†ä¸­éšæœºæŠ½é€‰ä¸€ä¸ªRANSACæ ·æœ¬ï¼Œå³4ä¸ªåŒ¹é…ç‚¹å¯¹</p><p>(2) æ ¹æ®è¿™4ä¸ªåŒ¹é…ç‚¹å¯¹è®¡ç®—å˜æ¢çŸ©é˜µM</p><p>(3) æ ¹æ®æ ·æœ¬é›†ï¼Œå˜æ¢çŸ©é˜µMï¼Œå’Œè¯¯å·®åº¦é‡å‡½æ•°è®¡ç®—æ»¡è¶³å½“å‰å˜æ¢çŸ©é˜µçš„ä¸€è‡´é›†consensusï¼Œå¹¶è¿”å›ä¸€è‡´é›†ä¸­å…ƒç´ ä¸ªæ•°</p><p>(4) æ ¹æ®å½“å‰ä¸€è‡´é›†ä¸­å…ƒç´ ä¸ªæ•°åˆ¤æ–­æ˜¯å¦æœ€ä¼˜(æœ€å¤§)ä¸€è‡´é›†ï¼Œè‹¥æ˜¯åˆ™æ›´æ–°å½“å‰æœ€ä¼˜ä¸€è‡´é›†</p><p>(5) æ›´æ–°å½“å‰é”™è¯¯æ¦‚ç‡pï¼Œè‹¥på¤§äºå…è®¸çš„æœ€å°é”™è¯¯æ¦‚ç‡åˆ™é‡å¤(1)è‡³(4)ç»§ç»­è¿­ä»£ï¼Œç›´åˆ°å½“å‰é”™è¯¯æ¦‚ç‡på°äºæœ€å°é”™è¯¯æ¦‚ç‡</p><pre><code>![img](https://img-blog.csdn.net/20151208162540847)</code></pre><p> <strong>å…¶ä¸­ï¼Œpä¸ºç½®ä¿¡åº¦ï¼Œä¸€èˆ¬å–0.995ï¼›wä¸ºâ€å†…ç‚¹â€çš„æ¯”ä¾‹ ; mä¸ºè®¡ç®—æ¨¡å‹æ‰€éœ€è¦çš„æœ€å°‘æ ·æœ¬æ•°=4ï¼›</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">points ImageStitching::RANSAC(<span class="built_in">vector</span>&lt;point_pair&gt; pairs) &#123;</span><br><span class="line">srand(time(<span class="number">0</span>));</span><br><span class="line"><span class="keyword">int</span> iterations = <span class="built_in">ceil</span>(<span class="built_in">log</span>(<span class="number">1</span> - <span class="number">0.99</span>) / <span class="built_in">log</span>(<span class="number">1</span> - <span class="built_in">pow</span>(<span class="number">0.5</span>, <span class="number">4</span>)));</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; max_inliner_indexs;</span><br><span class="line"><span class="keyword">while</span> (iterations--) &#123;</span><br><span class="line"><span class="built_in">vector</span>&lt;point_pair&gt; random_pairs;</span><br><span class="line"><span class="built_in">set</span>&lt;<span class="keyword">int</span>&gt; seleted_indexs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line"><span class="keyword">int</span> index = rand() % pairs.size();</span><br><span class="line"><span class="keyword">while</span> (seleted_indexs.find(index) != seleted_indexs.end()) &#123;</span><br><span class="line">index = rand() % pairs.size();</span><br><span class="line">&#125;</span><br><span class="line">seleted_indexs.insert(index);</span><br><span class="line"></span><br><span class="line">random_pairs.push_back(pairs[index]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">points H = HomographyMatrix(random_pairs);</span><br><span class="line"><span class="comment">//cout &lt;&lt; H.x1 &lt;&lt; endl;</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; cur_inliner_indexs;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pairs.size(); i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (seleted_indexs.find(i) != seleted_indexs.end()) &#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">float</span> real_x = pairs[i].b.x;</span><br><span class="line"><span class="keyword">float</span> real_y = pairs[i].b.y;</span><br><span class="line"></span><br><span class="line"><span class="keyword">float</span> x = H.x1 * pairs[i].a.x + H.x2 * pairs[i].a.y + H.x3 * pairs[i].a.x * pairs[i].a.y + H.x4;</span><br><span class="line"><span class="keyword">float</span> y = H.x5 * pairs[i].a.x + H.x6 * pairs[i].a.y + H.x7 * pairs[i].a.x * pairs[i].a.y + H.x8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">float</span> distance = <span class="built_in">sqrt</span>((x - real_x) * (x - real_x) + (y - real_y) * (y - real_y));</span><br><span class="line"><span class="keyword">if</span> (distance &lt; <span class="number">4</span>) &#123;</span><br><span class="line">cur_inliner_indexs.push_back(i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (cur_inliner_indexs.size() &gt; max_inliner_indexs.size()) &#123;</span><br><span class="line">max_inliner_indexs = cur_inliner_indexs;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> calc_size = max_inliner_indexs.size();</span><br><span class="line"></span><br><span class="line">CImg&lt;<span class="keyword">double</span>&gt; A(<span class="number">4</span>, calc_size, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">CImg&lt;<span class="keyword">double</span>&gt; b(<span class="number">1</span>, calc_size, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; calc_size; i++) &#123;</span><br><span class="line"><span class="keyword">int</span> cur_index = max_inliner_indexs[i];</span><br><span class="line"></span><br><span class="line">A(<span class="number">0</span>, i) = pairs[cur_index].a.x;</span><br><span class="line">A(<span class="number">1</span>, i) = pairs[cur_index].a.y;</span><br><span class="line">A(<span class="number">2</span>, i) = pairs[cur_index].a.x * pairs[cur_index].a.y;</span><br><span class="line">A(<span class="number">3</span>, i) = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">b(<span class="number">0</span>, i) = pairs[cur_index].b.x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CImg&lt;<span class="keyword">double</span>&gt; x1 = b.get_solve(A);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; calc_size; i++) &#123;</span><br><span class="line"><span class="keyword">int</span> cur_index = max_inliner_indexs[i];</span><br><span class="line"></span><br><span class="line">b(<span class="number">0</span>, i) = pairs[cur_index].b.y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CImg&lt;<span class="keyword">double</span>&gt; x2 = b.get_solve(A);</span><br><span class="line"><span class="keyword">return</span> points(x1(<span class="number">0</span>, <span class="number">0</span>), x1(<span class="number">0</span>, <span class="number">1</span>), x1(<span class="number">0</span>, <span class="number">2</span>), x1(<span class="number">0</span>, <span class="number">3</span>), x2(<span class="number">0</span>, <span class="number">0</span>), x2(<span class="number">0</span>, <span class="number">1</span>), x2(<span class="number">0</span>, <span class="number">2</span>), x2(<span class="number">0</span>, <span class="number">3</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å›¾åƒæ‹¼æ¥ï¼š"><a href="#å›¾åƒæ‹¼æ¥ï¼š" class="headerlink" title="å›¾åƒæ‹¼æ¥ï¼š"></a>å›¾åƒæ‹¼æ¥ï¼š</h3><p>å…ˆæ˜¯è¿›è¡Œè¿›è¡Œæ‹·è´ï¼Œå°†ä¸€å‰¯å›¾åƒæŒ‰ç…§éœ€è¦æ‹¼æ¥çš„ç‚¹æ‹·è´åˆ°å¦ä¸€å¹…å›¾åƒä¸Šã€‚ä½†å¦‚æœæ˜¯ç›´æ¥æ‹¼æ¥çš„è¯å¯èƒ½ä¸¤å¹…å›¾åƒå¯¹æ¥ç‚¹æ˜¾å¾—å¾ˆä¸è‡ªç„¶ã€‚è¿™é‡Œä½¿ç”¨Cimgçš„æ»¤æ³¢å‡½æ•°è¿›è¡Œè¾¹ç¼˜çš„æ»¤æ³¢å¹³æ»‘ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">CImg&lt;<span class="keyword">float</span>&gt; ImageStitching::Blend(CImg&lt;<span class="keyword">float</span>&gt; pic1, CImg&lt;<span class="keyword">float</span>&gt; pic2) &#123;</span><br><span class="line"><span class="keyword">double</span> sum_a_x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">double</span> sum_a_y = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> a_n = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">double</span> sum_overlap_x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">double</span> sum_overlap_y = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> overlap_n = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (pic1.width() &gt; pic1.height()) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; pic1.width(); x++) &#123;</span><br><span class="line"><span class="keyword">if</span> (!IsBlack(pic1, x, pic1.height() / <span class="number">2</span>)) &#123;</span><br><span class="line">sum_a_x += x;</span><br><span class="line">a_n++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!IsBlack(pic1, x, pic1.height() / <span class="number">2</span>) &amp;&amp; !IsBlack(pic2, x, pic1.height() / <span class="number">2</span>)) &#123;</span><br><span class="line">sum_overlap_x += x;</span><br><span class="line">overlap_n++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; pic1.height(); y++) &#123;</span><br><span class="line"><span class="keyword">if</span> (!IsBlack(pic1, pic1.width() / <span class="number">2</span>, y)) &#123;</span><br><span class="line">sum_a_y += y;</span><br><span class="line">a_n++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!IsBlack(pic1, pic1.width() / <span class="number">2</span>, y) &amp;&amp; !IsBlack(pic2, pic2.width() / <span class="number">2</span>, y)) &#123;</span><br><span class="line">sum_overlap_y += y;</span><br><span class="line">overlap_n++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> min_len = (pic1.width() &lt; pic1.height()) ? pic1.width() : pic1.height();</span><br><span class="line"><span class="keyword">int</span> n_level = <span class="built_in">floor</span>(log2(min_len));</span><br><span class="line"><span class="built_in">vector</span>&lt;CImg&lt;<span class="keyword">float</span>&gt; &gt; a_pyramid(n_level);</span><br><span class="line"><span class="built_in">vector</span>&lt;CImg&lt;<span class="keyword">float</span>&gt; &gt; b_pyramid(n_level);</span><br><span class="line"><span class="built_in">vector</span>&lt;CImg&lt;<span class="keyword">float</span>&gt; &gt; mask(n_level);</span><br><span class="line"><span class="comment">// Initialize the base.</span></span><br><span class="line">a_pyramid[<span class="number">0</span>] = pic1;</span><br><span class="line">b_pyramid[<span class="number">0</span>] = pic2;</span><br><span class="line">mask[<span class="number">0</span>] = CImg&lt;<span class="keyword">float</span>&gt;(pic1.width(), pic1.height(), <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (pic1.width() &gt; pic1.height()) &#123;</span><br><span class="line"><span class="keyword">if</span> (sum_a_x / a_n &lt; sum_overlap_x / overlap_n) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; sum_overlap_x / overlap_n; x++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; pic1.height(); y++) &#123;</span><br><span class="line">mask[<span class="number">0</span>](x, y) = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> x = sum_overlap_x / overlap_n + <span class="number">1</span>; x &lt; pic1.width(); x++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; pic1.height(); y++) &#123;</span><br><span class="line">mask[<span class="number">0</span>](x, y) = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (sum_a_y / a_n &lt; sum_overlap_y / overlap_n) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; pic1.width(); x++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; sum_overlap_y / overlap_n; y++) &#123;</span><br><span class="line">mask[<span class="number">0</span>](x, y) = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; pic1.width(); x++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> y = sum_overlap_y / overlap_n; y &lt; pic1.height(); y++) &#123;</span><br><span class="line">mask[<span class="number">0</span>](x, y) = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Down sampling a and b, building Gaussian pyramids.</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n_level; i++) &#123;</span><br><span class="line">a_pyramid[i] = a_pyramid[i - <span class="number">1</span>].get_blur(<span class="number">2</span>).get_resize(a_pyramid[i - <span class="number">1</span>].width() / <span class="number">2</span>, a_pyramid[i - <span class="number">1</span>].height() / <span class="number">2</span>, <span class="number">1</span>, a_pyramid[i - <span class="number">1</span>].spectrum(), <span class="number">3</span>);</span><br><span class="line">b_pyramid[i] = b_pyramid[i - <span class="number">1</span>].get_blur(<span class="number">2</span>).get_resize(b_pyramid[i - <span class="number">1</span>].width() / <span class="number">2</span>, b_pyramid[i - <span class="number">1</span>].height() / <span class="number">2</span>, <span class="number">1</span>, b_pyramid[i - <span class="number">1</span>].spectrum(), <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">mask[i] = mask[i - <span class="number">1</span>].get_blur(<span class="number">2</span>).get_resize(mask[i - <span class="number">1</span>].width() / <span class="number">2</span>, mask[i - <span class="number">1</span>].height() / <span class="number">2</span>, <span class="number">1</span>, mask[i - <span class="number">1</span>].spectrum(), <span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Building Laplacian pyramids.</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n_level - <span class="number">1</span>; i++) &#123;</span><br><span class="line">a_pyramid[i] = a_pyramid[i] - a_pyramid[i + <span class="number">1</span>].get_resize(a_pyramid[i].width(), a_pyramid[i].height(), <span class="number">1</span>, a_pyramid[i].spectrum(), <span class="number">3</span>);</span><br><span class="line">b_pyramid[i] = b_pyramid[i] - b_pyramid[i + <span class="number">1</span>].get_resize(b_pyramid[i].width(), b_pyramid[i].height(), <span class="number">1</span>, b_pyramid[i].spectrum(), <span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;CImg&lt;<span class="keyword">float</span>&gt; &gt; blend_pyramid(n_level);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n_level; i++) &#123;</span><br><span class="line">blend_pyramid[i] = CImg&lt;<span class="keyword">float</span>&gt;(a_pyramid[i].width(), a_pyramid[i].height(), <span class="number">1</span>, a_pyramid[i].spectrum(), <span class="number">0</span>);</span><br><span class="line">cimg_forXYC(blend_pyramid[i], x, y, c) &#123;</span><br><span class="line">blend_pyramid[i](x, y, c) = a_pyramid[i](x, y, c) * mask[i](x, y) + b_pyramid[i](x, y, c) * (<span class="number">1.0</span> - mask[i](x, y));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; res = blend_pyramid[n_level - <span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = n_level - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">res.resize(blend_pyramid[i].width(), blend_pyramid[i].height(), <span class="number">1</span>, blend_pyramid[i].spectrum(), <span class="number">3</span>);</span><br><span class="line">cimg_forXYC(blend_pyramid[i], x, y, c) &#123;</span><br><span class="line">res(x, y, c) = blend_pyramid[i](x, y, c) + res(x, y, c);</span><br><span class="line"><span class="keyword">if</span> (res(x, y, c) &gt; <span class="number">255</span>) res(x, y, c) = <span class="number">255</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (res(x, y, c) &lt; <span class="number">0</span>) res(x, y, c) = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æœ€åå°è£…æˆç±»ï¼š"><a href="#æœ€åå°è£…æˆç±»ï¼š" class="headerlink" title="æœ€åå°è£…æˆç±»ï¼š"></a>æœ€åå°è£…æˆç±»ï¼š</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageStitching</span> &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">//æºå›¾åˆ—è¡¨</span></span><br><span class="line">    CImgList&lt;<span class="keyword">float</span>&gt; imgs;</span><br><span class="line">    <span class="comment">//æ‹¼æ¥åçš„å›¾åƒ</span></span><br><span class="line">    CImg&lt;<span class="keyword">float</span>&gt; resultImg;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">//æŸ±é¢æŠ•å½±</span></span><br><span class="line">    CImg&lt;<span class="keyword">float</span>&gt; CylindricalProjection(CImg&lt;<span class="keyword">float</span>&gt; pic);</span><br><span class="line">    <span class="comment">//å›¾åƒä»rgbç©ºé—´è½¬ä¸ºç°åº¦ç©ºé—´</span></span><br><span class="line">    CImg&lt;<span class="keyword">float</span>&gt; convertTogray(CImg&lt;<span class="keyword">float</span>&gt; pic);</span><br><span class="line">    <span class="comment">//æå–å›¾åƒä¸­çš„ç‰¹å¾ç‚¹</span></span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt;, VlSiftKeypoint&gt; SIFTFeatures(CImg&lt;<span class="keyword">float</span>&gt; pic);</span><br><span class="line">    <span class="comment">//k-dæ ‘è¿›è¡Œç‰¹å¾ç‚¹åŒ¹é…</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;point_pair&gt; KDtreeMatch(<span class="built_in">map</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt;, VlSiftKeypoint&gt; feature_a, <span class="built_in">map</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">float</span>&gt;, VlSiftKeypoint&gt; feature_b);</span><br><span class="line">    <span class="comment">//åˆ©ç”¨RANSACç®—æ³•æ±‚å•åº”çŸ©é˜µ</span></span><br><span class="line">    <span class="function">points <span class="title">RANSAC</span><span class="params">(<span class="built_in">vector</span>&lt;point_pair&gt; pairs)</span></span>;</span><br><span class="line">    <span class="comment">//é€šè¿‡å•åº”çŸ©é˜µæ‰­æ›²ä¸¤å¹…å›¾åƒå†…å®¹</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">WarpTwoImg</span><span class="params">(CImg&lt;<span class="keyword">float</span>&gt; src, CImg&lt;<span class="keyword">float</span>&gt; &amp;dst, points H, <span class="keyword">float</span> offset_x, <span class="keyword">float</span> offset_y)</span></span>;</span><br><span class="line">    <span class="comment">//ç§»åŠ¨ä¸¤å¹…å›¾åƒ</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">MoveTwoImg</span><span class="params">(CImg&lt;<span class="keyword">float</span>&gt; src, CImg&lt;<span class="keyword">float</span>&gt; &amp;dst, <span class="keyword">int</span> offset_x, <span class="keyword">int</span> offset_y)</span></span>;</span><br><span class="line">    <span class="comment">//å›¾åƒæ‹¼æ¥</span></span><br><span class="line">    CImg&lt;<span class="keyword">float</span>&gt; Blend(CImg&lt;<span class="keyword">float</span>&gt; pic1, CImg&lt;<span class="keyword">float</span>&gt; pic2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ImageStitching();</span><br><span class="line">    ~ImageStitching();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">StitchProcess</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="ç»“æœæ‹¼æ¥å‡ºçš„å›¾åƒï¼š"><a href="#ç»“æœæ‹¼æ¥å‡ºçš„å›¾åƒï¼š" class="headerlink" title="ç»“æœæ‹¼æ¥å‡ºçš„å›¾åƒï¼š"></a>ç»“æœæ‹¼æ¥å‡ºçš„å›¾åƒï¼š</h3><p><img src="https://img-blog.csdnimg.cn/20181209194726866.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20181209194741175.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="å®éªŒæ€»ç»“ï¼š"><a href="#å®éªŒæ€»ç»“ï¼š" class="headerlink" title="å®éªŒæ€»ç»“ï¼š"></a>å®éªŒæ€»ç»“ï¼š</h4><p>ç¨‹åºå¤æ‚åº¦è¿‡é«˜ï¼Œç¬¬äºŒç»„å›¾è·‘äº†åŠä¸ªå°æ—¶ï¼Œä¸è¿‡ä¹Ÿè·Ÿè‡ªå·±è™šæ‹Ÿæœºåˆ†é…çš„å†…å­˜å’Œå¤„ç†å™¨ä¸è¶³æœ‰å…³ã€‚ä»£ç è€Œè¨€ä¸€æ–¹é¢æ˜¯SIFTç®—æ³•æœ¬èº«å¤æ‚åº¦å°±æ¯”è¾ƒé«˜ï¼Œç½‘ä¸Šæœ‰æåˆ°SIFTçš„ç®€åŒ–ç‰ˆSURFçš„å¤æ‚åº¦ä¼šä½å¾ˆå¤šï¼Œå…¶æ¬¡è‡ªå·±åœ¨è¾¹ç¼˜å¤„çš„ä¸€äº›æ’å€¼ç®—æ³•ä»¥åŠå›¾åƒæ‹¼æ¥å¤„çš„å¹³æ»‘ç­‰ä¹Ÿå¤§å¤§æé«˜äº†ç®—æ³•å¤æ‚åº¦ã€‚æœ‰æ—¶é—´ä¹‹åä¼šæ€è€ƒå»æ”¹è¿›ä¸€ä¸‹ã€‚</p><p>å†å°±æ˜¯æœ€å¤§çš„ç¼ºç‚¹æ„Ÿè§‰æŸ±é¢æŠ•å½±æ—¶å›¾ç‰‡è¾¹ç¼˜å­˜åœ¨è®¸å¤šæ¯›åˆºï¼Œè¿™ä¸ªæœ¬æ¥ä»¥ä¸ºç”¨äº†æ’å€¼ç®—æ³•ä¼šå¤§å¤§å‡å°‘è¿™ç§åƒç´ ç‚¹ï¼Œç»“æœè¿˜æ˜¯çœ‹èµ·æ¥æ¯”è¾ƒæ˜æ˜¾ã€‚åŒæ—¶å›¾åƒæ¥åˆå¤„çš„ç”¨æ»¤æ³¢çš„æ•ˆæœæ„Ÿè§‰ä¸å¦‚å¼€å§‹ä½¿ç”¨opencvåº“å°è¯•çš„æ—¶å€™æº¶è§£æ•ˆæœå¥½ï¼Œåˆ°æ—¶ä¼šå»è¯»ä¸€ä¸‹opencvä¸­æº¶è§£çš„æºç äº†è§£ä¸€ä¸‹è¿™ç±»çš„ç®—æ³•ã€‚</p><p><strong>å®Œæ•´ä»£ç å‚è§ï¼š</strong><br><a href="https://github.com/WangPerryWPY/Computer-Version/tree/master/Exp6" target="_blank" rel="noopener">https://github.com/WangPerryWPY/Computer-Version/tree/master/Exp6</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;ç¼–è¯‘è¿è¡Œï¼š&quot;&gt;&lt;a href=&quot;#ç¼–è¯‘è¿è¡Œï¼š&quot; class=&quot;headerlink&quot; title=&quot;ç¼–è¯‘è¿è¡Œï¼š&quot;&gt;&lt;/a&gt;ç¼–è¯‘è¿è¡Œï¼š&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;è¿è¡Œç¯å¢ƒ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Ubuntu 18&lt;/code&gt;&lt;/p&gt;
&lt;
      
    
    </summary>
    
      <category term="è®¡ç®—æœºè§†è§‰" scheme="http://yoursite.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="è®¡ç®—æœºè§†è§‰" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/"/>
    
  </entry>
  
  <entry>
    <title>è‡ªé€‚åº”çš„éœå¤«æ›¼ç¼–ç ä¸åŸå§‹çš„éœå¤«æ›¼ç¼–ç çš„æ¯”è¾ƒ</title>
    <link href="http://yoursite.com/2019/07/06/%E8%87%AA%E9%80%82%E5%BA%94%E7%9A%84%E9%9C%8D%E5%A4%AB%E6%9B%BC%E7%BC%96%E7%A0%81%E4%B8%8E%E5%8E%9F%E5%A7%8B%E7%9A%84%E9%9C%8D%E5%A4%AB%E6%9B%BC%E7%BC%96%E7%A0%81%E7%9A%84%E6%AF%94%E8%BE%83/"/>
    <id>http://yoursite.com/2019/07/06/è‡ªé€‚åº”çš„éœå¤«æ›¼ç¼–ç ä¸åŸå§‹çš„éœå¤«æ›¼ç¼–ç çš„æ¯”è¾ƒ/</id>
    <published>2019-07-06T13:07:54.000Z</published>
    <updated>2019-07-06T13:08:30.798Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¬¬ä¸€é¢˜ï¼š"><a href="#ç¬¬ä¸€é¢˜ï¼š" class="headerlink" title="ç¬¬ä¸€é¢˜ï¼š"></a>ç¬¬ä¸€é¢˜ï¼š</h2><h4 id="a-è‡ªé€‚åº”çš„éœå¤«æ›¼ç¼–ç ä¸åŸå§‹çš„éœå¤«æ›¼ç¼–ç ç›¸æ¯”ä»€ä¹ˆä¼˜ç‚¹ï¼š"><a href="#a-è‡ªé€‚åº”çš„éœå¤«æ›¼ç¼–ç ä¸åŸå§‹çš„éœå¤«æ›¼ç¼–ç ç›¸æ¯”ä»€ä¹ˆä¼˜ç‚¹ï¼š" class="headerlink" title="(a) è‡ªé€‚åº”çš„éœå¤«æ›¼ç¼–ç ä¸åŸå§‹çš„éœå¤«æ›¼ç¼–ç ç›¸æ¯”ä»€ä¹ˆä¼˜ç‚¹ï¼š"></a>(a) è‡ªé€‚åº”çš„éœå¤«æ›¼ç¼–ç ä¸åŸå§‹çš„éœå¤«æ›¼ç¼–ç ç›¸æ¯”ä»€ä¹ˆä¼˜ç‚¹ï¼š</h4><ol><li>åŸå§‹çš„Huffmanç®—æ³•ç»™å‡ºäº†ä¸€ç§é™æ€çš„ç¼–ç æ ‘æ„é€ æ–¹æ¡ˆï¼Œè¦æ±‚åœ¨å®é™…ç¼–ç ä¹‹å‰ç»Ÿè®¡è¢«ç¼–ç å¯¹è±¡ä¸­ç¬¦å·å‡ºç°çš„å‡ ç‡ï¼Œå¹¶æ®æ­¤è¿›è¡Œç¼–ç æ ‘çš„æ„é€ ã€‚æ‰€ä»¥åº”ç”¨æ­¤æ–¹æ¡ˆæ—¶å¿…é¡»å¯¹è¾“å…¥ç¬¦å·æµè¿›è¡Œä¸¤éæ‰«æï¼Œè€Œåœ¨å¤§å¤šæ•°å¤šåª’ä½“åº”ç”¨ä¸­æ•°æ®åˆ†å¸ƒçš„å…ˆå‰ç»Ÿè®¡æ•°æ®æ˜¯ä¸å¯è¡Œçš„ã€‚</li><li>å¦å¤–ï¼Œé™æ€ç¼–ç æ ‘æ„é€ æ–¹æ¡ˆä¸èƒ½å¯¹ç¬¦å·æµçš„å±€éƒ¨ç»Ÿè®¡è§„å¾‹å˜åŒ–åšå‡ºååº”ï¼Œå› ä¸ºå®ƒä»å§‹è‡³ç»ˆéƒ½ä½¿ç”¨å®Œå…¨ä¸å˜çš„ç¼–ç æ ‘ã€‚è€Œè‡ªé€‚åº”Huffmanç¼–ç ä¸éœ€è¦äº‹å…ˆæ„é€ Huffmanæ ‘ï¼Œè€Œæ˜¯éšç€ç¼–ç çš„è¿›è¡Œï¼Œé€æ­¥æ„é€ Huffmanæ ‘ã€‚åŒæ—¶ï¼Œè¿™ç§ç¼–ç æ–¹æ¡ˆå¯¹ç¬¦å·çš„ç»Ÿè®¡ä¹ŸåŠ¨æ€è¿›è¡Œï¼Œéšç€ç¨‹åºçš„è¿è¡Œï¼ŒåŒä¸€ä¸ªç¬¦å·çš„ç¼–ç å¯èƒ½å‘ç”Ÿæ”¹å˜ï¼ˆå˜å¾—æ›´é•¿æˆ–æ›´çŸ­ï¼‰ã€‚</li><li>å†è€…å°±é™æ€ç¼–ç åœ¨å‚¨å­˜æˆ–ä¼ è¾“Huffmanç¼–ç ç»“æœä¹‹å‰ï¼Œè¿˜å¿…é¡»å…ˆå‚¨å­˜æˆ–ä¼ è¾“Huffmanç¼–ç æ ‘ï¼Œè‡ªé€‚åº”éœå¤«æ›¼ç¼–ç åˆ™ä¸éœ€è¦ï¼Œè¿™å¤§å¤§èŠ‚çœäº†å†…å­˜å¼€é”€ã€‚</li></ol><h4 id="b"><a href="#b" class="headerlink" title="(b)"></a>(b)</h4><h5 id="i-æ¥æ”¶åˆ°çš„åç»­å‡ ä¸ªå­—æ¯æ˜¯ä»€ä¹ˆ"><a href="#i-æ¥æ”¶åˆ°çš„åç»­å‡ ä¸ªå­—æ¯æ˜¯ä»€ä¹ˆ" class="headerlink" title="(i)æ¥æ”¶åˆ°çš„åç»­å‡ ä¸ªå­—æ¯æ˜¯ä»€ä¹ˆ"></a>(i)æ¥æ”¶åˆ°çš„åç»­å‡ ä¸ªå­—æ¯æ˜¯ä»€ä¹ˆ</h5><p>æ¥æ”¶åˆ°çš„åç»­çš„å‡ ä¸ªå­—æ¯åˆ†åˆ«æ˜¯ <strong>b(01) a(01) c(00 10) c(101)</strong></p><p>(æ¨å¯¼è¿‡ç¨‹åŒç¬¬äºŒé—®)</p><p><strong>(ii)ç”»å‡ºæ¥æ”¶æ¯ä¸€ä¸ªåç»­å­—æ¯åçš„è‡ªé€‚åº”éœå¤«æ›¼æ ‘</strong></p><p><img src="https://img-blog.csdnimg.cn/2018120919340015.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><strong>fig 1</strong></p><p><img src="https://img-blog.csdnimg.cn/20181209193415577.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><strong>fig 2</strong></p><p><img src="https://img-blog.csdnimg.cn/20181209193427609.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><strong>fig 3</strong></p><p><img src="https://img-blog.csdnimg.cn/20181209193435475.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><strong>fig 4</strong></p><p><strong>æ¨å¯¼è¿‡ç¨‹ï¼š</strong></p><table><thead><tr><th>æ­¥éª¤</th><th>å­—ç¬¦</th><th>åˆ†æ</th></tr></thead><tbody><tr><td>ä¸€</td><td>01</td><td>ä»7-11å›¾å®šä½åˆ°01ä¸ºbï¼Œç„¶åbçš„æƒå€¼+1,æ­¤æ—¶bçš„èŠ‚ç‚¹æƒå€¼å˜ä¸º3&gt;a(2)ï¼Œbä¸aäº¤æ¢ä½ç½®ï¼Œhuffmanæ ‘å˜ä¸ºfig1</td></tr><tr><td>äºŒ</td><td>01</td><td>ä»fig1å®šä½åˆ°01ä¸ºaï¼Œç„¶åaæƒå€¼+1ï¼Œæ­¤æ—¶açš„èŠ‚ç‚¹æƒå€¼å˜ä¸º3=b(3)ï¼Œæ ‘çš„èŠ‚ç‚¹ä¸åšå˜åŠ¨ï¼Œhuffmanæ ‘å˜ä¸ºfig2</td></tr><tr><td>ä¸‰</td><td>00 10</td><td>æ ¹æ®fig2å®šä½åˆ°00æ˜¯newï¼Œæ„å‘³ç€æœ‰æ–°å­—ç¬¦çš„åŠ å…¥ï¼Œç„¶åæ ¹æ®ä¸‹é¢çš„10çŸ¥é“æ–°åŠ å…¥çš„å­—ç¬¦æ˜¯cï¼Œç„¶åç”¨åŒ…å«cå’Œnewçš„å­æ ‘æ›¿æ¢æ—§çš„newèŠ‚ç‚¹ï¼Œç„¶åå°†açš„çˆ¶èŠ‚ç‚¹çš„æƒå€¼+1å˜ä¸º4&gt;b(3)ï¼Œä¸bäº¤æ¢ä½ç½®ï¼Œå¾—åˆ°fig3</td></tr><tr><td>å››</td><td>101</td><td>æ ¹æ®fig3å®šä½åˆ°cï¼Œç„¶åå°†ç›¸åº”çš„èŠ‚ç‚¹æƒå€¼åˆ†åˆ«+1ï¼Œå‘ç°æ²¡æœ‰éœ€è¦ç½®æ¢çš„èŠ‚ç‚¹å’Œå­æ ‘ï¼Œå¾—åˆ°fig4</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç¬¬ä¸€é¢˜ï¼š&quot;&gt;&lt;a href=&quot;#ç¬¬ä¸€é¢˜ï¼š&quot; class=&quot;headerlink&quot; title=&quot;ç¬¬ä¸€é¢˜ï¼š&quot;&gt;&lt;/a&gt;ç¬¬ä¸€é¢˜ï¼š&lt;/h2&gt;&lt;h4 id=&quot;a-è‡ªé€‚åº”çš„éœå¤«æ›¼ç¼–ç ä¸åŸå§‹çš„éœå¤«æ›¼ç¼–ç ç›¸æ¯”ä»€ä¹ˆä¼˜ç‚¹ï¼š&quot;&gt;&lt;a href=&quot;#a-è‡ªé€‚åº”çš„éœå¤«æ›¼ç¼–ç ä¸åŸå§‹çš„éœå¤«æ›¼
      
    
    </summary>
    
      <category term="å¤šåª’ä½“æŠ€æœ¯" scheme="http://yoursite.com/categories/%E5%A4%9A%E5%AA%92%E4%BD%93%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="å¤šåª’ä½“æŠ€æœ¯" scheme="http://yoursite.com/tags/%E5%A4%9A%E5%AA%92%E4%BD%93%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>GIFå‹ç¼©ä¸JPEGå‹ç¼©å¯¹æ¯”</title>
    <link href="http://yoursite.com/2019/07/06/GIF%E5%8E%8B%E7%BC%A9%E4%B8%8EJPEG%E5%8E%8B%E7%BC%A9%E5%AF%B9%E6%AF%94/"/>
    <id>http://yoursite.com/2019/07/06/GIFå‹ç¼©ä¸JPEGå‹ç¼©å¯¹æ¯”/</id>
    <published>2019-07-06T13:06:15.000Z</published>
    <updated>2019-07-06T13:06:42.916Z</updated>
    
    <content type="html"><![CDATA[<h4 id="å›¾ç‰‡ç¤ºèŒƒ"><a href="#å›¾ç‰‡ç¤ºèŒƒ" class="headerlink" title="å›¾ç‰‡ç¤ºèŒƒ"></a>å›¾ç‰‡ç¤ºèŒƒ</h4><p><img src="https://img-blog.csdnimg.cn/20181209193758218.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åŠ¨ç‰©å¡é€šå›¾ç‰‡"><center><strong>fig: åŠ¨ç‰©å¡é€šå›¾ç‰‡</strong></center></p><p><img src="https://img-blog.csdnimg.cn/20181209193850976.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><center><strong>fig: åŠ¨ç‰©å›¾ç‰‡</strong></center></p><h4 id="GIFæ ¼å¼"><a href="#GIFæ ¼å¼" class="headerlink" title="GIFæ ¼å¼"></a>GIFæ ¼å¼</h4><p>å…¶ä¸­GIFæ ¼å¼é‡‡ç”¨çš„æ˜¯LZWçš„æ— æŸå‹ç¼©ç®—æ³•ï¼Œè¿™æ˜¯ä¸€ç§å­—å…¸ç´¢å¼•çš„å‹ç¼©æ–¹æ³•ï¼ŒåŸç†æ˜¯å‡å°‘æ¯ç‚¹çš„å­˜å‚¨ä½æ•°ä»¥å‡å°‘å›¾åƒæ–‡ä»¶çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„é¢œè‰²æŠ–åŠ¨ã€‚å› è€Œå®é™…å­˜å‚¨æ•°æ®çš„å¹¶ä¸æ˜¯å›¾åƒçš„ç›´æ¥è‰²å½©ï¼Œè€Œæ˜¯å­˜å‚¨çš„indexï¼Œé€šè¿‡indexæ¥æŸ¥è¯¢å­˜å‚¨é¢œè‰²çš„å­—å…¸ï¼ˆç±»ä¼¼æˆ‘ä»¬ä¸Šæ¬¡ä½œä¸šå®ç°çš„é‡‡è‰²æ¿ï¼‰ã€‚indexé€šå¸¸æœ€é«˜æ˜¯å­˜å‚¨å…«ä½ï¼Œä¹Ÿå°±æ˜¯2^8=256ç§é¢œè‰²ã€‚</p><p>ä½†å®é™…åœ¨ç”¨rgbå­˜å‚¨æ—¶ï¼Œä¸€å‰¯å…¨è‰²å›¾åƒæ˜¯é‡‡ç”¨ç›´æ¥è‰²å½©å­˜å‚¨ï¼Œæ¯è‰²å—å­˜8*3=24ä½ã€‚</p><ul><li>æˆ‘å°è¯•å¯¹è€å¸ˆç»™çš„åŠ¨ç‰©å›¾ç‰‡å…ˆè½¬ä¸ºbmpå…¶å¤§å°ä¸º2095kï¼Œç„¶åç”¨psè½¬ä¸º8ä½gifï¼Œå‘ç°å¤§å°å˜ä¸ºäº†257kï¼Œå·®ä¸å¤šå˜ä¸ºåŸæ¥çš„1/(2^3=8)</li></ul><p>æ‰€ä»¥å¯¹äºè‰²å½©å˜åŒ–ä¸æ˜æ˜¾çš„ç®€å•å›¾ç‰‡æˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨gifå‹ç¼©ï¼ŒåŸå› å°±æ˜¯åŸºäºLZWçš„åŸç†ï¼šåŸå§‹æ•°æ®ä¸²ä¸­æœ‰å¤§é‡çš„å­ä¸²å¤šæ¬¡é‡å¤å‡ºç°çš„è¯LZWå‹ç¼©æ•ˆæœæ•ˆæœå°±ä¼šè¶Šå¥½ã€‚é’ˆå¯¹å…·ä½“å›¾åƒæ¥è¯´ä¹Ÿå°±æ˜¯é¢œè‰²ç§ç±»è¶Šå°‘è¶Šå¥½ï¼Œåƒç´ å—è‰²å½©å€¼é‡å¤åº¦å°±é«˜ã€‚gifå‹ç¼©ä¸ä¼šä¸¢å¤±ä»»ä½•æ•°æ®è€Œä¸”åˆæ¯”åŒç­‰æ•ˆæœçš„jpgå›¾è¦å°ã€‚</p><h4 id="JPEGæ ¼å¼"><a href="#JPEGæ ¼å¼" class="headerlink" title="JPEGæ ¼å¼"></a>JPEGæ ¼å¼</h4><p>JPEGå‹ç¼©æ˜¯ä¸€ç§åå‘å¹³è¡¡æ€§çš„æ ¼å¼ï¼Œå®ƒä¼šèˆå¼ƒæ‰äººçœ¼æ ¹æœ¬æ— æ³•æ„ŸçŸ¥çš„é¢œè‰²ä¿¡æ¯ï¼Œä»¥ä½¿æ–‡ä»¶å°½å¯èƒ½å°å¹¶ä¸”ç»†èŠ‚ä¸ä¸¢å¤±ã€‚å› æ­¤ï¼Œå®ƒæ˜¯ä¸€ç§æœ‰æŸæ ¼å¼ã€‚å®ƒé¢œè‰²ä¸°å¯Œå¹¶ä¸”å¾ˆé€‚åˆé‚£äº›å…è®¸è½»å¾®å¤±çœŸçš„åƒç´ è‰²å½©ä¸°å¯Œçš„å›¾ç‰‡ï¼ˆå¦‚ç›¸ç‰‡ï¼‰ã€‚ </p><ul><li>jpegçš„å‹ç¼©æ¯”ä¾‹ä¸»è¦æ˜¯åœ¨äºé‡åŒ–ä¸€æ­¥ä¸­å¯¹äºå›¾åƒç»†èŠ‚çš„ä¿ç•™ç¨‹åº¦ï¼Œè¿™ä¸€æ­¥é‡‡ç”¨çš„é‡åŒ–è¡¨ä¹Ÿæ˜¯ä»å¹¿æ³›å®éªŒä¸­æ ¹æ®äººå¯¹è‰²å½©çš„æ•æ„Ÿç¨‹åº¦å¾—å‡ºã€‚è€Œä¸”æ ¹æ®äº®åº¦å’Œè‰²åº¦çš„ç²¾åº¦è¦æ±‚ä¸åŒé‡‡ç”¨ä¸åŒé‡åŒ–è¡¨ã€‚å‰è€…ç»†é‡åŒ–ï¼Œåè€…ç²—é‡åŒ–ã€‚</li><li>æœ€åçš„ç†µç¼–ç ä¸€èˆ¬é‡‡ç”¨éœå¤«æ›¼ç¼–ç ï¼Œè€ŒJPEGçš„éœå¤«æ›¼è¡¨æ˜¯ç”±ä¸€å®šè§„åˆ™ç”Ÿæˆï¼Œåªè¦ç»™å‡ºå°‘é‡çš„æè¿°å³å¯ç”Ÿæˆç›¸åº”çš„JPEGçš„éœå¤«æ›¼è¡¨ï¼Œè¿™ä¹Ÿå‡å°‘äº†å­˜å‚¨çš„å­—ç¬¦ä½æ•°ã€‚ </li></ul><p>JPEGçš„å›¾ç‰‡ç›¸æ¯”gifçš„ä¼˜ç‚¹ï¼Œæ˜¯é‡‡ç”¨äº†ç›´æ¥è‰²ï¼Œå¾—ç›Šäºæ›´ä¸°å¯Œçš„è‰²å½©ï¼ŒJPEGéå¸¸é€‚åˆç”¨æ¥å­˜å‚¨ç…§ç‰‡ï¼Œç”¨æ¥è¡¨è¾¾æ›´ç”ŸåŠ¨çš„å›¾åƒæ•ˆæœï¼Œæ¯”å¦‚é¢œè‰²æ¸å˜ã€‚ </p><h4 id="å›¾ç‰‡å­˜å‚¨æ ¼å¼åˆ†æ"><a href="#å›¾ç‰‡å­˜å‚¨æ ¼å¼åˆ†æ" class="headerlink" title="å›¾ç‰‡å­˜å‚¨æ ¼å¼åˆ†æ"></a>å›¾ç‰‡å­˜å‚¨æ ¼å¼åˆ†æ</h4><p>æ‰€ä»¥å¯¹äºåŠ¨ç‰©å›¾ç‰‡è¿™å¼ å›¾ï¼Œå®ƒçš„é¢œè‰²ä¸°å¯Œåº¦æ¯”è¾ƒä½ï¼ŒåŒæ—¶ä¹Ÿå·²ç»å­˜ä¸ºjpgäº†ï¼Œå†äºŒæ¬¡å‹ç¼©ä¸ºjpgä¼šå¤±çœŸåº¦è¾ƒé«˜ï¼Œä¹Ÿå°±æ˜¯æ˜¾å¾—å¾ˆç³Šï¼Œå› è€Œæˆ‘ä»¬é€‚åˆé‡‡ç”¨gifå‹ç¼©ã€‚</p><p>è€ŒåŠ¨ç‰©å¡é€šå›¾ç‰‡è¿™å¼ å›¾é¢œè‰²ç§ç±»ä¸°å¯Œï¼Œæ¸å˜ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œå› è€Œåªç”¨256ç§è‰²å½©å­˜å‚¨å¾ˆéš¾è¾¾åˆ°è¾ƒå¥½çš„è‰²å½©æ•ˆæœï¼Œæ‰€ä»¥é‡‡ç”¨jpegå‹ç¼©ã€‚</p><p><strong>é¦–å…ˆå…ˆæ¯”è¾ƒç¬¬ä¸€å¼ åŠ¨ç‰©å›¾ç‰‡ã€‚</strong>å…ˆçœ‹å‹ç¼©ç‡ï¼Œå°†ç¬¬ä¸€å¹…å›¾å­˜ä¸ºåŒç­‰æ•ˆæœçš„jpgå’Œgifï¼Œgifçš„å›¾ç‰‡å¤§å°ä¸º410kï¼Œè€Œjpgçš„å›¾ç‰‡å¤§å°ä¸º521kï¼›æ¥ç€å†çœ‹å¤±çœŸç‡ï¼Œå› ä¸ºgifæ˜¯æ— æŸå‹ç¼©ï¼Œè€Œjpgæ˜¯æœ‰æŸå‹ç¼©ï¼Œæ‰€ä»¥gifå›¾ç‰‡è§†è§‰çš„æ¸…æ™°åº¦è¦é«˜äºjpgå‹ç¼©ï¼Œå¤±çœŸåº¦è¾ƒå°ã€‚æ‰€ä»¥ç¬¬ä¸€å¹…å›¾æ— è®ºæ˜¯ä»å‹ç¼©ç‡è¿˜æ˜¯å¤±çœŸç‡æ¥è¯´gifå‹ç¼©éƒ½ä¼šç•¥èƒœä¸€ç­¹ã€‚</p><h3 id="ç»“æœå¯¹æ¯”éƒ¨åˆ†ï¼š"><a href="#ç»“æœå¯¹æ¯”éƒ¨åˆ†ï¼š" class="headerlink" title="ç»“æœå¯¹æ¯”éƒ¨åˆ†ï¼š"></a>ç»“æœå¯¹æ¯”éƒ¨åˆ†ï¼š</h3><p><strong>jpg</strong></p><p><img src="https://img-blog.csdnimg.cn/20181209194404217.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>gif</strong></p><p><img src="https://img-blog.csdnimg.cn/20181209194417507.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>ç„¶åæ¯”è¾ƒç¬¬äºŒå¹…åŠ¨ç‰©å¡é€šå›¾ç‰‡ã€‚</strong>ä»å‹ç¼©ç‡æ¥çœ‹ï¼Œä»åŒä¸€å¼ å›¾ç‰‡è¿›è¡ŒåŒç­‰æ•ˆæœçš„å‹ç¼©ågifçš„å¤§å°ä¸º348kï¼Œè€Œjpgçš„å¤§å°ä¸º210kã€‚æ¥ç€æ ¹æ®å¤±çœŸåº¦æ¯”è¾ƒï¼Œgifæœ€å¤šåªèƒ½å­˜å‚¨8ä½ï¼Œä¹Ÿå°±æ˜¯256ç§é¢œè‰²ã€‚è€Œjpgè™½ç„¶æœ‰ä¸€å®šçš„æ•°æ®ç²¾åº¦æŸå¤±ï¼Œä½†æ˜¯æ˜¯ä»¥ç›´æ¥è‰²å½©çš„æ–¹å¼å­˜å‚¨ï¼Œé¢œè‰²ä¸°å¯Œç¨‹åº¦è¦è¿œå¥½äºgifï¼Œè€Œå¯¹äºä¸€äº›ç»†èŠ‚çš„æ¸å˜æ•ˆæœä¹Ÿæ¯”è¾ƒå¥½ï¼Œæ‰€ä»¥è¿™å¹…å›¾jpgçš„è§†è§‰æ•ˆæœè¾ƒå¥½ã€‚æ‰€ä»¥ç»¼åˆå‹ç¼©ç‡å’Œå¤±çœŸç‡æ¥è¯´è¿™å¹…å›¾ç”¨jpegå‹ç¼©æ•ˆæœæ›´å¥½ã€‚</p><p><strong>jpg</strong></p><p><img src="https://img-blog.csdnimg.cn/20181209194238817.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>gif</strong></p><p><img src="https://img-blog.csdnimg.cn/20181209194250127.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>ps:</strong>ä¸ºä»€ä¹ˆåŒæ ·æ˜¯gifå‹ç¼©ç¬¬ä¸€å¹…å›¾å°±ä¼šæ¯”jpgå å†…å­˜å°è€Œç¬¬äºŒå¹…å›¾å°±ä¼šæ¯”jpgå¤§å‘¢ï¼Ÿä¸ªäººåˆ†ææ˜¯å› ä¸ºç¬¬ä¸€å¹…å›¾è‰²å½©ä¸°å¯Œåº¦å¤ªä½ï¼Œå›¾ç‰‡é¢œè‰²ç§ç±»å°‘äº256ç§ï¼Œæ‰€ä»¥gifå­˜å‚¨ä¸éœ€è¦8ä½(1~7ä½å³å¯)å°±å¯ä»¥å°†å›¾ç‰‡è‰²å½©å…¨éƒ¨è¡¨ç¤ºã€‚è€Œç¬¬äºŒå¹…å›¾è‰²å½©ä¸°å¯Œåº¦è¾ƒé«˜ï¼Œé¢œè‰²ç§ç±»å¤šäº256ç§ï¼Œgifæœ€å¤šä¹Ÿåªèƒ½å­˜å…«ä½ï¼Œæ‰€ä»¥æ˜¯å°†å›¾ç‰‡ä»¥8ä½ç´¢å¼•çš„å½¢å¼å­˜çš„ï¼Œå›¾ç‰‡å¤§å°å°±å¤§äºgifã€‚</p><p>ä¹‹åè¯•äº†ä¸€ä¸‹å°†ç¬¬ä¸€å¹…å›¾ç”¨pså¼ºè¡Œå­˜ä¸º8ä½ï¼Œå›¾ç‰‡çš„å†…å­˜å¤§å°ä¹Ÿç¡®å®è¦æ¯”jpgå¤§ï¼Œæ‰€ä»¥å¾—å‡ºç»“è®ºå¦‚æœå°†gifå­˜ä¸º8ä½ï¼ˆ256è‰²ç´¢å¼•ï¼‰ï¼Œå®ƒçš„å‹ç¼©æ•ˆæœæ˜¯è¦æ¯”jpegå‹ç¼©å·®çš„ï¼Œè€Œä¸”è§†è§‰ä¸Šçš„è‰²å½©ä¸°å¯Œç¨‹åº¦ä¹Ÿä¸è¾¾jpgã€‚ç„¶è€Œå¦‚æœå›¾ç‰‡è‰²å½©ä¸°å¯Œåº¦ä½ï¼Œä¾‹å¦‚èƒ½ç”¨128ç”šè‡³æ›´å°‘çš„è‰²å½©å­˜å‚¨ï¼Œé‚£ä¹ˆgifçš„å‹ç¼©æ•ˆæœæ˜¯ä¼šæ¯”jpgå¥½ï¼ŒåŒæ—¶å› ä¸ºæ˜¯æ— æŸå‹ç¼©åˆä¸ä¼šé€ æˆå›¾ç‰‡çš„å¤±çœŸã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;å›¾ç‰‡ç¤ºèŒƒ&quot;&gt;&lt;a href=&quot;#å›¾ç‰‡ç¤ºèŒƒ&quot; class=&quot;headerlink&quot; title=&quot;å›¾ç‰‡ç¤ºèŒƒ&quot;&gt;&lt;/a&gt;å›¾ç‰‡ç¤ºèŒƒ&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20181209193758218.jpg?x-
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>JPEGå‹ç¼©ç®—æ³•</title>
    <link href="http://yoursite.com/2019/07/06/JPEG%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95/"/>
    <id>http://yoursite.com/2019/07/06/JPEGå‹ç¼©ç®—æ³•/</id>
    <published>2019-07-06T13:04:46.000Z</published>
    <updated>2019-07-06T13:05:31.983Z</updated>
    
    <content type="html"><![CDATA[<p><strong>ç¼–è¯‘ç¯å¢ƒ</strong></p><p>windows10ä¸‹MinGW</p><p><strong>ç¼–è¯‘è¯­è¨€</strong></p><p>c++ &amp;&amp; CImgåº“</p><p><strong>è¿è¡Œå‘½ä»¤</strong></p><p><code>g++ -o test main.cpp jpegCompress.cpp jpegCompress.h -O2 -lgdi32</code></p><h4 id="1-8x8åˆ†å—"><a href="#1-8x8åˆ†å—" class="headerlink" title="1. 8x8åˆ†å—"></a>1. 8x8åˆ†å—</h4><p>å› ä¸ºä¹‹åçš„DCTå˜æ¢æ˜¯è¦å¯¹8x8çš„å­å—ä¸ºä¸€ä¸ªå•ä½è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿ç¬¬ä¸€æ­¥æˆ‘ä»¬å°±è¿›è¡Œåˆ†å—ã€‚æ‰€ä»¥æºå›¾çš„widthå’Œheightå¿…é¡»è¦æ˜¯8çš„å€æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹æºå›¾è¿›è¡Œåˆå§‹åŒ–å¤„ç†ï¼Œå¦‚æœä¸æ˜¯8çš„å€æ•°çš„è¯æˆ‘ä»¬è¦ç”¨0å¯¹å…¶è¿›è¡Œä¸¤ä¾§çš„å¡«å……ã€‚</p><p><strong>åˆå§‹åŒ–å¤„ç†ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è½½å…¥å›¾ç‰‡ï¼Œå¹¶å¯¹å›¾ç‰‡è¿›è¡Œåˆå§‹åŒ–å¤„ç†</span></span><br><span class="line"><span class="comment">//å¦‚æœå›¾ç‰‡çš„å®½é«˜ä¸æ˜¯8çš„å€æ•°ï¼Œåˆ™å°†ä¸¤è¾¹å‡åŒ€å¡«0</span></span><br><span class="line">source.load(fileName);</span><br><span class="line"><span class="keyword">int</span> width = source._width;</span><br><span class="line"><span class="keyword">int</span> height = source._height;</span><br><span class="line"><span class="keyword">int</span> width1 = width % <span class="number">8</span> == <span class="number">0</span> ? width : (width / <span class="number">8</span> + <span class="number">1</span>) * <span class="number">8</span>;</span><br><span class="line"><span class="keyword">int</span> height1 = height % <span class="number">8</span> ==<span class="number">0</span> ? height : (height / <span class="number">8</span> + <span class="number">1</span>) * <span class="number">8</span>;</span><br><span class="line">CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; source_a(width1, height1, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>);</span><br><span class="line">cimg_forXY(source_a, x, y) &#123;</span><br><span class="line"><span class="keyword">if</span> (x &lt; width &amp;&amp; y &lt; height) &#123;</span><br><span class="line">source_a(x + (width1 - width) / <span class="number">2</span>, y + (height1 - height) / <span class="number">2</span>, <span class="number">0</span>) = source(x, y, <span class="number">0</span>);</span><br><span class="line">source_a(x + (width1 - width) / <span class="number">2</span>, y + (height1 - height) / <span class="number">2</span>, <span class="number">1</span>) = source(x, y, <span class="number">1</span>);</span><br><span class="line">source_a(x + (width1 - width) / <span class="number">2</span>, y + (height1 - height) / <span class="number">2</span>, <span class="number">2</span>) = source(x, y, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">source = source_a;</span><br><span class="line">Width = source._width;</span><br><span class="line">Height = source._height;</span><br></pre></td></tr></table></figure><p><strong>åˆ†å—ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ¯æ¬¡å–8x8çš„å°å—è¿›è¡Œå¤„ç†</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> yPos=<span class="number">0</span>; yPos&lt;Height; yPos+=<span class="number">8</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> xPos=<span class="number">0</span>; xPos&lt;Width; xPos+=<span class="number">8</span>)</span><br></pre></td></tr></table></figure><h4 id="2-é¢œè‰²ç©ºé—´è½¬æ¢"><a href="#2-é¢œè‰²ç©ºé—´è½¬æ¢" class="headerlink" title="2.é¢œè‰²ç©ºé—´è½¬æ¢"></a>2.é¢œè‰²ç©ºé—´è½¬æ¢</h4><p> JPEGé‡‡ç”¨çš„æ˜¯YCrCbé¢œè‰²ç©ºé—´ï¼Œè€Œæ­£å¸¸çš„ç¼–ç¨‹è½¯ä»¶è¯»å…¥å›¾ç‰‡åéƒ½ä¼šè½¬ä¸ºrgbæ ¼å¼ï¼Œè¿™ä¹Ÿæ˜¯bmpæ–‡ä»¶å­˜å‚¨çš„é¢œè‰²ç©ºé—´ã€‚æ‰€ä»¥è¦è¿›è¡Œé¢œè‰²ç©ºé—´è½¬æ¢ã€‚ã€‚YCrCbé¢œè‰²ç©ºé—´ä¸­ï¼ŒYä»£è¡¨äº®åº¦ï¼ŒCr,Cbåˆ™ä»£è¡¨è‰²åº¦å’Œé¥±å’Œåº¦(ä¹Ÿæœ‰äººå°†Cb,Crä¸¤è€…ç»Ÿç§°ä¸ºè‰²åº¦)ï¼Œä¸‰è€…é€šå¸¸ä»¥Y,U,Væ¥è¡¨ç¤ºï¼Œå³ç”¨Uä»£è¡¨Cbï¼Œç”¨Vä»£è¡¨Crã€‚RGBå’ŒYCrCbä¹‹é—´çš„è½¬æ¢å…³ç³»å¦‚ä¸‹ï¼š<br>$$<br>Y = 0.299R+0.587G+0.114B<br>$$</p><p>$$<br>Cb = -0.1687R-0.3313G+0.5B+128<br>$$</p><p>$$<br>Cr = 0.5R=0.418G-0.0813B+128<br>$$</p><p><strong>ä»£ç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> JpegCompress::RGB2YCbCr(<span class="keyword">int</span> xPos, <span class="keyword">int</span> yPos, <span class="keyword">char</span>* y_channel, <span class="keyword">char</span>* cd_channel, <span class="keyword">char</span>* cr_channel)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> y=<span class="number">0</span>; y&lt;<span class="number">8</span>; y++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> x=<span class="number">0</span>; x&lt;<span class="number">8</span>; x++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> R = source(xPos+x,yPos+y,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> G = source(xPos+x,yPos+y,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> B = source(xPos+x,yPos+y,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">y_channel[y*<span class="number">8</span>+x] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)(<span class="number">0.299f</span> * R + <span class="number">0.587f</span> * G + <span class="number">0.114f</span> * B - <span class="number">128</span>);</span><br><span class="line">cd_channel[y*<span class="number">8</span>+x] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)(<span class="number">-0.1687f</span> * R - <span class="number">0.3313f</span> * G + <span class="number">0.5f</span> * B );</span><br><span class="line">cr_channel[y*<span class="number">8</span>+x] = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)(<span class="number">0.5f</span> * R - <span class="number">0.4187f</span> * G - <span class="number">0.0813f</span> * B);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å®ç°æ•ˆæœï¼š</strong><br><img src="https://img-blog.csdnimg.cn/20181209192404758.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>å¯¹åº”çš„åˆ†åˆ«æ˜¯Y,Cb,Crä¸‰ä¸ªç©ºé—´çš„å›¾ç‰‡ï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/20181209192346295.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="3-ç¦»æ•£ä½™å¼¦å˜æ¢-DCT"><a href="#3-ç¦»æ•£ä½™å¼¦å˜æ¢-DCT" class="headerlink" title="3.ç¦»æ•£ä½™å¼¦å˜æ¢(DCT)"></a>3.ç¦»æ•£ä½™å¼¦å˜æ¢(DCT)</h4><p>$$<br>F(u,v) = alpha(u)<em>alpha(v)</em>\sum_{x=0}^{7}\sum_{y=0}^{7} f(x,y)\cos(\frac{2x+1}{16}u\pi)cos(\frac{2y+1}{16}v\pi) \qquad u,v=0,1,â€¦,7<br>$$</p><p>$$<br>alpha(u) = \left{<br>\begin{aligned}<br>1/ \sqrt{8} \qquad when ;  u = 0 \<br>1 / \quad 2  \qquad when ; u  \neq 0<br>\end{aligned}<br>\right.<br>$$</p><p>8x8çš„äºŒç»´åƒç´ å—ç»è¿‡DCTæ“ä½œä¹‹åï¼Œå°±å¾—åˆ°äº†8x8çš„å˜æ¢ç³»æ•°çŸ©é˜µã€‚è¿™äº›ç³»æ•°ï¼Œéƒ½æœ‰å…·ä½“çš„ç‰©ç†å«ä¹‰ï¼Œä¾‹å¦‚ï¼ŒU=0ï¼ŒV=0æ—¶çš„Fï¼ˆ0,0ï¼‰æ˜¯åŸæ¥çš„64ä¸ªæ•°æ®çš„å‡å€¼ï¼Œç›¸å½“äºç›´æµåˆ†é‡ï¼Œä¹Ÿæœ‰äººç§°ä¹‹ä¸ºDCç³»æ•°æˆ–è€…ç›´æµç³»æ•°ã€‚éšç€Uï¼ŒVçš„å¢åŠ ï¼Œç›¸å¦å¤–çš„63ä¸ªç³»æ•°åˆ™ä»£è¡¨äº†æ°´å¹³ç©ºé—´é¢‘ç‡å’Œå‚ç›´ç©ºé—´é¢‘ç‡åˆ†é‡ï¼ˆé«˜é¢‘åˆ†é‡ï¼‰çš„å¤§å°ï¼Œå¤šåŠæ˜¯ä¸€äº›æ¥è¿‘äº0çš„æ­£è´Ÿæµ®ç‚¹æ•°ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºäº¤æµç³»æ•°ACã€‚DCTå˜æ¢åçš„8*8çš„ç³»æ•°çŸ©é˜µä¸­ï¼Œä½é¢‘åˆ†é‡é›†ä¸­åœ¨çŸ©é˜µçš„å·¦ä¸Šè§’ã€‚é«˜é¢‘æˆåˆ†åˆ™é›†ä¸­åœ¨å³ä¸‹è§’ã€‚</p><p><strong>DCTå˜æ¢ä»£ç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> JpegCompress::DCT(<span class="keyword">const</span> <span class="keyword">char</span>* channel_data, <span class="keyword">float</span>* fdc_data)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> v=<span class="number">0</span>; v&lt;<span class="number">8</span>; v++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> u=<span class="number">0</span>; u&lt;<span class="number">8</span>; u++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">float</span> alpha_u = (u==<span class="number">0</span>) ? <span class="number">1</span>/<span class="built_in">sqrt</span>(<span class="number">8.0f</span>) : <span class="number">0.5f</span>;</span><br><span class="line"><span class="keyword">float</span> alpha_v = (v==<span class="number">0</span>) ? <span class="number">1</span>/<span class="built_in">sqrt</span>(<span class="number">8.0f</span>) : <span class="number">0.5f</span>;</span><br><span class="line"><span class="keyword">float</span> f_xy = <span class="number">0.0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> x=<span class="number">0</span>; x&lt;<span class="number">8</span>; x++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> y=<span class="number">0</span>; y&lt;<span class="number">8</span>; y++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">float</span> data = channel_data[y*<span class="number">8</span>+x];</span><br><span class="line">data *= <span class="built_in">cos</span>((<span class="number">2</span>*x+<span class="number">1</span>)*u*PI/<span class="number">16.0f</span>);</span><br><span class="line">data *= <span class="built_in">cos</span>((<span class="number">2</span>*y+<span class="number">1</span>)*v*PI/<span class="number">16.0f</span>);</span><br><span class="line">f_xy += data;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">fdc_data[v*<span class="number">8</span>+u] = f_xy * alpha_u * alpha_v;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºå¤§å¤šæ•°å›¾åƒçš„é«˜é¢‘åˆ†é‡æ¯”è¾ƒå°ï¼Œç›¸åº”çš„å›¾åƒé«˜é¢‘åˆ†é‡çš„DCTç³»æ•°ç»å¸¸æ¥è¿‘äº0ï¼Œå†åŠ ä¸Šé«˜é¢‘åˆ†é‡ä¸­åªåŒ…å«äº†å›¾åƒçš„ç»†å¾®çš„ç»†èŠ‚å˜åŒ–ä¿¡æ¯ï¼Œè€Œäººçœ¼å¯¹è¿™ç§é«˜é¢‘æˆåˆ†çš„å¤±çœŸä¸å¤ªæ•æ„Ÿï¼Œæ‰€ä»¥ï¼Œå¯ä»¥è€ƒè™‘å°†è¿™ä¸€äº›é«˜é¢‘æˆåˆ†äºˆä»¥æŠ›å¼ƒï¼Œä»è€Œé™ä½éœ€è¦ä¼ è¾“çš„æ•°æ®é‡ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¼ é€DCTå˜æ¢ç³»æ•°çš„æ‰€éœ€è¦çš„ç¼–ç é•¿åº¦è¦è¿œè¿œå°äºä¼ é€å›¾åƒåƒç´ çš„ç¼–ç é•¿åº¦ã€‚åˆ°è¾¾æ¥æ”¶ç«¯ä¹‹åé€šè¿‡åç¦»æ•£ä½™å¼¦å˜æ¢å°±å¯ä»¥å¾—åˆ°åŸæ¥çš„æ•°æ®ï¼Œè™½ç„¶è¿™ä¹ˆåšå­˜åœ¨ä¸€å®šçš„å¤±çœŸï¼Œä½†äººçœ¼æ˜¯å¯æ¥å—çš„ï¼Œè€Œä¸”å¯¹è¿™ç§å¾®å°çš„å˜æ¢æ˜¯ä¸æ•æ„Ÿçš„ã€‚</p><h4 id="4-é‡åŒ–"><a href="#4-é‡åŒ–" class="headerlink" title="4.é‡åŒ–"></a>4.é‡åŒ–</h4><p>é‡åŒ–é˜¶æ®µéœ€è¦ä¸¤ä¸ª8*8é‡åŒ–çŸ©é˜µæ•°æ®ï¼Œä¸€ä¸ªæ˜¯ä¸“é—¨å¤„ç†äº®åº¦çš„é¢‘ç‡ç³»æ•°ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯é’ˆå¯¹è‰²åº¦çš„é¢‘ç‡ç³»æ•°ï¼Œå°†é¢‘ç‡ç³»æ•°é™¤ä»¥é‡åŒ–çŸ©é˜µçš„å€¼ä¹‹åå–æ•´ï¼Œå³å®Œæˆäº†é‡åŒ–è¿‡ç¨‹ã€‚å½“é¢‘ç‡ç³»æ•°ç»è¿‡é‡åŒ–ä¹‹åï¼Œå°†é¢‘ç‡ç³»æ•°ç”±æµ®ç‚¹æ•°è½¬å˜ä¸ºæ•´æ•°ï¼Œè¿™æ‰ä¾¿äºæ‰§è¡Œæœ€åçš„ç¼–ç ã€‚ä¸éš¾å‘ç°ï¼Œç»è¿‡é‡åŒ–é˜¶æ®µä¹‹åï¼Œæ‰€æœ‰çš„æ•°æ®åªä¿ç•™äº†æ•´æ•°è¿‘ä¼¼å€¼ï¼Œä¹Ÿå°±å†åº¦æŸå¤±äº†ä¸€äº›æ•°æ®å†…å®¹ã€‚åœ¨JPEGç®—æ³•ä¸­ï¼Œç”±äºå¯¹äº®åº¦å’Œè‰²åº¦çš„ç²¾åº¦è¦æ±‚ä¸åŒï¼Œåˆ†åˆ«å¯¹äº®åº¦å’Œè‰²åº¦é‡‡ç”¨ä¸åŒçš„é‡åŒ–è¡¨ã€‚å‰è€…ç»†é‡åŒ–ï¼Œåè€…ç²—é‡åŒ–ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20181209192631703.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ ‡å‡†äº®åº¦é‡åŒ–è¡¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> Luminance_Quantization_Table[<span class="number">64</span>] = </span><br><span class="line">&#123;</span><br><span class="line"><span class="number">16</span>,  <span class="number">11</span>,  <span class="number">10</span>,  <span class="number">16</span>,  <span class="number">24</span>,  <span class="number">40</span>,  <span class="number">51</span>,  <span class="number">61</span>,</span><br><span class="line"><span class="number">12</span>,  <span class="number">12</span>,  <span class="number">14</span>,  <span class="number">19</span>,  <span class="number">26</span>,  <span class="number">58</span>,  <span class="number">60</span>,  <span class="number">55</span>,</span><br><span class="line"><span class="number">14</span>,  <span class="number">13</span>,  <span class="number">16</span>,  <span class="number">24</span>,  <span class="number">40</span>,  <span class="number">57</span>,  <span class="number">69</span>,  <span class="number">56</span>,</span><br><span class="line"><span class="number">14</span>,  <span class="number">17</span>,  <span class="number">22</span>,  <span class="number">29</span>,  <span class="number">51</span>,  <span class="number">87</span>,  <span class="number">80</span>,  <span class="number">62</span>,</span><br><span class="line"><span class="number">18</span>,  <span class="number">22</span>,  <span class="number">37</span>,  <span class="number">56</span>,  <span class="number">68</span>, <span class="number">109</span>, <span class="number">103</span>,  <span class="number">77</span>,</span><br><span class="line"><span class="number">24</span>,  <span class="number">35</span>,  <span class="number">55</span>,  <span class="number">64</span>,  <span class="number">81</span>, <span class="number">104</span>, <span class="number">113</span>,  <span class="number">92</span>,</span><br><span class="line"><span class="number">49</span>,  <span class="number">64</span>,  <span class="number">78</span>,  <span class="number">87</span>, <span class="number">103</span>, <span class="number">121</span>, <span class="number">120</span>, <span class="number">101</span>,</span><br><span class="line"><span class="number">72</span>,  <span class="number">92</span>,  <span class="number">95</span>,  <span class="number">98</span>, <span class="number">112</span>, <span class="number">100</span>, <span class="number">103</span>,  <span class="number">99</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ‡å‡†è‰²å·®é‡åŒ–è¡¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> Chrominance_Quantization_Table[<span class="number">64</span>] = </span><br><span class="line">&#123;</span><br><span class="line"><span class="number">17</span>, <span class="number">18</span>, <span class="number">24</span>, <span class="number">47</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>,</span><br><span class="line"><span class="number">18</span>, <span class="number">21</span>, <span class="number">26</span>, <span class="number">66</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>,</span><br><span class="line"><span class="number">24</span>, <span class="number">26</span>, <span class="number">56</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>,</span><br><span class="line"><span class="number">47</span>, <span class="number">66</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>,</span><br><span class="line"><span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>,</span><br><span class="line"><span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>,</span><br><span class="line"><span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>,</span><br><span class="line"><span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span>, <span class="number">99</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>é‡åŒ–è¡¨ä¹Ÿæ˜¯æ§åˆ¶ JPEG å‹ç¼©æ¯”çš„å…³é”®ã€‚è¿™ä¸ªæ­¥éª¤é™¤æ‰äº†ä¸€äº›é«˜é¢‘é‡, æŸå¤±äº†å¾ˆé«˜ç»†èŠ‚ã€‚ä½†äº‹å®ä¸Šäººçœ¼å¯¹é«˜ç©ºé—´é¢‘ç‡è¿œæ²¡æœ‰ä½é¢‘æ•æ„Ÿ.æ‰€ä»¥å¤„ç†åçš„è§†è§‰æŸå¤±å¾ˆå°ã€‚</li><li>å¦ä¸€ä¸ªé‡è¦åŸå› æ˜¯æ‰€æœ‰çš„å›¾ç‰‡çš„ç‚¹ä¸ç‚¹ä¹‹é—´ä¼šæœ‰ä¸€ä¸ªè‰²å½©è¿‡æ¸¡çš„è¿‡ç¨‹. å¤§é‡çš„å›¾è±¡ä¿¡æ¯è¢«åŒ…å«åœ¨ä½ç©ºé—´é¢‘ç‡ä¸­ã€‚ç»è¿‡é‡åŒ–å¤„ç†å, åœ¨é«˜ç©ºé—´é¢‘ç‡æ®µ, å°†å‡ºç°å¤§é‡è¿ç»­çš„é›¶ã€‚</li><li>æˆ‘çš„è°ƒæ•´æ–¹å¼æ˜¯è®¾ä¸º10ä¸ªç­‰çº§ï¼Œç­‰çº§è¶Šé«˜å‹ç¼©æ¯”ä¾‹ä¹Ÿè¶Šå¤§ï¼Œå¾—åˆ°çš„å›¾ç‰‡è¶Šå°ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> JpegCompress::InitQualityTables(<span class="keyword">int</span> quality)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">64</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> quant = Luminance_Quantization_Table[i] * quality / <span class="number">10</span>;</span><br><span class="line">quant == <span class="number">0</span> ? Y_Table[ZigZag[i]] = <span class="number">1</span>:Y_Table[ZigZag[i]] = quant;</span><br><span class="line">quant = Chrominance_Quantization_Table[i] * quality / <span class="number">10</span>;</span><br><span class="line">quant == <span class="number">0</span> ? CbCr_Table[ZigZag[i]] = <span class="number">1</span>:CbCr_Table[ZigZag[i]] = quant;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç”¨å¾—åˆ°çš„å¤„ç†åçš„é‡åŒ–è¡¨è¿›è¡Œé‡åŒ–å¤„ç†ï¼š</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> JpegCompress::Quality(<span class="keyword">float</span>* fdc_data, <span class="keyword">short</span>* Quant, <span class="keyword">unsigned</span> <span class="keyword">char</span>* Table) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> v=<span class="number">0</span>; v&lt;<span class="number">8</span>; v++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> u=<span class="number">0</span>; u&lt;<span class="number">8</span>; u++)</span><br><span class="line">&#123;</span><br><span class="line">Quant[ZigZag[v*<span class="number">8</span>+u]] = round(fdc_data[v*<span class="number">8</span>+u] / Table[ZigZag[v*<span class="number">8</span>+u]]);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>çŸ©é˜µçš„é‡åŒ–æœ€åä¸€æ­¥æ˜¯æŠŠé‡åŒ–åçš„äºŒç»´çŸ©é˜µè½¬å˜æˆä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œä»¥æ–¹ä¾¿åé¢çš„éœå¤«æ›¼å‹ç¼©ï¼Œä½†åœ¨åšè¿™ä¸ªé¡ºåºè½¬æ¢æ—¶ï¼Œéœ€è¦æŒ‰ç…§ä¸€ä¸ªç‰¹å®šçš„å–å€¼é¡ºåº ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„<strong>ZigZagæ‰«æ</strong></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”¨äºå¯¹é‡åŒ–åçš„çŸ©é˜µè¿›è¡Œé¡ºåºè°ƒæ•´</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> ZigZag[<span class="number">64</span>] =</span><br><span class="line">&#123; </span><br><span class="line"> <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">5</span>,  <span class="number">6</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">27</span>, <span class="number">28</span>,</span><br><span class="line"> <span class="number">2</span>,  <span class="number">4</span>,  <span class="number">7</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">26</span>, <span class="number">29</span>, <span class="number">42</span>,</span><br><span class="line"> <span class="number">3</span>,  <span class="number">8</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">41</span>, <span class="number">43</span>,</span><br><span class="line"> <span class="number">9</span>, <span class="number">11</span>, <span class="number">18</span>, <span class="number">24</span>, <span class="number">31</span>, <span class="number">40</span>, <span class="number">44</span>, <span class="number">53</span>,</span><br><span class="line"><span class="number">10</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">32</span>, <span class="number">39</span>, <span class="number">45</span>, <span class="number">52</span>, <span class="number">54</span>,</span><br><span class="line"><span class="number">20</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">38</span>, <span class="number">46</span>, <span class="number">51</span>, <span class="number">55</span>, <span class="number">60</span>,</span><br><span class="line"><span class="number">21</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">47</span>, <span class="number">50</span>, <span class="number">56</span>, <span class="number">59</span>, <span class="number">61</span>,</span><br><span class="line"><span class="number">35</span>, <span class="number">36</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">62</span>, <span class="number">63</span> </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="5-Huffmanç¼–ç "><a href="#5-Huffmanç¼–ç " class="headerlink" title="5.Huffmanç¼–ç "></a>5.Huffmanç¼–ç </h4><h5 id="a-DCç³»æ•°çš„DPCMç¼–ç ï¼š"><a href="#a-DCç³»æ•°çš„DPCMç¼–ç ï¼š" class="headerlink" title="a. DCç³»æ•°çš„DPCMç¼–ç ï¼š"></a>a. DCç³»æ•°çš„DPCMç¼–ç ï¼š</h5><p>å³å–åŒä¸€ä¸ªå›¾åƒåˆ†é‡ä¸­æ¯ä¸ªDCå€¼ä¸å‰ä¸€ä¸ªDCå€¼çš„å·®å€¼æ¥è¿›è¡Œç¼–ç ã€‚è¿™æ ·å¯¹å·®å€¼è¿›è¡Œç¼–ç æ‰€éœ€è¦çš„ä½æ•°ä¼šæ¯”å¯¹åŸå€¼è¿›è¡Œç¼–ç æ‰€éœ€è¦çš„ä½æ•°å°‘äº†å¾ˆå¤š ã€‚</p><ul><li>è¿™æ˜¯åŸºäºDCç³»æ•°çš„ä¸¤ä¸ªç‰¹ç‚¹ï¼š<ul><li>ç³»æ•°çš„æ•°å€¼æ¯”è¾ƒå¤§ï¼›</li><li>ç›¸é‚»çš„8*8å›¾åƒå—çš„DCç³»æ•°å€¼å˜åŒ–ä¸å¤§ï¼›</li></ul></li></ul><p><strong>ä»£ç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯¹DCåˆ†é‡è¿›è¡ŒDPCMç¼–ç </span></span><br><span class="line"><span class="keyword">int</span> dcDiff = (<span class="keyword">int</span>)(Quant[<span class="number">0</span>] - prev);</span><br><span class="line">prev = Quant[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">if</span> (dcDiff == <span class="number">0</span>) &#123;</span><br><span class="line">outputBit[ptr] = DC_Table[<span class="number">0</span>];</span><br><span class="line">ptr++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">Bit B;</span><br><span class="line"><span class="keyword">int</span> v = <span class="built_in">abs</span>(dcDiff);</span><br><span class="line"><span class="keyword">int</span> length = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (v) &#123;</span><br><span class="line">length++;</span><br><span class="line">v /= <span class="number">2</span>;</span><br><span class="line">&#125; </span><br><span class="line">B.value = dcDiff&gt;<span class="number">0</span> ? dcDiff : (<span class="built_in">pow</span>(<span class="number">2</span>,length)+dcDiff<span class="number">-1</span>);</span><br><span class="line">B.length = length;</span><br><span class="line">outputBit[ptr] = DC_Table[B.length];</span><br><span class="line">ptr++;</span><br><span class="line">outputBit[ptr] = B;</span><br><span class="line">ptr++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="b-ACç³»æ•°çš„æ¸¸é•¿ç¼–ç ï¼š"><a href="#b-ACç³»æ•°çš„æ¸¸é•¿ç¼–ç ï¼š" class="headerlink" title="b. ACç³»æ•°çš„æ¸¸é•¿ç¼–ç ï¼š"></a>b. ACç³»æ•°çš„æ¸¸é•¿ç¼–ç ï¼š</h5><p>é‡åŒ–ä¹‹åçš„ACç³»æ•°çš„ç‰¹ç‚¹æ˜¯ï¼Œ63ä¸ªç³»æ•°ä¸­å«æœ‰å¾ˆå¤šå€¼ä¸º0çš„ç³»æ•°ï¼Œå°¤å…¶æ˜¯åœ¨ZigZagæ‰«æä¹‹å0å¤§éƒ¨åˆ†é›†ä¸­åœ¨æ•°ç»„çš„åé¢ä½ç½®ã€‚å› æ­¤ï¼Œå¯ä»¥é‡‡ç”¨è¡Œç¨‹ç¼–ç RLCï¼ˆRun Length Codingï¼‰æ¥æ›´è¿›ä¸€æ­¥é™ä½æ•°æ®çš„ä¼ è¾“é‡ã€‚åˆ©ç”¨è¯¥ç¼–ç æ–¹å¼ï¼Œå¯ä»¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­é‡å¤å‡ºç°çš„è¿ç»­å­—ç¬¦ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥ä»£æ›¿ï¼Œå…¶ä¸­ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä»£è¡¨é‡å¤çš„æ¬¡æ•°ï¼Œç¬¬äºŒä¸ªå­—èŠ‚ä»£è¡¨è¢«é‡å¤çš„å­—ç¬¦ä¸²ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯¹ACåˆ†é‡è¿›è¡Œæ¸¸é•¿ç¼–ç </span></span><br><span class="line"><span class="keyword">int</span> end = <span class="number">63</span>;</span><br><span class="line"><span class="comment">//æ‰¾åˆ°æœ€åä¸ä¸º0çš„ä¹‹å‰éƒ¨åˆ†ï¼Œåé¢ä¸º0çš„å…¨éƒ¨ç½®ä¸ºEOB</span></span><br><span class="line"><span class="keyword">while</span>((end &gt; <span class="number">0</span>) &amp;&amp; (Quant[end] == <span class="number">0</span>)) end--;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=end; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> start = i;</span><br><span class="line"><span class="keyword">while</span>((Quant[i] == <span class="number">0</span>) &amp;&amp; (i &lt;= end)) i++;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> count = i - start;</span><br><span class="line"><span class="keyword">if</span> (count &gt;= <span class="number">16</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;=count/<span class="number">16</span>; j++) &#123;</span><br><span class="line">outputBit[ptr] = AC_Table[<span class="number">0xF0</span>];</span><br><span class="line">ptr++;</span><br><span class="line">&#125;</span><br><span class="line">count = count%<span class="number">16</span>;</span><br><span class="line">&#125;</span><br><span class="line">Bit B;</span><br><span class="line"><span class="keyword">int</span> v = <span class="built_in">abs</span>(Quant[i]);</span><br><span class="line"><span class="keyword">int</span> length = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (v) &#123;</span><br><span class="line">length++;</span><br><span class="line">v /= <span class="number">2</span>;</span><br><span class="line">&#125; </span><br><span class="line">B.value = Quant[i]&gt;<span class="number">0</span> ? Quant[i] : (<span class="built_in">pow</span>(<span class="number">2</span>,length)+Quant[i]<span class="number">-1</span>);</span><br><span class="line">B.length = length;</span><br><span class="line">outputBit[ptr] = AC_Table[(count * <span class="number">16</span>) | B.length];</span><br><span class="line">ptr++;</span><br><span class="line">outputBit[ptr] = B;</span><br><span class="line">ptr++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (end != <span class="number">63</span>) &#123;</span><br><span class="line">outputBit[ptr] = AC_Table[<span class="number">0x00</span>];</span><br><span class="line">ptr++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="c-ç†µç¼–ç ï¼ˆHuffmanç¼–ç ï¼‰"><a href="#c-ç†µç¼–ç ï¼ˆHuffmanç¼–ç ï¼‰" class="headerlink" title="c. ç†µç¼–ç ï¼ˆHuffmanç¼–ç ï¼‰"></a>c. ç†µç¼–ç ï¼ˆHuffmanç¼–ç ï¼‰</h5><p>Huffmanç¼–ç æ—¶DCç³»æ•°ä¸ACç³»æ•°åˆ†åˆ«é‡‡ç”¨ä¸åŒçš„Huffmanç¼–ç è¡¨ï¼Œå¯¹äºäº®åº¦å’Œè‰²åº¦ä¹Ÿé‡‡ç”¨ä¸åŒçš„Huffmanç¼–ç è¡¨ã€‚å› æ­¤ï¼Œéœ€è¦4å¼ Huffmanç¼–ç è¡¨æ‰èƒ½å®Œæˆç†µç¼–ç çš„å·¥ä½œã€‚å…·ä½“çš„Huffmanç¼–ç é‡‡ç”¨æŸ¥è¡¨çš„æ–¹å¼æ¥é«˜æ•ˆåœ°å®Œæˆã€‚ </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ ‡å‡†ç›´æµåˆ†é‡è‰²åº¦äº®åº¦å“ˆå¤«æ›¼è¡¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> Standard_DC_Luminance_NRCodes[] = &#123; <span class="number">0</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> Standard_DC_Luminance_Values[] = &#123; <span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> Standard_DC_Chrominance_NRCodes[] = &#123; <span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> Standard_DC_Chrominance_Values[] = &#123; <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ‡å‡†äº¤æµåˆ†é‡è‰²åº¦äº®åº¦å“ˆå¤«æ›¼è¡¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> Standard_AC_Luminance_NRCodes[] = &#123; <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0x7d</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> Standard_AC_Luminance_Values[] = </span><br><span class="line">&#123;</span><br><span class="line"><span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x11</span>, <span class="number">0x05</span>, <span class="number">0x12</span>,</span><br><span class="line"><span class="number">0x21</span>, <span class="number">0x31</span>, <span class="number">0x41</span>, <span class="number">0x06</span>, <span class="number">0x13</span>, <span class="number">0x51</span>, <span class="number">0x61</span>, <span class="number">0x07</span>,</span><br><span class="line"><span class="number">0x22</span>, <span class="number">0x71</span>, <span class="number">0x14</span>, <span class="number">0x32</span>, <span class="number">0x81</span>, <span class="number">0x91</span>, <span class="number">0xa1</span>, <span class="number">0x08</span>,</span><br><span class="line"><span class="number">0x23</span>, <span class="number">0x42</span>, <span class="number">0xb1</span>, <span class="number">0xc1</span>, <span class="number">0x15</span>, <span class="number">0x52</span>, <span class="number">0xd1</span>, <span class="number">0xf0</span>,</span><br><span class="line"><span class="number">0x24</span>, <span class="number">0x33</span>, <span class="number">0x62</span>, <span class="number">0x72</span>, <span class="number">0x82</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x16</span>,</span><br><span class="line"><span class="number">0x17</span>, <span class="number">0x18</span>, <span class="number">0x19</span>, <span class="number">0x1a</span>, <span class="number">0x25</span>, <span class="number">0x26</span>, <span class="number">0x27</span>, <span class="number">0x28</span>,</span><br><span class="line"><span class="number">0x29</span>, <span class="number">0x2a</span>, <span class="number">0x34</span>, <span class="number">0x35</span>, <span class="number">0x36</span>, <span class="number">0x37</span>, <span class="number">0x38</span>, <span class="number">0x39</span>,</span><br><span class="line"><span class="number">0x3a</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0x45</span>, <span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x48</span>, <span class="number">0x49</span>,</span><br><span class="line"><span class="number">0x4a</span>, <span class="number">0x53</span>, <span class="number">0x54</span>, <span class="number">0x55</span>, <span class="number">0x56</span>, <span class="number">0x57</span>, <span class="number">0x58</span>, <span class="number">0x59</span>,</span><br><span class="line"><span class="number">0x5a</span>, <span class="number">0x63</span>, <span class="number">0x64</span>, <span class="number">0x65</span>, <span class="number">0x66</span>, <span class="number">0x67</span>, <span class="number">0x68</span>, <span class="number">0x69</span>,</span><br><span class="line"><span class="number">0x6a</span>, <span class="number">0x73</span>, <span class="number">0x74</span>, <span class="number">0x75</span>, <span class="number">0x76</span>, <span class="number">0x77</span>, <span class="number">0x78</span>, <span class="number">0x79</span>,</span><br><span class="line"><span class="number">0x7a</span>, <span class="number">0x83</span>, <span class="number">0x84</span>, <span class="number">0x85</span>, <span class="number">0x86</span>, <span class="number">0x87</span>, <span class="number">0x88</span>, <span class="number">0x89</span>,</span><br><span class="line"><span class="number">0x8a</span>, <span class="number">0x92</span>, <span class="number">0x93</span>, <span class="number">0x94</span>, <span class="number">0x95</span>, <span class="number">0x96</span>, <span class="number">0x97</span>, <span class="number">0x98</span>,</span><br><span class="line"><span class="number">0x99</span>, <span class="number">0x9a</span>, <span class="number">0xa2</span>, <span class="number">0xa3</span>, <span class="number">0xa4</span>, <span class="number">0xa5</span>, <span class="number">0xa6</span>, <span class="number">0xa7</span>,</span><br><span class="line"><span class="number">0xa8</span>, <span class="number">0xa9</span>, <span class="number">0xaa</span>, <span class="number">0xb2</span>, <span class="number">0xb3</span>, <span class="number">0xb4</span>, <span class="number">0xb5</span>, <span class="number">0xb6</span>,</span><br><span class="line"><span class="number">0xb7</span>, <span class="number">0xb8</span>, <span class="number">0xb9</span>, <span class="number">0xba</span>, <span class="number">0xc2</span>, <span class="number">0xc3</span>, <span class="number">0xc4</span>, <span class="number">0xc5</span>,</span><br><span class="line"><span class="number">0xc6</span>, <span class="number">0xc7</span>, <span class="number">0xc8</span>, <span class="number">0xc9</span>, <span class="number">0xca</span>, <span class="number">0xd2</span>, <span class="number">0xd3</span>, <span class="number">0xd4</span>,</span><br><span class="line"><span class="number">0xd5</span>, <span class="number">0xd6</span>, <span class="number">0xd7</span>, <span class="number">0xd8</span>, <span class="number">0xd9</span>, <span class="number">0xda</span>, <span class="number">0xe1</span>, <span class="number">0xe2</span>,</span><br><span class="line"><span class="number">0xe3</span>, <span class="number">0xe4</span>, <span class="number">0xe5</span>, <span class="number">0xe6</span>, <span class="number">0xe7</span>, <span class="number">0xe8</span>, <span class="number">0xe9</span>, <span class="number">0xea</span>,</span><br><span class="line"><span class="number">0xf1</span>, <span class="number">0xf2</span>, <span class="number">0xf3</span>, <span class="number">0xf4</span>, <span class="number">0xf5</span>, <span class="number">0xf6</span>, <span class="number">0xf7</span>, <span class="number">0xf8</span>,</span><br><span class="line"><span class="number">0xf9</span>, <span class="number">0xfa</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> Standard_AC_Chrominance_NRCodes[] = &#123; <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0x77</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> Standard_AC_Chrominance_Values[] =</span><br><span class="line">&#123;</span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x11</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x21</span>,</span><br><span class="line"><span class="number">0x31</span>, <span class="number">0x06</span>, <span class="number">0x12</span>, <span class="number">0x41</span>, <span class="number">0x51</span>, <span class="number">0x07</span>, <span class="number">0x61</span>, <span class="number">0x71</span>,</span><br><span class="line"><span class="number">0x13</span>, <span class="number">0x22</span>, <span class="number">0x32</span>, <span class="number">0x81</span>, <span class="number">0x08</span>, <span class="number">0x14</span>, <span class="number">0x42</span>, <span class="number">0x91</span>,</span><br><span class="line"><span class="number">0xa1</span>, <span class="number">0xb1</span>, <span class="number">0xc1</span>, <span class="number">0x09</span>, <span class="number">0x23</span>, <span class="number">0x33</span>, <span class="number">0x52</span>, <span class="number">0xf0</span>,</span><br><span class="line"><span class="number">0x15</span>, <span class="number">0x62</span>, <span class="number">0x72</span>, <span class="number">0xd1</span>, <span class="number">0x0a</span>, <span class="number">0x16</span>, <span class="number">0x24</span>, <span class="number">0x34</span>,</span><br><span class="line"><span class="number">0xe1</span>, <span class="number">0x25</span>, <span class="number">0xf1</span>, <span class="number">0x17</span>, <span class="number">0x18</span>, <span class="number">0x19</span>, <span class="number">0x1a</span>, <span class="number">0x26</span>,</span><br><span class="line"><span class="number">0x27</span>, <span class="number">0x28</span>, <span class="number">0x29</span>, <span class="number">0x2a</span>, <span class="number">0x35</span>, <span class="number">0x36</span>, <span class="number">0x37</span>, <span class="number">0x38</span>,</span><br><span class="line"><span class="number">0x39</span>, <span class="number">0x3a</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0x45</span>, <span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x48</span>,</span><br><span class="line"><span class="number">0x49</span>, <span class="number">0x4a</span>, <span class="number">0x53</span>, <span class="number">0x54</span>, <span class="number">0x55</span>, <span class="number">0x56</span>, <span class="number">0x57</span>, <span class="number">0x58</span>,</span><br><span class="line"><span class="number">0x59</span>, <span class="number">0x5a</span>, <span class="number">0x63</span>, <span class="number">0x64</span>, <span class="number">0x65</span>, <span class="number">0x66</span>, <span class="number">0x67</span>, <span class="number">0x68</span>,</span><br><span class="line"><span class="number">0x69</span>, <span class="number">0x6a</span>, <span class="number">0x73</span>, <span class="number">0x74</span>, <span class="number">0x75</span>, <span class="number">0x76</span>, <span class="number">0x77</span>, <span class="number">0x78</span>,</span><br><span class="line"><span class="number">0x79</span>, <span class="number">0x7a</span>, <span class="number">0x82</span>, <span class="number">0x83</span>, <span class="number">0x84</span>, <span class="number">0x85</span>, <span class="number">0x86</span>, <span class="number">0x87</span>,</span><br><span class="line"><span class="number">0x88</span>, <span class="number">0x89</span>, <span class="number">0x8a</span>, <span class="number">0x92</span>, <span class="number">0x93</span>, <span class="number">0x94</span>, <span class="number">0x95</span>, <span class="number">0x96</span>,</span><br><span class="line"><span class="number">0x97</span>, <span class="number">0x98</span>, <span class="number">0x99</span>, <span class="number">0x9a</span>, <span class="number">0xa2</span>, <span class="number">0xa3</span>, <span class="number">0xa4</span>, <span class="number">0xa5</span>,</span><br><span class="line"><span class="number">0xa6</span>, <span class="number">0xa7</span>, <span class="number">0xa8</span>, <span class="number">0xa9</span>, <span class="number">0xaa</span>, <span class="number">0xb2</span>, <span class="number">0xb3</span>, <span class="number">0xb4</span>,</span><br><span class="line"><span class="number">0xb5</span>, <span class="number">0xb6</span>, <span class="number">0xb7</span>, <span class="number">0xb8</span>, <span class="number">0xb9</span>, <span class="number">0xba</span>, <span class="number">0xc2</span>, <span class="number">0xc3</span>,</span><br><span class="line"><span class="number">0xc4</span>, <span class="number">0xc5</span>, <span class="number">0xc6</span>, <span class="number">0xc7</span>, <span class="number">0xc8</span>, <span class="number">0xc9</span>, <span class="number">0xca</span>, <span class="number">0xd2</span>,</span><br><span class="line"><span class="number">0xd3</span>, <span class="number">0xd4</span>, <span class="number">0xd5</span>, <span class="number">0xd6</span>, <span class="number">0xd7</span>, <span class="number">0xd8</span>, <span class="number">0xd9</span>, <span class="number">0xda</span>,</span><br><span class="line"><span class="number">0xe2</span>, <span class="number">0xe3</span>, <span class="number">0xe4</span>, <span class="number">0xe5</span>, <span class="number">0xe6</span>, <span class="number">0xe7</span>, <span class="number">0xe8</span>, <span class="number">0xe9</span>,</span><br><span class="line"><span class="number">0xea</span>, <span class="number">0xf2</span>, <span class="number">0xf3</span>, <span class="number">0xf4</span>, <span class="number">0xf5</span>, <span class="number">0xf6</span>, <span class="number">0xf7</span>, <span class="number">0xf8</span>,</span><br><span class="line"><span class="number">0xf9</span>, <span class="number">0xfa</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å‚ç…§jpegå®˜æ–¹çš„æ–‡ä»¶äº¤æ¢æ ¼å¼å°†æ ‡å‡†éœå¤«æ›¼è¡¨è½¬æ¢ä¸ºå›¾åƒä¸­åº”ç”¨çš„åŒ…å«ï¼ˆHuffman_sizeã€Huffman_codeï¼‰çš„ç›¸åº”å››å¼ æŸ¥è¯¢è¡¨ã€‚     </p><p>åœ¨ã€ŠISO/IEC10918-1, 1993(e), Annex Cã€‹ä¸­ï¼Œç”¨ä¸‰ä¸ªæµç¨‹å›¾ï¼Œè¿›è¡Œäº†è¯¦ç»†çš„é˜è¿°ï¼Œä¸‹é¢æ˜¯å…¶ç›¸åº”çš„å®˜æ–¹è½¬æ¢Matlabä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">% æ ¹æ®DHTäº§ç”ŸHUFFSIZE[]ã€HUFFCODE[]</span><br><span class="line">% å‚è€ƒ<span class="string">"ISO/IEC10918-1, 1993(e), Annex C"</span></span><br><span class="line">% dxq@<span class="number">2014</span><span class="number">-04</span><span class="number">-24</span></span><br><span class="line"></span><br><span class="line">function[ehufco,ehufsi]=dedht(dht)</span><br><span class="line">bits =dht(<span class="number">1</span>:<span class="number">16</span>);</span><br><span class="line">huffval =dht(<span class="number">17</span>:end);</span><br><span class="line">% å‚è€ƒ<span class="string">"ISO/IEC10918-1, 1993(e), Annex C ,Figure C.1"</span></span><br><span class="line">k = <span class="number">0</span> ;</span><br><span class="line">j = <span class="number">1</span> ;</span><br><span class="line">fori=<span class="number">1</span>:<span class="number">16</span></span><br><span class="line">    <span class="keyword">for</span> j=<span class="number">1</span>:bits(i)</span><br><span class="line">        huffsize(k+<span class="number">1</span>)=i;</span><br><span class="line">        k=k+<span class="number">1</span>;</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">huffsize(k+<span class="number">1</span>)=<span class="number">0</span>;</span><br><span class="line">lastk = k;</span><br><span class="line"></span><br><span class="line">% å‚è€ƒ<span class="string">"ISO/IEC10918-1, 1993(e), Annex C ,Figure C.2"</span></span><br><span class="line">code = <span class="number">0</span>;</span><br><span class="line">k=<span class="number">1</span>;</span><br><span class="line">si =huffsize(<span class="number">1</span>);</span><br><span class="line">whilehuffsize(k)&gt;<span class="number">0</span></span><br><span class="line">    huffcode(k)=code ;</span><br><span class="line">    code = code + <span class="number">1</span> ;</span><br><span class="line">    k = k+ <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">while</span> huffsize(k)==si</span><br><span class="line">        huffcode(k)=code ;</span><br><span class="line">        code = code + <span class="number">1</span> ;</span><br><span class="line">        k = k+ <span class="number">1</span> ;</span><br><span class="line">    end</span><br><span class="line">    <span class="keyword">if</span> huffsize(k)==<span class="number">0</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    end</span><br><span class="line">    code = code * <span class="number">2</span> ;</span><br><span class="line">    si = si + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> huffsize(k)~= si</span><br><span class="line">        code = code * <span class="number">2</span> ;</span><br><span class="line">        si = si + <span class="number">1</span>;</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">% å‚è€ƒ<span class="string">"ISO/IEC10918-1, 1993(e), Annex C ,Figure C.3"</span></span><br><span class="line"><span class="keyword">for</span> k=<span class="number">1</span>:lastk</span><br><span class="line">    i=huffval(k);</span><br><span class="line">    ehufco(i+<span class="number">1</span>)=uint32(huffcode(k));</span><br><span class="line">    ehufsi(i+<span class="number">1</span>)=uint32(huffsize(k));</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p><strong>æ”¹å†™ä¸ºc++ä»£ç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> JpegCompress::InitHuffmanTables()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> pos = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">short</span> code_value = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">16</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= Standard_DC_Luminance_NRCodes[i<span class="number">-1</span>]; j++)</span><br><span class="line">&#123;</span><br><span class="line">Y_DC_Huffman[Standard_DC_Luminance_Values[pos]].value = code_value;</span><br><span class="line">Y_DC_Huffman[Standard_DC_Luminance_Values[pos]].length = i;</span><br><span class="line">pos++;</span><br><span class="line">code_value++;</span><br><span class="line">&#125;</span><br><span class="line">code_value *= <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">pos = <span class="number">0</span>; code_value = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">16</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= Standard_AC_Luminance_NRCodes[i<span class="number">-1</span>]; j++)</span><br><span class="line">&#123;</span><br><span class="line">Y_AC_Huffman[Standard_AC_Luminance_Values[pos]].value = code_value;</span><br><span class="line">Y_AC_Huffman[Standard_AC_Luminance_Values[pos]].length = i;</span><br><span class="line">pos++;</span><br><span class="line">code_value++;</span><br><span class="line">&#125;</span><br><span class="line">code_value *= <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">pos = <span class="number">0</span>; code_value = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">16</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= Standard_DC_Chrominance_NRCodes[i<span class="number">-1</span>]; j++)</span><br><span class="line">&#123;</span><br><span class="line">CbCr_DC_Huffman[Standard_DC_Chrominance_Values[pos]].value = code_value;</span><br><span class="line">CbCr_DC_Huffman[Standard_DC_Chrominance_Values[pos]].length = i;</span><br><span class="line">pos++;</span><br><span class="line">code_value++;</span><br><span class="line">&#125;</span><br><span class="line">code_value *= <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">pos = <span class="number">0</span>; code_value = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">16</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= Standard_AC_Chrominance_NRCodes[i<span class="number">-1</span>]; j++)</span><br><span class="line">&#123;</span><br><span class="line">CbCr_AC_Huffman[Standard_AC_Chrominance_Values[pos]].value = code_value;</span><br><span class="line">CbCr_AC_Huffman[Standard_AC_Chrominance_Values[pos]].length = i;</span><br><span class="line">pos++;</span><br><span class="line">code_value++;</span><br><span class="line">&#125;</span><br><span class="line">code_value *= <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>d. èŒƒå¼éœå¤«æ›¼ç¼–ç çš„æ ¼å¼ï¼š</strong></p><p>ä¸ºäº†æé«˜å‚¨å­˜æ•ˆç‡, JPEG é‡Œå¹¶ä¸ç›´æ¥ä¿å­˜æ•°å€¼, è€Œæ˜¯å°†æ•°å€¼æŒ‰ä½æ•°åˆ†æˆ 16 ç»„:</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">                æ•°å€¼                 ç»„              å®é™…ä¿å­˜å€¼</span><br><span class="line">                <span class="number">0</span>                   <span class="number">0</span>                   -</span><br><span class="line">              <span class="number">-1</span>,<span class="number">1</span>                  <span class="number">1</span>                  <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">           <span class="number">-3</span>,<span class="number">-2</span>,<span class="number">2</span>,<span class="number">3</span>                <span class="number">2</span>              <span class="number">00</span>,<span class="number">01</span>,<span class="number">10</span>,<span class="number">11</span></span><br><span class="line">     <span class="number">-7</span>,<span class="number">-6</span>,<span class="number">-5</span>,<span class="number">-4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>            <span class="number">3</span>    <span class="number">000</span>,<span class="number">001</span>,<span class="number">010</span>,<span class="number">011</span>,<span class="number">100</span>,<span class="number">101</span>,<span class="number">110</span>,<span class="number">111</span></span><br><span class="line">       <span class="number">-15</span>,..,<span class="number">-8</span>,<span class="number">8</span>,..,<span class="number">15</span>            <span class="number">4</span>       <span class="number">0000</span>,..,<span class="number">0111</span>,<span class="number">1000</span>,..,<span class="number">1111</span></span><br><span class="line">      <span class="number">-31</span>,..,<span class="number">-16</span>,<span class="number">16</span>,..,<span class="number">31</span>           <span class="number">5</span>     <span class="number">00000</span>,..,<span class="number">01111</span>,<span class="number">10000</span>,..,<span class="number">11111</span></span><br><span class="line">      <span class="number">-63</span>,..,<span class="number">-32</span>,<span class="number">32</span>,..,<span class="number">63</span>           <span class="number">6</span>                   .</span><br><span class="line">     <span class="number">-127</span>,..,<span class="number">-64</span>,<span class="number">64</span>,..,<span class="number">127</span>          <span class="number">7</span>                   .</span><br><span class="line">    <span class="number">-255</span>,..,<span class="number">-128</span>,<span class="number">128</span>,..,<span class="number">255</span>         <span class="number">8</span>                   .</span><br><span class="line">    <span class="number">-511</span>,..,<span class="number">-256</span>,<span class="number">256</span>,..,<span class="number">511</span>         <span class="number">9</span>                   .</span><br><span class="line">   <span class="number">-1023</span>,..,<span class="number">-512</span>,<span class="number">512</span>,..,<span class="number">1023</span>       <span class="number">10</span>                   .</span><br><span class="line">  <span class="number">-2047</span>,..,<span class="number">-1024</span>,<span class="number">1024</span>,..,<span class="number">2047</span>      <span class="number">11</span>                   .</span><br><span class="line">  <span class="number">-4095</span>,..,<span class="number">-2048</span>,<span class="number">2048</span>,..,<span class="number">4095</span>      <span class="number">12</span>                   .</span><br><span class="line">  <span class="number">-8191</span>,..,<span class="number">-4096</span>,<span class="number">4096</span>,..,<span class="number">8191</span>      <span class="number">13</span>                   .</span><br><span class="line"> <span class="number">-16383</span>,..,<span class="number">-8192</span>,<span class="number">8192</span>,..,<span class="number">16383</span>     <span class="number">14</span>                   .</span><br><span class="line"><span class="number">-32767</span>,..,<span class="number">-16384</span>,<span class="number">16384</span>,..,<span class="number">32767</span>    <span class="number">15</span>                   .</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//èŒƒå¼éœå¤«æ›¼ç¼–ç è¡¨æ•°å€¼èŒƒå›´</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">short</span> paradigm_table[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">16</span>,<span class="number">32</span>,<span class="number">64</span>,<span class="number">128</span>,<span class="number">256</span>,<span class="number">512</span>,<span class="number">1024</span>,<span class="number">2048</span>,<span class="number">4096</span>,<span class="number">8192</span>,<span class="number">16384</span>,<span class="number">32768</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((value &amp; paradigm_table[pos]) != <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">newByte = newByte  | paradigm_table[newBytePos];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è‡³æ­¤ï¼Œç»ˆäºå®Œæˆäº†éœå¤«æ›¼ç¼–ç ã€‚</strong></p><h4 id="6-jpegæ–‡ä»¶çš„å†™å…¥"><a href="#6-jpegæ–‡ä»¶çš„å†™å…¥" class="headerlink" title="6.jpegæ–‡ä»¶çš„å†™å…¥"></a>6.jpegæ–‡ä»¶çš„å†™å…¥</h4><p>æŸ¥è¯¢å®˜æ–¹çš„jpegæ ¼å¼è¦æ±‚ï¼Œé™„åœ¨txtæ–‡æ¡£ä¸­ã€‚</p><p><strong>jpegå¤´æ–‡ä»¶ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> JpegCompress::JpegHeader(FILE* fp)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//SOI</span></span><br><span class="line">WriteShort(<span class="number">0xFFD8</span>, fp);<span class="comment">// marker = 0xFFD8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//APPO</span></span><br><span class="line">WriteShort(<span class="number">0xFFE0</span>,fp);<span class="comment">// marker = 0xFFE0</span></span><br><span class="line">WriteShort(<span class="number">16</span>, fp);<span class="comment">// length = 16 for usual JPEG</span></span><br><span class="line">fwrite(<span class="string">"JFIF"</span>, <span class="number">1</span>, <span class="number">5</span>, fp);<span class="comment">// 'JFIF\0'</span></span><br><span class="line">WriteByte(<span class="number">1</span>, fp);<span class="comment">// version_hi</span></span><br><span class="line">WriteByte(<span class="number">1</span>, fp);<span class="comment">// version_low</span></span><br><span class="line">WriteByte(<span class="number">0</span>, fp);<span class="comment">// xyunits = 0 no units, normal density</span></span><br><span class="line">WriteShort(<span class="number">1</span>, fp);<span class="comment">// xdensity</span></span><br><span class="line">WriteShort(<span class="number">1</span>, fp);<span class="comment">// ydensity</span></span><br><span class="line">WriteByte(<span class="number">0</span>, fp);<span class="comment">// thumbWidth</span></span><br><span class="line">WriteByte(<span class="number">0</span>, fp);<span class="comment">// thumbHeight</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//DQT</span></span><br><span class="line">WriteShort(<span class="number">0xFFDB</span>, fp);<span class="comment">//marker = 0xFFDB</span></span><br><span class="line">WriteShort(<span class="number">132</span>, fp);<span class="comment">//size=132</span></span><br><span class="line">WriteByte(<span class="number">0</span>, fp);<span class="comment">//QTYinfo== 0:  bit 0..3: number of QT = 0 (table for Y) </span></span><br><span class="line"><span class="comment">//bit 4..7: precision of QT</span></span><br><span class="line"><span class="comment">//bit 8: 0</span></span><br><span class="line">fwrite(Y_Table, <span class="number">1</span>,  <span class="number">64</span>, fp);<span class="comment">//YTable</span></span><br><span class="line">WriteByte(<span class="number">1</span>, fp);<span class="comment">//QTCbinfo = 1 (quantization table for Cb,Cr)</span></span><br><span class="line">fwrite(CbCr_Table, <span class="number">1</span>, <span class="number">64</span>, fp);<span class="comment">//CbCrTable</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//SOFO</span></span><br><span class="line">WriteShort(<span class="number">0xFFC0</span>, fp);<span class="comment">//marker = 0xFFC0</span></span><br><span class="line">WriteShort(<span class="number">17</span>, fp);<span class="comment">//length = 17 for a truecolor YCbCr JPG</span></span><br><span class="line">WriteByte(<span class="number">8</span>, fp);<span class="comment">//precision = 8: 8 bits/sample </span></span><br><span class="line">WriteShort(Height&amp;<span class="number">0xFFFF</span>, fp);<span class="comment">//height</span></span><br><span class="line">WriteShort(Width&amp;<span class="number">0xFFFF</span>, fp);<span class="comment">//width</span></span><br><span class="line">WriteByte(<span class="number">3</span>, fp);<span class="comment">//nrofcomponents = 3</span></span><br><span class="line"></span><br><span class="line">WriteByte(<span class="number">1</span>, fp);<span class="comment">//IdY = 1</span></span><br><span class="line">WriteByte(<span class="number">0x11</span>, fp);<span class="comment">//HVY sampling factors for Y (bit 0-3 vert., 4-7 hor.)(SuBamp 1x1)</span></span><br><span class="line">WriteByte(<span class="number">0</span>, fp);<span class="comment">//QTY </span></span><br><span class="line"></span><br><span class="line">WriteByte(<span class="number">2</span>, fp);<span class="comment">//IdCb = 2</span></span><br><span class="line">WriteByte(<span class="number">0x11</span>, fp);<span class="comment">//HVCb = 0x11(SuBamp 1x1)</span></span><br><span class="line">WriteByte(<span class="number">1</span>, fp);<span class="comment">//QTCb = 1</span></span><br><span class="line"></span><br><span class="line">WriteByte(<span class="number">3</span>, fp);<span class="comment">//IdCr = 3</span></span><br><span class="line">WriteByte(<span class="number">0x11</span>, fp);<span class="comment">//HVCr = 0x11 (SuBamp 1x1)</span></span><br><span class="line">WriteByte(<span class="number">1</span>, fp);<span class="comment">//QTCr </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//DHT</span></span><br><span class="line">WriteShort(<span class="number">0xFFC4</span>, fp);<span class="comment">//marker = 0xFFC4</span></span><br><span class="line">WriteShort(<span class="number">0x01A2</span>, fp);<span class="comment">//length = 0x01A2</span></span><br><span class="line">WriteByte(<span class="number">0</span>, fp);<span class="comment">//HTYDCinfo bit 0..3</span></span><br><span class="line"><span class="comment">//bit 4</span></span><br><span class="line"><span class="comment">//bit 5..7</span></span><br><span class="line">fwrite(Standard_DC_Luminance_NRCodes, <span class="number">1</span>, <span class="keyword">sizeof</span>(Standard_DC_Luminance_NRCodes), fp);<span class="comment">//DC_L_NRC</span></span><br><span class="line">fwrite(Standard_DC_Luminance_Values, <span class="number">1</span>, <span class="keyword">sizeof</span>(Standard_DC_Luminance_Values), fp);<span class="comment">//DC_L_VALUE</span></span><br><span class="line">WriteByte(<span class="number">0x10</span>, fp);<span class="comment">//HTYACinfo</span></span><br><span class="line">fwrite(Standard_AC_Luminance_NRCodes, <span class="number">1</span>, <span class="keyword">sizeof</span>(Standard_AC_Luminance_NRCodes), fp);</span><br><span class="line">fwrite(Standard_AC_Luminance_Values, <span class="number">1</span>, <span class="keyword">sizeof</span>(Standard_AC_Luminance_Values), fp); </span><br><span class="line">WriteByte(<span class="number">0x01</span>, fp);<span class="comment">//HTCbDCinfo</span></span><br><span class="line">fwrite(Standard_DC_Chrominance_NRCodes, <span class="number">1</span>, <span class="keyword">sizeof</span>(Standard_DC_Chrominance_NRCodes), fp);</span><br><span class="line">fwrite(Standard_DC_Chrominance_Values, <span class="number">1</span>, <span class="keyword">sizeof</span>(Standard_DC_Chrominance_Values), fp);</span><br><span class="line">WriteByte(<span class="number">0x11</span>, fp);<span class="comment">//HTCbACinfo</span></span><br><span class="line">fwrite(Standard_AC_Chrominance_NRCodes, <span class="number">1</span>, <span class="keyword">sizeof</span>(Standard_AC_Chrominance_NRCodes), fp);</span><br><span class="line">fwrite(Standard_AC_Chrominance_Values, <span class="number">1</span>, <span class="keyword">sizeof</span>(Standard_AC_Chrominance_Values), fp);</span><br><span class="line"></span><br><span class="line"><span class="comment">//SOS</span></span><br><span class="line">WriteShort(<span class="number">0xFFDA</span>, fp);<span class="comment">//marker = 0xFFC4</span></span><br><span class="line">WriteShort(<span class="number">12</span>, fp);<span class="comment">//length = 12</span></span><br><span class="line">WriteByte(<span class="number">3</span>, fp);<span class="comment">//nrofcomponents, Should be 3: truecolor JPG</span></span><br><span class="line"></span><br><span class="line">WriteByte(<span class="number">1</span>, fp);<span class="comment">//Idy=1</span></span><br><span class="line">WriteByte(<span class="number">0</span>, fp);<span class="comment">//HTYbits 0..3: AC table (0..3)</span></span><br><span class="line"><span class="comment">//bits 4..7: DC table (0..3)</span></span><br><span class="line">WriteByte(<span class="number">2</span>, fp);<span class="comment">//IdCb</span></span><br><span class="line">WriteByte(<span class="number">0x11</span>, fp);<span class="comment">//HTCb</span></span><br><span class="line"></span><br><span class="line">WriteByte(<span class="number">3</span>, fp);<span class="comment">//IdCr</span></span><br><span class="line">WriteByte(<span class="number">0x11</span>, fp);<span class="comment">//HTCr</span></span><br><span class="line"></span><br><span class="line">WriteByte(<span class="number">0</span>, fp);<span class="comment">//Ss</span></span><br><span class="line">WriteByte(<span class="number">0x3F</span>, fp);<span class="comment">//Se</span></span><br><span class="line">WriteByte(<span class="number">0</span>, fp);<span class="comment">//Bf</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¼–ç éƒ¨åˆ†çš„å†™å…¥ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> JpegCompress::WriteToJpeg(<span class="keyword">const</span> Bit* B, <span class="keyword">int</span> counts, <span class="keyword">int</span>&amp; newByte, <span class="keyword">int</span>&amp; newBytePos, FILE* fp)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;counts; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> value = B[i].value;</span><br><span class="line"><span class="keyword">int</span> pos = B[i].length - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> (pos &gt;= <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> ((value &amp; paradigm_table[pos]) != <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">newByte = newByte  | paradigm_table[newBytePos];</span><br><span class="line">&#125;</span><br><span class="line">pos--;</span><br><span class="line">newBytePos--;</span><br><span class="line"><span class="keyword">if</span> (newBytePos &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å†™å…¥</span></span><br><span class="line">WriteByte((<span class="keyword">unsigned</span> <span class="keyword">char</span>)(newByte), fp);</span><br><span class="line"><span class="keyword">if</span> (newByte == <span class="number">255</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ç‰¹æ®Šå¤„ç†</span></span><br><span class="line">WriteByte((<span class="keyword">unsigned</span> <span class="keyword">char</span>)(<span class="number">0x00</span>), fp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–æ›´æ–°</span></span><br><span class="line">newBytePos = <span class="number">7</span>;</span><br><span class="line">newByte = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7-å®ç°æ•ˆæœï¼š"><a href="#7-å®ç°æ•ˆæœï¼š" class="headerlink" title="7.å®ç°æ•ˆæœï¼š"></a>7.å®ç°æ•ˆæœï¼š</h4><p>å¯¹ä¸åŒç­‰çº§çš„é‡åŒ–ç¨‹åº¦è¿›è¡Œæµ‹è¯•ï¼Œå‡å¾—åˆ°ç†æƒ³æ•ˆæœï¼š</p><p>ä¾‹å¦‚ä¸‹é¢æ˜¯é‡åŒ–ç­‰çº§ä¸º5æ—¶çš„ç»“æœå›¾ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20181209192830119.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20181209192837786.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>å‚è€ƒæ–‡çŒ®ï¼š</strong></p><p><a href="https://www.codingnow.com/2000/download/jpeg.txt" target="_blank" rel="noopener">https://www.codingnow.com/2000/download/jpeg.txt</a></p><p><a href="https://www.impulseadventure.com/photo/jpeg-huffman-coding.html" target="_blank" rel="noopener">https://www.impulseadventure.com/photo/jpeg-huffman-coding.html</a></p><p><a href="https://www.w3.org/Graphics/JPEG/jfif.txt" target="_blank" rel="noopener">https://www.w3.org/Graphics/JPEG/jfif.txt</a></p><p><a href="https://blog.csdn.net/carson2005/article/details/7753499" target="_blank" rel="noopener">https://blog.csdn.net/carson2005/article/details/7753499</a></p><p><a href="https://blog.csdn.net/fzh2712/article/details/28318715" target="_blank" rel="noopener">https://blog.csdn.net/fzh2712/article/details/28318715</a></p><p><strong>é™„å½•ï¼š</strong></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line">é™„:JPEG æ–‡ä»¶æ ¼å¼</span><br><span class="line">~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line"><span class="code">  - æ–‡ä»¶å¤´ (2 bytes):  $ff, $d8 (SOI) (JPEG æ–‡ä»¶æ ‡è¯†)</span></span><br><span class="line"><span class="code">  - ä»»æ„æ•°é‡çš„æ®µ , è§åé¢</span></span><br><span class="line"><span class="code">  - æ–‡ä»¶ç»“æŸ (2 bytes): $ff, $d9 (EOI)</span></span><br><span class="line"></span><br><span class="line">æ®µçš„æ ¼å¼:</span><br><span class="line">~~~~~~~~~</span><br><span class="line"></span><br><span class="line"><span class="code">  - header (4 bytes):</span></span><br><span class="line"><span class="code">       $ff     æ®µæ ‡è¯†</span></span><br><span class="line"><span class="code">        n      æ®µçš„ç±»å‹ (1 byte)</span></span><br><span class="line"><span class="code">       sh, sl  è¯¥æ®µé•¿åº¦, åŒ…æ‹¬è¿™ä¸¤ä¸ªå­—èŠ‚, ä½†æ˜¯ä¸åŒ…æ‹¬å‰é¢çš„ $ff å’Œ n.</span></span><br><span class="line"><span class="code">               æ³¨æ„: é•¿åº¦ä¸æ˜¯ intel æ¬¡åº, è€Œæ˜¯ Motorola çš„, é«˜å­—èŠ‚åœ¨å‰,</span></span><br><span class="line"><span class="code">       ä½å­—èŠ‚åœ¨å!</span></span><br><span class="line"><span class="code">  - è¯¥æ®µçš„å†…å®¹, æœ€å¤š 65533 å­—èŠ‚</span></span><br><span class="line"></span><br><span class="line"><span class="code"> æ³¨æ„:</span></span><br><span class="line"><span class="code">  - æœ‰ä¸€äº›æ— å‚æ•°çš„æ®µ (ä¸‹é¢é‚£äº›å‰é¢æ³¨æ˜æ˜Ÿå·çš„)</span></span><br><span class="line"><span class="code">    è¿™äº›æ®µæ²¡æœ‰é•¿åº¦æè¿° (è€Œä¸”æ²¡æœ‰å†…å®¹), åªæœ‰ $ff å’Œç±»å‹å­—èŠ‚.</span></span><br><span class="line"><span class="code">  - æ®µä¹‹é—´æ— è®ºæœ‰å¤šå°‘ $ff éƒ½æ˜¯åˆæ³•çš„, å¿…é¡»è¢«å¿½ç•¥æ‰.</span></span><br><span class="line"></span><br><span class="line">æ®µçš„ç±»å‹:</span><br><span class="line">~~~~~~~~~</span><br><span class="line"></span><br><span class="line"><span class="code">   *TEM   = $01   å¯ä»¥å¿½ç•¥æ‰</span></span><br><span class="line"></span><br><span class="line"><span class="code">    SOF0  = $c0   å¸§å¼€å§‹ (baseline JPEG), ç»†èŠ‚é™„å</span></span><br><span class="line"><span class="code">    SOF1  = $c1   dito</span></span><br><span class="line"><span class="code">    SOF2  = $c2   é€šå¸¸ä¸æ”¯æŒ</span></span><br><span class="line"><span class="code">    SOF3  = $c3   é€šå¸¸ä¸æ”¯æŒ</span></span><br><span class="line"></span><br><span class="line"><span class="code">    SOF5  = $c5   é€šå¸¸ä¸æ”¯æŒ</span></span><br><span class="line"><span class="code">    SOF6  = $c6   é€šå¸¸ä¸æ”¯æŒ</span></span><br><span class="line"><span class="code">    SOF7  = $c7   é€šå¸¸ä¸æ”¯æŒ</span></span><br><span class="line"></span><br><span class="line"><span class="code">    SOF9  = $c9   arithmetic ç¼–ç (Huffman çš„ä¸€ç§æ‰©å±•ç®—æ³•), é€šå¸¸ä¸æ”¯æŒ</span></span><br><span class="line"><span class="code">    SOF10 = $ca   é€šå¸¸ä¸æ”¯æŒ</span></span><br><span class="line"><span class="code">    SOF11 = $cb   é€šå¸¸ä¸æ”¯æŒ</span></span><br><span class="line"></span><br><span class="line"><span class="code">    SOF13 = $cd   é€šå¸¸ä¸æ”¯æŒ</span></span><br><span class="line"><span class="code">    SOF14 = $ce   é€šå¸¸ä¸æ”¯æŒ</span></span><br><span class="line"><span class="code">    SOF14 = $ce   é€šå¸¸ä¸æ”¯æŒ</span></span><br><span class="line"><span class="code">    SOF15 = $cf   é€šå¸¸ä¸æ”¯æŒ</span></span><br><span class="line"></span><br><span class="line"><span class="code">    DHT   = $c4   å®šä¹‰ Huffman Table,  ç»†èŠ‚é™„å</span></span><br><span class="line"><span class="code">    JPG   = $c8   æœªå®šä¹‰/ä¿ç•™ (å¼•èµ·è§£ç é”™è¯¯)</span></span><br><span class="line"><span class="code">    DAC   = $cc   å®šä¹‰ Arithmetic Table, é€šå¸¸ä¸æ”¯æŒ</span></span><br><span class="line"></span><br><span class="line"><span class="code">   *RST0  = $d0   RSTn ç”¨äº resync, é€šå¸¸è¢«å¿½ç•¥</span></span><br><span class="line"><span class="code">   *RST1  = $d1</span></span><br><span class="line"><span class="code">   *RST2  = $d2</span></span><br><span class="line"><span class="code">   *RST3  = $d3</span></span><br><span class="line"><span class="code">   *RST4  = $d4</span></span><br><span class="line"><span class="code">   *RST5  = $d5</span></span><br><span class="line"><span class="code">   *RST6  = $d6</span></span><br><span class="line"><span class="code">   *RST7  = $d7</span></span><br><span class="line"></span><br><span class="line"><span class="code">    SOI   = $d8   å›¾ç‰‡å¼€å§‹</span></span><br><span class="line"><span class="code">    EOI   = $d9   å›¾ç‰‡ç»“æŸ</span></span><br><span class="line"><span class="code">    SOS   = $da   æ‰«æè¡Œå¼€å§‹, ç»†èŠ‚é™„å</span></span><br><span class="line"><span class="code">    DQT   = $db   å®šä¹‰ Quantization Table, ç»†èŠ‚é™„å</span></span><br><span class="line"><span class="code">    DNL   = $dc   é€šå¸¸ä¸æ”¯æŒ, å¿½ç•¥</span></span><br><span class="line"><span class="code">    DRI   = $dd   å®šä¹‰é‡æ–°å¼€å§‹é—´éš”, ç»†èŠ‚é™„å</span></span><br><span class="line"><span class="code">    DHP   = $de   å¿½ç•¥ (è·³è¿‡)</span></span><br><span class="line"><span class="code">    EXP   = $df   å¿½ç•¥ (è·³è¿‡)</span></span><br><span class="line"></span><br><span class="line"><span class="code">    APP0  = $e0   JFIF APP0 segment marker (ç»†èŠ‚ç•¥)</span></span><br><span class="line"><span class="code">    APP15 = $ef   å¿½ç•¥</span></span><br><span class="line"></span><br><span class="line"><span class="code">    JPG0  = $f0   å¿½ç•¥ (è·³è¿‡)</span></span><br><span class="line"><span class="code">    JPG13 = $fd   å¿½ç•¥ (è·³è¿‡)</span></span><br><span class="line"><span class="code">    COM   = $fe   æ³¨é‡Š, ç»†èŠ‚é™„å</span></span><br><span class="line"></span><br><span class="line"><span class="code"> å…¶å®ƒçš„æ®µç±»å‹éƒ½ä¿ç•™å¿…é¡»è·³è¿‡</span></span><br><span class="line"></span><br><span class="line">SOF0: Start Of Frame 0:</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line"><span class="code">  - $ff, $c0 (SOF0)</span></span><br><span class="line"><span class="code">  - é•¿åº¦ (é«˜å­—èŠ‚, ä½å­—èŠ‚), 8+components*3</span></span><br><span class="line"><span class="code">  - æ•°æ®ç²¾åº¦ (1 byte) æ¯ä¸ªæ ·æœ¬ä½æ•°, é€šå¸¸æ˜¯ 8 (å¤§å¤šæ•°è½¯ä»¶ä¸æ”¯æŒ 12 å’Œ 16)</span></span><br><span class="line"><span class="code">  - å›¾ç‰‡é«˜åº¦ (é«˜å­—èŠ‚, ä½å­—èŠ‚), å¦‚æœä¸æ”¯æŒ DNL å°±å¿…é¡» &gt;0</span></span><br><span class="line"><span class="code">  - å›¾ç‰‡å®½åº¦ (é«˜å­—èŠ‚, ä½å­—èŠ‚), å¦‚æœä¸æ”¯æŒ DNL å°±å¿…é¡» &gt;0</span></span><br><span class="line"><span class="code">  - components æ•°é‡(1 byte), ç°åº¦å›¾æ˜¯ 1, YCbCr/YIQ å½©è‰²å›¾æ˜¯ 3, CMYK å½©è‰²å›¾</span></span><br><span class="line"><span class="code">    æ˜¯ 4</span></span><br><span class="line"><span class="code">  - æ¯ä¸ª component: 3 bytes</span></span><br><span class="line"><span class="code">     - component id (1 = Y, 2 = Cb, 3 = Cr, 4 = I, 5 = Q)</span></span><br><span class="line"><span class="code">     - é‡‡æ ·ç³»æ•° (bit 0-3 vert., 4-7 hor.)</span></span><br><span class="line"><span class="code">     - quantization table å·</span></span><br><span class="line"></span><br><span class="line">DRI: Define Restart Interval:</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line"><span class="code">  - $ff, $dd (DRI)</span></span><br><span class="line"><span class="code">  - é•¿åº¦ (é«˜å­—èŠ‚, ä½å­—èŠ‚), å¿…é¡»æ˜¯ 4</span></span><br><span class="line"><span class="code">  - MCU å—çš„å•å…ƒä¸­çš„é‡æ–°å¼€å§‹é—´éš” (é«˜å­—èŠ‚, ä½å­—èŠ‚),</span></span><br><span class="line"><span class="code">    æ„æ€æ˜¯è¯´, æ¯ n ä¸ª MCU å—å°±æœ‰ä¸€ä¸ª RSTn æ ‡è®°.</span></span><br><span class="line"><span class="code">    ç¬¬ä¸€ä¸ªæ ‡è®°æ˜¯ RST0, ç„¶åæ˜¯ RST1 ç­‰, RST7 åå†ä» RST0 é‡å¤ </span></span><br><span class="line"></span><br><span class="line">DQT: Define Quantization Table:</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line"><span class="code">  - $ff, $db (DQT)</span></span><br><span class="line"><span class="code">  - é•¿åº¦ (é«˜å­—èŠ‚, ä½å­—èŠ‚)</span></span><br><span class="line"><span class="code">  - QT ä¿¡æ¯ (1 byte):</span></span><br><span class="line"><span class="code">     bit 0..3: QT å·(0..3, å¦åˆ™é”™è¯¯)</span></span><br><span class="line"><span class="code">     bit 4..7: QT ç²¾åº¦, 0 = 8 bit, å¦åˆ™ 16 bit</span></span><br><span class="line"><span class="code">  - n å­—èŠ‚çš„ QT, n = 64*(ç²¾åº¦+1)</span></span><br><span class="line"></span><br><span class="line"><span class="code"> å¤‡æ³¨:</span></span><br><span class="line"><span class="code">  - ä¸€ä¸ªå•ç‹¬çš„ DQT æ®µå¯ä»¥åŒ…å«å¤šä¸ª QT, æ¯ä¸ªéƒ½æœ‰è‡ªå·±çš„ä¿¡æ¯å­—èŠ‚</span></span><br><span class="line"><span class="code">  - å½“ç²¾åº¦=1 (16 bit), æ¯ä¸ªå­—éƒ½æ˜¯é«˜ä½åœ¨å‰ä½ä½åœ¨å</span></span><br><span class="line"></span><br><span class="line">DAC: Define Arithmetic Table:</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"><span class="code"> æ³•å¾‹åŸå› , ç°åœ¨çš„è½¯ä»¶ä¸æ”¯æŒ arithmetic ç¼–ç .</span></span><br><span class="line"><span class="code"> ä¸èƒ½ç”Ÿäº§ä½¿ç”¨ arithmetic ç¼–ç çš„ JPEG æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">DHT: Define Huffman Table:</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line"><span class="code">  - $ff, $c4 (DHT)</span></span><br><span class="line"><span class="code">  - é•¿åº¦ (é«˜å­—èŠ‚, ä½å­—èŠ‚)</span></span><br><span class="line"><span class="code">  - HT ä¿¡æ¯ (1 byte):</span></span><br><span class="line"><span class="code">     bit 0..3: HT å· (0..3, å¦åˆ™é”™è¯¯)</span></span><br><span class="line"><span class="code">     bit 4   : HT ç±»å‹, 0 = DC table, 1 = AC table</span></span><br><span class="line"><span class="code">     bit 5..7: å¿…é¡»æ˜¯ 0</span></span><br><span class="line"><span class="code">  - 16 bytes: é•¿åº¦æ˜¯ 1..16 ä»£ç çš„ç¬¦å·æ•°. è¿™ 16 ä¸ªæ•°çš„å’Œåº”è¯¥ &lt;=256</span></span><br><span class="line"><span class="code">  - n bytes: ä¸€ä¸ªåŒ…å«äº†æŒ‰é€’å¢æ¬¡åºä»£ç é•¿åº¦æ’åˆ—çš„ç¬¦å·è¡¨</span></span><br><span class="line"><span class="code">    (n = ä»£ç æ€»æ•°)</span></span><br><span class="line"></span><br><span class="line"><span class="code"> å¤‡æ³¨:</span></span><br><span class="line"><span class="code">  - ä¸€ä¸ªå•ç‹¬çš„ DHT æ®µå¯ä»¥åŒ…å«å¤šä¸ª HT, æ¯ä¸ªéƒ½æœ‰è‡ªå·±çš„ä¿¡æ¯å­—èŠ‚</span></span><br><span class="line"></span><br><span class="line">COM: æ³¨é‡Š:</span><br><span class="line">~~~~~~~~~~</span><br><span class="line"></span><br><span class="line"><span class="code">  - $ff, $fe (COM)</span></span><br><span class="line"><span class="code">  - æ³¨é‡Šé•¿åº¦ (é«˜å­—èŠ‚, ä½å­—èŠ‚) = L+2</span></span><br><span class="line"><span class="code">  - æ³¨é‡Šä¸ºé•¿åº¦ä¸º L çš„å­—ç¬¦æµ</span></span><br><span class="line"></span><br><span class="line">SOS: Start Of Scan:</span><br><span class="line">~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line"><span class="code">  - $ff, $da (SOS)</span></span><br><span class="line"><span class="code">  - é•¿åº¦ (é«˜å­—èŠ‚, ä½å­—èŠ‚), å¿…é¡»æ˜¯ 6+2*(æ‰«æè¡Œå†…ç»„ä»¶çš„æ•°é‡)</span></span><br><span class="line"><span class="code">  - æ‰«æè¡Œå†…ç»„ä»¶çš„æ•°é‡ (1 byte), å¿…é¡» &gt;= 1 , &lt;=4 (å¦åˆ™æ˜¯é”™çš„) é€šå¸¸æ˜¯ 3</span></span><br><span class="line"><span class="code">  - æ¯ä¸ªç»„ä»¶: 2 bytes</span></span><br><span class="line"><span class="code">     - component id (1 = Y, 2 = Cb, 3 = Cr, 4 = I, 5 = Q), è§ SOF0</span></span><br><span class="line"><span class="code">     - ä½¿ç”¨çš„ Huffman è¡¨:</span></span><br><span class="line"><span class="code">- bit 0..3: AC table (0..3)</span></span><br><span class="line"><span class="code">- bit 4..7: DC table (0..3)</span></span><br><span class="line"><span class="code">  - å¿½ç•¥ 3 bytes (???)</span></span><br><span class="line"></span><br><span class="line"><span class="code"> å¤‡æ³¨:</span></span><br><span class="line"><span class="code">  - å›¾ç‰‡æ•°æ® (ä¸€ä¸ªä¸ªæ‰«æè¡Œ) ç´§æ¥ç€ SOS æ®µ.</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;ç¼–è¯‘ç¯å¢ƒ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;windows10ä¸‹MinGW&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¼–è¯‘è¯­è¨€&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;c++ &amp;amp;&amp;amp; CImgåº“&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿è¡Œå‘½ä»¤&lt;/strong&gt;&lt;/p&gt;
&lt;p
      
    
    </summary>
    
      <category term="å¤šåª’ä½“æŠ€æœ¯" scheme="http://yoursite.com/categories/%E5%A4%9A%E5%AA%92%E4%BD%93%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="å¤šåª’ä½“æŠ€æœ¯" scheme="http://yoursite.com/tags/%E5%A4%9A%E5%AA%92%E4%BD%93%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>è‡ªå®šä¹‰åè®®å®ç°ç‚¹å¯¹ç‚¹å¤§æ–‡ä»¶ä¼ è¾“</title>
    <link href="http://yoursite.com/2019/07/06/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0%E7%82%B9%E5%AF%B9%E7%82%B9%E5%A4%A7%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93/"/>
    <id>http://yoursite.com/2019/07/06/è‡ªå®šä¹‰åè®®å®ç°ç‚¹å¯¹ç‚¹å¤§æ–‡ä»¶ä¼ è¾“/</id>
    <published>2019-07-06T13:03:08.000Z</published>
    <updated>2019-07-06T13:03:39.834Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://img-blog.csdnimg.cn/20181120233209761.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ä¸€éƒ¨åˆ†å…¶å®å°±æ˜¯å®ç°å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„ä¸€ä¸ªå¤§æ–‡ä»¶çš„ä¼ è¾“ï¼Œå› ä¸ºé¢˜ç›®è¦æ±‚æ˜¯åªéœ€è¦è‡ªå®šä¹‰åº”ç”¨å±‚åè®®ï¼Œæ‰€ä»¥æœ¬é¡¹ç›®æ˜¯åŸºäºTCP(ä¼ è¾“å±‚)åè®®ä¸‹å®ç°çš„ã€‚é‡‡ç”¨çš„æ˜¯pythonçš„structæ¨¡å—å¯¹ä¼ è¾“ä¿¡æ¯è¿›è¡Œæ‰“åŒ…ä»¥ä¾¿åº”å¯¹ä¸åŒç±»å‹çš„ä¼ è¾“æ–‡ä»¶ï¼ŒåŒæ—¶å¯ä»¥è½¬ä¸ºç”¨äºä¼ è¾“çš„byteç±»å‹ã€‚</p><p>é’ˆå¯¹å¤§æ–‡ä»¶çš„ä¼ è¾“å¼€å§‹æ˜¯æƒ³ç›´æ¥ç”¨åŠ¨æ€åˆ†é…å†…å­˜ç»™æ–‡ä»¶ä¼ è¾“åˆ†é…ä¸€ä¸ªå¤§å®¹é‡çš„å †ä½œä¸ºç¼“å†²åŒºï¼Œä½†æ„Ÿè§‰è¿™æ ·å°±è¿èƒŒäº†æœ¬é¢˜çš„æ„æ€è€Œä¸”å¯¹äºæ–‡ä»¶ä¼ è¾“çš„æ•ˆç‡ä¸é«˜ï¼Œäºæ˜¯é‡‡ç”¨å°ç¼“å†²åŒºåˆ†æ®µå¯¹æ–‡ä»¶è¿›è¡Œä¼ è¾“ã€‚</p><p><strong>å®ç°çš„åŠŸèƒ½ä¸ºï¼š</strong></p><p>æœåŠ¡ç«¯æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„éœ€æ±‚è¯·æ±‚å</p><p>æœåŠ¡ç«¯å®ç°ä¸‰ä¸ªåŠŸèƒ½ï¼š<br>1.å®¢æˆ·ç«¯è¯·æ±‚ä¸‹è½½æœåŠ¡ç«¯çš„æ–‡ä»¶ï¼ŒæœåŠ¡ç«¯è¿”å›ç»™å®¢æˆ·ç«¯å¯ä¸‹è½½çš„æ–‡ä»¶åˆ—è¡¨ï¼ŒæœåŠ¡ç«¯æ ¹æ®åˆ—è¡¨é€‰é¡¹å®Œæˆä¸‹è½½<br>2.å®¢æˆ·ç«¯è¯·æ±‚ä¸Šä¼ æ–‡ä»¶ï¼Œé€‰æ‹©ä¸€ä¸ªæœ¬åœ°çš„æ–‡ä»¶è¿›è¡Œä¸Šä¼ <br>3.å®¢æˆ·ç«¯è¯·æ±‚æ–­å¼€è¿æ¥åŒæ—¶å…³é—­æœåŠ¡å™¨</p><p><strong>å¾…å®Œå–„åŠŸèƒ½ï¼š</strong></p><p>å®ç°å¤šçº¿ç¨‹è¿æ¥ (æœ¬é¢˜æ¥è¯´å¿…è¦æ€§ä¸å¤§æ„Ÿè§‰)</p><p>åˆ©ç”¨pythonçš„guiæ¨¡å—åšä¸€ä¸ªæ•´æ´å¥½çœ‹çš„ç•Œé¢ (å°è¯•è¿‡è¢«å‡ºç°çš„å¥‡å¥‡æ€ªæ€ªçš„bugæ‰“è´¥)</p><p><strong>å®¢æˆ·ç«¯ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„éœ€æ±‚è¯·æ±‚å</span></span><br><span class="line"><span class="string">æœåŠ¡ç«¯å®ç°ä¸‰ä¸ªåŠŸèƒ½ï¼š</span></span><br><span class="line"><span class="string">1.å®¢æˆ·ç«¯è¯·æ±‚ä¸‹è½½æœåŠ¡ç«¯çš„æ–‡ä»¶ï¼ŒæœåŠ¡ç«¯è¿”å›ç»™å®¢æˆ·ç«¯å¯ä¸‹è½½çš„æ–‡ä»¶åˆ—è¡¨ï¼ŒæœåŠ¡ç«¯æ ¹æ®åˆ—è¡¨é€‰é¡¹å®Œæˆä¸‹è½½</span></span><br><span class="line"><span class="string">2.å®¢æˆ·ç«¯è¯·æ±‚ä¸Šä¼ æ–‡ä»¶ï¼Œé€‰æ‹©ä¸€ä¸ªæœ¬åœ°çš„æ–‡ä»¶è¿›è¡Œä¸Šä¼ </span></span><br><span class="line"><span class="string">3.å®¢æˆ·ç«¯è¯·æ±‚æ–­å¼€è¿æ¥åŒæ—¶å…³é—­æœåŠ¡å™¨</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">CSä¹‹é—´çš„ä¼ è¾“çš„åº”ç”¨å±‚åè®®è‡ªå®šä¹‰ä¸ºï¼š</span></span><br><span class="line"><span class="string">åŸºäºTCPä¼ è¾“å±‚åè®®ä¸‹ï¼š</span></span><br><span class="line"><span class="string">ä½¿ç”¨pythonçš„structæ¨¡å—ï¼Œå¯¹å‘é€çš„æ•°æ®è¿›è¡Œpackæ‰“åŒ…</span></span><br><span class="line"><span class="string">å°†åŒ…å†…æ•°æ®è½¬ä¸ºå¯ä¼ è¾“çš„byteç±»å‹ï¼Œæ¥æ”¶ç«¯æ¥æ”¶åæ‹†åŒ…ä¸ºstræˆ–intç­‰ç±»å‹è¿›è¡Œåº”ç”¨</span></span><br><span class="line"><span class="string">æ ¹æ®åŒ…å¤´ä¿¡æ¯å¯¹åŒ…ç±»å‹ä»¥åŠå¤§å°çš„å®šä¹‰å¯ä»¥å®Œæˆä¸åŒç±»å‹çš„æ•°æ®çš„ç½‘ç»œä¼ è¾“</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">filepath = <span class="string">'.'</span> + <span class="string">'/'</span> <span class="comment">#æœåŠ¡å™¨ç”¨äºå’Œå®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶çš„æ–‡ä»¶åº“</span></span><br><span class="line"></span><br><span class="line">HOST = <span class="string">''</span></span><br><span class="line">PORT = <span class="number">8686</span></span><br><span class="line">BUF_SIZE = <span class="number">1024</span> <span class="comment">#ç¼“å†²åŒºå¤§å°</span></span><br><span class="line">ADDR = (HOST, PORT) <span class="comment">#socket</span></span><br><span class="line"></span><br><span class="line">SerSock = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">SerSock.bind(ADDR)</span><br><span class="line"><span class="comment">#å¼€å§‹ç›‘å¬</span></span><br><span class="line">SerSock.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (<span class="string">'Waiting for connection...'</span>)</span><br><span class="line">CliSock, addr = SerSock.accept()</span><br><span class="line"><span class="keyword">print</span> (<span class="string">'...connected from: '</span>, addr)</span><br><span class="line">CliSock.send(<span class="string">'connected successfully'</span>.encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="comment">#æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚çš„åŠŸèƒ½éœ€æ±‚</span></span><br><span class="line">data = CliSock.recv(BUF_SIZE)</span><br><span class="line">data = data.decode()</span><br><span class="line"><span class="keyword">if</span> data == <span class="string">'1'</span>:</span><br><span class="line"><span class="comment">#æ˜¾ç¤ºç»™å®¢æˆ·ç«¯å¯ä»¥ä¸‹è½½çš„æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line">CliSock.send(<span class="string">'the list of files you can download: '</span>.encode())</span><br><span class="line">dirs = os.listdir(filepath)</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="comment">#ç»Ÿè®¡åˆ—è¡¨ä¸­æ–‡ä»¶çš„æ•°é‡å‘é€ç»™å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="keyword">for</span> dir <span class="keyword">in</span> dirs:</span><br><span class="line">count = count + <span class="number">1</span></span><br><span class="line">CliSock.send(struct.pack(<span class="string">'i'</span>, count)) <span class="comment">#iè¡¨ç¤ºä¼ è¾“çš„åŒ…ä¸ºintå‹</span></span><br><span class="line"><span class="comment">#å°†åˆ—è¡¨ä¸­çš„æ–‡ä»¶åé€ä¸€å‘é€ç»™å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="keyword">for</span> dir <span class="keyword">in</span> dirs:</span><br><span class="line"><span class="comment">#256siï¼šsè¡¨ç¤ºcharç±»å‹, iè¡¨ç¤ºintç±»å‹, 256è¡¨ç¤ºåŒ…å¯ä¼ é€çš„å­—èŠ‚å¤§å°</span></span><br><span class="line">CliSock.send(struct.pack(<span class="string">'256si'</span>, bytes(dir, <span class="string">'utf-8'</span>), os.stat(filepath+dir).st_size))</span><br><span class="line">file = CliSock.recv(struct.calcsize(<span class="string">'128si'</span>))</span><br><span class="line"><span class="keyword">if</span> file:</span><br><span class="line"><span class="comment">#è§£åŒ…,æ¥æ”¶å®¢æˆ·ç«¯ä¸‹è½½éœ€æ±‚</span></span><br><span class="line">fname, fisize= struct.unpack(<span class="string">'128si'</span>, file)</span><br><span class="line">fs = fname.decode().strip(<span class="string">'\0'</span>)</span><br><span class="line"><span class="keyword">if</span> fs <span class="keyword">in</span> dirs:</span><br><span class="line"><span class="comment">#å°†åŒ…çš„å…·ä½“ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">fhead = struct.pack(<span class="string">'256si'</span>,os.path.basename(fs).encode(), os.stat(filepath+fs).st_size)</span><br><span class="line">CliSock.send(fhead)</span><br><span class="line"><span class="comment">#è¯»å–æ–‡ä»¶å¹¶å°†æ–‡ä»¶æŒ‰ç…§ç¼“å†²åŒº(1KB)ä¸Šé™æ‹†åˆ†å‘é€</span></span><br><span class="line">fs = filepath+fs</span><br><span class="line">fp = open(fs, <span class="string">'rb'</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">fdata = fp.read(BUF_SIZE)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> fdata:</span><br><span class="line">print(<span class="string">'send successfully'</span>)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">CliSock.send(fdata)</span><br><span class="line">fp.close()</span><br><span class="line"><span class="comment">#CliSock.close()</span></span><br><span class="line"><span class="comment">#break</span></span><br><span class="line"><span class="keyword">elif</span> data == <span class="string">'2'</span>:</span><br><span class="line"><span class="comment">#æ¥æ”¶æ¥è‡ªæœåŠ¡ç«¯å‘é€çš„æ–‡ä»¶çš„åç§°åŠå¤§å°ä¿¡æ¯</span></span><br><span class="line">file = CliSock.recv(struct.calcsize(<span class="string">'256si'</span>))</span><br><span class="line"><span class="keyword">if</span> file:</span><br><span class="line">fname, fsize = struct.unpack(<span class="string">'256si'</span>, file)</span><br><span class="line">fs = fname.decode().strip(<span class="string">'\0'</span>)</span><br><span class="line">newfile = os.path.join(<span class="string">'new_'</span> + fs)</span><br><span class="line"><span class="comment">#å°†æ¥æ”¶çš„æ–°æ–‡ä»¶æ”¾åœ¨æœåŠ¡ç«¯ç”¨äºæ¥æ”¶å®¢æˆ·ç«¯æ–‡ä»¶çš„ç›®å½•ä¸‹</span></span><br><span class="line">newfile = filepath + newfile</span><br><span class="line">fp = open(newfile, <span class="string">'wb'</span>)</span><br><span class="line"><span class="comment">#è·å–æ¯æ¬¡æœåŠ¡ç«¯å‘é€æ¥çš„æ–‡ä»¶å†…å®¹ï¼Œå¹¶é€ä¸€å†™å…¥æ–°æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="comment">#åˆ¤æ–­ä¸è¶³1024æ—¶è¦åªå†™å…¥å‰©ä¸‹çš„å­—èŠ‚ï¼Œå¦åˆ™ä¼šäº§ç”Ÿé”™ç </span></span><br><span class="line">resize = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> resize == fsize:</span><br><span class="line"><span class="keyword">if</span> fsize - resize &gt; BUF_SIZE:</span><br><span class="line">data = CliSock.recv(BUF_SIZE)</span><br><span class="line">resize = resize + len(data)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">data = CliSock.recv(fsize - resize)</span><br><span class="line">resize = fsize</span><br><span class="line">fp.write(data)</span><br><span class="line">fp.close()</span><br><span class="line">print(<span class="string">'receive successfully'</span>)</span><br><span class="line"><span class="comment">#CliSock.close()</span></span><br><span class="line"><span class="comment">#break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é€€å‡º</span></span><br><span class="line"><span class="keyword">elif</span> data == <span class="string">'exit'</span>:</span><br><span class="line">CliSock.close()</span><br><span class="line">print(<span class="string">'shut down the connection with client successfully! '</span>)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="comment">#ä»£è¡¨å®¢æˆ·ç«¯çš„è¾“å…¥æ— æ³•è¯†åˆ«ï¼Œä¸åšå¤„ç†</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="comment">#CliSock.close()</span></span><br><span class="line">SerSock.close()</span><br><span class="line">print(<span class="string">'exit server successfully! '</span>)</span><br></pre></td></tr></table></figure><p><strong>å®¢æˆ·ç«¯ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">'localhost'</span></span><br><span class="line">PORT = <span class="number">8686</span></span><br><span class="line">BUF_SIZE = <span class="number">1024</span></span><br><span class="line">ADDR = (HOST, PORT)</span><br><span class="line"></span><br><span class="line">CliSock = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">CliSock.connect(ADDR)</span><br><span class="line"></span><br><span class="line">print(str(CliSock.recv(BUF_SIZE), <span class="string">'utf-8'</span>))</span><br><span class="line"><span class="comment">#åŠŸèƒ½UI</span></span><br><span class="line">print(<span class="string">'\n'</span>+<span class="string">'------- 1 express download a file -------'</span>+<span class="string">'\n'</span>+<span class="string">'-------- 2 express upload a file --------'</span>+<span class="string">'\n'</span>+<span class="string">'--- exit express shut down server and client ---'</span>+<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="comment">#é€‰æ‹©åŠŸèƒ½éœ€æ±‚å‘é€ç»™æœåŠ¡ç«¯</span></span><br><span class="line">type = input(<span class="string">'What type of service do you need? '</span>+<span class="string">'\n'</span>)</span><br><span class="line">CliSock.send(type.encode())</span><br><span class="line"><span class="keyword">if</span> type == <span class="string">'1'</span>:</span><br><span class="line">print(str(CliSock.recv(BUF_SIZE),<span class="string">'utf-8'</span>) + <span class="string">'\n'</span>)</span><br><span class="line"><span class="comment">#è·å–æ–‡ä»¶æ€»æ•°</span></span><br><span class="line">filesize = CliSock.recv(struct.calcsize(<span class="string">'i'</span>))</span><br><span class="line">filesize, = struct.unpack(<span class="string">'i'</span>, filesize)</span><br><span class="line"><span class="comment">#filesize = int(filesize.decode())</span></span><br><span class="line">fdict = &#123;&#125; <span class="comment">#è®°å½•æ–‡ä»¶åä¸ºç´¢å¼•çš„æ–‡ä»¶å¤§å°</span></span><br><span class="line">filenum = filesize</span><br><span class="line"><span class="comment">#è·å¾—æœåŠ¡ç«¯è¿”å›çš„å¯ä¸‹è½½æ–‡ä»¶åˆ—è¡¨å¹¶ä¸€ä¸€æ˜¾ç¤º</span></span><br><span class="line"><span class="keyword">while</span> filesize:</span><br><span class="line">filepath = CliSock.recv(struct.calcsize(<span class="string">'256si'</span>))</span><br><span class="line">file_name, ffsize= struct.unpack(<span class="string">'256si'</span>, filepath)</span><br><span class="line">file_name = file_name.decode(<span class="string">'utf-8'</span>).strip(<span class="string">'\0'</span>)</span><br><span class="line">print(file_name+<span class="string">'    ------ '</span> +str(ffsize//<span class="number">1024</span>+<span class="number">1</span>)+<span class="string">'KB'</span>)</span><br><span class="line">fdict[file_name] = ffsize</span><br><span class="line">filesize = filesize - <span class="number">1</span> </span><br><span class="line"><span class="keyword">print</span> (<span class="string">'\n'</span>+<span class="string">'the sum of the file is %d'</span> %filenum + <span class="string">'\n'</span>)</span><br><span class="line">file = input(<span class="string">'Select the file you want to download: '</span>+<span class="string">'\n'</span>)</span><br><span class="line"><span class="comment">#å°†æƒ³ä¸‹è½½çš„æ–‡ä»¶åä¼ è¾“ç»™æœåŠ¡ç«¯ä»¥ä¾¿è·å¾—æœåŠ¡ç«¯å‘é€çš„è¯¥æ–‡ä»¶å…·ä½“ä¿¡æ¯</span></span><br><span class="line">fhead = struct.pack(<span class="string">'128si'</span>, file.encode(), fdict[file])</span><br><span class="line">CliSock.send(fhead)</span><br><span class="line"><span class="comment">#æ¥æ”¶æœåŠ¡ç«¯å‘é€æ¥çš„æ–‡ä»¶è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">files = CliSock.recv(struct.calcsize(<span class="string">'256si'</span>))</span><br><span class="line"><span class="keyword">if</span> files:</span><br><span class="line">fname, fsize = struct.unpack(<span class="string">'256si'</span>, files)</span><br><span class="line">fs = fname.decode().strip(<span class="string">'\0'</span>)</span><br><span class="line"><span class="comment">#æ–°æ–‡ä»¶çš„å­˜å‚¨å</span></span><br><span class="line">newfile = os.path.join(<span class="string">'new_'</span> + fs)</span><br><span class="line">fp = open(newfile, <span class="string">'wb'</span>)</span><br><span class="line">print(<span class="string">'Its receiving..., wait a minute...'</span>+<span class="string">'\n'</span>)</span><br><span class="line">resize = <span class="number">0</span></span><br><span class="line"><span class="comment">#è·å–æ¯æ¬¡æœåŠ¡ç«¯å‘é€æ¥çš„æ–‡ä»¶å†…å®¹ï¼Œå¹¶é€ä¸€å†™å…¥æ–°æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="comment">#åˆ¤æ–­ä¸è¶³1024æ—¶è¦åªå†™å…¥å‰©ä¸‹çš„å­—èŠ‚ï¼Œå¦åˆ™ä¼šäº§ç”Ÿé”™ç </span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> resize == fsize:</span><br><span class="line"><span class="keyword">if</span> fsize - resize &gt; BUF_SIZE:</span><br><span class="line">data = CliSock.recv(BUF_SIZE)</span><br><span class="line">resize = resize + len(data)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">data = CliSock.recv(fsize - resize)</span><br><span class="line">resize = fsize</span><br><span class="line">fp.write(data)</span><br><span class="line">fp.close()</span><br><span class="line">print(<span class="string">'receive successfully'</span>)</span><br><span class="line"><span class="comment">#CliSock.close()</span></span><br><span class="line"><span class="comment">#break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> type == <span class="string">'2'</span>:</span><br><span class="line">data = input(<span class="string">'input the dir of the file you want to upload: '</span>+<span class="string">'\n'</span>)</span><br><span class="line"><span class="comment">#é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶å, è‹¥æ–‡ä»¶åé”™è¯¯æˆ–ä¸å­˜åœ¨åˆ™é‡æ–°è¾“å…¥</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> os.path.isfile(data):</span><br><span class="line">data = input(<span class="string">'Wrong! Please input again: '</span>+<span class="string">'\n'</span>)</span><br><span class="line">fhead = struct.pack(<span class="string">'256si'</span>,os.path.basename(data).encode(), os.stat(data).st_size)</span><br><span class="line">CliSock.send(fhead)</span><br><span class="line">fp = open(data, <span class="string">'rb'</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">fdata = fp.read(BUF_SIZE)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> fdata:</span><br><span class="line">print(<span class="string">'send successfully'</span>)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">CliSock.send(fdata)</span><br><span class="line">fp.close()</span><br><span class="line"><span class="comment">#CliSock.close()</span></span><br><span class="line"><span class="comment">#break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#é€€å‡ºå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„è¿æ¥</span></span><br><span class="line"><span class="keyword">elif</span> type == <span class="string">'exit'</span>:</span><br><span class="line">CliSock.close()</span><br><span class="line">print(<span class="string">'shut down the connection with server successfully! '</span>)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">type = input(<span class="string">'wrong input. Please input again: '</span>+<span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20181120233209761.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM
      
    
    </summary>
    
      <category term="è®¡ç®—æœºç½‘ç»œ" scheme="http://yoursite.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
      <category term="è®¡ç®—æœºç½‘ç»œ" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>åŒºå—é“¾é˜…è¯»(stateRoot, nonce, Hyperledger Fabric)</title>
    <link href="http://yoursite.com/2019/07/06/%E5%8C%BA%E5%9D%97%E9%93%BE%E9%98%85%E8%AF%BB-stateRoot-nonce-HyperledgerFabric/"/>
    <id>http://yoursite.com/2019/07/06/åŒºå—é“¾é˜…è¯»-stateRoot-nonce-HyperledgerFabric/</id>
    <published>2019-07-06T12:28:06.000Z</published>
    <updated>2019-07-06T12:29:01.912Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åŒºå—é“¾é˜…è¯»æŠ¥å‘Š"><a href="#åŒºå—é“¾é˜…è¯»æŠ¥å‘Š" class="headerlink" title="åŒºå—é“¾é˜…è¯»æŠ¥å‘Š"></a>åŒºå—é“¾é˜…è¯»æŠ¥å‘Š</h2><h3 id="ä¸ºä»€ä¹ˆè¦æœ‰stateRootï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦æœ‰stateRootï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æœ‰stateRootï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦æœ‰stateRootï¼Ÿ</h3><p>ä»¥å¤ªåŠä¸­çš„æ¯ä¸€ä¸ªå—éƒ½åŒ…å«ä¸€ä¸ªstateRootï¼Œè¿™æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„Merkleæ ‘ (Merkle Patricia Tree) çš„æ ¹å“ˆå¸Œã€‚å®ƒå­˜å‚¨ç³»ç»Ÿçš„æ•´ä¸ªçŠ¶æ€ï¼šæ‰€æœ‰è´¦æˆ·ä½™é¢ï¼ŒåˆåŒå­˜å‚¨ï¼ŒåˆåŒä»£ç å’Œè´¦æˆ·é‡Œçš„nonceã€‚</p><p>è¿™æ ·åšçš„ç›®çš„æ˜¯åªå…è®¸ç»™å‡ºæœ€åä¸€ä¸ªå—çš„èŠ‚ç‚¹ï¼Œä»¥åŠæœ€åä¸€ä¸ªå—å®é™…ä¸Šæ˜¯æœ€æ–°å—çš„ä¿è¯ï¼Œé€šè¿‡ç®€å•çš„ä¸‹è½½ï¼Œå¯ä»¥éå¸¸å¿«é€Ÿåœ°ä¸åŒºå—é“¾â€œåŒæ­¥â€è€Œæ— éœ€å¤„ç†ä»»ä½•å†å²äº¤æ˜“ä»ç½‘ç»œä¸­çš„èŠ‚ç‚¹å¼€å§‹çš„æ ‘çš„å…¶ä½™éƒ¨åˆ†ï¼Œé€šè¿‡æ£€æŸ¥æ‰€æœ‰å“ˆå¸Œæ˜¯å¦åŒ¹é…æ¥éªŒè¯æ ‘æ˜¯å¦æ­£ç¡®ï¼Œç„¶åä»é‚£é‡Œç»§ç»­ã€‚ </p><p>å¯¹äºè½»å‹å®¢æˆ·ç«¯ï¼ŒstateRootæ›´åŠ æœ‰åˆ©ï¼šå®ƒä»¬å¯ä»¥é€šè¿‡ç®€å•åœ°å‘ç½‘ç»œè¯¢é—®æ ‘çš„ç‰¹å®šåˆ†æ”¯æ¥ç«‹å³ç¡®å®šä»»ä½•å¸æˆ·çš„ç¡®åˆ‡å¹³è¡¡å’ŒçŠ¶æ€ï¼Œè€Œæ— éœ€éµå¾ªæ¯”ç‰¹å¸çš„å¤šæ­¥éª¤1-of-N â€œè¯¢é—®æ‰€æœ‰äº¤æ˜“è¾“å‡ºï¼Œç„¶åè¦æ±‚æ‰€æœ‰äº¤æ˜“æ”¯å‡ºè¿™äº›äº§å‡ºï¼Œå¹¶é‡‡å–å…¶ä½™çš„â€è½»å®¢æˆ·æ¨¡å‹ã€‚ </p><h3 id="nonceå€¼æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"><a href="#nonceå€¼æœ‰ä»€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="nonceå€¼æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"></a>nonceå€¼æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h3><p><strong>Nonce</strong>æ˜¯ä¸€ä¸ªåœ¨åŠ å¯†é€šä¿¡åªèƒ½ä½¿ç”¨ä¸€æ¬¡çš„æ•°å­—ã€‚åœ¨è®¤è¯åè®®ä¸­ï¼Œå®ƒå¾€å¾€æ˜¯ä¸€ä¸ªéšæœºæˆ–ä¼ªéšæœºæ•°ï¼Œä»¥é¿å…é‡æ”¾æ”»å‡»ã€‚Nonceä¹Ÿç”¨äºæµå¯†ç ä»¥ç¡®ä¿å®‰å…¨ã€‚å¦‚æœéœ€è¦ä½¿ç”¨ç›¸åŒçš„å¯†é’¥åŠ å¯†ä¸€ä¸ªä»¥ä¸Šçš„æ¶ˆæ¯ï¼Œå°±éœ€è¦Nonceæ¥ç¡®ä¿ä¸åŒçš„æ¶ˆæ¯ä¸è¯¥å¯†é’¥åŠ å¯†çš„å¯†é’¥æµä¸åŒã€‚ </p><p>åœ¨ä»¥å¤ªåŠä¸­ï¼Œä¸ºäº†é˜²æ­¢äº¤æ˜“é‡å¤è¿›è¡Œï¼Œä»¥å¤ªåŠè¦æ±‚æ¯ç¬”äº¤æ˜“å¿…é¡»æœ‰ä¸€ä¸ªnonceæ•°å€¼ã€‚nonceå€¼ä»0å¼€å§‹é€’å¢ï¼Œæ¯å‘é€ä¸€ç¬”äº¤æ˜“ï¼Œnonceä¾¿åŠ 1ã€‚</p><p>åªæœ‰å½“å‰é¢nonceå€¼è¾ƒå°çš„äº¤æ˜“å¤„ç†å®Œæˆä¹‹åæ‰ä¼šå¤„ç†åé¢nonceå€¼è¾ƒå¤§çš„äº¤æ˜“ã€‚</p><p><strong>ä»¥å¤ªåŠå¤„ç†nonceçš„è§„åˆ™ï¼š</strong></p><ol><li>å½“nonceå°äºä¹‹å‰å·²ç»æœ‰äº¤æ˜“ä½¿ç”¨çš„nonceå€¼ï¼Œäº¤æ˜“ä¼šè¢«æ‹’ç»ï¼›</li><li>å½“nonceå¤§äºå½“å‰åº”è¯¥ä½¿ç”¨çš„nonceæ—¶ï¼Œäº¤æ˜“ä¼šä¸€ç›´å¤„äºé˜Ÿåˆ—ä¹‹ä¸­è¿›è¡Œç­‰å¾…ï¼Œäº¤æ˜“ä¾æ¬¡æ‰§è¡Œï¼Œç›´åˆ°è¡¥é½ä¸­é—´é—´éš”çš„nonceå€¼ï¼Œæ‰å¯ä»¥æ‰§è¡Œã€‚</li><li>å½“æœ‰ä¸€ç¬”å¤„äºpendingçŠ¶æ€çš„äº¤æ˜“ï¼Œæ–°çš„ä¸€ç¬”äº¤æ˜“ä¸å…¶æ‹¥æœ‰ç›¸åŒçš„nonceå€¼ï¼Œå¦‚æœæ–°äº¤æ˜“çš„gas priceå¤ªå°ï¼Œæ— æ³•è¦†ç›–pendingçŠ¶æ€çš„äº¤æ˜“ï¼Œå¦‚æœæ–°äº¤æ˜“çš„gas priceé«˜äºåŸäº¤æ˜“çš„110%ï¼Œåˆ™åŸäº¤æ˜“ä¼šè¢«è¦†ç›–æ‰ã€‚</li></ol><h3 id="Hyperledger-Fabricçš„ç‰¹ç‚¹ï¼Œå’ŒComposerçš„å…³ç³»"><a href="#Hyperledger-Fabricçš„ç‰¹ç‚¹ï¼Œå’ŒComposerçš„å…³ç³»" class="headerlink" title="Hyperledger Fabricçš„ç‰¹ç‚¹ï¼Œå’ŒComposerçš„å…³ç³»?"></a>Hyperledger Fabricçš„ç‰¹ç‚¹ï¼Œå’ŒComposerçš„å…³ç³»?</h3><p>*<em>Hyperledger Fabricçš„ç‰¹ç‚¹: *</em></p><ul><li>å¼€æ”¾æ€§<ul><li>è¶…çº§è´¦æœ¬æ˜¯linuxåŸºé‡‘ä¼š2015å¹´åº•æˆç«‹çš„ã€‚è‡ªæˆç«‹åå¸å¼•äº†å¤§æ‰¹ä¼ä¸šï¼ŒåŒ…æ‹¬IBMã€accentureã€intelã€ciscoã€HITACHIç­‰å¤§ä¼ä¸šçš„åŠ å…¥ã€‚ç°åœ¨çš„Fabricæºä»£ç ä¸»è¦ç”±IBMå’ŒDigital Assetè¿™ä¸¤å®¶å…¬å¸æä¾›ã€‚æ˜¯IBMå¼€æºçš„blockchainé¡¹ç›®ã€‚</li></ul></li><li>å¼€æº<ul><li>Fabricçš„æºä»£ç çš„å¼€æºçš„ï¼Œæ‰€æœ‰å¼€å‘è€…æˆ–ä¼ä¸šæœºæ„éƒ½å¯ä»¥è‡ªç”±åœ°ä¸‹è½½ï¼Œè¿›è¡Œç ”ç©¶ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šç»“åˆä¸šåŠ¡åœºæ™¯ï¼Œåœ¨ä¸åŒçš„å•†ä¸šåœºæ™¯ä¸Šåº”ç”¨è½åœ°ã€‚</li></ul></li><li>SDKæ”¯æŒå¤šè¯­è¨€ï¼Œå‡ä½é—¨æ§›<ul><li>ç›®å‰Fabric SDKæ”¯æŒgoã€javaã€jsï¼Œpythonå››ç§ä¸»æµè¯­è¨€ï¼Œå¤§å¤šæ•°å¼€å‘è€…å¯ä»¥å¿«é€Ÿçš„ä¸Šæ‰‹ï¼Œé™ä½äº†å¼€å‘çš„é—¨æ§›å’Œæˆæœ¬ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªHyper ledger Composerå·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿåœ°æ­å»ºç¯å¢ƒã€‚</li></ul></li><li>å¯æ’æ‹”ï¼Œå¯æ‰©å±•<ul><li>Fabricä¸­çš„CAã€æ•°æ®åº“ã€å…±è¯†ç®—æ³•éƒ½æ˜¯å¯æ’æ‹”çš„ã€‚è€Œä¸”ï¼ŒFabricä¸­çš„é“¾ç æ˜¯é€šè¿‡dockerå®ç°ã€‚</li></ul></li><li>åŸºäºè”ç›Ÿé“¾çš„å‰æï¼Œå…¼é¡¾æ•°æ®å…±äº«å’Œéšç§ä¿æŠ¤<ul><li>Fabricæœ€å¤šçš„ç‰¹ç‚¹æ˜¯å¼•å…¥äº†é“¾ç å’Œé€šé“çš„æ¦‚å¿µã€‚åœ¨Fabricä¸­ï¼Œé€šè¿‡channelï¼Œä¹Ÿå³é€šé“éš”ç¦»æ•°æ®ï¼Œåªæœ‰åœ¨è¿™ä¸ªé€šé“çš„èŠ‚ç‚¹æ‰èƒ½å…±äº«è´¦æœ¬ï¼ŒäºŒè®¿é—®ä¸äº†å…¶ä»–è´¦æœ¬ã€‚é€šè¿‡å»ºç«‹ä¸åŒçš„é€šé“ï¼Œå¯å®ç°æŒ‰éœ€å…±äº«çš„ç›®çš„ã€‚æ›´ç¬¦åˆç°å®ç”Ÿæ´»çš„å•†ä¸šåœºæ™¯ã€‚</li></ul></li></ul><p><strong>Hyperledger Fabricå’ŒComposerçš„å…³ç³»ï¼š</strong></p><p>Hyperledger Fabricæ˜¯ä¸€ä¸ªç§æœ‰åŒºå—é“¾ç½‘ç»œï¼Œä¸ºäº‹åŠ¡æ€§ä¼ä¸šåº”ç”¨ç¨‹åºæä¾›åŸºç¡€ã€‚ </p><p>Hyperledger Composeræ˜¯ä¸€ä¸ªåŠ é€Ÿå¼€å‘åŸºäºHyperledger Fabricæ„å»ºçš„åº”ç”¨ç¨‹åºçš„æ¡†æ¶ ã€‚</p><p>Composeræ¡†æ¶åœ¨å…¶è‡ªå·±çš„éš”ç¦»è¿è¡Œæ—¶ä¸­è¿è¡Œï¼Œå¹¶é€šè¿‡è¿æ¥é…ç½®æ–‡ä»¶è¿æ¥åˆ°Fabricç½‘ç»œï¼Œè¯¥é…ç½®æ–‡ä»¶å…è®¸éƒ¨ç½²ç”±Composeræ¡†æ¶ç”Ÿæˆçš„å·²å®šä¹‰çš„ä¸šåŠ¡ç½‘ç»œå®šä¹‰<strong>ï¼ˆBNDï¼‰</strong>å­˜æ¡£æ–‡ä»¶<strong>ï¼ˆ.bnaæ–‡ä»¶ï¼‰</strong> ã€‚</p><h3 id="è”ç›Ÿé“¾æ™ºèƒ½åˆçº¦å’Œä¸­å¿ƒè´¦æœ¬çš„åŒºåˆ«ï¼Ÿ"><a href="#è”ç›Ÿé“¾æ™ºèƒ½åˆçº¦å’Œä¸­å¿ƒè´¦æœ¬çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="è”ç›Ÿé“¾æ™ºèƒ½åˆçº¦å’Œä¸­å¿ƒè´¦æœ¬çš„åŒºåˆ«ï¼Ÿ"></a>è”ç›Ÿé“¾æ™ºèƒ½åˆçº¦å’Œä¸­å¿ƒè´¦æœ¬çš„åŒºåˆ«ï¼Ÿ</h3><p>è”ç›ŸåŒºå—é“¾æ˜¯æŒ‡å…¶å…±è¯†è¿‡ç¨‹å—åˆ°é¢„é€‰èŠ‚ç‚¹æ§åˆ¶çš„åŒºå—é“¾ï¼›ä¾‹å¦‚ï¼Œä¸å¦¨æƒ³è±¡ä¸€ä¸ªæœ‰15ä¸ªé‡‘èæœºæ„ç»„æˆçš„å…±åŒä½“ï¼Œæ¯ä¸ªæœºæ„éƒ½è¿è¡Œç€ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œä¸”ä¸ºäº†ä½¿æ¯ä¸ªåŒºå—ç”Ÿæ•ˆéœ€è¦è·å¾—å…¶ä¸­10ä¸ªæœºæ„çš„ç¡®è®¤ï¼ˆ2/3ç¡®è®¤ï¼‰ã€‚åŒºå—é“¾æˆ–è®¸å…è®¸æ¯ä¸ªäººéƒ½å¯è¯»å–ï¼Œæˆ–è€…åªå—é™äºå‚ä¸è€…ï¼Œæˆ–èµ°æ··åˆå‹è·¯çº¿ï¼Œä¾‹å¦‚åŒºå—çš„æ ¹å“ˆå¸ŒåŠå…¶APIï¼ˆåº”ç”¨ç¨‹åºæ¥å£ï¼‰å¯¹å¤–å…¬å¼€ï¼ŒAPIå¯å…è®¸å¤–ç•Œç”¨æ¥ä½œæœ‰é™æ¬¡æ•°çš„æŸ¥è¯¢å’Œè·å–åŒºå—é“¾çŠ¶æ€çš„ä¿¡æ¯ã€‚è¿™äº›åŒºå—é“¾å¯è§†ä¸ºâ€œéƒ¨åˆ†å»ä¸­å¿ƒåŒ–â€ã€‚ å…¶æ™ºèƒ½åˆçº¦çš„è®°è´¦æ–¹å¼ä¹Ÿæ˜¯ä»‹äºåˆ†å¸ƒå¼è®°è´¦å’Œä¸­å¿ƒè®°è´¦ä¹‹é—´ã€‚</p><p>è€Œä¸­å¿ƒè´¦ç°¿åˆ™æ˜¯å®Œå…¨ä¸­å¿ƒåŒ–çš„è®°è´¦æ–¹å¼ï¼Œåªç”±ä¸€æ–¹(ä¸­å¿ƒæœºæ„)å®ç°è®°è´¦ã€‚è¿™ç§ä¸­å¿ƒåŒ–çš„è®°è´¦æ–¹å¼ï¼Œæ— æ³•ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼Œä¹Ÿå»ºç«‹ä¸èµ·ä¸€ä¸ªå¯ä¿¡çš„æœºåˆ¶ï¼Œå³æ— æ³•è®©äººä¿¡æœè¿™ä¸ªè´¦æœ¬æ•°æ®çš„çœŸå®æ€§ã€‚æ¯”å¦‚é“¶è¡Œï¼Œä¼ä¸šçš„è´¢åŠ¡è´¦æœ¬ï¼Œä¸€æ—¦å‡ºç°æŸä¸ªäººåšå‡è´¦ï¼Œå°†ä¼šå‡ºç°ä»€ä¹ˆæ ·çš„åæœï¼Œè€Œå¦‚æœä»–ä»¬çš„è´¢åŠ¡æ•°æ®çªç„¶è¢«ä¸€æŠŠç«çƒ§äº†ï¼Œäº§ç”Ÿçš„ç¾éš¾å¯æƒ³è€ŒçŸ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;åŒºå—é“¾é˜…è¯»æŠ¥å‘Š&quot;&gt;&lt;a href=&quot;#åŒºå—é“¾é˜…è¯»æŠ¥å‘Š&quot; class=&quot;headerlink&quot; title=&quot;åŒºå—é“¾é˜…è¯»æŠ¥å‘Š&quot;&gt;&lt;/a&gt;åŒºå—é“¾é˜…è¯»æŠ¥å‘Š&lt;/h2&gt;&lt;h3 id=&quot;ä¸ºä»€ä¹ˆè¦æœ‰stateRootï¼Ÿ&quot;&gt;&lt;a href=&quot;#ä¸ºä»€ä¹ˆè¦æœ‰stateRootï¼Ÿ&quot; c
      
    
    </summary>
    
      <category term="åŒºå—é“¾" scheme="http://yoursite.com/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
    
      <category term="åŒºå—é“¾" scheme="http://yoursite.com/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
  </entry>
  
  <entry>
    <title>Color transfer between images(labé¢œè‰²ç©ºé—´)</title>
    <link href="http://yoursite.com/2019/07/06/images-lab%E9%A2%9C%E8%89%B2%E7%A9%BA%E9%97%B4/"/>
    <id>http://yoursite.com/2019/07/06/images-labé¢œè‰²ç©ºé—´/</id>
    <published>2019-07-06T12:21:45.000Z</published>
    <updated>2019-07-06T13:16:34.455Z</updated>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®ï¼š"><a href="#é¢˜ç›®ï¼š" class="headerlink" title="é¢˜ç›®ï¼š"></a>é¢˜ç›®ï¼š</h3><p>å¯ä»¥æ ¹æ®è¯¾ç¨‹ PPT å’Œå¯¹åº”å‚è€ƒæ–‡çŒ®(â€œColor transfer between imagesâ€)å®ç°é¢œè‰²è½¬æ¢ã€‚</p><p>  (a) æµ‹è¯•å›¾åƒé›†åˆä¸ä½äº 5 å¯¹å›¾åƒ(å‚è€ƒå›¾å’ŒåŸå›¾)ï¼›</p><p>  (b) æœ€åå¯¹å®éªŒç»“æœè¿›è¡Œåˆ†æï¼Œç‰¹åˆ«æ˜¯å­˜åœ¨é—®é¢˜è¿›è¡Œåˆ†æï¼Œç»™å‡ºåˆæ­¥çš„æ”¹è¿›å»ºè®®æ–¹æ³•å’Œç»™å‡ºå‚è€ƒæ–‡çŒ®ã€‚ </p><h3 id="å›¾åƒé—´çš„é¢œè‰²è½¬åŒ–ï¼š"><a href="#å›¾åƒé—´çš„é¢œè‰²è½¬åŒ–ï¼š" class="headerlink" title="å›¾åƒé—´çš„é¢œè‰²è½¬åŒ–ï¼š"></a>å›¾åƒé—´çš„é¢œè‰²è½¬åŒ–ï¼š</h3><p>è¿™ä¸ªç®—æ³•çš„æ ¸å¿ƒå…³é”®åœ¨äºä¸¤éƒ¨åˆ†ï¼š</p><ul><li>1æ˜¯rgbç©ºé—´å’Œlabç©ºé—´çš„ç›¸äº’è½¬åŒ–</li><li>2æ˜¯åœ¨labç©ºé—´æ ¹æ®ä¸¤å¹…å›¾æå–çš„å‡å€¼å’Œæ ‡å‡†å·®è¿›è¡Œè½¬æ¢å¤„ç†</li></ul><p><strong>rgb-lab</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">CImg&lt;<span class="keyword">float</span>&gt; ImgConverse::RGB_LAB(CImg&lt;<span class="keyword">float</span>&gt; picture, <span class="keyword">float</span> *mean, <span class="keyword">float</span> *<span class="built_in">std</span>) &#123;</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; pic = picture;</span><br><span class="line"><span class="keyword">float</span> sum[<span class="number">3</span>];</span><br><span class="line"><span class="keyword">float</span> sum_std[<span class="number">3</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">sum[i] = <span class="number">0.0</span>; sum_std[i] = <span class="number">0.0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> size = pic.width()*pic.height();</span><br><span class="line">cimg_forXY(pic, x, y) &#123;</span><br><span class="line"><span class="keyword">float</span> r = pic(x, y, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">float</span> g = pic(x, y, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">float</span> b = pic(x, y, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">float</span> L = <span class="number">0.3811</span> * r + <span class="number">0.5783</span> * g + <span class="number">0.0402</span> * b;</span><br><span class="line"><span class="keyword">float</span> M = <span class="number">0.1967</span> * r + <span class="number">0.7244</span> * g + <span class="number">0.0782</span> * b;</span><br><span class="line"><span class="keyword">float</span> S = <span class="number">0.0241</span> * r + <span class="number">0.1288</span> * g + <span class="number">0.8444</span> * b;</span><br><span class="line"><span class="keyword">if</span> (L == <span class="number">0</span>) L = <span class="built_in">log</span>(<span class="number">1</span>); <span class="keyword">else</span> L = <span class="built_in">log</span>(L);</span><br><span class="line"><span class="keyword">if</span> (M == <span class="number">0</span>) M = <span class="built_in">log</span>(<span class="number">1</span>); <span class="keyword">else</span> M = <span class="built_in">log</span>(M);</span><br><span class="line"><span class="keyword">if</span> (S == <span class="number">0</span>) S = <span class="built_in">log</span>(<span class="number">1</span>); <span class="keyword">else</span> S = <span class="built_in">log</span>(S);</span><br><span class="line"><span class="keyword">float</span> l = (<span class="number">1.0</span> / <span class="built_in">sqrt</span>(<span class="number">3</span>)) * (L + M + S);</span><br><span class="line"><span class="keyword">float</span> A = <span class="number">1.0</span> / <span class="built_in">sqrt</span>(<span class="number">6</span>) * L + <span class="number">1.0</span> / <span class="built_in">sqrt</span>(<span class="number">6</span>) * M - <span class="number">2.0</span> / <span class="built_in">sqrt</span>(<span class="number">6</span>) * S;</span><br><span class="line"><span class="keyword">float</span> B= <span class="number">1.0</span> / <span class="built_in">sqrt</span>(<span class="number">2</span>) * L - <span class="number">1.0</span> / <span class="built_in">sqrt</span>(<span class="number">2</span>) * M;</span><br><span class="line">pic(x, y, <span class="number">0</span>) = l; pic(x, y, <span class="number">1</span>) = A; pic(x, y, <span class="number">2</span>) = B;</span><br><span class="line">sum[<span class="number">0</span>] += l;</span><br><span class="line">sum[<span class="number">1</span>] += A;</span><br><span class="line">sum[<span class="number">2</span>] += B;</span><br><span class="line">&#125;</span><br><span class="line">mean[<span class="number">0</span>] = sum[<span class="number">0</span>] / size;</span><br><span class="line">mean[<span class="number">1</span>] = sum[<span class="number">1</span>] / size;</span><br><span class="line">mean[<span class="number">2</span>] = sum[<span class="number">2</span>] / size;</span><br><span class="line">cimg_forXY(pic, x, y) &#123;</span><br><span class="line">sum_std[<span class="number">0</span>] += <span class="built_in">pow</span>((pic(x, y, <span class="number">0</span>) - mean[<span class="number">0</span>]), <span class="number">2</span>);</span><br><span class="line">sum_std[<span class="number">1</span>] += <span class="built_in">pow</span>((pic(x, y, <span class="number">1</span>) - mean[<span class="number">1</span>]), <span class="number">2</span>);</span><br><span class="line">sum_std[<span class="number">2</span>] += <span class="built_in">pow</span>((pic(x, y, <span class="number">2</span>) - mean[<span class="number">2</span>]), <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">std</span>[<span class="number">0</span>] = <span class="built_in">sqrt</span>(sum_std[<span class="number">0</span>] / size);</span><br><span class="line"><span class="built_in">std</span>[<span class="number">1</span>] = <span class="built_in">sqrt</span>(sum_std[<span class="number">1</span>] / size);</span><br><span class="line"><span class="built_in">std</span>[<span class="number">2</span>] = <span class="built_in">sqrt</span>(sum_std[<span class="number">2</span>] / size);</span><br><span class="line"><span class="keyword">return</span> pic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>lab-rgb</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CImg&lt;<span class="keyword">float</span>&gt; ImgConverse::LAB_RGB(CImg&lt;<span class="keyword">float</span>&gt; picture) &#123;</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; pic = picture;</span><br><span class="line">cimg_forXY(pic, x, y) &#123;</span><br><span class="line"><span class="keyword">float</span> L = <span class="built_in">sqrt</span>(<span class="number">3</span>) / <span class="number">3</span> * pic(x, y, <span class="number">0</span>) + <span class="built_in">sqrt</span>(<span class="number">6</span>) / <span class="number">6</span> * pic(x, y, <span class="number">1</span>) + <span class="built_in">sqrt</span>(<span class="number">2</span>) / <span class="number">2</span> * pic(x, y, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">float</span> M = <span class="built_in">sqrt</span>(<span class="number">3</span>) / <span class="number">3</span> * pic(x, y, <span class="number">0</span>) + <span class="built_in">sqrt</span>(<span class="number">6</span>) / <span class="number">6</span> * pic(x, y, <span class="number">1</span>) - <span class="built_in">sqrt</span>(<span class="number">2</span>) / <span class="number">2</span> * pic(x, y, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">float</span> S = <span class="built_in">sqrt</span>(<span class="number">3</span>) / <span class="number">3</span> * pic(x, y, <span class="number">0</span>) - <span class="built_in">sqrt</span>(<span class="number">6</span>) / <span class="number">3</span> * pic(x, y, <span class="number">1</span>);</span><br><span class="line">L = <span class="built_in">exp</span>(L);</span><br><span class="line">M = <span class="built_in">exp</span>(M);</span><br><span class="line">S = <span class="built_in">exp</span>(S);</span><br><span class="line">pic(x, y, <span class="number">0</span>) = <span class="number">4.4679</span> * L - <span class="number">3.5873</span> * M + <span class="number">0.1193</span> * S;</span><br><span class="line">pic(x, y, <span class="number">1</span>) = <span class="number">-1.2186</span> * L + <span class="number">2.3809</span> * M - <span class="number">0.1624</span> * S;</span><br><span class="line">pic(x, y, <span class="number">2</span>) = <span class="number">0.0497</span> * L - <span class="number">0.2439</span> * M + <span class="number">1.2045</span> * S;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> pic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è½¬åŒ–å¤„ç†ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ImgConverse::colorTransfer() &#123;</span><br><span class="line">sourceImg.display(<span class="string">"æºå›¾"</span>);</span><br><span class="line">targetImg.display(<span class="string">"ç›®æ ‡å›¾"</span>);</span><br><span class="line">sourcelab = RGB_LAB(sourceImg, mean0, std0);</span><br><span class="line">targetlab = RGB_LAB(targetImg, mean1, std1);</span><br><span class="line">result = sourcelab;</span><br><span class="line">cimg_forXY(result, x, y) &#123;</span><br><span class="line">result(x, y, <span class="number">0</span>) = (result(x, y, <span class="number">0</span>) - mean0[<span class="number">0</span>])*std1[<span class="number">0</span>] / std0[<span class="number">0</span>] + mean1[<span class="number">0</span>];</span><br><span class="line">result(x, y, <span class="number">1</span>) = (result(x, y, <span class="number">1</span>) - mean0[<span class="number">1</span>])*std1[<span class="number">1</span>] / std0[<span class="number">1</span>] + mean1[<span class="number">1</span>];</span><br><span class="line">result(x, y, <span class="number">2</span>) = (result(x, y, <span class="number">2</span>) - mean0[<span class="number">2</span>])*std1[<span class="number">2</span>] / std0[<span class="number">2</span>] + mean1[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//targetlab = LAB_RGB(targetlab);</span></span><br><span class="line">result = LAB_RGB(result);</span><br><span class="line">result.display(<span class="string">"ç»“æœå›¾"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•æ•ˆæœï¼š"><a href="#æµ‹è¯•æ•ˆæœï¼š" class="headerlink" title="æµ‹è¯•æ•ˆæœï¼š"></a>æµ‹è¯•æ•ˆæœï¼š</h4><p>å…ˆæ‹¿pptä¸Šçš„æµ‹è¯•å›¾è¿›è¡Œä¸€ä¸ªæ•ˆæœæµ‹è¯•ï¼Œå‘ç°ç»“æœè¿˜ä¸é”™ã€‚<br><img src="https://img-blog.csdnimg.cn/20181120231811254.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181120231821626.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181120231839898.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>ä¹‹ååˆæµ‹è¯•äº†å‡ å¼ å›¾</strong><br><img src="https://img-blog.csdnimg.cn/20181120231914301.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181120231929905.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181120231940371.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181120232010800.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181120232024199.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181120232037701.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æ•ˆæœåˆ†æï¼š"><a href="#æ•ˆæœåˆ†æï¼š" class="headerlink" title="æ•ˆæœåˆ†æï¼š"></a>æ•ˆæœåˆ†æï¼š</h4><p> ä»ä»¥ä¸Šå¤šå¼ å›¾çš„æ•ˆæœåˆ†ææˆ‘ä»¬å¯ä»¥çœ‹å‡ºç®—æ³•åªæ˜¯ä»¥å‚è€ƒåŒºåŸŸçš„è‰²å½©ä¿¡æ¯ä½œä¸ºå‡†åˆ™ï¼Œè€Œå®Œå…¨å¿½ç•¥äº†ç›®æ ‡åŒºåŸŸçš„è¾¹ç¼˜ï¼Œçº¹ç†ç­‰ç»†èŠ‚ä¿¡æ¯ï¼Œåªè¿½æ±‚è‰²å½©ä¸å‚è€ƒåŒºåŸŸçš„å®Œå…¨ä¸€è‡´ï¼Œå¯èƒ½ä¼šä½¿ç›®æ ‡åŒºåŸŸçš„ç»†èŠ‚ä¿¡æ¯è¿‡åº¦ä¸¢å¤±ã€‚é€šä¿—çš„è¯´ä¹Ÿå°±æ˜¯æœ‰çš„å›¾ç‰‡æ•ˆæœä¼šç»™äººä¸€ç§è’™è’™çš„æ„Ÿè§‰ã€‚</p><p>æ‰€ä»¥æƒ³åˆ°çš„è§£å†³æ–¹æ³•ä¹Ÿæ˜¯ç”¨è¾¹ç¼˜åˆ†å‰²ä»¥åŠé€šè¿‡è°ƒæ•´æ¢¯åº¦çš„é˜ˆå€¼æ¥è·å–å±€éƒ¨è¾¹ç¼˜çº¹ç†ç­‰ä¿¡æ¯ï¼Œé€šè¿‡è°ƒæ•´ä¸åŒç›®æ ‡å¯¹è±¡çš„é¢œè‰²è¿ç§»çš„å¹…åº¦å¤§å°ï¼Œå®ç°çš„åŠŸèƒ½æ˜¯ç±»ä¼¼ä¸photoshopä¸­æ·»åŠ è’™ç‰ˆä»¥åŠé€šè¿‡è°ƒæ•´æµé‡å’Œä¸é€æ˜åº¦æ¥æ˜¯å›¾ç‰‡èåˆæ•ˆæœä¸æ˜¾å¾—é‚£ä¹ˆçªå…€ã€‚</p><p><strong>å‚è€ƒæ–‡çŒ®ï¼š</strong></p><ul><li><p>Color transfer between images</p></li><li><p>Novel Algorithm for Local Color Transfer Based on Preserving Detail Texture</p></li></ul><p><strong>å®Œæ•´ä»£ç å‚è§ï¼š</strong><br><a href="https://github.com/WangPerryWPY/Computer-Version/tree/master/Exp4" target="_blank" rel="noopener">https://github.com/WangPerryWPY/Computer-Version/tree/master/Exp4</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;é¢˜ç›®ï¼š&quot;&gt;&lt;a href=&quot;#é¢˜ç›®ï¼š&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®ï¼š&quot;&gt;&lt;/a&gt;é¢˜ç›®ï¼š&lt;/h3&gt;&lt;p&gt;å¯ä»¥æ ¹æ®è¯¾ç¨‹ PPT å’Œå¯¹åº”å‚è€ƒæ–‡çŒ®(â€œColor transfer between imagesâ€)å®ç°é¢œè‰²è½¬æ¢ã€‚&lt;/p&gt;
&lt;p&gt;
      
    
    </summary>
    
      <category term="è®¡ç®—æœºè§†è§‰" scheme="http://yoursite.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="è®¡ç®—æœºè§†è§‰" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/"/>
    
  </entry>
  
  <entry>
    <title>ç°åº¦ç›´æ–¹å›¾å¤„ç†ä»¥åŠæ”¹è¿›æ–¹æ³•(hsvç©ºé—´ä»¥åŠè¾¹ç¼˜æ£€æµ‹)</title>
    <link href="http://yoursite.com/2019/07/06/%E7%81%B0%E5%BA%A6%E7%9B%B4%E6%96%B9%E5%9B%BE%E5%A4%84%E7%90%86%E4%BB%A5%E5%8F%8A%E6%94%B9%E8%BF%9B%E6%96%B9%E6%B3%95-hsv%E7%A9%BA%E9%97%B4%E4%BB%A5%E5%8F%8A%E8%BE%B9%E7%BC%98%E6%A3%80%E6%B5%8B/"/>
    <id>http://yoursite.com/2019/07/06/ç°åº¦ç›´æ–¹å›¾å¤„ç†ä»¥åŠæ”¹è¿›æ–¹æ³•-hsvç©ºé—´ä»¥åŠè¾¹ç¼˜æ£€æµ‹/</id>
    <published>2019-07-06T12:18:36.000Z</published>
    <updated>2019-07-06T12:19:20.376Z</updated>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®ï¼š"><a href="#é¢˜ç›®ï¼š" class="headerlink" title="é¢˜ç›®ï¼š"></a>é¢˜ç›®ï¼š</h3><p>ç”¨ CImg ç¼–å†™ç°åº¦å›¾åƒç›´æ–¹å›¾å‡è¡¡åŒ–ï¼š </p><p>   (a) åŒå­¦ç”¨æ‰‹æœºæ‹æ‘„ä¸åŒå…‰ç…§æƒ…å†µä¸‹çš„å›¾åƒï¼Œä½œä¸ºæµ‹è¯•æ ·æœ¬ï¼Œä¸ä½äº 5 å¼ ï¼›</p><p>   (b) åˆ†åˆ«é’ˆå¯¹ç°åº¦å›¾åƒå’Œå½©è‰²å›¾åƒåˆ†åˆ«ç”¨ç›´æ–¹å›¾å‡è¡¡åŒ–çš„æ–¹æ³•å®Œæˆç»“æœï¼›</p><p>   (c) æœ€åå¯¹å®éªŒç»“æœè¿›è¡Œåˆ†æï¼Œç‰¹åˆ«æ˜¯å½©è‰²å›¾åƒç›´æ¥é‡‡ç”¨ç›´æ–¹å›¾å‡è¡¡åŒ–æ•ˆæœå¦‚ä½•è¿›è¡Œåˆ†æï¼Œå¦‚æœè¦æ”¹è¿›åº”è¯¥ä»å“ªäº›æ–¹é¢è¿›è¡Œæ”¹è¿›ã€‚ </p><h3 id="ç›´æ–¹å›¾å‡è¡¡åŒ–ï¼š"><a href="#ç›´æ–¹å›¾å‡è¡¡åŒ–ï¼š" class="headerlink" title="ç›´æ–¹å›¾å‡è¡¡åŒ–ï¼š"></a>ç›´æ–¹å›¾å‡è¡¡åŒ–ï¼š</h3><h4 id="ç®—æ³•å®ç°ï¼š"><a href="#ç®—æ³•å®ç°ï¼š" class="headerlink" title="ç®—æ³•å®ç°ï¼š"></a>ç®—æ³•å®ç°ï¼š</h4><p>æ•´ä¸ªæ¨¡å—çš„æ ¸å¿ƒä»£ç æ˜¯ç›´æ–¹å›¾å‡è¡¡åŒ–å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">CImg&lt;<span class="keyword">int</span>&gt; ImgConverse::Hist(CImg&lt;<span class="keyword">int</span>&gt; picture) &#123;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; img1 = picture;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; pic = img1;</span><br><span class="line"><span class="keyword">int</span> size = img1.size();</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; hist = img1.histogram(<span class="number">256</span>, <span class="number">0</span>, <span class="number">255</span>); <span class="comment">//histogramçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å…±æœ‰256ä¸ªç°åº¦çº§ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç°åº¦çš„æœ€å°å€¼ï¼Œç¬¬ä¸‰ä¸ªæ˜¯ç°åº¦æœ€å¤§å€¼</span></span><br><span class="line"><span class="keyword">double</span> sum = <span class="number">0.0</span>;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; index;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">sum += (<span class="keyword">double</span>)hist(i) / size;</span><br><span class="line"><span class="keyword">int</span> Sum = (<span class="keyword">int</span>)(sum * <span class="number">255</span>);</span><br><span class="line">index.insert(pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;(i, Sum));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;::iterator iter = index.begin();</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;::iterator end = index.end();</span><br><span class="line">cimg_forXY(pic, x, y) &#123;</span><br><span class="line">pic(x, y) = index[pic(x, y)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> pic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äº<strong>ç°åº¦å›¾</strong>çš„ç›´æ–¹å›¾å‡è¡¡åŒ–æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥ç›´æ¥å¯¹ç°åº¦å›¾è¿›è¡Œç›´æ–¹å›¾çš„å‡è¡¡åŒ–å¤„ç†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å°†å›¾ç‰‡è½¬ä¸ºç°åº¦å›¾</span></span><br><span class="line"><span class="keyword">void</span> ImgConverse::toGray() &#123;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; pic(img._width, img._height, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">cimg_forXY(img, x, y) &#123;</span><br><span class="line">pic(x, y) = img(x, y, <span class="number">0</span>) * <span class="number">0.2126</span> + img(x, y, <span class="number">1</span>) * <span class="number">0.7152</span> + img(x, y, <span class="number">2</span>) * <span class="number">0.0722</span>;</span><br><span class="line">&#125;</span><br><span class="line">gray_img = pic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> ImgConverse::Hist_gray() &#123;</span><br><span class="line">toGray();</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; pic = gray_img;</span><br><span class="line">pic.display(<span class="string">"å¤„ç†å‰å›¾ç‰‡"</span>);</span><br><span class="line"><span class="comment">//ç”¨äºè·å–å„ä¸ªç°åº¦çº§å¯¹åº”åƒç´ ç‚¹çš„ä¸ªæ•°</span></span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; hist = pic.histogram(<span class="number">256</span>, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line"><span class="comment">//æç»˜ç›´æ–¹å›¾</span></span><br><span class="line">hist.display_graph(<span class="string">"å¤„ç†å‰ç›´æ–¹å›¾"</span>);</span><br><span class="line">pic = Hist(gray_img);</span><br><span class="line">pic.display(<span class="string">"å¤„ç†åå›¾ç‰‡"</span>);</span><br><span class="line">hist_equalImg = pic;</span><br><span class="line">hist = pic.histogram(<span class="number">256</span>, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">hist.display_graph(<span class="string">"å¤„ç†åç›´æ–¹å›¾"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œå¯¹äº<strong>å½©è‰²å›¾ç‰‡</strong>ï¼Œå› ä¸ºå…¶æœ‰rgbä¸‰ä¸ªé€šé“ï¼Œæ‰€ä»¥å¤„ç†è¿‡ç¨‹ä¼šç›¸å¯¹éº»çƒ¦ä¸€ç‚¹ï¼Œæˆ‘é‡‡å–äº†ä¸¤ç§åŠæ³•</p><ol><li>å°†å›¾ç‰‡çš„rgbä¸‰ä¸ªé€šé“åˆ†åˆ«è¿›è¡Œç›´æ–¹å›¾å‡è¡¡åŒ–å†åˆå¹¶</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ImgConverse::Hist_color() &#123;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; _img = img;</span><br><span class="line">_img.display(<span class="string">"å¤„ç†å‰å›¾ç‰‡"</span>);</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; hist = _img.histogram(<span class="number">256</span>, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">hist.display_graph(<span class="string">"å¤„ç†å‰ç›´æ–¹å›¾"</span>);</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; img_r(img._width, img._height, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; img_g = img_r, img_b = img_r;</span><br><span class="line">cimg_forXY(img, x, y) &#123;</span><br><span class="line">img_r(x, y) = img(x, y, <span class="number">0</span>);</span><br><span class="line">img_g(x, y) = img(x, y, <span class="number">1</span>);</span><br><span class="line">img_b(x, y) = img(x, y, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">img_r = Hist(img_r);</span><br><span class="line">img_g = Hist(img_g);</span><br><span class="line">img_b = Hist(img_b);</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; pic(img._width, img._height, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>);</span><br><span class="line">cimg_forXY(img, x, y) &#123;</span><br><span class="line">pic(x, y, <span class="number">0</span>) = img_r(x, y);</span><br><span class="line">pic(x, y, <span class="number">1</span>) = img_g(x, y);</span><br><span class="line">pic(x, y, <span class="number">2</span>) = img_b(x, y);</span><br><span class="line">&#125;</span><br><span class="line">pic.display(<span class="string">"å¤„ç†åå›¾ç‰‡"</span>);</span><br><span class="line">hist_equalImg = pic;</span><br><span class="line">hist = pic.histogram(<span class="number">256</span>, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">hist.display_graph(<span class="string">"å¤„ç†åç›´æ–¹å›¾"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>å°†å½©è‰²å›¾ä»RGBç©ºé—´è½¬æ¢åˆ°HSI(è‰²å½©ï¼Œé¥±å’Œåº¦ï¼Œäº®åº¦) ç©ºé—´åå†å¯¹å…¶äº®åº¦ç©ºé—´è¿›è¡Œç›´æ–¹å›¾å‡è¡¡åŒ–</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å°†å›¾ç‰‡ç”±rgbç©ºé—´è½¬ä¸ºhsiç©ºé—´å¹¶å¯¹å…¶äº®åº¦ç©ºé—´è¿›è¡Œç›´æ–¹å›¾å‡è¡¡</span></span><br><span class="line"><span class="keyword">void</span> ImgConverse::RGB_HSI() &#123;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; img_ = img;</span><br><span class="line">img_.display(<span class="string">"å¤„ç†å‰å›¾ç‰‡"</span>);</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; img0 = img_.histogram(<span class="number">256</span>, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">img0.display_graph(<span class="string">"å¤„ç†åç›´æ–¹å›¾"</span>);</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; pic = img; <span class="comment">//å®šä¹‰floatç±»å‹çš„ç›®çš„æ˜¯å¯¹å…¶è¿›è¡Œå½’ä¸€åŒ–</span></span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; hsi = img;</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; hsi_i(img.width(), img.height(), <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">hsi.RGBtoHSI(); <span class="comment">//å°†rgbç©ºé—´è½¬æ¢åˆ°hsi(è‰²å½©,é¥±å’Œåº¦,äº®åº¦)ç©ºé—´ï¼Œåªå¯¹å…¶ä¸­çš„äº®åº¦ç©ºé—´è¿›è¡Œå¤„ç†</span></span><br><span class="line">cimg_forXY(hsi, x, y) &#123;</span><br><span class="line">hsi_i(x, y) = hsi(x, y, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; hsi_ii = hsi_i.normalize(<span class="number">0</span>,<span class="number">255</span>);</span><br><span class="line">hsi_ii = Hist(hsi_ii);</span><br><span class="line">hsi_i = hsi_ii;</span><br><span class="line">hsi_i = hsi_i.normalize(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">cimg_forXY(hsi, x, y) &#123;</span><br><span class="line">hsi(x, y, <span class="number">2</span>) = hsi_i(x, y);</span><br><span class="line">&#125;</span><br><span class="line">hsi.HSItoRGB();</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; hist = hsi.normalize(<span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">hist.display(<span class="string">"å¤„ç†åå›¾ç‰‡"</span>);</span><br><span class="line">hist_equalImg = hist;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; hist0 = pic.histogram(<span class="number">256</span>, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">hist0.display_graph(<span class="string">"å¤„ç†åç›´æ–¹å›¾"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•æ•ˆæœï¼š"><a href="#æµ‹è¯•æ•ˆæœï¼š" class="headerlink" title="æµ‹è¯•æ•ˆæœï¼š"></a>æµ‹è¯•æ•ˆæœï¼š</h4><p>ä¸‹é¢ä¸€ç»„å›¾å¯¹åº”ç€åˆ†åˆ«åœ¨ç°åº¦å›¾å’Œå½©è‰²å›¾å¤„ç†ä¸‹çš„ç›´æ–¹å›¾å‡è¡¡åŒ–æ•ˆæœå›¾ä»¥åŠç°åº¦åˆ†å¸ƒç›´æ–¹å›¾ï¼Œ<strong>æ¯ä¸€ç»„çš„æœ€åä¸€å¼ å½©è‰²å›¾æ˜¯è½¬ä¸ºlabç©ºé—´ä¸‹çš„å›¾ç‰‡</strong>ã€‚<br><img src="https://img-blog.csdnimg.cn/20181120231050438.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181120231103878.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181120231135114.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181120231201896.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181120231217216.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181120231231705.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>ä»åˆ†ææ•ˆæœå¯ä»¥çœ‹å‡ºå¯¹äºå½©è‰²å›¾çš„å¤„ç†æ¥è¯´æ˜æ˜¾è½¬ä¸ºlabçš„æ•ˆæœè¦æ¯”ç›´æ¥ä¸‰é€šé“å¤„ç†æ•ˆæœå¥½å¾—å¤šã€‚</strong></p><h4 id="æ•ˆæœåˆ†æï¼š"><a href="#æ•ˆæœåˆ†æï¼š" class="headerlink" title="æ•ˆæœåˆ†æï¼š"></a>æ•ˆæœåˆ†æï¼š</h4><p><em>å‡è¡¡åŒ–æœ‰ä¼˜ç‚¹ä¹Ÿæœ‰ç¼ºç‚¹</em></p><p><strong>ä¼˜ç‚¹æ˜¯ï¼š</strong></p><ul><li><p>è¿™ç§æ–¹æ³•é€šå¸¸ç”¨æ¥å¢åŠ è®¸å¤šå›¾åƒçš„å±€éƒ¨å¯¹æ¯”åº¦ï¼Œå°¤å…¶æ˜¯å½“å›¾åƒçš„æœ‰ç”¨æ•°æ®çš„å¯¹æ¯”åº¦ç›¸å½“æ¥è¿‘çš„æ—¶å€™ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œäº®åº¦å¯ä»¥æ›´å¥½åœ°åœ¨ç›´æ–¹å›¾ä¸Šåˆ†å¸ƒã€‚è¿™æ ·å°±å¯ä»¥ç”¨äºå¢å¼ºå±€éƒ¨çš„å¯¹æ¯”åº¦è€Œä¸å½±å“æ•´ä½“çš„å¯¹æ¯”åº¦ï¼Œç›´æ–¹å›¾å‡è¡¡åŒ–é€šè¿‡æœ‰æ•ˆåœ°æ‰©å±•å¸¸ç”¨çš„äº®åº¦æ¥å®ç°è¿™ç§åŠŸèƒ½ã€‚è¿™ç§æ–¹æ³•å¯¹äºèƒŒæ™¯å’Œå‰æ™¯éƒ½å¤ªäº®æˆ–è€…å¤ªæš—çš„å›¾åƒéå¸¸æœ‰ç”¨ï¼Œè¿™ç§æ–¹æ³•å°¤å…¶æ˜¯å¯ä»¥å¸¦æ¥Xå…‰å›¾åƒä¸­æ›´å¥½çš„éª¨éª¼ç»“æ„æ˜¾ç¤ºä»¥åŠæ›å…‰è¿‡åº¦æˆ–è€…æ›å…‰ä¸è¶³ç…§ç‰‡ä¸­æ›´å¥½çš„ç»†èŠ‚ã€‚</p></li><li><p>è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªä¸»è¦ä¼˜åŠ¿æ˜¯å®ƒæ˜¯ä¸€ä¸ªç›¸å½“ç›´è§‚çš„æŠ€æœ¯å¹¶ä¸”æ˜¯å¯é€†æ“ä½œï¼Œå¦‚æœå·²çŸ¥å‡è¡¡åŒ–å‡½æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ¢å¤åŸå§‹çš„ç›´æ–¹å›¾ï¼Œå¹¶ä¸”è®¡ç®—é‡ä¹Ÿä¸å¤§ã€‚è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯å®ƒå¯¹å¤„ç†çš„æ•°æ®ä¸åŠ é€‰æ‹©ï¼Œå®ƒå¯èƒ½ä¼šå¢åŠ èƒŒæ™¯æ‚è®¯çš„å¯¹æ¯”åº¦å¹¶ä¸”é™ä½æœ‰ç”¨ä¿¡å·çš„å¯¹æ¯”åº¦ã€‚</p></li></ul><p><strong>ç¼ºç‚¹æ˜¯ï¼š</strong></p><ul><li>å˜æ¢åå›¾åƒçš„ç°åº¦çº§å‡å°‘ï¼ŒæŸäº›ç»†èŠ‚æ¶ˆå¤±ï¼›</li><li>æŸäº›å›¾åƒï¼Œå¦‚ç›´æ–¹å›¾æœ‰é«˜å³°ï¼Œç»å¤„ç†åå¯¹æ¯”åº¦ä¸è‡ªç„¶çš„è¿‡åˆ†å¢å¼ºã€‚  </li></ul><p><strong>é’ˆå¯¹æå‡ºçš„ç¼ºç‚¹ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</strong></p><p>å¯¹å­™ä¿ªè¿™å¼ å›¾è¿›è¡Œä¸€ä¸‹ç›´æ–¹å›¾å‡è¡¡åŒ–ï¼Œæ•ˆæœ<em>å­™ä¿ªçœ‹äº†æƒ³æ‰“äºº.jpg</em></p><p><img src="https://img-blog.csdnimg.cn/2018112023084961.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181120230911992.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç©¶å…¶åŸå› ï¼Œä¸»è¦æ˜¯ä¸Šå¼ å›¾å¯¹å›¾ç‰‡è¿›è¡Œäº†ä¸€ä¸ªæ•´ä½“çš„å¤„ç†ï¼Œè€Œå®é™…ä¸Šæˆ‘ä»¬å¹¶ä¸æƒ³å¯¹èƒŒæ™¯æ¿å•Šï¼Œå¢™å•Šè¿™äº›è¿›è¡Œå¤„ç†ï¼Œå› ä¸ºè¿™äº›æ¥è¿‘äºçº¯è‰²ï¼Œä»–ä»¬å¤„ç†åçš„å¯¹æ¯”åº¦ç¡®å®å¢å¼ºäº†ï¼Œä½†æ‹‰ä½äº†äººç‰©çš„å¯¹æ¯”åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”ç”¨ä¸ŠèŠ‚è¯¾å­¦è¿‡çš„è¾¹ç¼˜åˆ†å‰²å…ˆå–å›¾ç‰‡è¾¹ç¼˜ï¼Œç„¶ååªå¯¹å…¶ä¸­ä¸ä¸ºé›¶çš„ç‚¹è¿›è¡Œç›´æ–¹å›¾å‡è¡¡ï¼Œå¾—åˆ°çš„æ•ˆæœå¦‚ä¸‹ï¼š<br><img src="https://img-blog.csdnimg.cn/2018112023092875.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä½†å…¶å®è¿™ä¸ªæ•ˆæœä»ç„¶æœ‰ç‚¹å¾®å¼±ï¼Œå®é™…æ›´æƒ³åšçš„æ˜¯å°†ä¸»ä½“è¿™ä¸€ä¸ªå¤§ç±»è¿›è¡Œç›´æ–¹å›¾å‡è¡¡åŒ–è€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªè¾¹ç¼˜ï¼Œè¿™ä¸ªæŸ¥äº†ä¸€ä¸‹å¯èƒ½è¦ç”¨åˆ°è¯­ä¹‰åˆ†å‰²å’Œå®ä¾‹åˆ†å‰²çš„çŸ¥è¯†ï¼Œéš¾åº¦æœ‰ç‚¹å¤§ï¼Œä»¥åæœ‰æ—¶é—´å¸Œæœ›èƒ½å†æ·±å…¥åšä¸€ä¸‹ã€‚<br><img src="https://img-blog.csdnimg.cn/20181120230939753.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>å®Œæ•´ä»£ç å‚è§ï¼š</strong><br><a href="https://github.com/WangPerryWPY/Computer-Version/tree/master/Exp4" target="_blank" rel="noopener">https://github.com/WangPerryWPY/Computer-Version/tree/master/Exp4</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;é¢˜ç›®ï¼š&quot;&gt;&lt;a href=&quot;#é¢˜ç›®ï¼š&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®ï¼š&quot;&gt;&lt;/a&gt;é¢˜ç›®ï¼š&lt;/h3&gt;&lt;p&gt;ç”¨ CImg ç¼–å†™ç°åº¦å›¾åƒç›´æ–¹å›¾å‡è¡¡åŒ–ï¼š &lt;/p&gt;
&lt;p&gt;   (a) åŒå­¦ç”¨æ‰‹æœºæ‹æ‘„ä¸åŒå…‰ç…§æƒ…å†µä¸‹çš„å›¾åƒï¼Œä½œä¸ºæµ‹è¯•æ ·æœ¬ï¼Œä¸ä½äº 5
      
    
    </summary>
    
      <category term="è®¡ç®—æœºè§†è§‰" scheme="http://yoursite.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="è®¡ç®—æœºè§†è§‰" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/"/>
    
  </entry>
  
  <entry>
    <title>ImageMorping</title>
    <link href="http://yoursite.com/2019/07/06/ImageMorping/"/>
    <id>http://yoursite.com/2019/07/06/ImageMorping/</id>
    <published>2019-07-06T12:13:42.000Z</published>
    <updated>2019-07-06T12:14:19.326Z</updated>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®ï¼šImageMorphing"><a href="#é¢˜ç›®ï¼šImageMorphing" class="headerlink" title="é¢˜ç›®ï¼šImageMorphing"></a>é¢˜ç›®ï¼šImageMorphing</h3><ul><li><strong>å®ç°ä¸‹é¢ä¸¤å¼ å›¾ä¸­é—´11å¸§çš„å˜æ¢</strong></li><li>å‚è€ƒæ–‡çŒ®ï¼š<a href="http://202.116.81.74/cache/1/03/web.media.mit.edu/9232d3e36ce968ec4fe798131c11e185/07_Image%20Morphing.pdf" target="_blank" rel="noopener">http://202.116.81.74/cache/1/03/web.media.mit.edu/9232d3e36ce968ec4fe798131c11e185/07_Image%20Morphing.pdf</a><br><img src="https://img-blog.csdnimg.cn/20181120230243901.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li></ul><p><img src="https://img-blog.csdnimg.cn/20181120230250880.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="å®ç°è¿‡ç¨‹ï¼š"><a href="#å®ç°è¿‡ç¨‹ï¼š" class="headerlink" title="å®ç°è¿‡ç¨‹ï¼š"></a>å®ç°è¿‡ç¨‹ï¼š</h3><h4 id="1-ç½‘æ ¼çš„ç”Ÿæˆ"><a href="#1-ç½‘æ ¼çš„ç”Ÿæˆ" class="headerlink" title="1. ç½‘æ ¼çš„ç”Ÿæˆ"></a>1. ç½‘æ ¼çš„ç”Ÿæˆ</h4><p><strong>å°†æºå›¾åƒå’Œç›®æ ‡å›¾åƒé€šè¿‡å»ºç«‹ç‰¹å¾ç‚¹ï¼Œå½¢æˆç‚¹é›†ï¼Œç„¶åé€šè¿‡ä¸‰è§’å‰–åˆ†çš„æ–¹æ³•å½¢æˆä¸‰è§’å½¢ç½‘ç»œ</strong></p><p>1ï¼‰æŠŠæºå›¾åƒä¸­å½¢æˆçš„ä¸‰è§’å½¢å’Œç›®æ ‡å›¾åƒç”Ÿæˆçš„ä¸‰è§’å½¢ï¼ˆä¸‰è§’å½¢å¯¹ï¼‰å¯¹åº”èµ·æ¥ã€‚ï¼ˆå¯¹æ•´ä½“çš„æºå›¾åƒå’Œç›®æ ‡å›¾åƒæ¥è¯´ï¼Œä»–ä»¬åˆ’åˆ†å‡ºç½‘æ ¼ä¹‹åï¼Œåº”è¯¥æ˜¯åŒæ„çš„ã€‚ï¼‰</p><p>å› æ­¤å°†æºå›¾å’Œç›®æ ‡å›¾ä¸­éœ€è¦å»ºç«‹ç½‘æ ¼çš„åŒæ„ç‚¹å­˜åˆ°ä¸¤ä¸ªæ–‡æœ¬ä¸­ï¼Œå†å°†æ‰€éœ€è¦å»ºç«‹çš„å›¾ç‰‡çš„ä¸‰è§’å½¢ç½‘æ ¼å¯¹åº”çš„åæ ‡ä½ç½®å­˜å‚¨åœ¨å¦ä¸€ä¸ªæ–‡æœ¬ä¸­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¯»å…¥æºå›¾ä¸­é¢éƒ¨ç‰¹å¾ç‚¹</span></span><br><span class="line">ifstream filePoint;</span><br><span class="line">filePoint.open(<span class="string">"source.txt"</span>);</span><br><span class="line"><span class="built_in">string</span> s;</span><br><span class="line"><span class="keyword">int</span> x = <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (getline(filePoint, s)) &#123;</span><br><span class="line"><span class="function"><span class="built_in">stringstream</span> <span class="title">ss</span><span class="params">(s)</span></span>;</span><br><span class="line">ss &gt;&gt; x &gt;&gt; y;</span><br><span class="line"><span class="function">point <span class="title">p</span><span class="params">(x, y)</span></span>;</span><br><span class="line">source_point.push_back(p);</span><br><span class="line">&#125;</span><br><span class="line">filePoint.close();</span><br><span class="line"><span class="comment">//è¯»å…¥ç›®æ ‡å›¾ä¸­é¢éƒ¨ç‰¹å¾ç‚¹</span></span><br><span class="line">filePoint.open(<span class="string">"target.txt"</span>);</span><br><span class="line"><span class="keyword">while</span> (getline(filePoint, s)) &#123;</span><br><span class="line"><span class="function"><span class="built_in">stringstream</span> <span class="title">ss</span><span class="params">(s)</span></span>;</span><br><span class="line">ss &gt;&gt; x &gt;&gt; y;</span><br><span class="line"><span class="function">point <span class="title">p</span><span class="params">(x, y)</span></span>;</span><br><span class="line">target_point.push_back(p);</span><br><span class="line">&#125;</span><br><span class="line">filePoint.close();</span><br><span class="line"><span class="comment">//è¯»å…¥éœ€è¦å»ºç«‹çš„ä»¿å°„å˜æ¢ç½‘æ ¼ç‚¹</span></span><br><span class="line">filePoint.open(<span class="string">"grid.txt"</span>);</span><br><span class="line"><span class="keyword">int</span> p1 = <span class="number">0</span>, p2 = <span class="number">0</span>, p3 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (getline(filePoint, s)) &#123;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; p;</span><br><span class="line"><span class="function"><span class="built_in">stringstream</span> <span class="title">ss</span><span class="params">(s)</span></span>;</span><br><span class="line">ss &gt;&gt; p1 &gt;&gt; p2 &gt;&gt; p3;</span><br><span class="line">p.push_back(p1);</span><br><span class="line">p.push_back(p2);</span><br><span class="line">p.push_back(p3);</span><br><span class="line">triangle_grid.push_back(p);</span><br><span class="line">&#125;</span><br><span class="line">filePoint.close();</span><br></pre></td></tr></table></figure><p>2ï¼‰é€šè¿‡æºä¸‰è§’å½¢å’Œç›®æ ‡ä¸‰è§’å½¢çš„é¡¶ç‚¹åæ ‡å€¼ï¼Œä½¿ç”¨ä»¿å°„å˜æ¢æ±‚å‡ºå˜æ¢ä»æºä¸‰è§’å½¢åˆ°ç›®æ ‡ä¸‰è§’å½¢çš„å˜æ¢çŸ©é˜µTã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–ä¸­é—´æ¯ä¸€å¸§å›¾ç‰‡çš„ä¸‰è§’å½¢ç½‘æ ¼</span></span><br><span class="line"><span class="keyword">void</span> ImageMorphing::get_middleGrid() &#123;</span><br><span class="line"><span class="comment">//å­˜å‚¨æ¯ä¸€å¸§ä¸­é—´å›¾çš„ç‚¹</span></span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="built_in">vector</span>&lt;point&gt;&gt; mid_point;</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; frame; ++i) &#123;</span><br><span class="line"><span class="built_in">vector</span>&lt;point&gt; temp;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; source_point.size(); ++j) &#123;</span><br><span class="line"><span class="keyword">int</span> x = <span class="keyword">float</span>(source_point[j].x) + <span class="keyword">float</span>(<span class="keyword">float</span>(i + <span class="number">1</span>) / (frame + <span class="number">1</span>)) * <span class="keyword">float</span>(target_point[j].x - source_point[j].x);</span><br><span class="line"><span class="keyword">int</span> y = <span class="keyword">float</span>(source_point[j].y) + <span class="keyword">float</span>(<span class="keyword">float</span>(i + <span class="number">1</span>) / (frame + <span class="number">1</span>)) * <span class="keyword">float</span>(target_point[j].y - source_point[j].y);</span><br><span class="line"><span class="function">point <span class="title">p</span><span class="params">(x, y)</span></span>;</span><br><span class="line">temp.push_back(p);</span><br><span class="line">&#125;</span><br><span class="line">mid_point.push_back(temp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è·å–ä¸­é—´æ¯ä¸€å¸§çš„ä¸‰è§’å½¢ç½‘æ ¼</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; frame; ++i) &#123;</span><br><span class="line"><span class="built_in">vector</span>&lt;triangle&gt; temp;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; triangle_grid.size(); ++j) &#123;</span><br><span class="line"><span class="function">triangle <span class="title">t</span><span class="params">(mid_point[i][triangle_grid[j][<span class="number">0</span>]], mid_point[i][triangle_grid[j][<span class="number">1</span>]], mid_point[i][triangle_grid[j][<span class="number">2</span>]])</span></span>;</span><br><span class="line">temp.push_back(t);</span><br><span class="line">&#125;</span><br><span class="line">mid_triangle.push_back(temp);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> ImageMorphing::AffineTransform() &#123;</span><br><span class="line"><span class="comment">//è·å–æ¯ä¸€å¸§å›¾ä¸æºå›¾ç½‘æ ¼çš„å˜æ¢çŸ©é˜µ</span></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; frame; ++i) &#123;</span><br><span class="line"><span class="built_in">vector</span>&lt;CImg&lt;<span class="keyword">float</span>&gt;&gt; temp;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; triangle_grid.size(); ++j) &#123;</span><br><span class="line">triangle src = mid_triangle[i][j];</span><br><span class="line">triangle dst = source_triangle[j];</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; A(<span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; y1(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>), y2(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; c1(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>), c2(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">A(<span class="number">0</span>, <span class="number">0</span>) = src.a.x; A(<span class="number">1</span>, <span class="number">0</span>) = src.a.y;</span><br><span class="line">A(<span class="number">0</span>, <span class="number">1</span>) = src.b.x; A(<span class="number">1</span>, <span class="number">1</span>) = src.b.y;</span><br><span class="line">A(<span class="number">0</span>, <span class="number">2</span>) = src.c.x; A(<span class="number">1</span>, <span class="number">2</span>) = src.c.y;</span><br><span class="line">y1(<span class="number">0</span>, <span class="number">0</span>) = dst.a.x; y2(<span class="number">0</span>, <span class="number">0</span>) = dst.a.y;</span><br><span class="line">y1(<span class="number">0</span>, <span class="number">1</span>) = dst.b.x; y2(<span class="number">0</span>, <span class="number">1</span>) = dst.b.y;</span><br><span class="line">y1(<span class="number">0</span>, <span class="number">2</span>) = dst.c.x; y2(<span class="number">0</span>, <span class="number">2</span>) = dst.c.y;</span><br><span class="line">c1 = y1.solve(A);</span><br><span class="line">c2 = y2.solve(A);</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; transform(<span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; <span class="number">3</span>; ++k) &#123;</span><br><span class="line">transform(k, <span class="number">0</span>) = c1(<span class="number">0</span>, k);</span><br><span class="line">transform(k, <span class="number">1</span>) = c2(<span class="number">0</span>, k);</span><br><span class="line">&#125;</span><br><span class="line">transform(<span class="number">2</span>, <span class="number">2</span>) = <span class="number">1</span>;</span><br><span class="line">temp.push_back(transform);</span><br><span class="line">&#125;</span><br><span class="line">source_matrix.push_back(temp);</span><br><span class="line"><span class="comment">//temp.clear();</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è·å–æ¯ä¸€å¸§å›¾ä¸ç›®æ ‡å›¾ç½‘æ ¼çš„å˜æ¢çŸ©é˜µ</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; frame; ++i) &#123;</span><br><span class="line"><span class="built_in">vector</span>&lt;CImg&lt;<span class="keyword">float</span>&gt;&gt; temp;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; triangle_grid.size(); ++j) &#123;</span><br><span class="line">triangle src = mid_triangle[i][j];</span><br><span class="line">triangle dst = target_triangle[j];</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; A(<span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; y1(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>), y2(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; c1(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>), c2(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">A(<span class="number">0</span>, <span class="number">0</span>) = src.a.x; A(<span class="number">1</span>, <span class="number">0</span>) = src.a.y;</span><br><span class="line">A(<span class="number">0</span>, <span class="number">1</span>) = src.b.x; A(<span class="number">1</span>, <span class="number">1</span>) = src.b.y;</span><br><span class="line">A(<span class="number">0</span>, <span class="number">2</span>) = src.c.x; A(<span class="number">1</span>, <span class="number">2</span>) = src.c.y;</span><br><span class="line">y1(<span class="number">0</span>, <span class="number">0</span>) = dst.a.x; y2(<span class="number">0</span>, <span class="number">0</span>) = dst.a.y;</span><br><span class="line">y1(<span class="number">0</span>, <span class="number">1</span>) = dst.b.x; y2(<span class="number">0</span>, <span class="number">1</span>) = dst.b.y;</span><br><span class="line">y1(<span class="number">0</span>, <span class="number">2</span>) = dst.c.x; y2(<span class="number">0</span>, <span class="number">2</span>) = dst.c.y;</span><br><span class="line">c1 = y1.solve(A);</span><br><span class="line">c2 = y2.solve(A);</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; transform(<span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; <span class="number">3</span>; ++k) &#123;</span><br><span class="line">transform(k, <span class="number">0</span>) = c1(<span class="number">0</span>, k);</span><br><span class="line">transform(k, <span class="number">1</span>) = c2(<span class="number">0</span>, k);</span><br><span class="line">&#125;</span><br><span class="line">transform(<span class="number">2</span>, <span class="number">2</span>) = <span class="number">1</span>;</span><br><span class="line">temp.push_back(transform);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">target_matrix.push_back(temp);</span><br><span class="line"><span class="comment">//temp.clear();</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-ä¸­é—´å¸§ç”Ÿæˆ"><a href="#2-ä¸­é—´å¸§ç”Ÿæˆ" class="headerlink" title="2. ä¸­é—´å¸§ç”Ÿæˆ"></a>2. ä¸­é—´å¸§ç”Ÿæˆ</h4><p><strong>å¯¹å…¶ä¸­ä¸€ä¸ªä¸‰è§’å½¢å¯¹æ¥è¯´,ä¸­é—´å¸§çš„ç”Ÿæˆè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</strong></p><p>1) é€šè¿‡å˜æ¢çŸ©é˜µTï¼Œæ±‚å¾—ä¸‰è§’å½¢å¯¹çš„å¯¹åº”åƒç´ ç‚¹åæ ‡ã€‚</p><p>2) å®šä½æºä¸‰è§’å½¢å†…éƒ¨åƒç´ ç‚¹P0çš„RGBå€¼ï¼Œç»è¿‡çº¿å‹æ’å€¼è¿ç®—ï¼šPinternal=(1-1/n)P0+(1/n)P1ï¼ˆPinternalæ˜¯ä¸­é—´å¸§åƒç´ ç‚¹RGBå€¼ï¼ŒP1æ˜¯ç›®æ ‡åƒç´ ç‚¹RGBå€¼ï¼Œnä¸ºå˜å½¢åŠ¨ç”»çš„å¸§æ•°ï¼‰è·å¾—ä¸­é—´å¸§ä¸­ç‚¹Pinternalçš„RGBå€¼ã€‚</p><p>é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œæ±‚å¾—å…¶ä½™ä¸‰è§’å½¢çš„ä¸­é—´å¸§ç‚¹Pinternalçš„RGBå€¼ï¼Œå¹¶å°†ä»–ä»¬å†™å…¥ä¸­é—´å¸§ç¼“å­˜ä¸­ï¼Œæœ€ç»ˆç”Ÿæˆä¸­é—´å¸§å›¾åƒã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯¹å›¾ç‰‡è¿›è¡Œå˜æ¢å¤„ç†</span></span><br><span class="line"><span class="keyword">void</span> ImageMorphing::Morphing_process() &#123;</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">result.push_back(source);</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; frame; ++i) &#123;</span><br><span class="line"><span class="keyword">float</span> k = <span class="keyword">float</span>(i + <span class="number">1</span>) / (frame + <span class="number">1</span>);</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; middle(target.width(), target.height(), <span class="number">1</span>,<span class="number">3</span>,<span class="number">0</span>);</span><br><span class="line">cimg_forXY(middle, x, y) &#123;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; mid_triangle[<span class="number">0</span>].size(); ++j) &#123;</span><br><span class="line"><span class="function">point <span class="title">p</span><span class="params">(x, y)</span></span>;</span><br><span class="line"><span class="keyword">if</span> (IsTriangle(p, mid_triangle[i][j])) &#123;</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; x0(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; b1(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>), b2(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">x0(<span class="number">0</span>, <span class="number">0</span>) = x;</span><br><span class="line">x0(<span class="number">0</span>, <span class="number">1</span>) = y;</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; A1 = source_matrix[i][j];</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; A2 = target_matrix[i][j];</span><br><span class="line">b1 = A1 * x0;</span><br><span class="line">b2 = A2 * x0;</span><br><span class="line">middle(x, y, <span class="number">0</span>) = (<span class="number">1</span> - k) * source(b1(<span class="number">0</span>, <span class="number">0</span>), b1(<span class="number">0</span>, <span class="number">1</span>), <span class="number">0</span>) + k * target(b2(<span class="number">0</span>, <span class="number">0</span>), b2(<span class="number">0</span>, <span class="number">1</span>), <span class="number">0</span>);</span><br><span class="line">middle(x, y, <span class="number">1</span>) = (<span class="number">1</span> - k) * source(b1(<span class="number">0</span>, <span class="number">0</span>), b1(<span class="number">0</span>, <span class="number">1</span>), <span class="number">1</span>) + k * target(b2(<span class="number">0</span>, <span class="number">0</span>), b2(<span class="number">0</span>, <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">middle(x, y, <span class="number">2</span>) = (<span class="number">1</span> - k) * source(b1(<span class="number">0</span>, <span class="number">0</span>), b1(<span class="number">0</span>, <span class="number">1</span>), <span class="number">2</span>) + k * target(b2(<span class="number">0</span>, <span class="number">0</span>), b2(<span class="number">0</span>, <span class="number">1</span>), <span class="number">2</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">result.push_back(middle);</span><br><span class="line">&#125;</span><br><span class="line">result.push_back(target);</span><br><span class="line"><span class="comment">//ä¿å­˜ç»“æœçš„gifåŠ¨å›¾</span></span><br><span class="line">result.save_gif_external(<span class="string">"a.gif"</span>);</span><br><span class="line"><span class="comment">//å­˜å‚¨æ¯ä¸€å¸§å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; result.size(); i++) &#123;</span><br><span class="line"><span class="built_in">string</span> s = to_string(i + <span class="number">1</span>);</span><br><span class="line">s += <span class="string">".bmp"</span>;</span><br><span class="line">result[i].save_bmp(s.c_str());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨è¯¥ä¸‰è§’å½¢ç½‘æ ¼å†…</span></span><br><span class="line"><span class="comment">//è‹¥ç‚¹påœ¨ABCç»„æˆçš„ä¸‰è§’å½¢å†…ï¼Œåˆ™p = A +  u * (C â€“ A) + v * (B - A)</span></span><br><span class="line"><span class="comment">//u &gt;= 0  v &gt;= 0 u + v &lt;= 1</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IsTriangle</span><span class="params">(point p, triangle t)</span> </span>&#123;</span><br><span class="line"><span class="keyword">float</span> x0 = t.c.x - t.a.x, y0 = t.c.y - t.a.y;</span><br><span class="line"><span class="keyword">float</span> x1 = t.b.x - t.a.x, y1 = t.b.y - t.a.y;</span><br><span class="line"><span class="keyword">float</span> x2 = p.x - t.a.x, y2 = p.y - t.a.y;</span><br><span class="line"><span class="keyword">float</span> temp = x0 * x0 + y0 * y0, temp1 = x0 * x1 + y0 * y1, temp2 = x0 * x2 + y0 * y2, temp3 = x1 * x1 + y1 * y1, temp4 = x1 * x2 + y1 * y2;</span><br><span class="line"><span class="keyword">float</span> u = <span class="keyword">float</span>(temp3 * temp2 - temp1 * temp4) / (<span class="keyword">float</span>)(temp * temp3 - temp1 * temp1);</span><br><span class="line"><span class="keyword">float</span> v = <span class="keyword">float</span>(temp * temp4 - temp1 * temp2) / (<span class="keyword">float</span>)(temp * temp3 - temp1 * temp1);</span><br><span class="line"><span class="keyword">if</span> (u &gt;= <span class="number">0</span> &amp;&amp; v &gt;= <span class="number">0</span> &amp;&amp; u + v &lt;= <span class="number">1</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-æœ€åå°è£…æˆä¸€ä¸ªå®Œæ•´çš„ç±»"><a href="#3-æœ€åå°è£…æˆä¸€ä¸ªå®Œæ•´çš„ç±»" class="headerlink" title="3.æœ€åå°è£…æˆä¸€ä¸ªå®Œæ•´çš„ç±»"></a>3.æœ€åå°è£…æˆä¸€ä¸ªå®Œæ•´çš„ç±»</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"CImg.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cimg_library;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> frame 11 <span class="comment">//å›¾ç‰‡å˜æ¢çš„å¸§æ•°</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åƒç´ ç‚¹</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">point</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span> x, y;</span><br><span class="line">point(<span class="keyword">int</span> x0, <span class="keyword">int</span> y0) :x(x0), y(y0) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç½‘æ ¼ä¸‰è§’</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">triangle</span> &#123;</span></span><br><span class="line">point a, b, c;</span><br><span class="line">triangle(point a0, point b0, point c0) :a(a0), b(b0), c(c0) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageMorphing</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; source; <span class="comment">//æºå›¾</span></span><br><span class="line">CImg&lt;<span class="keyword">float</span>&gt; target; <span class="comment">//ç›®æ ‡å›¾</span></span><br><span class="line">CImgList&lt;<span class="keyword">float</span>&gt; result; <span class="comment">//ç»“æœå›¾ç‰‡é›†</span></span><br><span class="line"><span class="built_in">vector</span>&lt;point&gt; source_point; <span class="comment">//æºå›¾ç½‘æ ¼ç‚¹</span></span><br><span class="line"><span class="built_in">vector</span>&lt;point&gt; target_point; <span class="comment">//ç›®æ ‡å›¾ç½‘æ ¼ç‚¹</span></span><br><span class="line"><span class="built_in">vector</span>&lt;triangle&gt; source_triangle; <span class="comment">//æºå›¾ç½‘æ ¼</span></span><br><span class="line"><span class="built_in">vector</span>&lt;triangle&gt; target_triangle; <span class="comment">//ç›®æ ‡å›¾ç½‘æ ¼</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;triangle&gt;&gt; mid_triangle; <span class="comment">//ä¸­é—´å¸§ç½‘æ ¼</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; triangle_grid; <span class="comment">//éœ€è¦å‚ä¸å˜æ¢çš„ç½‘æ ¼</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;CImg&lt;<span class="keyword">float</span>&gt;&gt;&gt; source_matrix; <span class="comment">//æºå›¾åˆ°ä¸­é—´å¸§çš„å˜æ¢çŸ©é˜µ</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;CImg&lt;<span class="keyword">float</span>&gt;&gt;&gt; target_matrix; <span class="comment">//ç›®æ ‡å›¾åˆ°ä¸­é—´å¸§çš„å˜æ¢çŸ©é˜µ</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">ImageMorphing();</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_middleGrid</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">AffineTransform</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Morphing_process</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="ç»“æœæµ‹è¯•ï¼š"><a href="#ç»“æœæµ‹è¯•ï¼š" class="headerlink" title="ç»“æœæµ‹è¯•ï¼š"></a>ç»“æœæµ‹è¯•ï¼š</h3><p>æºå›¾å’Œç›®æ ‡å›¾ä¸­ä¸€å…±å–äº†83ä¸ªç‚¹ï¼Œå…±å»ºç«‹äº†153ä¸ªç½‘æ ¼ï¼š<br><img src="https://img-blog.csdnimg.cn/20181120230152801.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>ç»“æœå›¾åƒçš„gifï¼š</strong><br><img src="https://img-blog.csdnimg.cn/20181120224637896.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>å®Œæ•´ä»£ç è¯·å‚è€ƒï¼š</strong><br><a href="https://github.com/WangPerryWPY/Computer-Version/tree/master/Exp5" target="_blank" rel="noopener">https://github.com/WangPerryWPY/Computer-Version/tree/master/Exp5</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;é¢˜ç›®ï¼šImageMorphing&quot;&gt;&lt;a href=&quot;#é¢˜ç›®ï¼šImageMorphing&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®ï¼šImageMorphing&quot;&gt;&lt;/a&gt;é¢˜ç›®ï¼šImageMorphing&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;
      
    
    </summary>
    
      <category term="è®¡ç®—æœºè§†è§‰" scheme="http://yoursite.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="è®¡ç®—æœºè§†è§‰" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/"/>
    
  </entry>
  
  <entry>
    <title>éœå¤«å˜æ¢</title>
    <link href="http://yoursite.com/2019/07/06/%E9%9C%8D%E5%A4%AB%E5%8F%98%E6%8D%A2/"/>
    <id>http://yoursite.com/2019/07/06/éœå¤«å˜æ¢/</id>
    <published>2019-07-06T12:12:29.000Z</published>
    <updated>2019-07-06T12:13:10.163Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åŸç†ï¼š"><a href="#åŸç†ï¼š" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h2><ul><li><strong>ç›´çº¿</strong>ï¼š</li></ul><p>ä¸€æ¡ç›´çº¿åœ¨å›¾åƒä¸­æ˜¯ä¸€ç³»åˆ—ç¦»æ•£ç‚¹çš„é›†åˆï¼Œé€šè¿‡ä¸€ä¸ªç›´çº¿çš„ç¦»æ•£æåæ ‡å…¬å¼ï¼Œå¯ä»¥è¡¨è¾¾å‡ºç›´çº¿çš„ç¦»æ•£ç‚¹å‡ ä½•ç­‰å¼å¦‚ä¸‹ï¼š<br>$$<br>X *cos(theta) + y * sin(theta)  = r<br>$$<br>å…¶ä¸­è§’åº¦thetaæŒ‡rä¸Xè½´ä¹‹é—´çš„å¤¹è§’ï¼Œrä¸ºåˆ°ç›´çº¿å‡ ä½•å‚ç›´è·ç¦»ã€‚ä»»ä½•åœ¨ç›´çº¿ä¸Šç‚¹ï¼Œx,  yéƒ½å¯ä»¥è¡¨è¾¾ï¼Œå…¶ä¸­ rï¼Œ thetaæ˜¯å¸¸é‡ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥è¦ç»˜åˆ¶æ¯ä¸ª(r, theta)å€¼æ ¹æ®åƒç´ ç‚¹åæ ‡P(x, y)å€¼ï¼Œé‚£ä¹ˆå›¾åƒå°±ä»å›¾åƒç¬›å¡å°”åæ ‡ç³»ç»Ÿè½¬æ¢åˆ°æåæ ‡éœå¤«ç©ºé—´ç³»ç»Ÿï¼Œè¿™ç§ä»ç‚¹åˆ°æ›²çº¿çš„å˜æ¢ç§°ä¸ºç›´çº¿çš„éœå¤«å˜æ¢ã€‚å˜æ¢é€šè¿‡é‡åŒ–éœå¤«å‚æ•°ç©ºé—´ä¸ºæœ‰é™ä¸ªå€¼é—´éš”ç­‰åˆ†æˆ–è€…ç´¯åŠ æ ¼å­ã€‚å½“éœå¤«å˜æ¢ç®—æ³•å¼€å§‹ï¼Œæ¯ä¸ªåƒç´ åæ ‡ç‚¹P(x, y)è¢«è½¬æ¢åˆ°(r, theta)çš„æ›²çº¿ç‚¹ä¸Šé¢ï¼Œç´¯åŠ åˆ°å¯¹åº”çš„æ ¼å­æ•°æ®ç‚¹ï¼Œå½“ä¸€ä¸ªæ³¢å³°å‡ºç°æ—¶å€™ï¼Œè¯´æ˜æœ‰ç›´çº¿å­˜åœ¨ã€‚</p><ul><li><strong>åœ†</strong></li></ul><p>åŒä»¥ä¸Šä¸€æ ·çš„åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥æ£€æµ‹åœ†ï¼Œåªæ˜¯å¯¹äºåœ†çš„å‚æ•°æ–¹ç¨‹å˜ä¸ºå¦‚ä¸‹ç­‰å¼ï¼š<br>$$<br>(x â€“a ) ^2 + (y-b) ^ 2 = r^2<br>$$<br>å…¶ä¸­(a, b)ä¸ºåœ†çš„ä¸­å¿ƒç‚¹åæ ‡ï¼Œråœ†çš„åŠå¾„ã€‚è¿™æ ·éœå¤«çš„å‚æ•°ç©ºé—´å°±å˜æˆä¸€ä¸ªä¸‰ç»´å‚æ•°ç©ºé—´ã€‚ç»™å®šåœ†åŠå¾„è½¬ä¸ºäºŒç»´éœå¤«å‚æ•°ç©ºé—´ã€‚</p><h2 id="å®ç°è¿‡ç¨‹ï¼š"><a href="#å®ç°è¿‡ç¨‹ï¼š" class="headerlink" title="å®ç°è¿‡ç¨‹ï¼š"></a>å®ç°è¿‡ç¨‹ï¼š</h2><ul><li>å®éªŒåŸºäºä¸Šä¸€æ¬¡ä»£ç çš„å®ç°ï¼Œç”¨sobelç®—å­å…ˆå®ç°è¾¹ç¼˜æ£€æµ‹ï¼Œç„¶åå†åœ¨è¾¹ç¼˜æ£€æµ‹çš„åŸºç¡€ä¸Šé€šè¿‡è°ƒèŠ‚é«˜æ–¯æ»¤æ³¢çš„å†…æ ¸sizeã€æ ‡å‡†å·®ä»¥åŠåŒé˜ˆå€¼æ£€æµ‹çš„é˜ˆå€¼å¤§å°æ¥å®ç°å¯¹å›¾åƒæ£€æµ‹çš„æ•ˆæœã€‚</li><li>æ•ˆæœåŸºæœ¬å®ç°ï¼Œç¼ºç‚¹æ˜¯ç›´çº¿æ£€æµ‹ä¸­çš„å›¾ç‰‡4ä¾§é¢ä¸¤æ¡è¾¹å› ä¸ºè¿‡äº®æ‰€ä»¥å¹²æ‰°æ¯”è¾ƒå¼ºï¼Œæ²¡æœ‰å®ç°å¾ˆå¥½çš„èƒ½ç›´æ¥æ£€æµ‹å››æ¡è¾¹ï¼Œè€Œæ˜¯é€šè¿‡æ£€æµ‹å‡ºçš„ç›´çº¿åæ’é™¤è¾ƒçŸ­çš„ä¸¤æ¡ç›´çº¿å‰©ä¸‹ä¸­é—´çš„çº¸å¼ ã€‚è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯åœ†æ£€æµ‹æ˜¯åšä¸åˆ°æ™ºèƒ½åœ°æ£€æµ‹å‡ºå›¾åƒä¸­åœ†çš„æ•°é‡ï¼Œè€Œæ˜¯è¦ä¸€ä¸ªé¢„ä¼°æ•°é‡å€¼(å…¶å®ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®ä¸€ä¸ªå¾ˆå¤§çš„æ£€æµ‹å€¼æ¥é€šè¿‡è®¾ç½®æŠ•ç¥¨å€¼çš„å¤§å°å®ç°æ•°é‡æ£€æµ‹ï¼Œä¸è¿‡ç®—æ³•å¤æ‚åº¦è¦å¾ˆé«˜)ã€‚</li><li>æ²¡åŠæ³•å®ç°ç”¨ä¸€å¥—è¾¹ç¼˜æ£€æµ‹å‚æ•°æµ‹å‡ºæ‰€æœ‰çš„å›¾åƒï¼Œå¹²æ‰°ç¨‹åº¦å¤§çš„å›¾ç‰‡éœ€è¦è°ƒå‚æ¥å®ç°ã€‚</li></ul><h3 id="ç›´çº¿ï¼š"><a href="#ç›´çº¿ï¼š" class="headerlink" title="ç›´çº¿ï¼š"></a>ç›´çº¿ï¼š</h3><ul><li><strong>è¿‡ç¨‹ä¸­ç”¨åˆ°çš„ç±»æˆå‘˜ï¼š</strong></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CImg&lt;<span class="keyword">int</span>&gt; HoughImg; <span class="comment">//ç›´çº¿çš„éœå¤«ç©ºé—´å›¾åƒ</span></span><br><span class="line"><span class="built_in">vector</span>&lt;lineParameter&gt; HoughLine; <span class="comment">//ç›´çº¿æ£€æµ‹å¾—å‡ºçš„ç›´çº¿çš„å‚æ•°</span></span><br><span class="line"><span class="built_in">vector</span>&lt;lineParameter&gt; Hough_Line; <span class="comment">//ä¸´æ—¶å­˜å‚¨ç›´çº¿å‚æ•°</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums;  <span class="comment">//ç”¨äºç­›é€‰å‡ºæœ€é•¿çš„å››æ¡è¾¹</span></span><br><span class="line"><span class="built_in">vector</span>&lt;parameter&gt; HoughPoint; <span class="comment">//ç›´çº¿æ£€æµ‹çš„è§’ç‚¹</span></span><br></pre></td></tr></table></figure><ul><li><strong>è¿‡ç¨‹ä¸­ç”¨åˆ°çš„ç±»æˆå‘˜å‡½æ•°ï¼š</strong></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å°†ç›´çº¿å˜æ¢ä¸ºæåæ ‡</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Polar_Line</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//éœå¤«ç›´çº¿æ£€æµ‹</span></span><br><span class="line">CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; LineDetect(<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>);</span><br><span class="line"><span class="comment">//æç»˜è§’ç‚¹</span></span><br><span class="line">CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; drawPoint();</span><br><span class="line"><span class="comment">//ç›´çº¿æ£€æµ‹æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LineDetect_Image</span><span class="params">(<span class="built_in">string</span>, <span class="keyword">int</span>, <span class="keyword">double</span>, <span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</span><br></pre></td></tr></table></figure><ul><li>*<em>å°†ç›´è§’åæ ‡è½¬åˆ°æåæ ‡å¹¶ç»Ÿè®¡â€œç¥¨æ•°â€ï¼š *</em></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> Hough::Polar_Line() &#123;</span><br><span class="line">  CImg&lt;<span class="keyword">int</span>&gt; pic = thres;</span><br><span class="line">  <span class="keyword">int</span> rows = pic.width();</span><br><span class="line">  <span class="keyword">int</span> cols = pic.height();</span><br><span class="line">  <span class="keyword">int</span> maxLength = (<span class="keyword">int</span>)<span class="built_in">sqrt</span>(<span class="built_in">pow</span>(rows, <span class="number">2</span>) + <span class="built_in">pow</span>(cols, <span class="number">2</span>));</span><br><span class="line">  HoughImg.resize(<span class="number">360</span>, maxLength, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  HoughImg.fill(<span class="number">0</span>);</span><br><span class="line">  cimg_forXY(pic, x, y) &#123;</span><br><span class="line">    <span class="keyword">if</span> (pic(x,y) != <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">360</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> r = (<span class="keyword">int</span>)x * <span class="built_in">cos</span>(M_PI*i / <span class="number">180</span>) + y * <span class="built_in">sin</span>(M_PI*i / <span class="number">180</span>);</span><br><span class="line">        <span class="keyword">if</span> (r &gt;= <span class="number">0</span> &amp;&amp; r &lt; maxLength) &#123;</span><br><span class="line">          HoughImg(i, r)++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ç­›é€‰å‡ºå¾—ç¥¨æ•°æœ€é«˜çš„æˆ‘ä»¬éœ€æ±‚æ•°é‡çš„ç›´çº¿ï¼Œå¹¶å‰”é™¤å¹²æ‰°ç›´çº¿ï¼š</strong></li></ul><p>(å…¶ä¸­çš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤ºè¦æ£€æµ‹å‡ºçš„ç›´çº¿æ•°é‡ï¼ˆéƒ½æ˜¯4ï¼‰ï¼Œå¹²æ‰°ç›´çº¿çš„æ•°é‡ï¼Œä»¥åŠè®¤ä¸ºæ˜¯åŒä¸€æ¡ç›´çº¿éœ€è¦å‰”é™¤æ‰çš„æ£€æµ‹è·ç¦»)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line">CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; Hough::LineDetect(<span class="keyword">int</span> lineNum, <span class="keyword">int</span> linedisturb, <span class="keyword">int</span> distance) &#123;</span><br><span class="line">  <span class="keyword">int</span> linenum = lineNum;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> Num = lineNum;</span><br><span class="line">  CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; pic = thres;</span><br><span class="line">   </span><br><span class="line">  pic.resize(pic.width(),pic.height(),<span class="number">1</span>,<span class="number">3</span>);</span><br><span class="line">  <span class="built_in">vector</span>&lt;parameter&gt; Lines;</span><br><span class="line">  <span class="built_in">vector</span>&lt;parameter&gt; result;</span><br><span class="line">  <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; lineweight;</span><br><span class="line">  cimg_forXY(HoughImg, x, y) &#123;</span><br><span class="line">    parameter a;</span><br><span class="line">    a.x = x;</span><br><span class="line">    a.y = y;</span><br><span class="line">    Lines.push_back(a);</span><br><span class="line">    lineweight.push_back(HoughImg(x, y));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; sortlineweight = lineweight;</span><br><span class="line">  sort(sortlineweight.begin(), sortlineweight.end(), greater&lt;<span class="keyword">int</span>&gt;());</span><br><span class="line">  <span class="keyword">int</span> fnums = lineNum + linedisturb;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; fnums; i++) &#123;</span><br><span class="line">    <span class="keyword">int</span> weight = sortlineweight[i], index;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator iter = find(lineweight.begin(), lineweight.end(), weight);</span><br><span class="line">    index = iter - lineweight.begin();</span><br><span class="line">    <span class="keyword">int</span> x1 = Lines[index].x, y1 = Lines[index].y;</span><br><span class="line">    <span class="comment">//cout &lt;&lt; x1 &lt;&lt; " " &lt;&lt; y1 &lt;&lt; endl;</span></span><br><span class="line">    <span class="keyword">bool</span> flag = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; i; k++) &#123;</span><br><span class="line">        <span class="keyword">int</span> x0 = result[k].x;</span><br><span class="line">        <span class="keyword">int</span> y0 = result[k].y;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">sqrt</span>(<span class="built_in">pow</span>(x1-x0,<span class="number">2</span>)+<span class="built_in">pow</span>(y1-y0,<span class="number">2</span>)) &lt; distance) &#123;</span><br><span class="line">          flag = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (flag == <span class="number">1</span>) &#123;</span><br><span class="line">      result.push_back(Lines[index]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      fnums++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> red[] = &#123; <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span> &#125;;</span><br><span class="line">  <span class="comment">//cout &lt;&lt; result.size() &lt;&lt; endl;</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; result.size(); i++) &#123;</span><br><span class="line">    <span class="keyword">int</span> a0 = <span class="number">0</span>;</span><br><span class="line">    nums.push_back(a0);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; result.size(); i++) &#123;</span><br><span class="line">    <span class="comment">//cout &lt;&lt; result[i].x &lt;&lt; " " &lt;&lt; result[i].y &lt;&lt; endl;</span></span><br><span class="line">    <span class="comment">//æ­¤æ—¶sinè§’åº¦å€¼ä¸º0ï¼Œkä¸ºæ— ç©·ï¼Œå•ç‹¬è®¨è®º</span></span><br><span class="line">    <span class="keyword">if</span> (result[i].x == <span class="number">0</span> || result[i].x == <span class="number">180</span>) &#123;</span><br><span class="line">      <span class="keyword">int</span> r = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> (result[i].x == <span class="number">0</span>) &#123;</span><br><span class="line">        r = result[i].y;</span><br><span class="line">        <span class="comment">//cout &lt;&lt; "Line " &lt;&lt; i+1 &lt;&lt; ": x=" &lt;&lt; r &lt;&lt; endl;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        r  -= (result[i].y);</span><br><span class="line">        <span class="comment">//cout &lt;&lt; "Line " &lt;&lt; i+1 &lt;&lt; ": x=" &lt;&lt; r &lt;&lt; endl;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//const int x_min = 0;</span></span><br><span class="line">      <span class="comment">//const int x_max = pic.width() - 1;</span></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">int</span> y_min = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">int</span> y_max = pic.height() - <span class="number">1</span>;</span><br><span class="line">      lineParameter temp;</span><br><span class="line">      temp.k = DBL_MAX;</span><br><span class="line">      temp.b = r;</span><br><span class="line">      Hough_Line.push_back(temp);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> yi = y_min; yi &lt; y_max; yi++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (thres.atXY(r, yi) != <span class="number">0</span>) &#123;</span><br><span class="line">          nums[i]++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//pic.draw_line(r , y_min, r, y_max, red);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">double</span> theta = <span class="keyword">double</span>(result[i].x)*M_PI/<span class="number">180</span>;</span><br><span class="line">      <span class="keyword">int</span> r = result[i].y;</span><br><span class="line">      <span class="comment">//cout &lt;&lt; "Line " &lt;&lt; i &lt;&lt; "  " &lt;&lt; theta &lt;&lt; "  " &lt;&lt; r &lt;&lt; endl;</span></span><br><span class="line">      <span class="keyword">double</span> k = (<span class="keyword">double</span>)(-<span class="built_in">cos</span>(theta) / <span class="built_in">sin</span>(theta));</span><br><span class="line">      <span class="keyword">double</span> b = (<span class="keyword">double</span>) r / <span class="built_in">sin</span>(theta);</span><br><span class="line">      lineParameter temp;</span><br><span class="line">      temp.k = k;</span><br><span class="line">      temp.b = b;</span><br><span class="line">      Hough_Line.push_back(temp);</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">int</span> x_min = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">int</span> x_max = pic.width() - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">int</span> y_min = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">int</span> y_max = pic.height() - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">int</span> x0 = (<span class="keyword">double</span>)(y_min - b) / k;</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">int</span> x1 = (<span class="keyword">double</span>)(y_max - b) / k;</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">int</span> y0 = x_min * k + b;</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">int</span> y1 = x_max * k + b;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">abs</span>(k) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> yi = y1; yi &lt; y_max; yi++) &#123;</span><br><span class="line">          <span class="keyword">int</span> xi = (<span class="keyword">double</span>)(yi - b) / k;</span><br><span class="line">          <span class="keyword">if</span> (thres.atXY(xi,yi) != <span class="number">0</span> || thres.atXY(xi+<span class="number">1</span>,yi) != <span class="number">0</span> || thres.atXY(xi,yi+<span class="number">1</span>) != <span class="number">0</span> || thres.atXY(xi+<span class="number">1</span>,yi+<span class="number">1</span>) != <span class="number">0</span>)</span><br><span class="line">            nums[i]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//pic.draw_line(x0, y_min, x1, y_max, red);</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> xi = x_min; xi &lt; x_max; xi++) &#123;</span><br><span class="line">          <span class="keyword">int</span> yi = k*xi + b;</span><br><span class="line">          <span class="keyword">if</span> (thres.atXY(xi,yi) != <span class="number">0</span> || thres.atXY(xi+<span class="number">1</span>,yi) != <span class="number">0</span> || thres.atXY(xi,yi+<span class="number">1</span>) != <span class="number">0</span> || thres.atXY(xi+<span class="number">1</span>,yi+<span class="number">1</span>) != <span class="number">0</span>)</span><br><span class="line">            nums[i]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//pic.draw_line(x_min, y0, x_max, y1, red);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//cout &lt;&lt; nums[i] &lt;&lt; endl;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; sortnums = nums;</span><br><span class="line">  sort(sortnums.begin(), sortnums.end(), greater&lt;<span class="keyword">int</span>&gt;());</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lineNum; i++) &#123;</span><br><span class="line">    <span class="keyword">int</span> weight1 = sortnums[i], index1;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator iter1 = find(nums.begin(), nums.end(), weight1);</span><br><span class="line">    index1 = iter1 - nums.begin();</span><br><span class="line">    HoughLine.push_back(Hough_Line[index1]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; HoughLine.size(); i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> x_min = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> x_max = pic.width() - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> y_min = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> y_max = pic.height() - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">double</span> b = HoughLine[i].b;</span><br><span class="line">    <span class="keyword">if</span> (HoughLine[i].k &lt; DBL_MAX) &#123;</span><br><span class="line">      <span class="keyword">double</span> k = HoughLine[i].k;</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">int</span> x0 = (<span class="keyword">double</span>)(y_min - b) / k;</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">int</span> x1 = (<span class="keyword">double</span>)(y_max - b) / k;</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">int</span> y0 = x_min * k + b;</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">int</span> y1 = x_max * k + b;</span><br><span class="line">      <span class="keyword">if</span> (b &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Line "</span> &lt;&lt; i+<span class="number">1</span> &lt;&lt; <span class="string">": y="</span> &lt;&lt; k &lt;&lt; <span class="string">"*x+"</span> &lt;&lt; b &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (b == <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Line "</span> &lt;&lt; i+<span class="number">1</span> &lt;&lt; <span class="string">": y="</span> &lt;&lt; k &lt;&lt; <span class="string">"*x"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Line "</span> &lt;&lt; i+<span class="number">1</span> &lt;&lt; <span class="string">": y="</span> &lt;&lt; k &lt;&lt; <span class="string">"*x"</span> &lt;&lt; b &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">abs</span>(k) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        pic.draw_line(x0, y_min, x1, y_max, red);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        pic.draw_line(x_min, y0, x_max, y1, red);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">cout</span> &lt;&lt; <span class="string">"Line "</span> &lt;&lt; i+<span class="number">1</span> &lt;&lt; <span class="string">": x="</span> &lt;&lt; b &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">      pic.draw_line(b , y_min, b, y_max, red);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//pic.display();</span></span><br><span class="line">  sort(HoughLine.begin(), HoughLine.end());</span><br><span class="line">  <span class="comment">//å¾—å‡ºå››ä¸ªè§’ç‚¹çš„åæ ‡</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lineNum; i++) &#123;</span><br><span class="line">      <span class="keyword">double</span> k0 = HoughLine[i].k;</span><br><span class="line">      <span class="keyword">double</span> b0 = HoughLine[i].b;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt; lineNum; j++) &#123;</span><br><span class="line">      <span class="keyword">int</span> x = <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> (HoughLine[j].k &lt; DBL_MAX) &#123;</span><br><span class="line">        x =  (<span class="keyword">double</span>)(HoughLine[j].b - b0) / (<span class="keyword">double</span>)(k0 - HoughLine[j].k);</span><br><span class="line">        y =  (<span class="keyword">double</span>)(k0*HoughLine[j].b - HoughLine[j].k*b0) / (<span class="keyword">double</span>)(k0 - HoughLine[j].k);</span><br><span class="line">        </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//Kæ— ç©·å¤§æ—¶çš„å–å€¼</span></span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        x = HoughLine[j].b;</span><br><span class="line">        y = k0*x+b0;</span><br><span class="line">      &#125;</span><br><span class="line">      parameter p;</span><br><span class="line">      p.x = x; p.y = y;</span><br><span class="line">      <span class="keyword">if</span> (p.x &gt; <span class="number">0</span> &amp;&amp; p.x &lt; img.width() &amp;&amp; p.y &gt; <span class="number">0</span> &amp;&amp; p.y &lt; img.height()) &#123;</span><br><span class="line">          <span class="keyword">bool</span> flag1 = <span class="number">1</span>;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; HoughPoint.size();k++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (p.x == HoughPoint[k].x &amp;&amp; p.y == HoughPoint[k].y) &#123;</span><br><span class="line">              flag1 = <span class="number">0</span>;</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (flag1) &#123;</span><br><span class="line">            HoughPoint.push_back(p);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> pic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>*<em>ç»˜åˆ¶ç›´çº¿ç›¸äº¤çš„è§’ç‚¹ï¼š *</em></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; Hough::drawPoint() &#123;</span><br><span class="line">  <span class="comment">/*for (int i = 0; i &lt; HoughLine.size(); i++) &#123;</span></span><br><span class="line"><span class="comment">    cout &lt;&lt; HoughLine[i].k &lt;&lt; " " &lt;&lt; HoughLine[i].b &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">  &#125;*/</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> blue[] = &#123; <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span> &#125;;</span><br><span class="line">  CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; pic = img;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; HoughPoint.size(); i++) &#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; HoughPoint[i].x &lt;&lt; <span class="string">" "</span> &lt;&lt; HoughPoint[i].y &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    pic.draw_circle(HoughPoint[i].x, HoughPoint[i].y, <span class="number">50</span>, blue);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> pic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>*<em>æ•´åˆåˆ°ä¸€èµ·ï¼š *</em></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> Hough::LineDetect_Image(<span class="built_in">string</span> name, <span class="keyword">int</span> scale, <span class="keyword">double</span> sigma, <span class="keyword">int</span> thresh_low, <span class="keyword">int</span> thresh_high, <span class="keyword">int</span> lineNum, <span class="keyword">int</span> linedisturb, <span class="keyword">int</span> distance) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *names = name.c_str();</span><br><span class="line">  img.load_bmp(names);</span><br><span class="line">  toGrayScale();</span><br><span class="line">  useFilter(scale, sigma);</span><br><span class="line">  sobel();</span><br><span class="line">  nonMaxSupp();</span><br><span class="line">  threshold(thresh_low, thresh_high);</span><br><span class="line">  Polar_Line();</span><br><span class="line">  CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; pic = LineDetect(lineNum, linedisturb, distance);</span><br><span class="line">  CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; pic1 = drawPoint();</span><br><span class="line">  <span class="built_in">string</span> path = <span class="string">"result1/"</span> + name.substr(<span class="number">9</span>,<span class="number">1</span>) + <span class="string">"_a.bmp"</span>;</span><br><span class="line">  <span class="built_in">string</span> path1 = <span class="string">"result1/"</span> + name.substr(<span class="number">9</span>,<span class="number">1</span>) + <span class="string">"_b.bmp"</span>;</span><br><span class="line">  pic.save(path.c_str());</span><br><span class="line">  pic1.save(path1.c_str());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ£€æµ‹æ•ˆæœï¼š"><a href="#æ£€æµ‹æ•ˆæœï¼š" class="headerlink" title="æ£€æµ‹æ•ˆæœï¼š"></a>æ£€æµ‹æ•ˆæœï¼š</h3><p><img src="https://img-blog.csdnimg.cn/20181030180017544.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/2018103018025198.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181030180326928.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="åœ†ï¼š"><a href="#åœ†ï¼š" class="headerlink" title="åœ†ï¼š"></a>åœ†ï¼š</h2><p><strong>ç”¨åˆ°çš„ç±»æˆå‘˜ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; HoughImg_Circle; <span class="comment">//éœå¤«ç©ºé—´åœ†å›¾åƒ</span></span><br><span class="line">CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; CircleImg; <span class="comment">//åœ¨éœå¤«åœ†å›¾åƒä¸Šç”Ÿæˆçš„åƒç´ ç‚¹</span></span><br><span class="line">CImg&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt; thres_img; <span class="comment">//è¾¹ç¼˜æ£€æµ‹å›¾åƒçš„åœ†æ£€æµ‹å›¾</span></span><br></pre></td></tr></table></figure><p><strong>ç”¨åˆ°çš„ç±»æˆå‘˜å‡½æ•°ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//éœå¤«åœ†æ£€æµ‹</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CircleDetect</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="comment">//æŸ¥æ‰¾åœ†å¯¹åº”çš„åƒç´ ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">findpixelCircle</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//åœ†æ£€æµ‹æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CircleDetect_Image</span><span class="params">(<span class="built_in">string</span>, <span class="keyword">int</span>, <span class="keyword">double</span>, <span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</span><br></pre></td></tr></table></figure><p><strong>å°†åŠå¾„åˆ†æ¢¯åº¦æ˜ å°„åˆ°æåæ ‡å¹¶æŠ•ç¥¨ç­›é€‰å‡ºå›¾ä¸­å­˜åœ¨çš„åŠå¾„å€¼å¹¶è¿›ä¸€æ­¥ä»¥è¯¥å€¼æ˜ å°„åˆ°æåæ ‡ç¡®å®šåœ†å¿ƒï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> Hough::CircleDetect(<span class="keyword">int</span> Nums, <span class="keyword">int</span> min_r, <span class="keyword">int</span> max_r) &#123;</span><br><span class="line">  thres_img = thres;</span><br><span class="line">  thres_img.resize(thres.width(), thres.height(), <span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">  <span class="comment">//thres_img.display();</span></span><br><span class="line">  <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; sortCircleWeight;</span><br><span class="line">  <span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt; Circle;</span><br><span class="line">  <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; Circleweight;</span><br><span class="line">  <span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt; center;</span><br><span class="line">  <span class="keyword">int</span> max = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> width = thres_img.width();</span><br><span class="line">  <span class="keyword">int</span> height = thres_img.height();</span><br><span class="line">  CImg&lt;<span class="keyword">int</span>&gt; pic = thres;</span><br><span class="line">  <span class="comment">//pic.display();</span></span><br><span class="line">  <span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt; vote;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> r = min_r; r &lt; max_r; r+=<span class="number">5</span>) &#123;</span><br><span class="line">    HoughImg_Circle.resize(width, height, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    HoughImg_Circle.fill(<span class="number">0</span>);</span><br><span class="line">    max = <span class="number">0</span>;</span><br><span class="line">    cimg_forXY(pic,x,y) &#123;</span><br><span class="line">      <span class="keyword">if</span> (pic(x,y) != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">360</span>; i++) &#123;</span><br><span class="line">          <span class="keyword">int</span> x0 = x - r*<span class="built_in">cos</span>(i*M_PI/<span class="number">180</span>);</span><br><span class="line">          <span class="keyword">int</span> y0 = y - r*<span class="built_in">sin</span>(i*M_PI/<span class="number">180</span>);</span><br><span class="line">          <span class="keyword">if</span> (x0 &gt; <span class="number">0</span> &amp;&amp; x0 &lt; width &amp;&amp; y0 &gt; <span class="number">0</span> &amp;&amp; y0 &lt; height)</span><br><span class="line">            HoughImg_Circle(x0,y0)++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cimg_forXY(HoughImg_Circle,x,y) &#123;</span><br><span class="line">      <span class="keyword">if</span> (HoughImg_Circle(x,y) &gt; max) &#123;</span><br><span class="line">        max = HoughImg_Circle(x,y);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    vote.push_back(make_pair(max, r));</span><br><span class="line">  &#125;</span><br><span class="line">  sort(vote.begin(), vote.end(), [](<span class="keyword">const</span> pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&amp; x, <span class="keyword">const</span> pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&amp; y) -&gt; <span class="keyword">int</span> &#123; <span class="keyword">return</span> x.first &gt; y.first; &#125;);</span><br><span class="line">  <span class="comment">//int Nums = 1;</span></span><br><span class="line">  <span class="keyword">int</span> knums = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> num = <span class="number">0</span>; num &lt; Nums; num++) &#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    HoughImg_Circle.resize(width, height, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    HoughImg_Circle.fill(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> r = vote[num].second;</span><br><span class="line">    cimg_forXY(pic,x,y) &#123;</span><br><span class="line">      <span class="keyword">if</span> (pic(x,y) != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">360</span>; i++) &#123;</span><br><span class="line">          <span class="keyword">int</span> x0 = x - r*<span class="built_in">cos</span>(i*M_PI/<span class="number">180</span>);</span><br><span class="line">          <span class="keyword">int</span> y0 = y - r*<span class="built_in">sin</span>(i*M_PI/<span class="number">180</span>);</span><br><span class="line">          <span class="keyword">if</span> (x0 &gt; <span class="number">0</span> &amp;&amp; x0 &lt; width &amp;&amp; y0 &gt; <span class="number">0</span> &amp;&amp; y0 &lt; height)</span><br><span class="line">            HoughImg_Circle(x0,y0)++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Circle.clear();</span><br><span class="line">    Circleweight.clear();</span><br><span class="line">    cimg_forXY(HoughImg_Circle,x,y) &#123;</span><br><span class="line">      <span class="keyword">if</span> (HoughImg_Circle(x,y) != <span class="number">0</span>) &#123;</span><br><span class="line">        Circle.push_back(make_pair(x,y));</span><br><span class="line">        Circleweight.push_back(HoughImg_Circle(x,y));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> blue[<span class="number">3</span>] = &#123; <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span> &#125;;</span><br><span class="line">    sortCircleWeight = Circleweight;</span><br><span class="line">    sort(sortCircleWeight.begin(), sortCircleWeight.end(), greater&lt;<span class="keyword">int</span>&gt;()); <span class="comment">// å°†ç´¯åŠ çŸ©é˜µä»å¤§åˆ°å°è¿›è¡Œæ’åº</span></span><br><span class="line">    <span class="comment">//åŒä¸ªåŠå¾„åœ†çš„æ£€æµ‹</span></span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> weight = sortCircleWeight[count], index;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator iter = find(Circleweight.begin(), Circleweight.end(), weight);</span><br><span class="line">        index = iter - Circleweight.begin();</span><br><span class="line">        <span class="keyword">int</span> a = Circle[index].first, b = Circle[index].second;</span><br><span class="line">        count++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> ii;</span><br><span class="line">        <span class="keyword">for</span> (ii = <span class="number">0</span>; ii &lt; center.size(); ii++) &#123;</span><br><span class="line">          <span class="comment">// åˆ¤æ–­æ£€æµ‹å‡ºæ¥çš„åœ†å¿ƒåæ ‡æ˜¯å¦è·Ÿå·²æ£€æµ‹çš„åœ†å¿ƒåæ ‡çš„è·ç¦»ï¼Œå¦‚æœè·ç¦»è¿‡å°ï¼Œé»˜è®¤æ˜¯åŒä¸ªåœ†</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">sqrt</span>(<span class="built_in">pow</span>((center[ii].first - a), <span class="number">2</span>) + <span class="built_in">pow</span>((center[ii].second - b), <span class="number">2</span>)) &lt; minRadius) &#123;</span><br><span class="line">                <span class="keyword">break</span>; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ii == center.size()) &#123;</span><br><span class="line">            center.push_back(make_pair(a, b));</span><br><span class="line">            thres_img.draw_circle(a, b, r, blue, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">            knums++;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"the number of the coins is: "</span> &lt;&lt; knums &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¯»æ‰¾æ£€æµ‹å‡ºçš„åœ†åœ¨åŸå›¾ä¸­å¯¹åº”çš„åƒç´ ç‚¹ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> Hough::findpixelCircle() &#123;</span><br><span class="line">  CircleImg = img;</span><br><span class="line">  CircleImg.resize(thres.width(), thres.height());</span><br><span class="line">  cimg_forXY(CircleImg, x, y) &#123;</span><br><span class="line">    <span class="keyword">if</span> (thres_img(x,y,<span class="number">0</span>) == <span class="number">0</span> &amp;&amp; thres_img(x,y,<span class="number">1</span>) == <span class="number">0</span> &amp;&amp; thres_img(x,y,<span class="number">2</span>) == <span class="number">255</span> &amp;&amp; thres(x,y) == <span class="number">0</span>) &#123;</span><br><span class="line">      CircleImg(x,y,<span class="number">0</span>) = <span class="number">255</span>;</span><br><span class="line">      CircleImg(x,y,<span class="number">1</span>) = <span class="number">0</span>;</span><br><span class="line">      CircleImg(x,y,<span class="number">2</span>) = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//CircleImg.display();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•´åˆåˆ°ä¸€èµ·ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> Hough::CircleDetect_Image(<span class="built_in">string</span> name, <span class="keyword">int</span> scale, <span class="keyword">double</span> sigma, <span class="keyword">int</span> thresh_low, <span class="keyword">int</span> thresh_high, <span class="keyword">int</span> Nums, <span class="keyword">int</span> min_r, <span class="keyword">int</span> max_r) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *names = name.c_str();</span><br><span class="line">  img.load_bmp(names);</span><br><span class="line">  toGrayScale();</span><br><span class="line">  useFilter(scale, sigma);</span><br><span class="line">  sobel();</span><br><span class="line">  nonMaxSupp();</span><br><span class="line">  threshold(thresh_low, thresh_high);</span><br><span class="line">  CircleDetect(Nums, min_r, max_r);</span><br><span class="line">  findpixelCircle();</span><br><span class="line">  <span class="built_in">string</span> path = <span class="string">"result2/"</span> + name.substr(<span class="number">9</span>,<span class="number">1</span>) + <span class="string">"_a.bmp"</span>;</span><br><span class="line">  <span class="built_in">string</span> path1 = <span class="string">"result2/"</span> + name.substr(<span class="number">9</span>,<span class="number">1</span>) + <span class="string">"_b.bmp"</span>;</span><br><span class="line">  thres_img.save(path.c_str());</span><br><span class="line">  CircleImg.save(path1.c_str());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ£€æµ‹æ•ˆæœï¼š-1"><a href="#æ£€æµ‹æ•ˆæœï¼š-1" class="headerlink" title="æ£€æµ‹æ•ˆæœï¼š"></a>æ£€æµ‹æ•ˆæœï¼š</h3><p><img src="https://img-blog.csdnimg.cn/20181030180456648.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20181030180514774.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20181030180547421.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>å®Œæ•´ä»£ç å‚è§</strong><br><a href="https://github.com/WangPerryWPY/Computer-Version/tree/master/Exp3" target="_blank" rel="noopener">https://github.com/WangPerryWPY/Computer-Version/tree/master/Exp3</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;åŸç†ï¼š&quot;&gt;&lt;a href=&quot;#åŸç†ï¼š&quot; class=&quot;headerlink&quot; title=&quot;åŸç†ï¼š&quot;&gt;&lt;/a&gt;åŸç†ï¼š&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç›´çº¿&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€æ¡ç›´çº¿åœ¨å›¾åƒä¸­æ˜¯ä¸€ç³»åˆ—ç¦»æ•£ç‚¹çš„é›†åˆï¼Œé€šè¿‡ä¸€ä¸ªç›´çº¿
      
    
    </summary>
    
      <category term="è®¡ç®—æœºè§†è§‰" scheme="http://yoursite.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="è®¡ç®—æœºè§†è§‰" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/"/>
    
  </entry>
  
  <entry>
    <title>PoWå…±è¯†æœºåˆ¶</title>
    <link href="http://yoursite.com/2019/07/06/PoW%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6/"/>
    <id>http://yoursite.com/2019/07/06/PoWå…±è¯†æœºåˆ¶/</id>
    <published>2019-07-06T12:09:27.000Z</published>
    <updated>2019-07-06T12:10:24.980Z</updated>
    
    <content type="html"><![CDATA[<p>æ³¨ï¼šæœ¬æ–‡ç« é€šè¿‡é˜…è¯»è®¨è®ºå·¥ä½œé‡å…±è¯†åœ¨åƒåœ¾é‚®ä»¶çš„ä½¿ç”¨çš„ Proof-of-Work-Proves-Not-to-Work-version-0.2 æ–‡ç« ä»¥åŠåšå®¢çŸ¥ä¹ä¸Šå…³äº PoW æœºåˆ¶çš„è®¨è®ºå®Œæˆã€‚ </p><h2 id="åŸç†ï¼š"><a href="#åŸç†ï¼š" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h2><p>é¦–å…ˆ PoW æ˜¯ä¸€ç§å…±è¯†æœºåˆ¶ï¼Œå¤„äºåŒºå—é“¾æ¶æ„çš„å…±è¯†å±‚ä¸­ã€‚ä¸Šæ¬¡ä½œä¸šçš„å­¦ä¹ ä¸­æœ‰äº†è§£åˆ°åŒºå—é“¾çš„æ ¸å¿ƒä¼˜åŠ¿ä¹‹ä¸€å°±æ˜¯èƒ½å¤Ÿåœ¨å†³ç­–æƒé«˜åº¦åˆ†æ•£çš„å»ä¸­å¿ƒåŒ–ç³»ç»Ÿä¸­ä½¿å¾—å„èŠ‚ç‚¹é«˜æ•ˆåœ°é’ˆå¯¹åŒºå—æ•°æ®çš„æœ‰æ•ˆæ€§è¾¾æˆå…±è¯†ã€‚è€Œè¦è¾¾æˆå…±è¯†å°±è¦é‡‡ç”¨æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„å…±è¯†æœºåˆ¶ï¼Œå…¶ä¸­ PoW å°±æ˜¯ä¸€ç§æœ€å¸¸è§çš„å…±è¯†æœºåˆ¶ï¼ˆæ¯”ç‰¹å¸ä¸­çš„æŒ–çŸ¿ï¼‰ã€‚åœ¨æ¯”ç‰¹å¸æŒ–çŸ¿ä¸­å„èŠ‚ç‚¹è´¡çŒ®è‡ªå·±çš„è®¡ç®—èµ„æºæ¥ç«äº‰è§£å†³ä¸€ä¸ªéš¾åº¦å¯åŠ¨æ€è°ƒæ•´çš„æ•°å­¦é—®é¢˜, æˆåŠŸè§£å†³è¯¥æ•°å­¦é—®é¢˜çš„çŸ¿å·¥å°†è·å¾—åŒºå—çš„è®°è´¦æƒ, å¹¶å°†å½“å‰æ—¶é—´æ®µçš„æ‰€æœ‰æ¯”ç‰¹å¸äº¤æ˜“æ‰“åŒ…è®°å…¥ä¸€ä¸ªæ–°çš„åŒºå—ã€æŒ‰ç…§æ—¶é—´é¡ºåºé“¾æ¥åˆ°æ¯”ç‰¹å¸ä¸»é“¾ä¸Š. æ¯”ç‰¹å¸ç³»ç»ŸåŒæ—¶ä¼šå‘è¡Œä¸€å®šæ•°é‡çš„æ¯”ç‰¹å¸ä»¥å¥–åŠ±è¯¥çŸ¿å·¥, å¹¶æ¿€åŠ±å…¶ä»–çŸ¿å·¥ç»§ç»­è´¡çŒ®ç®—åŠ›ã€‚ </p><p>æ‰€ä»¥å…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å¼•å…¥åˆ†å¸ƒå¼èŠ‚ç‚¹çš„ç®—åŠ›ç«äº‰æ¥ä¿è¯æ•°æ®ä¸€è‡´æ€§å’Œå…±è¯†çš„å®‰å…¨æ€§ã€‚æ¯”ç‰¹å¸ç³»ç»Ÿä¸­, å„èŠ‚ç‚¹ (å³çŸ¿å·¥) åŸºäºå„è‡ªçš„è®¡ç®—æœºç®—åŠ›ç›¸äº’ç«äº‰æ¥å…±åŒè§£å†³ä¸€ä¸ªæ±‚è§£å¤æ‚ä½†éªŒè¯å®¹æ˜“çš„ SHA256 æ•°å­¦éš¾é¢˜ (å³æŒ–çŸ¿), æœ€å¿«è§£å†³è¯¥éš¾é¢˜çš„èŠ‚ç‚¹å°†è·å¾—åŒºå—è®°è´¦æƒå’Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„æ¯”ç‰¹å¸å¥–åŠ±. è¯¥æ•°å­¦éš¾é¢˜å¯è¡¨è¿°ä¸º: æ ¹æ®å½“å‰éš¾åº¦å€¼, é€šè¿‡æœç´¢æ±‚è§£ä¸€ä¸ªåˆé€‚çš„éšæœºæ•° (Nonce) ä½¿å¾—åŒºå—å„å…ƒæ•°æ®çš„åŒ SHA256 å“ˆå¸Œå€¼å°äºæˆ–ç­‰äºç›®æ ‡å“ˆå¸Œå€¼ã€‚ä¸€èˆ¬è¯´æ¥, PoW å…±è¯†åœ¨åŒºå—é“¾ç³»ç»Ÿä¸­å®ç°è¿‡ç¨‹å¦‚ä¸‹ï¼š </p><ul><li>å…ˆå®šä¹‰ä¸€ä¸ªå›ºå®šçš„ 256 ä½é•¿åº¦åˆå§‹æ•°ï¼Œæ¯”å¦‚ï¼šé•¿åº¦ä¸º 256 ä½å­—ç¬¦ 0000â€¦0001 ï¼ˆ32 å­—èŠ‚ï¼Œ64 å­—ç¬¦ï¼‰ </li><li>è®¾ç½®éš¾åº¦ç³»æ•°å€¼ï¼Œæ¯”å¦‚ï¼šå¦‚æœéš¾åº¦ç³»æ•°å®šä¹‰ä¸ºå‰é¢ 4 ä¸ª 0ï¼Œå³ 16 ä½é•¿åº¦ï¼ˆ0000 0000 0000 0001 = 4 ä¸ªå­—ç¬¦ = 2 ä¸ªå­—èŠ‚ï¼‰ã€‚ </li><li>æŒ‰ç…§éš¾åº¦ç³»æ•°å€¼è¿›è¡Œç§»ä½æ“ä½œï¼Œå°† Hash å·¥ä½œé‡å€¼æ‰©å¤§ï¼Œå‘å·¦ç§»ï¼ˆ256-éš¾åº¦ç³»æ•° N ä½ï¼‰æ¯”å¦‚ï¼šå°†åˆå§‹æ•° 0000â€¦..0001 å‘å·¦ç§»ï¼ˆ256-16 ä½ï¼‰å¾—åˆ°ï¼š0000 0000 0000 0001 0000 â€¦0000ã€‚ </li><li>å°†éšæœºæ•° Nonce é€’å¢åŠ  1 å†åŠ ä¸ŠåŒºå—å¤´ï¼ˆBlock Headerï¼‰Hash å€¼æ‹¼æ¥ï¼Œç„¶åè¿›è¡Œ SHA256 Hash è¿ç®—ã€‚ </li><li>å°†è®¡ç®—ç»“æœå€¼ä¸å½“å‰éš¾åº¦ç³»æ•°ç›®æ ‡å€¼ä½œå¯¹æ¯”ï¼Œå¦‚æœå½“å‰è®¡ç®—å€¼å¤§äºéš¾åº¦ç³»æ•°æ¡ä»¶ å€¼ï¼Œå³ç»§ç»­é€’å¢ Nonce å€¼å†è¿›è¡Œä¸‹ä¸€æ¬¡çš„ SHA256 Hash è¿ç®—ï¼Œç›´åˆ°è®¡ç®—å‡ºçš„ç»“æœ Hash å€¼å°‘äºç›®æ ‡å€¼ï¼Œåˆ™æ‰è®¤ä¸ºè§£é¢˜æˆåŠŸï¼Œæ­¤æ¬¡çš„å·¥ä½œé‡è¯æ˜å®Œæˆå¹¶è·å¾—è®°è´¦æƒï¼Œç„¶åè¿›è¡Œå¯¹ äº¤æ˜“åŒºå—è¿›è¡Œæ‰“åŒ…ç¡®è®¤å¹¶å¹¿æ’­ç»™å…¨èŠ‚ç‚¹ï¼Œå¹¶ä» Coinbase ä¸­è·å¾— gas å¥–åŠ±ã€‚ </li></ul><p><strong>Ps:</strong> å¦‚æœè¦æ±‚ Hash å€¼å‰é¢çš„ N ä½ 0 è¶Šå¤§ï¼Œå³å®ƒçš„è®¡ç®—éš¾åº¦å°±è¶Šå¤§ï¼Œæ¯å¢åŠ ä¸€ä½ 0ï¼Œå®ƒ çš„è®¡ç®—æ¬¡æ•°å°±å˜å¾—é«˜å‡ºå¾ˆå¤šå€ï¼Œå½“è¦æ±‚è®¡ç®—éš¾åº¦å€¼å‰ N ä½è¦æ±‚ä¸º 7 ä½æ˜¯ 0 çš„æ—¶å€™ï¼Œå®ƒ çš„è®¡ç®—æ¬¡æ•°å°±è¾¾åˆ° 5.6 äº¿æ¬¡ï¼Œæ‰€ä»¥å·¥ä½œé‡éå¸¸å¤§ï¼Œå¦‚æœä½œå¼Šé‚£æ˜¯å‡ ä¹ä¸å¯èƒ½ã€‚ </p><h2 id="ä¼˜ç¼ºç‚¹ï¼š"><a href="#ä¼˜ç¼ºç‚¹ï¼š" class="headerlink" title="ä¼˜ç¼ºç‚¹ï¼š"></a>ä¼˜ç¼ºç‚¹ï¼š</h2><h4 id="ä¼˜ç‚¹ï¼š"><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h4><p>1ï¼‰ç®—æ³•ç®€æ´ï¼Œå¾ˆå®¹æ˜“å®ç°ã€‚<br>2ï¼‰ç­”æ¡ˆå”¯ä¸€ä¸”å®¹æ˜“éªŒè¯ï¼ŒèŠ‚ç‚¹é—´æ— éœ€äº¤æ¢é¢å¤–ä¿¡æ¯ï¼Œå®¹æ˜“è¾¾æˆå…±è¯†ã€‚<br>3ï¼‰å…¬å¹³æ€§å¥½ï¼Œå°†è®°è´¦æƒå…¬å¹³çš„åˆ†æ´¾åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚çŸ¿å·¥èƒ½å¤Ÿè·å¾—çš„å¸çš„æ•°é‡ï¼Œå–å†³äºæŒ–çŸ¿è´¡çŒ®çš„æœ‰æ•ˆå·¥ä½œã€‚<br>4ï¼‰å®‰å…¨æ€§é«˜ï¼Œç ´åç³»ç»Ÿéœ€è¦æŠ•å…¥æå¤§çš„æˆæœ¬ï¼Œå¦‚æœæƒ³ä½œå¼Šï¼Œè¦æœ‰å‹å€’å¤§å¤šæ•°äººçš„ç®—åŠ›ï¼ˆ51%æ”»å‡»ï¼‰ã€‚å› ä¸ºä½œå¼Šè¦ä»˜å‡ºä¸€å®šæˆæœ¬ï¼Œä½œå¼Šè€…å°±ä¼šè°¨æ…å¯¹å¾…äº†ã€‚åœ¨æ¯”ç‰¹å¸ PoW æœºåˆ¶ä¸­ï¼Œç”±äºè·å¾—è®¡ç®—ç»“æœçš„æ¦‚ç‡è¶‹è¿‘äºæ‰€å ç®—åŠ›æ¯”ä¾‹ï¼Œå› æ­¤åœ¨ä¸æŒæ¡51%ä»¥ä¸Šç®—åŠ›çš„å‰æä¸‹ï¼ŒçŸ¿å·¥æ¬ºè¯ˆçš„æˆæœ¬è¦æ˜¾è‘—é«˜äºè¯šå®æŒ–çŸ¿ï¼Œç”šè‡³ä¸å¯èƒ½å®Œæˆæ¬ºè¯ˆ(ç”±äºæ¦‚ç‡è¿‡ä½)ã€‚ </p><h4 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h4><p>1ï¼‰æŒ–çŸ¿é€ æˆå¤§é‡çš„èµ„æºæµªè´¹ï¼Œç›®å‰ bitcoin å·²ç»å¸å¼•å…¨çƒå¤§éƒ¨åˆ†çš„ç®—åŠ›ï¼Œå…¶å®ƒå†ç”¨ Pow å…±è¯†æœºåˆ¶çš„åŒºå—é“¾åº”ç”¨å¾ˆéš¾è·å¾—ç›¸åŒçš„ç®—åŠ›æ¥ä¿éšœè‡ªèº«çš„å®‰å…¨ã€‚è¿™è®©ä¾æ®ç®—åŠ›å…¬å¹³åˆ†é…å¥–åŠ±çš„æœºåˆ¶ï¼Œæ¼”å˜ä¸ºäº†å¯¹çŸ¿æœºç®—åŠ›çš„å¤§ä¸¾æŠ•å…¥ã€‚<br>2ï¼‰ç½‘ç»œæ€§èƒ½å¤ªä½ï¼Œéœ€è¦ç­‰å¾…å¤šä¸ªç¡®è®¤ï¼Œå®¹æ˜“äº§ç”Ÿåˆ†å‰ï¼ŒåŒºå—çš„ç¡®è®¤å…±è¯†è¾¾æˆçš„å‘¨æœŸè¾ƒé•¿ï¼ˆ10 åˆ†é’Ÿï¼‰ï¼Œç°åœ¨æ¯ç§’äº¤æ˜“é‡ä¸Šé™æ˜¯ 7 ç¬”ï¼ˆ visa çš„å¹³å‡æ¯ç§’äº¤æ˜“é‡ä¸Šä¸‡ï¼Œæ”¯ä»˜å®å³°å€¼æ¥è¿‘ 9 ä¸‡ï¼‰ï¼Œä¸é€‚åˆå•†ä¸šåº”ç”¨ã€‚<br>3ï¼‰PoW å…±è¯†ç®—æ³•ç®—åŠ›è¿‡äºé›†ä¸­åŒ–ï¼Œæ…¢æ…¢çš„åç¦»äº†åŸæ¥çš„å»ä¸­å¿ƒåŒ–è½¨é“ã€‚ä»æ¯”ç‰¹å¸æ‰©å®¹ä¹‹äº‰å¯ä»¥çœ‹åˆ°ï¼Œç®—åŠ›é«˜çš„å¤§å‹çŸ¿æ± æ˜¯ä¸»äººï¼Œè€ŒæŒå¸çš„äººæ²¡æœ‰å‚ä¸å†³å®šçš„æƒåˆ©ï¼Œæ¯”ç‰¹å¸åˆ†å‰å‡ºå¾ˆå¤šå­å‰ï¼Œå³å°†å¤±å»â€œå»ä¸­å¿ƒåŒ–â€çš„æ ‡ç­¾ã€‚ </p><h2 id="å¯¹å­˜åœ¨çš„é—®é¢˜çš„è§£å†³ï¼š"><a href="#å¯¹å­˜åœ¨çš„é—®é¢˜çš„è§£å†³ï¼š" class="headerlink" title="å¯¹å­˜åœ¨çš„é—®é¢˜çš„è§£å†³ï¼š"></a>å¯¹å­˜åœ¨çš„é—®é¢˜çš„è§£å†³ï¼š</h2><p>ç”±äº PoW å­˜åœ¨ç€å¾ˆå¤šéœ€è¦æ”¹è¿›çš„ç¼ºç‚¹ï¼Œæ„Ÿè§‰å¾ˆé‡è¦ä¸€ç‚¹å°±æ˜¯èµ„æºæ¶ˆè€—é‡è¿‡å¤§ã€‚äºæ˜¯é’ˆå¯¹æ­¤é—®é¢˜æå‡º PoS å…±è¯†ï¼Œ PoS å…±è¯†æœ¬è´¨ä¸Šæ˜¯é‡‡ç”¨æƒç›Šè¯æ˜æ¥ä»£æ›¿ PoW ä¸­çš„åŸºäºå“ˆå¸Œç®—åŠ›çš„å·¥ä½œé‡è¯æ˜, æ˜¯ç”±ç³»ç»Ÿä¸­å…·æœ‰æœ€é«˜æƒç›Šè€Œéæœ€é«˜ç®—åŠ›çš„èŠ‚ç‚¹è·å¾—åŒºå—è®°è´¦æƒ. æƒç›Šä½“ç°ä¸ºèŠ‚ç‚¹å¯¹ç‰¹å®šæ•°é‡è´§å¸çš„æ‰€æœ‰æƒ, ä¹Ÿå°±æ˜¯å¸é¾„. å¸é¾„æ˜¯ç‰¹å®šæ•°é‡çš„å¸ä¸å…¶æœ€åä¸€æ¬¡äº¤æ˜“çš„æ—¶é—´é•¿åº¦çš„ä¹˜ç§¯, æ¯æ¬¡äº¤æ˜“éƒ½å°†ä¼šæ¶ˆè€—æ‰ç‰¹å®šæ•°é‡çš„å¸é¾„ã€‚é‡‡ç”¨ PoS å…±è¯†æœºåˆ¶çš„ç³»ç»Ÿåœ¨ç‰¹å®šæ—¶é—´ç‚¹ä¸Šçš„å¸é¾„æ€»æ•°æ˜¯æœ‰é™çš„, é•¿æœŸæŒå¸è€…æ›´å€¾å‘äºæ‹¥æœ‰æ›´å¤šå¸é¾„, å› æ­¤å¸é¾„å¯è§†ä¸ºå…¶ PoS ç³»ç»Ÿä¸­çš„æƒç›Š. æ­¤å¤–, PoW å…±è¯†è¿‡ç¨‹ä¸­å„èŠ‚ç‚¹æŒ–çŸ¿éš¾åº¦ç›¸åŒ, è€Œ PoS å…±è¯†è¿‡ç¨‹ä¸­çš„éš¾åº¦ä¸äº¤æ˜“è¾“å…¥çš„å¸é¾„æˆåæ¯”, æ¶ˆè€—å¸é¾„è¶Šå¤šåˆ™æŒ–çŸ¿éš¾åº¦è¶Šä½. èŠ‚ç‚¹åˆ¤æ–­ä¸»é“¾çš„æ ‡å‡†ä¹Ÿç”± PoW å…±è¯†çš„æœ€é«˜ç´¯è®¡éš¾åº¦è½¬å˜ä¸ºæœ€é«˜æ¶ˆè€—å¸é¾„, æ¯ä¸ªåŒºå—çš„äº¤æ˜“éƒ½ä¼šå°†å…¶æ¶ˆè€—çš„å¸é¾„æäº¤ç»™è¯¥åŒºå—, ç´¯è®¡æ¶ˆè€—å¸é¾„æœ€é«˜çš„åŒºå—å°†è¢«é“¾æ¥åˆ°ä¸»é“¾. ç”±æ­¤å¯è§, PoS å…±è¯†è¿‡ç¨‹ä»…ä¾é å†…éƒ¨å¸é¾„å’Œæƒç›Šè€Œä¸éœ€è¦æ¶ˆè€—å¤–éƒ¨ç®—åŠ›å’Œèµ„æº, ä»æ ¹æœ¬ä¸Šè§£å†³äº† PoW å…±è¯†ç®—åŠ›æµªè´¹çš„é—®é¢˜, å¹¶ä¸”èƒ½å¤Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼©çŸ­è¾¾æˆå…±è¯†çš„æ—¶é—´, å› è€Œæ¯”ç‰¹å¸ä¹‹åçš„è®¸å¤šç«äº‰å¸å‡é‡‡ç”¨ PoS å…±è¯†æœºåˆ¶ã€‚ </p><p>ä»¥ä¸Šæ‘˜æŠ„è‡ªåŒºå—é“¾è®ºæ–‡ä¸­ PoS çš„ä»‹ç»ï¼Œä»ä¸­å¯ä»¥çœ‹å‡ºé‡‡ç”¨ PoW æœºåˆ¶çš„æ•°å­—è´§å¸ä¸æ˜¯ç†æƒ³çŠ¶æ€çš„æ•°å­—è´§å¸ï¼Œå› ä¸ºå®ƒä»¬çš„å®‰å…¨æ€§ä¸ç›´æ¥ä¸ä½¿ç”¨è€…ç›¸å…³ï¼Œè€Œæ˜¯è¦é€šè¿‡çŸ¿å·¥è¿™ä¸ªåª’ä»‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒPoW æœºåˆ¶å¯¹äº 51%æ”»å‡»æœ‰æ½œåœ¨éšæ‚£ï¼Œæ”»å‡»è€…å¹¶ä¸éœ€è¦æ‹¥æœ‰æ¯”ç‰¹å¸ï¼Œå¦‚æœè¦åš 51%æ”»å‡»ï¼Œæ‰€éœ€è¦çš„èŠ±è´¹è·ŸæŒ–çŸ¿éš¾åº¦ç›¸å…³è€Œä¸æ˜¯ç›´æ¥è·Ÿæ¯”ç‰¹å¸ä»·æ ¼ç›¸å…³ã€‚è€Œåœ¨ PoS æœºåˆ¶ä¸‹ï¼Œè¿›è¡Œ 51%æ”»å‡»çš„ä»£ä»·æ›´é«˜ï¼Œå› ä¸ºæƒ³è¦è¿›è¡Œ51%æ”»å‡»çš„è¯ï¼Œä½ å¾—æ‹¥æœ‰ 51%çš„è´§å¸â€”â€”è¿™ä¸œè¥¿è¶Šå€¼é’±ï¼Œæ”»å‡»çš„æˆæœ¬å°±è¶Šé«˜ã€‚ä½†è¿™ä¹Ÿå°±æ„å‘³ç€å­˜åœ¨å¦ä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„æ— åˆ©ç›Šæ”»å‡»é—®é¢˜ï¼š<strong>å¯¹äº PoS å…±è¯†æœºåˆ¶çš„è´§å¸ï¼Œä½ è¶Šæœ‰é’±ï¼Œä½œæ¶ä»˜å‡ºçš„ä»£ä»·å°±è¶Šå¤§ï¼›ç„¶è€Œå¯¹äºæ²¡æœ‰é’±çš„äººï¼Œä½œæ¶ä»£ä»·å¾ˆå°ï¼Œæ‰€ä»¥ä¸€äº›ä½œæ¶è¡Œä¸ºå¯¹ä»–ä»¬è€Œè¨€æ˜¯æœ‰ç›Šçš„ã€‚</strong> </p><p>é’ˆå¯¹ä»¥ä¸Šé—®é¢˜åˆå‡ºç°äº† Casper Pos å…±è¯†ï¼ŒCasper PoS æ˜¯ä¸€ç§åŸºäºä¿è¯é‡‘çš„ç»æµæ¿€åŠ±å…±è¯†åè®®ã€‚åè®®ä¸­çš„èŠ‚ç‚¹ï¼Œä½œä¸ºâ€œé”å®šä¿è¯é‡‘çš„éªŒè¯äººâ€ï¼Œå¿…é¡»å…ˆç¼´çº³ä¿è¯é‡‘(è¿™ä¸€æ­¥å«åšé”å®šä¿è¯é‡‘)æ‰å¯ä»¥å‚ä¸å‡ºå—å’Œå…±è¯†å½¢æˆã€‚Casper å…±è¯†åè®®é€šè¿‡å¯¹è¿™äº›ä¿è¯é‡‘çš„ç›´æ¥æ§åˆ¶æ¥çº¦æŸéªŒè¯äººçš„è¡Œä¸ºã€‚å…·ä½“æ¥è¯´å°±æ˜¯ï¼Œå¦‚æœä¸€ä¸ªéªŒè¯äººä½œå‡ºäº†ä»»ä½• Casper è®¤ä¸ºâ€œéæ³•â€çš„äº‹æƒ…ï¼Œä»–çš„ä¿è¯é‡‘å°†è¢«ç½šæ²¡ï¼Œå‡ºå—å’Œå‚ä¸å…±è¯†çš„æƒåˆ©ä¹Ÿä¼šè¢«å–æ¶ˆã€‚ä¿è¯é‡‘çš„å¼•å…¥è§£å†³äº†æ— åˆ©ç›Šæ”»å‡»ã€‚ä¹Ÿå°±æ˜¯ç»å…¸ PoS åè®®ä¸­åšåäº‹çš„ä»£ä»·å¾ˆä½çš„é—®é¢˜ï¼Œç°åœ¨æœ‰äº†ä»£ä»·ï¼Œè€Œä¸”è¢«å®¢è§‚è¯æ˜åšé”™äº‹çš„éªŒè¯äººå°†ä¼šä»˜å‡ºè¿™ä¸ªä»£ä»·ã€‚ </p><p>é’ˆå¯¹èƒŒç¦»å»ä¸­å¿ƒåŒ–æ€æƒ³çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥å¤ªåŠé€‰ç”¨çš„ PoW ç®—æ³•æ˜¯çº¿æ€§å†…å­˜å›°éš¾çš„ã€‚è¯¥ç®—æ³•è¢«è®¾è®¡æˆç®—å‡ºä¸€ä¸ª nonce å€¼éœ€è¦å¤§é‡çš„å†…å­˜å’Œå¸¦å®½ã€‚å³ä½¿æ˜¯è¶…é«˜é€Ÿè®¡ç®—æœºï¼Œä¹Ÿæ— æ³•åœ¨éœ€è¦å¤§é‡çš„å†…å­˜å’Œå¸¦å®½çš„æ¡ä»¶ä¸‹åŒæ—¶è®¡ç®—å‡ºå¤šä¸ª nonce å€¼ã€‚è¿™å‡å°‘äº†ä¸­å¿ƒåŒ–çš„é£é™©ï¼Œä¸ºèŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªå…¬å¹³ç«äº‰çš„ç¯å¢ƒã€‚ </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ³¨ï¼šæœ¬æ–‡ç« é€šè¿‡é˜…è¯»è®¨è®ºå·¥ä½œé‡å…±è¯†åœ¨åƒåœ¾é‚®ä»¶çš„ä½¿ç”¨çš„ Proof-of-Work-Proves-Not-to-Work-version-0.2 æ–‡ç« ä»¥åŠåšå®¢çŸ¥ä¹ä¸Šå…³äº PoW æœºåˆ¶çš„è®¨è®ºå®Œæˆã€‚ &lt;/p&gt;
&lt;h2 id=&quot;åŸç†ï¼š&quot;&gt;&lt;a href=&quot;#åŸç†ï¼š&quot; class=&quot;h
      
    
    </summary>
    
      <category term="åŒºå—é“¾" scheme="http://yoursite.com/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
    
      <category term="åŒºå—é“¾" scheme="http://yoursite.com/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
  </entry>
  
  <entry>
    <title>Cannyç®—å­å®ç°è¾¹ç¼˜åˆ†å‰²å¹¶åšè¿çº¿å¤„ç†</title>
    <link href="http://yoursite.com/2019/07/06/Canny%E7%AE%97%E5%AD%90%E5%AE%9E%E7%8E%B0%E8%BE%B9%E7%BC%98%E5%88%86%E5%89%B2%E5%B9%B6%E5%81%9A%E8%BF%9E%E7%BA%BF%E5%A4%84%E7%90%86/"/>
    <id>http://yoursite.com/2019/07/06/Cannyç®—å­å®ç°è¾¹ç¼˜åˆ†å‰²å¹¶åšè¿çº¿å¤„ç†/</id>
    <published>2019-07-05T16:37:29.000Z</published>
    <updated>2019-07-05T16:38:07.236Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Ex2ï¼šç”¨-CImg-é‡å†™ã€å°è£…ç»™å®šçš„-Canny-ä»£ç ï¼Œå¹¶æµ‹è¯•"><a href="#Ex2ï¼šç”¨-CImg-é‡å†™ã€å°è£…ç»™å®šçš„-Canny-ä»£ç ï¼Œå¹¶æµ‹è¯•" class="headerlink" title="Ex2ï¼šç”¨ CImg é‡å†™ã€å°è£…ç»™å®šçš„ Canny ä»£ç ï¼Œå¹¶æµ‹è¯•"></a>Ex2ï¼šç”¨ CImg é‡å†™ã€å°è£…ç»™å®šçš„ Canny ä»£ç ï¼Œå¹¶æµ‹è¯•</h2><h3 id="C-å°è£…è¦æ±‚ï¼š"><a href="#C-å°è£…è¦æ±‚ï¼š" class="headerlink" title="C++å°è£…è¦æ±‚ï¼š"></a><strong>C++å°è£…è¦æ±‚ï¼š</strong></h3><p>(1)æ‰€æœ‰çš„å›¾åƒè¯»å†™ã€æ•°æ®å¤„ç†åªèƒ½ç”¨ CImg åº“(æ•´ä¸ªå·¥ç¨‹æ–‡ä»¶ä¸å…è®¸<br>ä½¿ç”¨ Opencv ä¹‹ç±»çš„ç¬¬ä¸‰æ–¹åº“)ï¼› (2)ä»£ç å°è£…è¦æ±‚å‡½æ•°æ¥å£ç®€æ´æ¸…æ™°ï¼Œå¯å‚è€ƒ<br>Code2 çš„æ–¹å¼å°è£…ã€‚<br>åœ¨åŸæ¥çš„ä»£ç åŸºç¡€ä¸Š, å¢åŠ ä¸€ä¸ªå‡½æ•°ï¼šé¦–å…ˆæŠŠç›¸é‚»çš„è¾¹ç¼˜è¿æˆé•¿çš„çº¿æ¡ï¼Œå¹¶åˆ é™¤<br>é•¿åº¦å°äº 20 çš„ Edgeã€‚<br>å¯¹ç®—æ³•çš„è‹¥å¹²ç»„å‚æ•°ï¼Œå¯¹æ‰€æœ‰æµ‹è¯•å›¾åƒè¿›è¡Œæµ‹è¯•ï¼Œå¹¶åˆ†æå„å‚æ•°å¯¹ç»“æœçš„å½±å“ã€‚</p><h3 id="å®ç°è¿‡ç¨‹ï¼š"><a href="#å®ç°è¿‡ç¨‹ï¼š" class="headerlink" title="å®ç°è¿‡ç¨‹ï¼š"></a><strong>å®ç°è¿‡ç¨‹ï¼š</strong></h3><p><strong>åŸç†ï¼š</strong><br>å®ç° canny è¾¹ç¼˜æ£€æµ‹çš„åŸç†é€šä¿—æ¥è¯´å°±æ˜¯ç”¨ç¦»æ•£åŒ–çš„æ¢¯åº¦é€¼è¿‘å‡½æ•°æ ¹æ®äºŒç»´ç°åº¦çŸ©é˜µæ¢¯åº¦å‘é‡æ¥å¯»æ‰¾å›¾åƒç°åº¦çŸ©é˜µçš„ç°åº¦è·ƒå˜ä½ç½®ï¼Œç„¶åå†å›¾åƒä¸­å°†è¿™äº›ç‚¹è¿èµ·æ¥å°±å½¢æˆäº†å›¾åƒçš„è¾¹ç¼˜ã€‚<br><strong>å¤„ç†è¿‡ç¨‹ï¼š</strong><br>ä¸€èˆ¬å¯¹å›¾åƒè¿›è¡Œ canny è¾¹ç¼˜æ£€æµ‹è¦ç»è¿‡ä»¥ä¸‹å‡ æ­¥ï¼š </p><ol><li><p>å¯¹å›¾åƒè¿›è¡Œç°åº¦åŒ–å¤„ç†ï¼š<br><strong>å…¬å¼ï¼š</strong> Gimg = 0.299R+0.587G+0.114B </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RGBtoGray</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure></li><li><p>å¯¹å›¾åƒè¿›è¡Œé«˜æ–¯æ»¤æ³¢(å‡ºå»å›¾ç‰‡ä¸­å™ªå£°å¯¹è¾¹ç¼˜æ£€æµ‹çš„å½±å“) </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gaussian_smooth</span><span class="params">(<span class="keyword">float</span> sigma)</span></span>;</span><br></pre></td></tr></table></figure></li></ol><p>ç”¨åˆ°è¾…åŠ©å‡½æ•°ï¼š<br><code>void make_gaussian_kernel(float sigma, float **kernel, int *windowsize);</code> </p><ol start="3"><li>ç”¨ä¸€é˜¶åå¯¼çš„æœ‰é™å·®åˆ†æ¥è®¡ç®—æ¢¯åº¦çš„å¹…å€¼å’Œæ–¹å‘ <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¡ç®—x,yæ–¹å‘çš„ä¸€é˜¶å¯¼æ•° </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">derrivative_x_y</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure></li></ol><p>ç”¨åˆ°è¾…åŠ©å‡½æ•°ï¼š<br><code>double angle_radians(double x, double y);</code> </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¡ç®—æ¢¯åº¦å‘ä¸Šçš„æ–¹å‘ï¼Œä»¥æ­£xè½´ä¸ºé€†æ—¶é’ˆæ–¹å‘æŒ‡å®šçš„å¼§åº¦ </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">radian_direction</span><span class="params">(<span class="keyword">int</span> xdirtag, <span class="keyword">int</span> ydirtag)</span></span>; </span><br><span class="line"><span class="comment">//è®¡ç®—æ¢¯åº¦çš„å¹…å€¼ </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">magnitude_x_y</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><ol start="4"><li><p>å¯¹æ¢¯åº¦å¹…å€¼è¿›è¡Œéæå¤§å€¼æŠ‘åˆ¶ </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">non_max_supp</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure></li><li><p>åŒé˜ˆå€¼æ£€æµ‹å’Œè¿æ¥è¾¹ç¼˜ </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">apply_hysteresis</span><span class="params">(<span class="keyword">float</span> tlow, <span class="keyword">float</span> thigh)</span></span>;</span><br></pre></td></tr></table></figure></li></ol><p>ç”¨åˆ°è¾…åŠ©å‡½æ•°:<br><code>void follow_edges(int *edgemapptr, int *edgemagptr, int lowval, int cols);</code> </p><ol start="6"><li>ä¹‹åå†å¯¹å°†ç›¸é‚»è¾¹ç¼˜è¿æˆçº¿æ¡ï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CImg&lt;<span class="keyword">int</span>&gt; canny_line(CImg&lt;<span class="keyword">int</span>&gt; picture, <span class="keyword">int</span> distance);</span><br></pre></td></tr></table></figure></li></ol><p>ç”¨åˆ°è¾…åŠ©å‡½æ•°ï¼š<br><code>CImg&lt;int&gt; Draw_line(CImg&lt;int&gt; tmp, int x, int y, int x1, int y1);</code> </p><ol start="7"><li>åˆ é™¤é•¿åº¦å°äº20çš„çº¿æ¡ï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CImg&lt;<span class="keyword">int</span>&gt; delete_line(CImg&lt;<span class="keyword">int</span>&gt; picture); CImg&lt;<span class="keyword">int</span>&gt; delete_line(CImg&lt;<span class="keyword">int</span>&gt; picture);</span><br></pre></td></tr></table></figure></li></ol><h2 id="ä»£ç ï¼š"><a href="#ä»£ç ï¼š" class="headerlink" title="ä»£ç ï¼š"></a><strong>ä»£ç ï¼š</strong></h2><p><strong>Canny.h</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*å®ç°cannyè¾¹ç¼˜æ£€æµ‹çš„åŸç†é€šä¿—æ¥è¯´å°±æ˜¯ç”¨ç¦»æ•£åŒ–çš„æ¢¯åº¦é€¼è¿‘å‡½æ•°æ ¹æ®äºŒç»´ç°åº¦çŸ©é˜µæ¢¯åº¦å‘é‡æ¥å¯»æ‰¾å›¾åƒç°åº¦çŸ©é˜µ</span></span><br><span class="line"><span class="comment">çš„ç°åº¦è·ƒå˜ä½ç½®ï¼Œç„¶åå†å›¾åƒä¸­å°†è¿™äº›ç‚¹è¿èµ·æ¥å°±å½¢æˆäº†å›¾åƒçš„è¾¹ç¼˜</span></span><br><span class="line"><span class="comment">ä¸€èˆ¬å¯¹å›¾åƒè¿›è¡Œcannyè¾¹ç¼˜æ£€æµ‹è¦ç»è¿‡ä»¥ä¸‹å‡ æ­¥ï¼š</span></span><br><span class="line"><span class="comment">1.å¯¹å›¾åƒè¿›è¡Œç°åº¦åŒ–å¤„ç†ï¼šGimg = 0.299R+0.587G+0.114B</span></span><br><span class="line"><span class="comment">2.å¯¹å›¾åƒè¿›è¡Œé«˜æ–¯æ»¤æ³¢(å‡ºå»å›¾ç‰‡ä¸­å™ªå£°å¯¹è¾¹ç¼˜æ£€æµ‹çš„å½±å“)</span></span><br><span class="line"><span class="comment">3.ç”¨ä¸€é˜¶åå¯¼çš„æœ‰é™å·®åˆ†æ¥è®¡ç®—æ¢¯åº¦çš„å¹…å€¼å’Œæ–¹å‘</span></span><br><span class="line"><span class="comment">4.å¯¹æ¢¯åº¦å¹…å€¼è¿›è¡Œéæå¤§å€¼æŠ‘åˆ¶</span></span><br><span class="line"><span class="comment">5.åŒé˜ˆå€¼æ£€æµ‹å’Œè¿æ¥è¾¹ç¼˜</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> CANNY_H_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CANNY_H_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"CImg.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cimg_library;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Canny</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; img;</span><br><span class="line"><span class="keyword">int</span> rows;</span><br><span class="line"><span class="keyword">int</span> cols;</span><br><span class="line"><span class="keyword">int</span> *smoothedim;</span><br><span class="line"><span class="keyword">int</span> *delta_x;  <span class="comment">//xæ–¹å‘çš„ä¸€é˜¶å¯¼æ•°</span></span><br><span class="line"><span class="keyword">int</span> *delta_y;  <span class="comment">//yæ–¹å‘çš„ä¸€é˜¶å¯¼æ•°</span></span><br><span class="line"><span class="keyword">float</span> *dirim;  <span class="comment">//æ¢¯åº¦çš„æ–¹å‘</span></span><br><span class="line"><span class="keyword">int</span> *magnitude; <span class="comment">//æ¢¯åº¦çš„å¹…å€¼</span></span><br><span class="line"><span class="keyword">int</span> *nms;   <span class="comment">//éæå¤§å€¼æŠ‘åˆ¶åå¾—åˆ°çŸ©é˜µ</span></span><br><span class="line"><span class="keyword">int</span> *edge;  <span class="comment">//è¾¹ç¼˜æ•°ç»„</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">Canny();</span><br><span class="line">Canny(<span class="built_in">string</span> name,<span class="built_in">string</span> format);</span><br><span class="line">~Canny();</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RGBtoGray</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gaussian_smooth</span><span class="params">(<span class="keyword">float</span> sigma)</span></span>;</span><br><span class="line"><span class="comment">//è®¡ç®—x,yæ–¹å‘çš„ä¸€é˜¶å¯¼æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">derrivative_x_y</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//è®¡ç®—æ¢¯åº¦å‘ä¸Šçš„æ–¹å‘ï¼Œä»¥æ­£xè½´ä¸ºé€†æ—¶é’ˆæ–¹å‘æŒ‡å®šçš„å¼§åº¦</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">radian_direction</span><span class="params">(<span class="keyword">int</span> xdirtag, <span class="keyword">int</span> ydirtag)</span></span>;</span><br><span class="line"><span class="comment">//è®¡ç®—æ¢¯åº¦çš„å¹…å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">magnitude_x_y</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//è¿›è¡Œéæå¤§å€¼æŠ‘åˆ¶</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">non_max_supp</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//åŒé˜ˆå€¼æ£€æµ‹</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">apply_hysteresis</span><span class="params">(<span class="keyword">float</span> tlow, <span class="keyword">float</span> thigh)</span></span>;</span><br><span class="line"><span class="comment">//é»˜è®¤å‚æ•°è®¾ç½®é«˜æ–¯æ»¤æ³¢æ ‡å‡†å·®ä¸º2.0ï¼Œä½é˜ˆå€¼ä¸º0.25ï¼Œé«˜é˜ˆå€¼ä¸º0.75</span></span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; canny_image();</span><br><span class="line"><span class="comment">//æ•´åˆæ‰€æœ‰è·å–æœ€åçš„è¾¹ç¼˜å›¾,sigmaè¡¨ç¤ºé«˜æ–¯æ»¤æ³¢çš„å‚æ•°ï¼Œtlowå’Œthighä¸ºä¸¤ä¸ªé˜ˆå€¼</span></span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; canny_image(<span class="keyword">int</span> sigma, <span class="keyword">float</span> tlow, <span class="keyword">float</span> thigh);</span><br><span class="line"><span class="comment">//é€‰å‡ºä¸¤ä¸ªè¾¹ç¼˜ç‚¹è¾ƒè¿‘çš„è·ç¦»è¿çº¿</span></span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; canny_line(CImg&lt;<span class="keyword">int</span>&gt; picture, <span class="keyword">int</span> distance);</span><br><span class="line"><span class="comment">//åˆ æ‰é•¿åº¦å°äº20çš„è¾¹ç¼˜çº¿</span></span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; delete_line(CImg&lt;<span class="keyword">int</span>&gt; picture);</span><br><span class="line"><span class="comment">//æ˜¾ç¤ºå›¾åƒ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//ç¼–å†™ç±»è¿‡ç¨‹çš„æµ‹è¯•ï¼Œæ— å®é™…ç”¨å¤„</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p><strong>Canny.cpp</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pch.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Canny.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"CImg.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pi 3.1415926</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> M_PI 3.14159265358979323846</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BOOSTBLURFACTOR 90.0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NOEDGE 255</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> POSSIBLE_EDGE 128</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EDGE 0</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cimg_library;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">make_gaussian_kernel</span><span class="params">(<span class="keyword">float</span> sigma, <span class="keyword">float</span> **kernel, <span class="keyword">int</span> *windowsize)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">angle_radians</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">follow_edges</span><span class="params">(<span class="keyword">int</span> *edgemapptr, <span class="keyword">int</span> *edgemagptr, <span class="keyword">int</span> lowval, <span class="keyword">int</span> cols)</span></span>;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; Draw_line(CImg&lt;<span class="keyword">int</span>&gt; tmp, <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> x1, <span class="keyword">int</span> y1);</span><br><span class="line"></span><br><span class="line">Canny::Canny() &#123;</span><br><span class="line">rows = <span class="number">0</span>;</span><br><span class="line">cols = <span class="number">0</span>;</span><br><span class="line">smoothedim = <span class="literal">NULL</span>;</span><br><span class="line">delta_x = <span class="literal">NULL</span>;  <span class="comment">//xæ–¹å‘çš„ä¸€é˜¶å¯¼æ•°</span></span><br><span class="line">delta_y = <span class="literal">NULL</span>;  <span class="comment">//yæ–¹å‘çš„ä¸€é˜¶å¯¼æ•°</span></span><br><span class="line">dirim = <span class="literal">NULL</span>;  <span class="comment">//æ¢¯åº¦çš„æ–¹å‘</span></span><br><span class="line">magnitude = <span class="literal">NULL</span>; <span class="comment">//æ¢¯åº¦çš„å¹…å€¼</span></span><br><span class="line">nms = <span class="literal">NULL</span>;   <span class="comment">//éæå¤§å€¼æŠ‘åˆ¶åå¾—åˆ°çŸ©é˜µ</span></span><br><span class="line">edge = <span class="literal">NULL</span>; <span class="comment">//è¾¹ç¼˜æ•°ç»„</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Canny::Canny(<span class="built_in">string</span> name, <span class="built_in">string</span> format) &#123;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *a = name.c_str();</span><br><span class="line"><span class="built_in">string</span> jpg = <span class="string">"jpg"</span>;</span><br><span class="line"><span class="built_in">string</span> png = <span class="string">"png"</span>;</span><br><span class="line"><span class="built_in">string</span> tiff = <span class="string">"tiff"</span>;</span><br><span class="line"><span class="built_in">string</span> bmp = <span class="string">"bmp"</span>;</span><br><span class="line"><span class="keyword">if</span> (format.compare(jpg) == <span class="number">0</span>)</span><br><span class="line">img.load_jpeg(a);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (format.compare(png) == <span class="number">0</span>)</span><br><span class="line">img.load_png(a);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (format.compare(tiff) == <span class="number">0</span>)</span><br><span class="line">img.load_tiff(a);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (format.compare(bmp) == <span class="number">0</span>)</span><br><span class="line">img.load_bmp(a);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="comment">//img.load_jpeg("lena.jpg");</span></span><br><span class="line">rows = img.width();</span><br><span class="line">cols = img.height();</span><br><span class="line">delta_x = <span class="keyword">new</span> <span class="keyword">int</span>[rows*cols]; <span class="built_in">memset</span>(delta_x, <span class="number">0x0</span>, rows*cols*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">delta_y = <span class="keyword">new</span> <span class="keyword">int</span>[rows*cols]; <span class="built_in">memset</span>(delta_y, <span class="number">0x0</span>, rows*cols * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">dirim = <span class="keyword">new</span> <span class="keyword">float</span>[rows*cols]; <span class="built_in">memset</span>(dirim, <span class="number">0x0</span>, rows*cols * <span class="keyword">sizeof</span>(<span class="keyword">float</span>));</span><br><span class="line">magnitude = <span class="keyword">new</span> <span class="keyword">int</span>[rows*cols]; <span class="built_in">memset</span>(magnitude, <span class="number">0x0</span>, rows*cols * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">nms = <span class="keyword">new</span> <span class="keyword">int</span>[rows*cols]; <span class="built_in">memset</span>(nms, <span class="number">0x0</span>, rows*cols * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">edge = <span class="keyword">new</span> <span class="keyword">int</span>[rows*cols]; <span class="built_in">memset</span>(edge, <span class="number">0x0</span>, rows*cols * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">smoothedim = <span class="keyword">new</span> <span class="keyword">int</span>[rows*cols];  <span class="built_in">memset</span>(smoothedim, <span class="number">0x0</span>, rows*cols * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Canny::~Canny() &#123;</span><br><span class="line"><span class="keyword">delete</span>[] delta_x;</span><br><span class="line"><span class="keyword">delete</span>[] delta_y;</span><br><span class="line"><span class="keyword">delete</span>[] dirim;</span><br><span class="line"><span class="keyword">delete</span>[] magnitude;</span><br><span class="line"><span class="keyword">delete</span>[] nms;</span><br><span class="line"><span class="keyword">delete</span>[] edge;</span><br><span class="line"><span class="keyword">delete</span>[] smoothedim;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Canny::display() &#123;</span><br><span class="line">img.display();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Canny::RGBtoGray() &#123;</span><br><span class="line"><span class="keyword">int</span> r = <span class="number">0</span>, g = <span class="number">0</span>, b = <span class="number">0</span>;</span><br><span class="line">cimg_forXY(img, x, y) &#123;</span><br><span class="line">r = img(x, y, <span class="number">0</span>);</span><br><span class="line">g = img(x, y, <span class="number">1</span>);</span><br><span class="line">b = img(x, y, <span class="number">2</span>);</span><br><span class="line">img(x, y, <span class="number">0</span>) = img(x, y, <span class="number">1</span>) = img(x, y, <span class="number">2</span>) = (r*<span class="number">0.2126</span> + g * <span class="number">0.7152</span> + b * <span class="number">0.0722</span>);</span><br><span class="line">&#125;</span><br><span class="line">img.resize(rows, cols, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Canny::gaussian_smooth(<span class="keyword">float</span> sigma)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> *tempim = <span class="keyword">new</span> <span class="keyword">int</span>[rows*cols];</span><br><span class="line"><span class="keyword">int</span> r, c,rr,cc,</span><br><span class="line">windowsize,  <span class="comment">//é«˜æ–¯æ ¸ç»´åº¦</span></span><br><span class="line">center;      <span class="comment">//æ ¸ä¸­å¿ƒ</span></span><br><span class="line"><span class="keyword">float</span> *kernel,</span><br><span class="line">dot,</span><br><span class="line">sum;</span><br><span class="line">make_gaussian_kernel(sigma, &amp;kernel, &amp;windowsize);</span><br><span class="line">center = windowsize / <span class="number">2</span>;</span><br><span class="line"><span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; rows; r++) &#123;</span><br><span class="line"><span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; cols; c++) &#123;</span><br><span class="line">dot = <span class="number">0.0</span>;</span><br><span class="line">sum = <span class="number">0.0</span>;</span><br><span class="line"><span class="keyword">for</span> (cc = (-center); cc &lt;= center; cc++) &#123;</span><br><span class="line"><span class="keyword">if</span> (((c + cc) &gt;= <span class="number">0</span>) &amp;&amp; ((c + cc) &lt; cols)) &#123;</span><br><span class="line">dot += (<span class="keyword">float</span>)img(r,c+cc) * kernel[center + cc];</span><br><span class="line">sum += kernel[center + cc];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">tempim[r*cols + c] = dot / sum;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; cols; c++) &#123;</span><br><span class="line"><span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; rows; r++) &#123;</span><br><span class="line">sum = <span class="number">0.0</span>;</span><br><span class="line">dot = <span class="number">0.0</span>;</span><br><span class="line"><span class="keyword">for</span> (rr = (-center); rr &lt;= center; rr++) &#123;</span><br><span class="line"><span class="keyword">if</span> (((r + rr) &gt;= <span class="number">0</span>) &amp;&amp; ((r + rr) &lt; rows)) &#123;</span><br><span class="line">dot += tempim[(r + rr)*cols + c] * kernel[center + rr];</span><br><span class="line">sum += kernel[center + rr];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">smoothedim[r*cols + c] = (<span class="keyword">short</span> <span class="keyword">int</span>)(dot*BOOSTBLURFACTOR / sum + <span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Canny::derrivative_x_y() &#123;</span><br><span class="line"><span class="keyword">int</span> r = <span class="number">0</span>, c = <span class="number">0</span>, pos = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//è®¡ç®—xæ–¹å‘çš„ä¸€é˜¶å¯¼æ•°ï¼Œåˆ¤æ–­è¾¹ç•Œé¿å…é—å¤±è¾¹ç•Œåƒç´ ç‚¹</span></span><br><span class="line"><span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; rows; r++) &#123;</span><br><span class="line">pos = r * cols;</span><br><span class="line">delta_x[pos] = smoothedim[pos + <span class="number">1</span>] - smoothedim[pos];</span><br><span class="line">pos++;</span><br><span class="line"><span class="keyword">for</span> (c = <span class="number">1</span>; c &lt; (cols - <span class="number">1</span>); c++, pos++) &#123;</span><br><span class="line">delta_x[pos] = smoothedim[pos + <span class="number">1</span>] - smoothedim[pos - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line">delta_x[pos] = smoothedim[pos] - smoothedim[pos - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è®¡ç®—yæ–¹å‘çš„ä¸€é˜¶å¯¼æ•°ï¼Œåˆ¤æ–­è¾¹ç•Œé¿å…é—å¤±è¾¹ç•Œåƒç´ ç‚¹</span></span><br><span class="line"><span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; cols; c++) &#123;</span><br><span class="line">pos = c;</span><br><span class="line">delta_y[pos] = smoothedim[pos + cols] - smoothedim[pos];</span><br><span class="line">pos += cols;</span><br><span class="line"><span class="keyword">for</span> (r = <span class="number">1</span>; r &lt; (rows - <span class="number">1</span>); r++, pos += cols) &#123;</span><br><span class="line">delta_y[pos] = smoothedim[pos + cols] - smoothedim[pos - cols];</span><br><span class="line">&#125;</span><br><span class="line">delta_y[pos] = smoothedim[pos] - smoothedim[pos - cols];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Canny::radian_direction(<span class="keyword">int</span> xdirtag, <span class="keyword">int</span> ydirtag) &#123;</span><br><span class="line"><span class="keyword">double</span> dx = <span class="number">0.0</span>, dy = <span class="number">0.0</span>;</span><br><span class="line"><span class="keyword">int</span> r = <span class="number">0</span>, c = <span class="number">0</span>, pos = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (r = <span class="number">0</span>, pos = <span class="number">0</span>; r &lt; rows; r++) &#123;</span><br><span class="line"><span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; cols; c++, pos++) &#123;</span><br><span class="line">dx = (<span class="keyword">double</span>)delta_x[pos];</span><br><span class="line">dy = (<span class="keyword">double</span>)delta_y[pos];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (xdirtag == <span class="number">1</span>) dx = -dx;</span><br><span class="line"><span class="keyword">if</span> (ydirtag == <span class="number">-1</span>) dy = -dy;</span><br><span class="line"></span><br><span class="line">dirim[pos] = (<span class="keyword">float</span>)angle_radians(dx, dy);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Canny::magnitude_x_y() &#123;</span><br><span class="line"><span class="keyword">int</span> r = <span class="number">0</span>, c = <span class="number">0</span>, pos = <span class="number">0</span>, sq1 = <span class="number">0</span>, sq2 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (r = <span class="number">0</span>, pos = <span class="number">0</span>; r &lt; rows; r++) &#123;</span><br><span class="line"><span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; cols; c++, pos++) &#123;</span><br><span class="line">sq1 = (<span class="keyword">int</span>)delta_x[pos] * (<span class="keyword">int</span>)delta_x[pos];</span><br><span class="line">sq2 = (<span class="keyword">int</span>)delta_y[pos] * (<span class="keyword">int</span>)delta_y[pos];</span><br><span class="line">magnitude[pos] = (<span class="keyword">short</span>)(<span class="number">0.5</span> + <span class="built_in">sqrt</span>((<span class="keyword">float</span>)sq1 + (<span class="keyword">float</span>)sq2));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Canny::non_max_supp() &#123;</span><br><span class="line"><span class="keyword">int</span> rowcount = <span class="number">0</span>, colcount = <span class="number">0</span>, count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> *magrowptr, *magptr;</span><br><span class="line"><span class="keyword">int</span> *gxrowptr, *gxptr;</span><br><span class="line"><span class="keyword">int</span> *gyrowptr, *gyptr, z1 = <span class="number">0</span>, z2 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> m00, gx = <span class="number">0</span>, gy = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">float</span> mag1 = <span class="number">0.0</span>, mag2 = <span class="number">0.0</span>, xperp = <span class="number">0.0</span>, yperp = <span class="number">0.0</span>;</span><br><span class="line"><span class="keyword">int</span> *resultrowptr, *resultptr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (count = <span class="number">0</span>, resultrowptr = nms, resultptr = nms + cols * (rows - <span class="number">1</span>);</span><br><span class="line">count &lt; cols; resultptr++, resultrowptr++, count++) &#123;</span><br><span class="line">*resultrowptr = *resultptr = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (count = <span class="number">0</span>, resultptr = nms, resultrowptr = nms + cols - <span class="number">1</span>;</span><br><span class="line">count &lt; rows; count++, resultptr += cols, resultrowptr += cols) &#123;</span><br><span class="line">*resultptr = *resultrowptr = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (rowcount = <span class="number">1</span>, magrowptr = magnitude + cols + <span class="number">1</span>, gxrowptr = delta_x + cols + <span class="number">1</span>,</span><br><span class="line">gyrowptr = delta_y + cols + <span class="number">1</span>, resultrowptr = nms + cols + <span class="number">1</span>;</span><br><span class="line">rowcount &lt; rows - <span class="number">2</span>;</span><br><span class="line">rowcount++, magrowptr += cols, gyrowptr += cols, gxrowptr += cols,</span><br><span class="line">resultrowptr += cols) &#123;</span><br><span class="line"><span class="keyword">for</span> (colcount = <span class="number">1</span>, magptr = magrowptr, gxptr = gxrowptr, gyptr = gyrowptr,</span><br><span class="line">resultptr = resultrowptr; colcount &lt; cols - <span class="number">2</span>;</span><br><span class="line">colcount++, magptr++, gxptr++, gyptr++, resultptr++) &#123;</span><br><span class="line">m00 = *magptr;</span><br><span class="line"><span class="keyword">if</span> (m00 == <span class="number">0</span>) &#123;</span><br><span class="line">*resultptr = NOEDGE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">xperp = -(gx = *gxptr) / ((<span class="keyword">float</span>)m00);</span><br><span class="line">yperp = (gy = *gyptr) / ((<span class="keyword">float</span>)m00);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (gx &gt;= <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (gy &gt;= <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (gx &gt;= gy)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 111 */</span></span><br><span class="line"><span class="comment">/* Left point */</span></span><br><span class="line">z1 = *(magptr - <span class="number">1</span>);</span><br><span class="line">z2 = *(magptr - cols - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mag1 = (m00 - z1)*xperp + (z2 - z1)*yperp;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Right point */</span></span><br><span class="line">z1 = *(magptr + <span class="number">1</span>);</span><br><span class="line">z2 = *(magptr + cols + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mag2 = (m00 - z1)*xperp + (z2 - z1)*yperp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 110 */</span></span><br><span class="line"><span class="comment">/* Left point */</span></span><br><span class="line">z1 = *(magptr - cols);</span><br><span class="line">z2 = *(magptr - cols - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mag1 = (z1 - z2)*xperp + (z1 - m00)*yperp;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Right point */</span></span><br><span class="line">z1 = *(magptr + cols);</span><br><span class="line">z2 = *(magptr + cols + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mag2 = (z1 - z2)*xperp + (z1 - m00)*yperp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (gx &gt;= -gy)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 101 */</span></span><br><span class="line"><span class="comment">/* Left point */</span></span><br><span class="line">z1 = *(magptr - <span class="number">1</span>);</span><br><span class="line">z2 = *(magptr + cols - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mag1 = (m00 - z1)*xperp + (z1 - z2)*yperp;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Right point */</span></span><br><span class="line">z1 = *(magptr + <span class="number">1</span>);</span><br><span class="line">z2 = *(magptr - cols + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mag2 = (m00 - z1)*xperp + (z1 - z2)*yperp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 100 */</span></span><br><span class="line"><span class="comment">/* Left point */</span></span><br><span class="line">z1 = *(magptr + cols);</span><br><span class="line">z2 = *(magptr + cols - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mag1 = (z1 - z2)*xperp + (m00 - z1)*yperp;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Right point */</span></span><br><span class="line">z1 = *(magptr - cols);</span><br><span class="line">z2 = *(magptr - cols + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mag2 = (z1 - z2)*xperp + (m00 - z1)*yperp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> ((gy = *gyptr) &gt;= <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (-gx &gt;= gy)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 011 */</span></span><br><span class="line"><span class="comment">/* Left point */</span></span><br><span class="line">z1 = *(magptr + <span class="number">1</span>);</span><br><span class="line">z2 = *(magptr - cols + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mag1 = (z1 - m00)*xperp + (z2 - z1)*yperp;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Right point */</span></span><br><span class="line">z1 = *(magptr - <span class="number">1</span>);</span><br><span class="line">z2 = *(magptr + cols - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mag2 = (z1 - m00)*xperp + (z2 - z1)*yperp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 010 */</span></span><br><span class="line"><span class="comment">/* Left point */</span></span><br><span class="line">z1 = *(magptr - cols);</span><br><span class="line">z2 = *(magptr - cols + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mag1 = (z2 - z1)*xperp + (z1 - m00)*yperp;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Right point */</span></span><br><span class="line">z1 = *(magptr + cols);</span><br><span class="line">z2 = *(magptr + cols - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mag2 = (z2 - z1)*xperp + (z1 - m00)*yperp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (-gx &gt; -gy)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 001 */</span></span><br><span class="line"><span class="comment">/* Left point */</span></span><br><span class="line">z1 = *(magptr + <span class="number">1</span>);</span><br><span class="line">z2 = *(magptr + cols + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mag1 = (z1 - m00)*xperp + (z1 - z2)*yperp;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Right point */</span></span><br><span class="line">z1 = *(magptr - <span class="number">1</span>);</span><br><span class="line">z2 = *(magptr - cols - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mag2 = (z1 - m00)*xperp + (z1 - z2)*yperp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 000 */</span></span><br><span class="line"><span class="comment">/* Left point */</span></span><br><span class="line">z1 = *(magptr + cols);</span><br><span class="line">z2 = *(magptr + cols + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mag1 = (z2 - z1)*xperp + (m00 - z1)*yperp;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Right point */</span></span><br><span class="line">z1 = *(magptr - cols);</span><br><span class="line">z2 = *(magptr - cols - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mag2 = (z2 - z1)*xperp + (m00 - z1)*yperp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Now determine if the current point is a maximum point */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((mag1 &gt; <span class="number">0.0</span>) || (mag2 &gt; <span class="number">0.0</span>))</span><br><span class="line">&#123;</span><br><span class="line">*resultptr = NOEDGE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (mag2 == <span class="number">0.0</span>)</span><br><span class="line">*resultptr = NOEDGE;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">*resultptr = POSSIBLE_EDGE;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Canny::apply_hysteresis(<span class="keyword">float</span> tlow, <span class="keyword">float</span> thigh) &#123;</span><br><span class="line"><span class="keyword">int</span> r = <span class="number">0</span>, c = <span class="number">0</span>, pos = <span class="number">0</span>, numedges = <span class="number">0</span>, lowcount = <span class="number">0</span>, highcount = <span class="number">0</span>, lowthreshold = <span class="number">0</span>, highthreshold = <span class="number">0</span>,</span><br><span class="line">i = <span class="number">0</span>, *hist, rr = <span class="number">0</span>, cc = <span class="number">0</span>;</span><br><span class="line">hist = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">32768</span>];</span><br><span class="line"><span class="keyword">int</span> maximum_mag = <span class="number">0</span>, sumpix = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (r = <span class="number">0</span>, pos = <span class="number">0</span>; r &lt; rows; r++) &#123;</span><br><span class="line"><span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; cols; c++, pos++) &#123;</span><br><span class="line"><span class="keyword">if</span> (nms[pos] == POSSIBLE_EDGE) edge[pos] = POSSIBLE_EDGE;</span><br><span class="line"><span class="keyword">else</span> edge[pos] = NOEDGE;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (r = <span class="number">0</span>, pos = <span class="number">0</span>; r &lt; rows; r++, pos += cols) &#123;</span><br><span class="line">edge[pos] = NOEDGE;</span><br><span class="line">edge[pos + cols - <span class="number">1</span>] = NOEDGE;</span><br><span class="line">&#125;</span><br><span class="line">pos = (rows - <span class="number">1</span>) * cols;</span><br><span class="line"><span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; cols; c++, pos++) &#123;</span><br><span class="line">edge[c] = NOEDGE;</span><br><span class="line">edge[pos] = NOEDGE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">32768</span>; r++) hist[r] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (r = <span class="number">0</span>, pos = <span class="number">0</span>; r &lt; rows; r++) &#123;</span><br><span class="line"><span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; cols; c++, pos++) &#123;</span><br><span class="line"><span class="keyword">if</span> (edge[pos] == POSSIBLE_EDGE) hist[magnitude[pos]]++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (r = <span class="number">1</span>, numedges = <span class="number">0</span>; r &lt; <span class="number">32768</span>; r++) &#123;</span><br><span class="line"><span class="keyword">if</span> (hist[r] != <span class="number">0</span>) maximum_mag = r;</span><br><span class="line">numedges += hist[r];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highcount = (<span class="keyword">int</span>)(numedges * thigh + <span class="number">0.5</span>);</span><br><span class="line"></span><br><span class="line">r = <span class="number">1</span>;</span><br><span class="line">numedges = hist[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">while</span> ((r &lt; (maximum_mag - <span class="number">1</span>)) &amp;&amp; (numedges &lt; highcount)) &#123;</span><br><span class="line">r++;</span><br><span class="line">numedges += hist[r];</span><br><span class="line">&#125;</span><br><span class="line">highthreshold = r;</span><br><span class="line">lowthreshold = (<span class="keyword">int</span>)(highthreshold * tlow + <span class="number">0.5</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (r = <span class="number">0</span>, pos = <span class="number">0</span>; r &lt; rows; r++) &#123;</span><br><span class="line"><span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; cols; c++, pos++) &#123;</span><br><span class="line"><span class="keyword">if</span> ((edge[pos] == POSSIBLE_EDGE) &amp;&amp; (magnitude[pos] &gt;= highthreshold)) &#123;</span><br><span class="line">edge[pos] = EDGE;</span><br><span class="line">follow_edges((edge + pos), (magnitude + pos), lowthreshold, cols);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (r = <span class="number">0</span>, pos = <span class="number">0</span>; r &lt; rows; r++) &#123;</span><br><span class="line"><span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; cols; c++, pos++) <span class="keyword">if</span> (edge[pos] != EDGE) edge[pos] = NOEDGE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">delete</span>[] hist;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">make_gaussian_kernel</span><span class="params">(<span class="keyword">float</span> sigma, <span class="keyword">float</span> **kernel, <span class="keyword">int</span> *windowsize)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>, center = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">float</span> x, fx, sum = <span class="number">0.0</span>;</span><br><span class="line"><span class="comment">//æ ¹æ®é«˜æ–¯æ»¤æ³¢æ ¸çš„æ–¹å·®è®¡ç®—é«˜æ–¯æ ¸çš„å®½é«˜</span></span><br><span class="line">*windowsize = <span class="number">1</span> + <span class="number">2</span> * <span class="built_in">ceil</span>(<span class="number">2.5</span> * sigma);</span><br><span class="line"><span class="comment">//*kernel = (float*)calloc((*windowsize), sizeof(float));</span></span><br><span class="line">center = (*windowsize) / <span class="number">2</span>;</span><br><span class="line">*kernel = <span class="keyword">new</span> <span class="keyword">float</span>[*windowsize];</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; (*windowsize); i++) &#123;</span><br><span class="line">x = (<span class="keyword">float</span>)(i - center);</span><br><span class="line">fx = <span class="built_in">pow</span>(<span class="number">2.71828</span>, <span class="number">-0.5</span>*x*x / (sigma*sigma)) / (sigma * <span class="built_in">sqrt</span>(<span class="number">6.2831853</span>));</span><br><span class="line">(*kernel)[i] = fx;</span><br><span class="line">sum += fx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; (*windowsize); i++) &#123;</span><br><span class="line">(*kernel)[i] /= sum;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">angle_radians</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> </span>&#123;</span><br><span class="line"><span class="keyword">double</span> xu = <span class="number">0.0</span>, yu = <span class="number">0.0</span>, ang = <span class="number">0.0</span>;</span><br><span class="line">xu = <span class="built_in">fabs</span>(x);</span><br><span class="line">yu = <span class="built_in">fabs</span>(y);</span><br><span class="line"><span class="keyword">if</span> ((xu == <span class="number">0</span>) &amp;&amp; (yu == <span class="number">0</span>)) <span class="keyword">return</span>(<span class="number">0</span>);</span><br><span class="line">ang = <span class="built_in">atan</span>(yu / xu);</span><br><span class="line"><span class="keyword">if</span> (x &gt;= <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (y &gt;= <span class="number">0</span>) <span class="keyword">return</span> (ang);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span>(<span class="number">2</span> * M_PI - ang);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (y &gt;= <span class="number">0</span>) <span class="keyword">return</span> (M_PI - ang);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span>(M_PI + ang);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">follow_edges</span><span class="params">(<span class="keyword">int</span> *edgemapptr, <span class="keyword">int</span> *edgemagptr, <span class="keyword">int</span> lowval, <span class="keyword">int</span> cols)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> *tempmagptr;</span><br><span class="line"><span class="keyword">int</span> *tempmapptr;</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">float</span> thethresh;</span><br><span class="line"><span class="keyword">int</span> x[<span class="number">8</span>] = &#123; <span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">1</span> &#125;,</span><br><span class="line">y[<span class="number">8</span>] = &#123; <span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">-1</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">tempmapptr = edgemapptr - y[i] * cols + x[i];</span><br><span class="line">tempmagptr = edgemagptr - y[i] * cols + x[i];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((*tempmapptr == POSSIBLE_EDGE) &amp;&amp; (*tempmagptr &gt; lowval)) &#123;</span><br><span class="line">*tempmapptr = EDGE;</span><br><span class="line">follow_edges(tempmapptr, tempmagptr, lowval, cols);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; Canny::canny_image() &#123;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; pic = canny_image(<span class="number">2.0</span>, <span class="number">0.25</span>, <span class="number">0.75</span>);</span><br><span class="line"><span class="keyword">return</span> pic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; Canny::canny_image(<span class="keyword">int</span> sigma, <span class="keyword">float</span> tlow, <span class="keyword">float</span> thigh) &#123;</span><br><span class="line">RGBtoGray();</span><br><span class="line">gaussian_smooth(sigma);</span><br><span class="line">derrivative_x_y();</span><br><span class="line">radian_direction(<span class="number">-1</span>, <span class="number">-1</span>);</span><br><span class="line">magnitude_x_y();</span><br><span class="line">non_max_supp();</span><br><span class="line">apply_hysteresis(tlow, thigh);</span><br><span class="line"><span class="comment">//img.test();</span></span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; pic(rows, cols, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">pic.fill(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rows; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; cols; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (edge[i*cols + j] &lt; <span class="number">0</span>)</span><br><span class="line">pic(i, j) = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (edge[i*cols + j] &gt; <span class="number">255</span>)</span><br><span class="line">pic(i, j) = <span class="number">255</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">pic(i, j) = edge[i*cols + j];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> pic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; Canny::canny_line(CImg&lt;<span class="keyword">int</span>&gt; picture, <span class="keyword">int</span> distance) &#123;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; pic = picture;</span><br><span class="line"><span class="comment">//ç”¨äºè®¡ç®—æŸä¸€ä¸ªåƒç´ ç‚¹æ˜¯å¦ä¸ºè¾¹ç¼˜ç‚¹</span></span><br><span class="line"><span class="comment">//åˆ¤æ–­æ–¹æ³•ä¸ºæŸ¥çœ‹ä»¥è¿™ä¸ªç‚¹ä¸ºä¸­å¿ƒçš„å…«é‚»åŸŸï¼Œå¦‚æœé™„è¿‘åªæœ‰1ä¸ªåƒç´ ç‚¹ä¸º0, å…¶ä»–7ä¸ªä¸º255åˆ™æ˜¯è¾¹ç¼˜ç‚¹</span></span><br><span class="line"><span class="keyword">bool</span> isEdge[<span class="number">1000</span>][<span class="number">1000</span>];</span><br><span class="line">cimg_forXY(pic, x, y) &#123;</span><br><span class="line">isEdge[x][y] = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (x != rows - <span class="number">1</span> &amp;&amp; x != <span class="number">0</span> &amp;&amp; y != cols - <span class="number">1</span> &amp;&amp; y != <span class="number">0</span> &amp;&amp; pic(x, y) == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">int</span> linyu[<span class="number">8</span>];</span><br><span class="line"><span class="keyword">int</span> m = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = x - <span class="number">1</span>; i &lt;= x + <span class="number">1</span>; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = y - <span class="number">1</span>; j &lt;= y + <span class="number">1</span>; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (!(i == x &amp;&amp; j == y)) &#123;</span><br><span class="line">linyu[m] = pic(i, j);</span><br><span class="line">m++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">sort(linyu, linyu + <span class="number">8</span>);</span><br><span class="line"><span class="keyword">if</span> (linyu[<span class="number">0</span>] == <span class="number">0</span> &amp;&amp; linyu[<span class="number">1</span>] == <span class="number">255</span>)</span><br><span class="line">isEdge[x][y] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">cimg_forXY(pic, x, y) &#123;</span><br><span class="line"><span class="keyword">if</span> (x &gt;= distance &amp;&amp; x &lt;= rows - <span class="number">1</span> - distance &amp;&amp; y &gt;= distance &amp;&amp; y &lt;= cols - <span class="number">1</span> - distance &amp;&amp; isEdge[x][y] == <span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = x - distance; i &lt;= x + distance; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = y - distance; j &lt;= y + distance; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (isEdge[i][j] == <span class="literal">true</span>) &#123;</span><br><span class="line">pic = Draw_line(pic, x, y, i, j);</span><br><span class="line">isEdge[i][j] = <span class="literal">false</span>;</span><br><span class="line">isEdge[x][y] = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> pic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; Canny::delete_line(CImg&lt;<span class="keyword">int</span>&gt; picture) &#123;</span><br><span class="line"><span class="comment">//ç”¨äºè®¡ç®—æŸä¸€ä¸ªåƒç´ ç‚¹æ˜¯å¦ä¸ºè¾¹ç¼˜ç‚¹</span></span><br><span class="line"><span class="comment">//åˆ¤æ–­æ–¹æ³•ä¸ºæŸ¥çœ‹ä»¥è¿™ä¸ªç‚¹ä¸ºä¸­å¿ƒçš„å…«é‚»åŸŸï¼Œå¦‚æœé™„è¿‘åªæœ‰1ä¸ªåƒç´ ç‚¹ä¸º0, å…¶ä»–7ä¸ªä¸º255åˆ™æ˜¯è¾¹ç¼˜ç‚¹</span></span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; pic = picture;</span><br><span class="line"><span class="keyword">bool</span> isEdge[<span class="number">1000</span>][<span class="number">1000</span>];</span><br><span class="line">cimg_forXY(pic, x, y) &#123;</span><br><span class="line">isEdge[x][y] = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (x != rows - <span class="number">1</span> &amp;&amp; x != <span class="number">0</span> &amp;&amp; y != cols - <span class="number">1</span> &amp;&amp; y != <span class="number">0</span> &amp;&amp; pic(x, y) == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">int</span> linyu[<span class="number">8</span>];</span><br><span class="line"><span class="keyword">int</span> m = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = x - <span class="number">1</span>; i &lt;= x + <span class="number">1</span>; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = y - <span class="number">1</span>; j &lt;= y + <span class="number">1</span>; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (!(i == x &amp;&amp; j == y)) &#123;</span><br><span class="line">linyu[m] = pic(i, j);</span><br><span class="line">m++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">sort(linyu, linyu + <span class="number">8</span>);</span><br><span class="line"><span class="keyword">if</span> (linyu[<span class="number">0</span>] == <span class="number">0</span> &amp;&amp; linyu[<span class="number">1</span>] == <span class="number">255</span>)</span><br><span class="line">isEdge[x][y] = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//åˆ é™¤å•ä¸ªå­¤ç«‹çš„ç‚¹</span></span><br><span class="line"><span class="keyword">if</span> (linyu[<span class="number">0</span>] == <span class="number">255</span>)</span><br><span class="line">pic(x, y) = <span class="number">255</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ é™¤é•¿åº¦å°‘äº20çš„è¿çº¿</span></span><br><span class="line"><span class="comment">//åˆ¤æ–­å¦‚æœä¸¤ä¸ªè¾¹ç•Œç‚¹çš„è·ç¦»å°äº20ï¼Œå°±åˆ é™¤è¿™ä¸¤ä¸ªè¾¹ç•Œç‚¹ç»„æˆçš„çŸ©é˜µå†…æ‰€æœ‰é»‘ç‚¹ï¼Œè¿™æ ·çš„è¯å³ä½¿ä¸¤ä¸ªè¾¹ç•Œç‚¹åˆ†åˆ«æ˜¯ä¸¤æ¡ç›´çº¿çš„è¯ä¹Ÿæ— æ‰€è°“</span></span><br><span class="line"><span class="comment">//åæ­£æ˜¯è¿™æ ·çš„è¯è¿™ä¸¤è¾¹ç•Œç‚¹ä¹‹é—´éƒ½æ˜¯ç™½è‰²åŒºåŸŸï¼Œåˆ é™¤ä¹Ÿæ— æ‰€è°“</span></span><br><span class="line">cimg_forXY(pic, x, y) &#123;</span><br><span class="line"><span class="keyword">int</span> distance = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">if</span> (isEdge[x][y] == <span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">int</span> begin_x = x - distance &gt; <span class="number">0</span> ? x - distance : <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> begin_y = y - distance &gt; <span class="number">0</span> ? y - distance : <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> end_x = x + distance &lt; rows - <span class="number">1</span> ? x + distance : rows - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> end_y = y + distance &lt; cols - <span class="number">1</span> ? y + distance : cols - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = begin_x; i &lt;= end_x; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = begin_y; j &lt;= end_y; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (isEdge[i][j] == <span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">int</span> max_x = x &gt;= i ? x : i;</span><br><span class="line"><span class="keyword">int</span> max_y = y &gt;= j ? y : j;</span><br><span class="line"><span class="keyword">int</span> min_x = max_x == x ? i : x;</span><br><span class="line"><span class="keyword">int</span> min_y = max_y == y ? j : y;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> ii = min_x; ii &lt;= max_x; ii++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> jj = min_y; jj &lt;= max_y; jj++) &#123;</span><br><span class="line">pic(ii, jj) = <span class="number">255</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">isEdge[i][j] = <span class="literal">false</span>;</span><br><span class="line">isEdge[x][y] = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ é™¤ç»è¿‡ä¸Šä¸€æ­¥å¤„ç†å®Œå¯èƒ½å­˜åœ¨çš„å•ä¸ªå­¤ç«‹çš„å™ªå£°ç‚¹</span></span><br><span class="line">cimg_forXY(pic, x, y) &#123;</span><br><span class="line"><span class="keyword">if</span> (x != rows - <span class="number">1</span> &amp;&amp; x != <span class="number">0</span> &amp;&amp; y != cols - <span class="number">1</span> &amp;&amp; y != <span class="number">0</span> &amp;&amp; pic(x, y) == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">int</span> linyu[<span class="number">8</span>];</span><br><span class="line"><span class="keyword">int</span> m = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = x - <span class="number">1</span>; i &lt;= x + <span class="number">1</span>; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = y - <span class="number">1</span>; j &lt;= y + <span class="number">1</span>; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (!(i == x &amp;&amp; j == y)) &#123;</span><br><span class="line">linyu[m] = pic(i, j);</span><br><span class="line">m++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">sort(linyu, linyu + <span class="number">8</span>);</span><br><span class="line"><span class="keyword">if</span> (linyu[<span class="number">0</span>] == <span class="number">255</span>)</span><br><span class="line">pic(x, y) = <span class="number">255</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> pic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; Draw_line(CImg&lt;<span class="keyword">int</span>&gt; tmp, <span class="keyword">int</span> x ,<span class="keyword">int</span> y, <span class="keyword">int</span> x1, <span class="keyword">int</span> y1) &#123;</span><br><span class="line"></span><br><span class="line">CImg &lt;<span class="keyword">int</span>&gt; TempImg = tmp;</span><br><span class="line"><span class="keyword">int</span> black[] = &#123; <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span> &#125;;</span><br><span class="line">TempImg.draw_line(x, y, x1, y1, black);</span><br><span class="line"><span class="keyword">return</span> TempImg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Canny::test() &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rows*cols; i++) &#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; edge[i] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¯¦ç»†æµ‹è¯•ç»“æœçœ‹æµ‹è¯•æŠ¥å‘Šï¼š</strong><br><a href="https://download.csdn.net/download/perry0528/10732970" target="_blank" rel="noopener">https://download.csdn.net/download/perry0528/10732970</a><br><strong>å®Œæ•´ä»£ç å‚è§ï¼š</strong><br><a href="https://github.com/WangPerryWPY/Computer-Version/tree/master/Exp2" target="_blank" rel="noopener">https://github.com/WangPerryWPY/Computer-Version/tree/master/Exp2</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Ex2ï¼šç”¨-CImg-é‡å†™ã€å°è£…ç»™å®šçš„-Canny-ä»£ç ï¼Œå¹¶æµ‹è¯•&quot;&gt;&lt;a href=&quot;#Ex2ï¼šç”¨-CImg-é‡å†™ã€å°è£…ç»™å®šçš„-Canny-ä»£ç ï¼Œå¹¶æµ‹è¯•&quot; class=&quot;headerlink&quot; title=&quot;Ex2ï¼šç”¨ CImg é‡å†™ã€å°è£…ç»™å®šçš„ Canny ä»£ç 
      
    
    </summary>
    
      <category term="è®¡ç®—æœºå›¾å½¢å­¦" scheme="http://yoursite.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="è®¡ç®—æœºå›¾å½¢å­¦" scheme="http://yoursite.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨ä¸­ä½åˆ‡å‰²ç®—æ³•å®ç°å›¾åƒå‡è‰²</title>
    <link href="http://yoursite.com/2019/07/06/%E7%94%A8%E4%B8%AD%E4%BD%8D%E5%88%87%E5%89%B2%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0%E5%9B%BE%E5%83%8F%E5%87%8F%E8%89%B2/"/>
    <id>http://yoursite.com/2019/07/06/ç”¨ä¸­ä½åˆ‡å‰²ç®—æ³•å®ç°å›¾åƒå‡è‰²/</id>
    <published>2019-07-05T16:34:35.000Z</published>
    <updated>2019-07-05T16:35:22.260Z</updated>
    
    <content type="html"><![CDATA[<ul><li>å®ç°ç¯å¢ƒï¼š<strong>python</strong><br>å¤„ç†ä¸€å¼ çº¢è‹¹æœå›¾ï¼š<br><img src="https://img-blog.csdn.net/20181014163625887?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>å…ˆæè¿°ä¸€ä¸‹ä¸­ä½åˆ‡å‰²ç®—æ³•å§ï¼š</strong> </li></ul><ol><li>å°†å›¾ç‰‡å†…çš„æ‰€æœ‰åƒç´ åŠ å…¥åˆ°åŒä¸€ä¸ªåŒºåŸŸ </li><li>å¯¹äºæ‰€æœ‰çš„åŒºåŸŸåšä»¥ä¸‹çš„äº‹ï¼š </li><li>è®¡ç®—æ­¤åŒºåŸŸå†…æ‰€æœ‰åƒç´ çš„ RGB ä¸‰å…ƒç´ æœ€å¤§å€¼ä¸æœ€å°å€¼çš„å·®ã€‚ </li><li>é€‰å‡ºç›¸å·®æœ€å¤§çš„é‚£ä¸ªé¢œè‰²ï¼ˆR æˆ– G æˆ– Bï¼‰ </li><li>æ ¹æ®é‚£ä¸ªé¢œè‰²å»æ’åºæ­¤åŒºåŸŸå†…æ‰€æœ‰åƒç´  </li><li>åˆ†å‰²å‰ä¸€åŠä¸åä¸€åŠçš„åƒç´ åˆ°äºŒä¸ªä¸åŒçš„åŒºåŸŸï¼ˆè¿™é‡Œå°±æ˜¯â€œä¸­ä½åˆ‡<br>å‰²â€åå­—çš„ç”±æ¥ï¼‰ </li><li>é‡å¤ç¬¬äºŒæ­¥ç›´åˆ°ä½ æœ‰ 256 ä¸ªåŒºåŸŸ </li><li>å°†æ¯ä¸ªåŒºåŸŸå†…çš„åƒç´ å¹³å‡èµ·æ¥ï¼Œäºæ˜¯ä½ å°±å¾—åˆ°äº† 256 è‰² </li></ol><p><strong>äºæ˜¯æ ¹æ®ç»´åŸºç™¾ç§‘çš„ç®—æ³•æè¿°å…ˆæ˜¯å®ç°äº†ä¸€ä¸ª cube çš„ç±»ç”¨äºè¿›è¡ŒåŒºåŸŸçš„ç­›é€‰ï¼Œ</strong><br><strong>cube.py:</strong> </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> statistics <span class="keyword">import</span> mean</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cube</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, colors)</span>:</span></span><br><span class="line">        self.colors = colors <span class="keyword">or</span> []</span><br><span class="line">        self.red = [r[<span class="number">0</span>] <span class="keyword">for</span> r <span class="keyword">in</span> colors]</span><br><span class="line">        self.green = [g[<span class="number">1</span>] <span class="keyword">for</span> g <span class="keyword">in</span> colors]</span><br><span class="line">        self.blue = [b[<span class="number">2</span>] <span class="keyword">for</span> b <span class="keyword">in</span> colors]</span><br><span class="line">        self.size = (max(self.red) - min(self.red),</span><br><span class="line">                     max(self.green) - min(self.green),</span><br><span class="line">                     max(self.blue) - min(self.blue))</span><br><span class="line">        self.range = max(self.size)</span><br><span class="line">        self.channel = self.size.index(self.range)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.range &lt; other.range</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">average</span><span class="params">(self)</span>:</span></span><br><span class="line">        r = int(mean(self.red))</span><br><span class="line">        g = int(mean(self.green))</span><br><span class="line">        b = int(mean(self.blue))</span><br><span class="line">        <span class="keyword">return</span> r, g, b</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">split</span><span class="params">(self)</span>:</span></span><br><span class="line">        middle = int(len(self.colors) / <span class="number">2</span>)</span><br><span class="line">        colors = sorted(self.colors, key=<span class="keyword">lambda</span> c: c[self.channel])</span><br><span class="line">        <span class="keyword">return</span> Cube(colors[:middle]), Cube(colors[middle:])</span><br></pre></td></tr></table></figure><p><strong>main å‡½æ•°å€ŸåŠ© Cube ç±»å®ç°äº†å¯¹å›¾åƒä¸­åƒç´  rgb å€¼å¯¹åº” LUT çš„åŒ¹é…ï¼š</strong><br><strong>main.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> cube <span class="keyword">import</span> Cube</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">median_cut</span><span class="params">(img, num)</span>:</span></span><br><span class="line">    colors = []</span><br><span class="line">    <span class="keyword">for</span> count, color <span class="keyword">in</span> img.getcolors(img.width * img.height):</span><br><span class="line">        colors += [color]</span><br><span class="line">    cubes = [Cube(colors)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> len(cubes) &lt; num:</span><br><span class="line">        cubes.sort()</span><br><span class="line">        cubes += cubes.pop().split()</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    LUT = &#123;&#125;</span><br><span class="line">    index = ()</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> cubes:</span><br><span class="line">        average = c.average()</span><br><span class="line">        <span class="keyword">for</span> color <span class="keyword">in</span> c.colors:</span><br><span class="line">            LUT[color] = average                </span><br><span class="line">    <span class="keyword">return</span> LUT</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span> :</span></span><br><span class="line">    image = Image.open(<span class="string">'E://Desktop//duomeiti//redapple.jpg'</span>)</span><br><span class="line">    LUT = median_cut(image, <span class="number">256</span>)</span><br><span class="line">    img = np.array(image)</span><br><span class="line">    rows,cols,channel=img.shape</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(rows):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(cols):</span><br><span class="line">            index = (img[i,j,<span class="number">0</span>],img[i,j,<span class="number">1</span>],img[i,j,<span class="number">2</span>])</span><br><span class="line">            color = LUT[index]</span><br><span class="line">            img[i,j] = color</span><br><span class="line">    plt.imshow(img)</span><br><span class="line">    plt.axis(<span class="string">'off'</span>)</span><br><span class="line">    plt.savefig(<span class="string">'result3.jpg'</span>)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p><strong>ç»“æœç¤ºä¾‹ï¼š</strong><br><img src="https://img-blog.csdn.net/20181014163124977?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>å¦‚æœå°†é¢œè‰²è¡¨æå–å‡ºæ¥æ•ˆæœå¦‚ä¸‹ï¼š</strong><br>ï¼ˆå› 256è‰²å¸¦æ˜¯åœ¨å¤ªå¤§csdnæ— æ³•æ˜¾ç¤ºï¼Œæ•…åªæˆªå–äº†ä¸€éƒ¨åˆ†ï¼‰<br><img src="https://img-blog.csdn.net/20181014163300275?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdn.net/20181014163346307?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdn.net/20181014163422947?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;å®ç°ç¯å¢ƒï¼š&lt;strong&gt;python&lt;/strong&gt;&lt;br&gt;å¤„ç†ä¸€å¼ çº¢è‹¹æœå›¾ï¼š&lt;br&gt;&lt;img src=&quot;https://img-blog.csdn.net/20181014163625887?watermark/2/text/aHR0cHM6Ly9ibG9
      
    
    </summary>
    
      <category term="å¤šåª’ä½“æŠ€æœ¯" scheme="http://yoursite.com/categories/%E5%A4%9A%E5%AA%92%E4%BD%93%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
      <category term="å¤šåª’ä½“æŠ€æœ¯" scheme="http://yoursite.com/tags/%E5%A4%9A%E5%AA%92%E4%BD%93%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>å®ç°ä¸¤å¸§çš„å›¾åƒåŠ¨æ€å›¾åƒåˆ‡æ¢å¹¶å­˜ä¸ºgif</title>
    <link href="http://yoursite.com/2019/07/06/%E5%AE%9E%E7%8E%B0%E4%B8%A4%E5%B8%A7%E7%9A%84%E5%9B%BE%E5%83%8F%E5%8A%A8%E6%80%81%E5%9B%BE%E5%83%8F%E5%88%87%E6%8D%A2%E5%B9%B6%E5%AD%98%E4%B8%BAgif/"/>
    <id>http://yoursite.com/2019/07/06/å®ç°ä¸¤å¸§çš„å›¾åƒåŠ¨æ€å›¾åƒåˆ‡æ¢å¹¶å­˜ä¸ºgif/</id>
    <published>2019-07-05T16:31:26.000Z</published>
    <updated>2019-07-05T16:32:25.561Z</updated>
    
    <content type="html"><![CDATA[<p><strong>å®ç°ä»£ç ï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">imageChange</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"><span class="title">s</span> = <span class="title">char</span>(<span class="params"><span class="string">'E:\Desktop\å¤šåª’ä½“æŠ€æœ¯\è¯ºè´å°”.jpg'</span>,<span class="string">'E:\Desktop\å¤šåª’ä½“æŠ€æœ¯\lena.jpg'</span></span>);</span></span><br><span class="line"><span class="function"><span class="title">image</span> = <span class="title">cellstr</span>(<span class="params">s</span>);</span></span><br><span class="line"><span class="function"><span class="title">I1</span> = <span class="title">imread</span>(<span class="params">image&#123;<span class="number">1</span>&#125;</span>);</span></span><br><span class="line"><span class="function"><span class="title">I2</span> = <span class="title">imread</span>(<span class="params">image&#123;<span class="number">2</span>&#125;</span>);</span></span><br><span class="line"><span class="function"><span class="title">I1</span>=<span class="title">im2double</span>(<span class="params">I1</span>);</span></span><br><span class="line"><span class="function"><span class="title">I2</span>=<span class="title">im2double</span>(<span class="params">I2</span>);</span></span><br><span class="line">img = I1(:,:,2); %å°†è¯ºè´å°”å›¾ç‰‡è½¬æ¢ä¸ºå•é€šé“ç°åº¦å›¾ï¼Œè¿™é‡Œä¿ç•™ç»¿è‰²é€šé“</span><br><span class="line">img2 = I2(:,:,<span class="number">1</span>); %å°†lenaå›¾ç‰‡åªä¿ç•™çº¢è‰²é€šé“</span><br><span class="line">[width,height] = size(img);</span><br><span class="line">%è®¾ç½®çª—å£å±æ€§ï¼šç¦ç”¨èœå•æ ï¼Œæ ‡é¢˜ä¸æ˜¾ç¤ºç¼–å·ï¼Œè®¾ç½®position</span><br><span class="line">F = figure(<span class="string">'menubar'</span>,<span class="string">'none'</span>,<span class="string">'NumberTitle'</span>,<span class="string">'off'</span>,<span class="string">'position'</span>,[<span class="number">1000</span> <span class="number">1000</span> width height],<span class="string">'name'</span>,<span class="string">'è§†é¢‘åˆ‡æ¢æ•ˆæœ'</span>);</span><br><span class="line">movegui(F,<span class="string">'center'</span>);%å±…ä¸­</span><br><span class="line">%å…³é—­åæ ‡çº¿</span><br><span class="line">axes(<span class="string">'Visible'</span>,<span class="string">'off'</span>,<span class="string">'units'</span>,<span class="string">'normalized'</span>,<span class="string">'position'</span>,[<span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span>]);</span><br><span class="line">%è®¾ç½®æœ€å¤§çš„åŠå¾„å€¼</span><br><span class="line">R_max = sqrt((width/<span class="number">2</span>)^<span class="number">2</span>+(height/<span class="number">2</span>)^<span class="number">2</span>);</span><br><span class="line">step = <span class="number">30</span>; %è®¾ç½®æ­¥é•¿ï¼Œå³<span class="number">30</span>å¸§</span><br><span class="line">x0 = width/<span class="number">2</span>; y0 = height/<span class="number">2</span>;</span><br><span class="line">pic_num = <span class="number">1</span>;</span><br><span class="line">hIm = imshow(img);</span><br><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>:<span class="number">1</span>:step</span><br><span class="line">%%åœ†çš„åˆ¤æ–­</span><br><span class="line">    <span class="keyword">for</span> x = <span class="number">1</span>:width</span><br><span class="line">        <span class="keyword">for</span> y = <span class="number">1</span>:height</span><br><span class="line">            <span class="keyword">if</span>(sqrt((x-x0)^<span class="number">2</span>+(y-y0)^<span class="number">2</span>) &lt;= i/step*R_max)</span><br><span class="line">               img(x,y) = img2(x,y);</span><br><span class="line">            end</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    <span class="keyword">set</span>(hIm,'CData',img);%è®¾ç½®imageå¯¹è±¡CDataå±æ€§ä¸ºIm</span><br><span class="line">    drawnow ;</span><br><span class="line">    %æ¥ä¸‹æ¥æ˜¯matlabæ ¹æ®æ¯å¸§çª—å£ç”Ÿæˆgifçš„æ¨¡æ¿ï¼Œå¯å¥—ç”¨</span><br><span class="line">    F1=getframe(gcf);</span><br><span class="line">    I=frame2im(F1);</span><br><span class="line">    [I,map]=rgb2ind(I,256);</span><br><span class="line">    if pic_num == 1</span><br><span class="line">        imwrite(I,map,'E:\Desktop\å¤šåª’ä½“æŠ€æœ¯\test.gif','gif', 'Loopcount',inf,'DelayTime',0.2);</span><br><span class="line">    else</span><br><span class="line">        imwrite(I,map,'E:\Desktop\å¤šåª’ä½“æŠ€æœ¯\test.gif','gif','WriteMode','append','DelayTime',0.2);</span><br><span class="line">    end</span><br><span class="line">    pic_num = pic_num + 1;</span><br><span class="line">end</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p><strong>ç”¨äºæµ‹è¯•çš„åŸå›¾ï¼š</strong><br><img src="https://img-blog.csdn.net/20180930195805938?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdn.net/20180930195818225?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>å®ç°æ•ˆæœï¼š</strong><br><img src="https://img-blog.csdn.net/20180930195643900?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;å®ç°ä»£ç ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;li
      
    
    </summary>
    
      <category term="æ•°å­—åª’ä½“æŠ€æœ¯" scheme="http://yoursite.com/categories/%E6%95%B0%E5%AD%97%E5%AA%92%E4%BD%93%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="matlab" scheme="http://yoursite.com/tags/matlab/"/>
    
      <category term="å¤šåª’ä½“æŠ€æœ¯" scheme="http://yoursite.com/tags/%E5%A4%9A%E5%AA%92%E4%BD%93%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>c++æ‹‰æ™®æ‹‰æ–¯ç®—å­é”åŒ–æ»¤æ³¢ä»¥åŠæ ‡å®šå·®åº¦æ–¹æ³•</title>
    <link href="http://yoursite.com/2019/07/06/c-%E6%8B%89%E6%99%AE%E6%8B%89%E6%96%AF%E7%AE%97%E5%AD%90%E9%94%90%E5%8C%96%E6%BB%A4%E6%B3%A2%E4%BB%A5%E5%8F%8A%E6%A0%87%E5%AE%9A%E5%B7%AE%E5%BA%A6%E6%96%B9%E6%B3%95/"/>
    <id>http://yoursite.com/2019/07/06/c-æ‹‰æ™®æ‹‰æ–¯ç®—å­é”åŒ–æ»¤æ³¢ä»¥åŠæ ‡å®šå·®åº¦æ–¹æ³•/</id>
    <published>2019-07-05T16:28:13.000Z</published>
    <updated>2019-07-05T16:29:08.640Z</updated>
    
    <content type="html"><![CDATA[<ul><li>c++ <strong>CImg</strong>åº“</li><li>é‡‡ç”¨æ ‡å®šå’Œä¸ºæ ‡å®šä¸¤ç§å®ç°ç®—æ³•</li></ul><p><strong>æœªæ ‡å®šï¼š</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">CImg&lt;<span class="keyword">int</span>&gt; laplace_filter(CImg&lt;<span class="keyword">int</span>&gt; img) &#123;</span><br><span class="line"><span class="function">MatrixXd <span class="title">m</span><span class="params">(<span class="number">3</span>, <span class="number">3</span>)</span></span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> x = <span class="number">0</span>;x &lt; <span class="number">3</span>; x++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; <span class="number">3</span>; y++) &#123;</span><br><span class="line"><span class="keyword">if</span> (x == <span class="number">1</span> &amp;&amp; y == <span class="number">1</span>) &#123;</span><br><span class="line">m(x, y) = <span class="number">8</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">m(x, y) = <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> x = <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> w = img.width(), h = img.height();</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; pic(w, h, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">pic = img;</span><br><span class="line">pic.resize(w + <span class="number">2</span> , h + <span class="number">2</span> , <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; pic1 = pic;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; temp(w,h,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">cimg_forXY(pic, x, y) &#123;</span><br><span class="line"><span class="keyword">if</span> (x &gt;= <span class="number">1</span> &amp;&amp; y &gt;= <span class="number">1</span> &amp;&amp; x &lt;= w  &amp;&amp; y &lt;= h ) &#123;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; t(<span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">t(i, j) = pic1(x<span class="number">-1</span>+i, y<span class="number">-1</span>+j);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">cimg_forXY(t, i1, j1) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i2 = <span class="number">0</span>; i2 &lt; <span class="number">3</span>; i2++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j2 = <span class="number">0</span>; j2 &lt; <span class="number">3</span>; j2++) &#123;</span><br><span class="line"><span class="keyword">if</span> (i1 + i2 == <span class="number">2</span> &amp;&amp; j1 + j2 == <span class="number">2</span>) &#123;</span><br><span class="line">sum += t(i1, j1)*m(i2, j2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (sum &lt; <span class="number">0</span>)sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (sum &gt; <span class="number">255</span>) sum = <span class="number">255</span>;</span><br><span class="line"><span class="keyword">else</span> sum = sum;</span><br><span class="line">pic(x, y) = sum;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> pic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ ‡å®šï¼š</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">CImg&lt;<span class="keyword">int</span>&gt; laplace_filterbiaoding(CImg&lt;<span class="keyword">int</span>&gt; img) &#123;</span><br><span class="line"><span class="function">MatrixXd <span class="title">m</span><span class="params">(<span class="number">3</span>, <span class="number">3</span>)</span></span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; <span class="number">3</span>; x++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; <span class="number">3</span>; y++) &#123;</span><br><span class="line"><span class="keyword">if</span> (x == <span class="number">1</span> &amp;&amp; y == <span class="number">1</span>) &#123;</span><br><span class="line">m(x, y) = <span class="number">8</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">m(x, y) = <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> x = <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> w = img.width(), h = img.height();</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; pic(w, h, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">pic = img;</span><br><span class="line">pic.resize(w + <span class="number">2</span>, h + <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; pic1 = pic;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; temp(w, h, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">int</span> min = <span class="number">100000</span>;</span><br><span class="line">cimg_forXY(pic, x, y) &#123;</span><br><span class="line"><span class="keyword">if</span> (x &gt;= <span class="number">1</span> &amp;&amp; y &gt;= <span class="number">1</span> &amp;&amp; x &lt;= w &amp;&amp; y &lt;= h) &#123;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; t(<span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">t(i, j) = pic1(x - <span class="number">1</span> + i, y - <span class="number">1</span> + j);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">cimg_forXY(t, i1, j1) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i2 = <span class="number">0</span>; i2 &lt; <span class="number">3</span>; i2++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j2 = <span class="number">0</span>; j2 &lt; <span class="number">3</span>; j2++) &#123;</span><br><span class="line"><span class="keyword">if</span> (i1 + i2 == <span class="number">2</span> &amp;&amp; j1 + j2 == <span class="number">2</span>) &#123;</span><br><span class="line">sum += t(i1, j1)*m(i2, j2);</span><br><span class="line"><span class="keyword">if</span> (sum &lt; min) min = sum;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">pic(x, y) = sum;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">cimg_forXY(pic, x, y) &#123;</span><br><span class="line"><span class="comment">//cout &lt;&lt; pic(x, y) &lt;&lt;" ";</span></span><br><span class="line">pic(x, y) -= min;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> max = <span class="number">-1</span>;</span><br><span class="line">cimg_forXY(pic, x, y) &#123;</span><br><span class="line"><span class="keyword">if</span> (pic(x, y) &gt; max)</span><br><span class="line">max = pic(x, y);</span><br><span class="line">&#125;</span><br><span class="line">cimg_forXY(pic, x, y) &#123;</span><br><span class="line">pic(x, y) = pic(x, y) * <span class="number">255</span> / max;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> pic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œé¡ºä¾¿è¯´ä¸€ä¸‹å¸¸ç”¨çš„æ ‡å®šæ–¹æ³•æœ‰ä¸¤ç§ï¼š</strong></p><ul><li><p>æ–¹æ³•ä¸€ï¼š<br>å¯¹æ¯ä¸€ä¸ªåƒç´ å€¼å†åŠ ä¸Š255ï¼Œç„¶åé™¤ä»¥2ã€‚è¯¥æ–¹æ³•æ— æ³•ä¿è¯åƒç´ çš„å–å€¼å¯ä»¥è¦†ç›–0åˆ°255çš„å…¨éƒ¨8æ¯”ç‰¹èŒƒå›´ï¼Œä½†æ˜¯æ‰€æœ‰çš„åƒç´ ä¸€å®šåœ¨è¿™ä¸€èŒƒå›´ã€‚å¦å¤–ï¼Œåœ¨é™¤ä»¥2è¿‡ç¨‹ä¸­å›ºæœ‰çš„æˆªå°¾è¯¯å·®é€šå¸¸å°†å¯¼è‡´ç²¾ç¡®åº¦çš„æŸå¤±ã€‚è™½ç„¶æœ‰å¾ˆå¤šçš„ä¸è¶³ï¼Œä½†æ˜¯è¯¥éå¸¸çš„ç®€å•æ–¹ä¾¿ã€‚</p></li><li><p>æ–¹æ³•äºŒï¼š<br>è¯¥æ–¹æ³•å¼¥è¡¥çš„æ–¹æ³•ä¸€çš„ç¼ºç‚¹ï¼Œå®ƒå¯ä»¥å¾—åˆ°æ›´é«˜çš„ç²¾ç¡®åº¦å¹¶ä½¿åƒç´ å–å€¼è¦†ç›–æ•´ä¸ª8æ¯”ç‰¹çš„èŒƒå›´ã€‚æˆ‘ä»¬é¦–å…ˆæå–æœ€å°å€¼ï¼Œå¹¶æŠŠå®ƒçš„è´Ÿå€¼åŠ åˆ°æ‰€æœ‰çš„å·®å€¼å›¾åƒçš„åƒç´ ä¸­ï¼ˆå¦‚æœæœ€å°å€¼æ˜¯-a(a&gt;0)ï¼Œåˆ™åŠ ä¸Šaï¼›å¦‚æœæœ€å°å€¼æ˜¯aï¼Œåˆ™å‡å»aï¼›é€šè¿‡è¯¥æ“ä½œåï¼Œå·®å€¼å›¾åƒä¸­æœ€å°çš„å€¼å°±ä¸º0äº†ï¼‰ã€‚ä¹‹åï¼Œæ¯ä¸€ä¸ªåƒç´ ä¹˜ä»¥255/Maxï¼Œå…¶ä¸­Maxä¸ºä¸Šä¸€æ­¥æ“ä½œä¹‹åå›¾åƒçš„ä¸­æœ€å¤§åƒç´ å€¼ï¼Œè¿™æ ·å°±å°†æ‰€æœ‰çš„åƒç´ æ ‡å®šåˆ°0åˆ°255çš„èŒƒå›´å†…ã€‚</p></li></ul><p><strong>è¿è¡Œç»“æœï¼š</strong></p><p><img src="https://img-blog.csdn.net/2018092911252817?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="æœªæ ‡å®š"></p><p><img src="https://img-blog.csdn.net/20180929112622526?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>åŸå›¾ï¼š</strong><br><img src="https://img-blog.csdn.net/20180929114017796?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>ä¸åŸå›¾åŠ åˆ°ä¸€èµ·åå¤„ç†çš„æ•ˆæœï¼š</strong><br><img src="https://img-blog.csdn.net/20180929113951368?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>æ•ˆæœæ˜¯ä¸æ˜¯ç‰¹åˆ«æ£’æ£’ï¼ï¼ï¼</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;c++ &lt;strong&gt;CImg&lt;/strong&gt;åº“&lt;/li&gt;
&lt;li&gt;é‡‡ç”¨æ ‡å®šå’Œä¸ºæ ‡å®šä¸¤ç§å®ç°ç®—æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æœªæ ‡å®šï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr
      
    
    </summary>
    
      <category term="æ•°å­—å›¾åƒå¤„ç†" scheme="http://yoursite.com/categories/%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="æ•°å­—å›¾åƒå¤„ç†" scheme="http://yoursite.com/tags/%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>c++å®ç°å¹³æ»‘ç©ºé—´æ»¤æ³¢</title>
    <link href="http://yoursite.com/2019/07/06/c-%E5%AE%9E%E7%8E%B0%E5%B9%B3%E6%BB%91%E7%A9%BA%E9%97%B4%E6%BB%A4%E6%B3%A2/"/>
    <id>http://yoursite.com/2019/07/06/c-å®ç°å¹³æ»‘ç©ºé—´æ»¤æ³¢/</id>
    <published>2019-07-05T16:26:45.000Z</published>
    <updated>2019-07-05T16:27:27.101Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-å¹³æ»‘çº¿æ€§æ»¤æ³¢å™¨ï¼š"><a href="#1-å¹³æ»‘çº¿æ€§æ»¤æ³¢å™¨ï¼š" class="headerlink" title="1.å¹³æ»‘çº¿æ€§æ»¤æ³¢å™¨ï¼š"></a>1.å¹³æ»‘çº¿æ€§æ»¤æ³¢å™¨ï¼š</h3><p><strong>è‡ªå·±å®ç°äº†ç”¨äºç©ºé—´å¹³æ»‘æ»¤æ³¢çš„å‡½æ•°ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">CImg&lt;<span class="keyword">int</span>&gt; Smooth_filter(CImg&lt;<span class="keyword">int</span>&gt; img, <span class="keyword">int</span> num) &#123;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; m(num, num);</span><br><span class="line">cimg_forXY(m, x, y) &#123;</span><br><span class="line">m(x, y) = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> w = img.width(), h = img.height();</span><br><span class="line"><span class="keyword">int</span> k = (num - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; pic(w, h, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">pic = img;</span><br><span class="line">pic.resize(w + <span class="number">2</span> * k, h + <span class="number">2</span> * k, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; pic1 = pic;</span><br><span class="line"><span class="keyword">if</span> (num % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"ä¸åˆæ³•"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; temp(w,h,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">cimg_forXY(pic, x, y) &#123;</span><br><span class="line"><span class="keyword">if</span> (x &gt;= k &amp;&amp; y &gt;= k &amp;&amp; x &lt;= w + k - <span class="number">1</span> &amp;&amp; y &lt;= h + k - <span class="number">1</span>) &#123;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; t(num, num);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; num; j++) &#123;</span><br><span class="line">t(i, j) = pic1(x-k+i, y-k+j);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">double</span> sum = <span class="number">0.0</span>;</span><br><span class="line">cimg_forXY(t, i1, j1) &#123;</span><br><span class="line">cimg_forXY(m, i2, j2) &#123;</span><br><span class="line"><span class="keyword">if</span> (i1 + i2 - k == <span class="number">1</span> &amp;&amp; j1 + j2 - k == <span class="number">1</span>) &#123;</span><br><span class="line">sum += (<span class="keyword">double</span>)t(i1, j1)*m(i2, j2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">pic(x, y) = sum / num / num;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> pic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨3*3çš„çŸ©é˜µè¿›è¡Œå¹³æ»‘æ»¤æ³¢åçš„æ•ˆæœï¼š</strong></p><p><img src="https://img-blog.csdn.net/20180928105513507?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdn.net/20180928105545944?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="2-ä¸­å€¼æ»¤æ³¢å™¨ï¼š"><a href="#2-ä¸­å€¼æ»¤æ³¢å™¨ï¼š" class="headerlink" title="2.ä¸­å€¼æ»¤æ³¢å™¨ï¼š"></a>2.ä¸­å€¼æ»¤æ³¢å™¨ï¼š</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">CImg&lt;<span class="keyword">int</span>&gt; median_filter(CImg&lt;<span class="keyword">int</span>&gt; img, <span class="keyword">int</span> num) &#123;</span><br><span class="line"><span class="keyword">int</span> w = img.width(), h = img.height();</span><br><span class="line"><span class="keyword">int</span> k = (num - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; pic(w, h, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">pic = img;</span><br><span class="line">pic.resize(w + <span class="number">2</span> * k, h + <span class="number">2</span> * k, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; pic1 = pic;</span><br><span class="line"><span class="keyword">if</span> (num % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"ä¸åˆæ³•"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; temp(w, h, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">cimg_forXY(pic, x, y) &#123;</span><br><span class="line"><span class="keyword">if</span> (x &gt;= k &amp;&amp; y &gt;= k &amp;&amp; x &lt;= w + k - <span class="number">1</span> &amp;&amp; y &lt;= h + k - <span class="number">1</span>) &#123;</span><br><span class="line">CImg&lt;<span class="keyword">int</span>&gt; t(num, num);</span><br><span class="line"><span class="keyword">int</span> a = num * num;</span><br><span class="line"><span class="keyword">int</span> *filter;</span><br><span class="line">filter = <span class="keyword">new</span> <span class="keyword">int</span>[a];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; num; j++) &#123;</span><br><span class="line">t(i, j) = pic1(x - k + i, y - k + j);</span><br><span class="line">filter[i*num + j] = t(i, j);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">sort(filter,filter+a);</span><br><span class="line">pic(x, y) = filter[(a + <span class="number">1</span>) / <span class="number">2</span> - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> pic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨3*3ä¸­å€¼æ»¤æ³¢å™¨çš„æ»¤æ³¢æ•ˆæœï¼š</strong><br><img src="https://img-blog.csdn.net/2018092811410825?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>ä½¿ç”¨CImgå°è£…çš„ä¸­å€¼æ»¤æ³¢å™¨æ£€éªŒä¸€ä¸‹æ•ˆæœâ€”blur_median</strong><br><img src="https://img-blog.csdn.net/20180928115744805?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlcnJ5MDUyOA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;1-å¹³æ»‘çº¿æ€§æ»¤æ³¢å™¨ï¼š&quot;&gt;&lt;a href=&quot;#1-å¹³æ»‘çº¿æ€§æ»¤æ³¢å™¨ï¼š&quot; class=&quot;headerlink&quot; title=&quot;1.å¹³æ»‘çº¿æ€§æ»¤æ³¢å™¨ï¼š&quot;&gt;&lt;/a&gt;1.å¹³æ»‘çº¿æ€§æ»¤æ³¢å™¨ï¼š&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;è‡ªå·±å®ç°äº†ç”¨äºç©ºé—´å¹³æ»‘æ»¤æ³¢çš„å‡½æ•°ï¼š&lt;/strong&gt;&lt;/p&gt;
      
    
    </summary>
    
      <category term="æ•°å­—å›¾åƒå¤„ç†" scheme="http://yoursite.com/categories/%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/"/>
    
    
      <category term="c++" scheme="http://yoursite.com/tags/c/"/>
    
      <category term="æ•°å­—å›¾åƒå¤„ç†" scheme="http://yoursite.com/tags/%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
</feed>
